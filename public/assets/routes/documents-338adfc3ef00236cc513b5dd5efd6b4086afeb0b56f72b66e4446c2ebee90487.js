var Lorem;!function(){Lorem=function(){this.type=null,this.query=null,this.data=null},Lorem.IMAGE=1,Lorem.TEXT=2,Lorem.TYPE={PARAGRAPH:1,SENTENCE:2,WORD:3},Lorem.WORDS=["lorem","ipsum","dolor","sit","amet,","consectetur","adipiscing","elit","ut","aliquam,","purus","sit","amet","luctus","venenatis,","lectus","magna","fringilla","urna,","porttitor","rhoncus","dolor","purus","non","enim","praesent","elementum","facilisis","leo,","vel","fringilla","est","ullamcorper","eget","nulla","facilisi","etiam","dignissim","diam","quis","enim","lobortis","scelerisque","fermentum","dui","faucibus","in","ornare","quam","viverra","orci","sagittis","eu","volutpat","odio","facilisis","mauris","sit","amet","massa","vitae","tortor","condimentum","lacinia","quis","vel","eros","donec","ac","odio","tempor","orci","dapibus","ultrices","in","iaculis","nunc","sed","augue","lacus,","viverra","vitae","congue","eu,","consequat","ac","felis","donec","et","odio","pellentesque","diam","volutpat","commodo","sed","egestas","egestas","fringilla","phasellus","faucibus","scelerisque","eleifend","donec","pretium","vulputate","sapien","nec","sagittis","aliquam","malesuada","bibendum","arcu","vitae","elementum","curabitur","vitae","nunc","sed","velit","dignissim","sodales","ut","eu","sem","integer","vitae","justo","eget","magna","fermentum","iaculis","eu","non","diam","phasellus","vestibulum","lorem","sed","risus","ultricies","tristique","nulla","aliquet","enim","tortor,","at","auctor","urna","nunc","id","cursus","metus","aliquam","eleifend","mi","in","nulla","posuere","sollicitudin","aliquam","ultrices","sagittis","orci,","a","scelerisque","purus","semper","eget","duis","at","tellus","at","urna","condimentum","mattis","pellentesque","id","nibh","tortor,","id","aliquet","lectus","proin","nibh","nisl,","condimentum","id","venenatis","a,","condimentum","vitae","sapien","pellentesque","habitant","morbi","tristique","senectus","et","netus","et","malesuada","fames","ac","turpis","egestas","sed","tempus,","urna","et","pharetra","pharetra,","massa","massa","ultricies","mi,","quis","hendrerit","dolor","magna","eget","est","lorem","ipsum","dolor","sit","amet,","consectetur","adipiscing","elit","pellentesque","habitant","morbi","tristique","senectus","et","netus","et","malesuada","fames","ac","turpis","egestas","integer","eget","aliquet","nibh","praesent","tristique","magna","sit","amet","purus","gravida","quis","blandit","turpis","cursus","in","hac","habitasse","platea","dictumst","quisque","sagittis,","purus","sit","amet","volutpat","consequat,","mauris","nunc","congue","nisi,","vitae","suscipit","tellus","mauris","a","diam","maecenas","sed","enim","ut","sem","viverra","aliquet","eget","sit","amet","tellus","cras","adipiscing","enim","eu","turpis","egestas","pretium","aenean","pharetra,","magna","ac","placerat","vestibulum,","lectus","mauris","ultrices","eros,","in","cursus","turpis","massa","tincidunt","dui","ut","ornare","lectus","sit","amet","est","placerat","in","egestas","erat","imperdiet","sed","euismod","nisi","porta","lorem","mollis","aliquam","ut","porttitor","leo","a","diam","sollicitudin","tempor","id","eu","nisl","nunc","mi","ipsum,","faucibus","vitae","aliquet","nec,","ullamcorper","sit","amet","risus","nullam","eget","felis","eget","nunc","lobortis","mattis","aliquam","faucibus","purus","in","massa","tempor","nec","feugiat","nisl","pretium","fusce","id","velit","ut","tortor","pretium","viverra","suspendisse","potenti","nullam","ac","tortor","vitae","purus","faucibus","ornare","suspendisse","sed","nisi","lacus,","sed","viverra","tellus","in","hac","habitasse","platea","dictumst","vestibulum","rhoncus","est","pellentesque","elit","ullamcorper","dignissim","cras","tincidunt","lobortis","feugiat","vivamus","at","augue","eget","arcu","dictum","varius","duis","at","consectetur","lorem","donec","massa","sapien,","faucibus","et","molestie","ac,","feugiat","sed","lectus","vestibulum","mattis","ullamcorper","velit","sed","ullamcorper","morbi","tincidunt","ornare","massa,","eget","egestas","purus","viverra","accumsan","in","nisl","nisi,","scelerisque","eu","ultrices","vitae,","auctor","eu","augue","ut","lectus","arcu,","bibendum","at","varius","vel,","pharetra","vel","turpis","nunc","eget","lorem","dolor,","sed","viverra","ipsum","nunc","aliquet","bibendum","enim,","facilisis","gravida","neque","convallis","a","cras","semper","auctor","neque,","vitae","tempus","quam","pellentesque","nec","nam","aliquam","sem","et","tortor","consequat","id","porta","nibh","venenatis","cras","sed","felis","eget","velit","aliquet","sagittis","id","consectetur","purus","ut","faucibus","pulvinar","elementum","integer","enim","neque,","volutpat","ac","tincidunt","vitae,","semper","quis","lectus","nulla","at","volutpat","diam","ut","venenatis","tellus","in","metus","vulputate","eu","scelerisque","felis","imperdiet","proin","fermentum","leo","vel","orci","porta","non","pulvinar","neque","laoreet","suspendisse","interdum","consectetur","libero,","id","faucibus","nisl","tincidunt","eget","nullam","non","nisi","est,","sit","amet","facilisis","magna","etiam","tempor,","orci","eu","lobortis","elementum,","nibh","tellus","molestie","nunc,","non","blandit","massa","enim","nec","dui","nunc","mattis","enim","ut","tellus","elementum","sagittis","vitae","et","leo","duis","ut","diam","quam","nulla","porttitor","massa","id","neque","aliquam","vestibulum","morbi","blandit","cursus","risus,","at","ultrices","mi","tempus","imperdiet","nulla","malesuada","pellentesque","elit","eget","gravida","cum","sociis","natoque","penatibus","et","magnis","dis","parturient","montes,","nascetur","ridiculus","mus","mauris","vitae","ultricies","leo","integer","malesuada","nunc","vel","risus","commodo","viverra","maecenas","accumsan,","lacus","vel","facilisis","volutpat,","est","velit","egestas","dui,","id","ornare","arcu","odio","ut","sem","nulla","pharetra","diam","sit","amet","nisl","suscipit","adipiscing","bibendum","est","ultricies","integer","quis","auctor","elit","sed","vulputate","mi","sit","amet","mauris","commodo","quis","imperdiet","massa","tincidunt","nunc","pulvinar","sapien","et","ligula","ullamcorper","malesuada","proin","libero","nunc,","consequat","interdum","varius","sit","amet,","mattis","vulputate","enim","nulla","aliquet","porttitor","lacus,","luctus","accumsan","tortor","posuere","ac","ut","consequat","semper","viverra","nam","libero","justo,","laoreet","sit","amet","cursus","sit","amet,","dictum","sit","amet","justo","donec","enim","diam,","vulputate","ut","pharetra","sit","amet,","aliquam","id","diam","maecenas","ultricies","mi","eget","mauris","pharetra","et","ultrices","neque","ornare","aenean","euismod","elementum","nisi,","quis","eleifend","quam","adipiscing","vitae","proin","sagittis,","nisl","rhoncus","mattis","rhoncus,","urna","neque","viverra","justo,","nec","ultrices","dui","sapien","eget","mi","proin","sed","libero","enim,","sed","faucibus","turpis","in","eu","mi","bibendum","neque","egestas","congue","quisque","egestas","diam","in","arcu","cursus","euismod","quis","viverra","nibh","cras","pulvinar","mattis","nunc,","sed","blandit","libero","volutpat","sed","cras","ornare","arcu","dui","vivamus","arcu","felis,","bibendum","ut","tristique","et,","egestas","quis","ipsum","suspendisse","ultrices","gravida","dictum","fusce","ut","placerat","orci","nulla","pellentesque","dignissim","enim,","sit","amet","venenatis","urna","cursus","eget","nunc","scelerisque","viverra","mauris,","in","aliquam","sem","fringilla","ut","morbi","tincidunt","augue","interdum","velit","euismod","in","pellentesque","massa","placerat","duis","ultricies","lacus","sed","turpis","tincidunt","id","aliquet","risus","feugiat","in","ante","metus,","dictum","at","tempor","commodo,","ullamcorper","a","lacus","vestibulum","sed","arcu","non","odio","euismod","lacinia","at","quis","risus","sed","vulputate","odio","ut","enim","blandit","volutpat","maecenas","volutpat","blandit","aliquam","etiam","erat","velit,","scelerisque","in","dictum","non,","consectetur","a","erat","nam","at","lectus","urna","duis","convallis","convallis","tellus,","id","interdum","velit","laoreet","id","donec","ultrices","tincidunt","arcu,","non","sodales","neque","sodales","ut","etiam","sit","amet","nisl","purus,","in","mollis","nunc","sed","id","semper","risus","in","hendrerit","gravida","rutrum","quisque","non","tellus","orci,","ac","auctor","augue","mauris","augue","neque,","gravida","in","fermentum","et,","sollicitudin","ac","orci","phasellus","egestas","tellus","rutrum","tellus","pellentesque","eu","tincidunt","tortor","aliquam","nulla","facilisi","cras","fermentum,","odio","eu","feugiat","pretium,","nibh","ipsum","consequat","nisl,","vel","pretium","lectus","quam","id","leo","in","vitae","turpis","massa","sed","elementum","tempus","egestas","sed","sed","risus","pretium","quam","vulputate","dignissim","suspendisse","in","est","ante","in","nibh","mauris,","cursus","mattis","molestie","a,","iaculis","at","erat","pellentesque","adipiscing","commodo","elit,","at","imperdiet","dui","accumsan","sit","amet","nulla","facilisi","morbi","tempus","iaculis","urna,","id","volutpat","lacus","laoreet","non","curabitur","gravida","arcu","ac","tortor","dignissim","convallis","aenean","et","tortor","at","risus","viverra","adipiscing","at","in","tellus","integer","feugiat","scelerisque","varius","morbi","enim","nunc,","faucibus","a","pellentesque","sit","amet,","porttitor","eget","dolor","morbi","non","arcu","risus,","quis","varius","quam","quisque","id","diam","vel","quam","elementum","pulvinar","etiam","non","quam","lacus","suspendisse","faucibus","interdum","posuere","lorem","ipsum","dolor","sit","amet,","consectetur","adipiscing","elit","duis","tristique","sollicitudin","nibh","sit","amet","commodo","nulla","facilisi","nullam","vehicula","ipsum","a","arcu","cursus","vitae","congue","mauris","rhoncus","aenean","vel","elit","scelerisque","mauris","pellentesque","pulvinar","pellentesque","habitant","morbi","tristique","senectus","et","netus","et","malesuada","fames","ac","turpis","egestas","maecenas","pharetra","convallis","posuere","morbi","leo","urna,","molestie","at","elementum","eu,","facilisis","sed","odio","morbi","quis","commodo","odio","aenean","sed","adipiscing","diam","donec","adipiscing","tristique","risus","nec","feugiat","in","fermentum","posuere","urna","nec","tincidunt","praesent","semper","feugiat","nibh","sed","pulvinar","proin","gravida","hendrerit","lectus","a","molestie"],Lorem.prototype.randomInt=function(t,e){return Math.floor(Math.random()*(e-t+1))+t},Lorem.prototype.createText=function(t,e){switch(e){case Lorem.TYPE.PARAGRAPH:for(var i=new Array,s=0;t>s;s++){var r=this.randomInt(10,20),a=this.createText(r,Lorem.TYPE.SENTENCE);i.push("<p>"+a+"</p>")}return i.join("\n");case Lorem.TYPE.SENTENCE:for(var n=new Array,s=0;t>s;s++){var o=this.randomInt(5,10),l=this.createText(o,Lorem.TYPE.WORD).split(" ");l[0]=l[0].substr(0,1).toUpperCase()+l[0].substr(1);var u=l.join(" ");n.push(u)}return(n.join(". ")+".").replace(/(\.\,|\,\.)/g,".");case Lorem.TYPE.WORD:var p=this.randomInt(0,Lorem.WORDS.length-t-1);return Lorem.WORDS.slice(p,p+t).join(" ").replace(/\.|\,/g,"")}},Lorem.prototype.createLorem=function(t){var e,i=new Array;if(/\d+-\d+[psw]/.test(this.query)){var s=this.query.replace(/[a-z]/,"").split("-");e=Math.floor(Math.random()*parseInt(s[1]))+parseInt(s[0])}else e=parseInt(this.query);if(/\d+p/.test(this.query))var r=Lorem.TYPE.PARAGRAPH;else if(/\d+s/.test(this.query))var r=Lorem.TYPE.SENTENCE;else if(/\d+w/.test(this.query))var r=Lorem.TYPE.WORD;if(i.push(this.createText(e,r)),i=i.join(" "),t)if(this.type==Lorem.TEXT)t.innerHTML+=i;else if(this.type==Lorem.IMAGE){var a="",n=this.query.split(" ");"gray"==n[0]&&(a+="/g",n[0]=""),t.getAttribute("width")&&(a+="/"+t.getAttribute("width")),t.getAttribute("height")&&(a+="/"+t.getAttribute("height")),a+="/"+n.join(" ").replace(/(^\s+|\s+$)/,""),t.src="http://lorempixum.com"+a.replace(/\/\//,"/")}return null==t?i:void 0},"undefined"!=typeof jQuery&&!function(t){t.fn.lorem=function(){t(this).each(function(){var e=new Lorem;e.type=t(this).is("img")?Lorem.IMAGE:Lorem.TEXT,e.query=t(this).data("lorem"),e.createLorem(this)})},t(document).ready(function(){t("[data-lorem]").lorem()})}(jQuery)}(),define("lorem",function(t){return function(){var e;return e||t.Lorem}}(this)),function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define("jsyaml",[],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.jsyaml=t()}}(function(){return function t(e,i,s){function r(n,o){if(!i[n]){if(!e[n]){var l="function"==typeof require&&require;if(!o&&l)return l(n,!0);if(a)return a(n,!0);var u=new Error("Cannot find module '"+n+"'");throw u.code="MODULE_NOT_FOUND",u}var p=i[n]={exports:{}};e[n][0].call(p.exports,function(t){var i=e[n][1][t];return r(i?i:t)},p,p.exports,t,e,i,s)}return i[n].exports}for(var a="function"==typeof require&&require,n=0;n<s.length;n++)r(s[n]);return r}({1:[function(t,e){"use strict";function i(t){return function(){throw new Error("Function "+t+" is deprecated and cannot be used.")}}var s=t("./js-yaml/loader"),r=t("./js-yaml/dumper");e.exports.Type=t("./js-yaml/type"),e.exports.Schema=t("./js-yaml/schema"),e.exports.FAILSAFE_SCHEMA=t("./js-yaml/schema/failsafe"),e.exports.JSON_SCHEMA=t("./js-yaml/schema/json"),e.exports.CORE_SCHEMA=t("./js-yaml/schema/core"),e.exports.DEFAULT_SAFE_SCHEMA=t("./js-yaml/schema/default_safe"),e.exports.DEFAULT_FULL_SCHEMA=t("./js-yaml/schema/default_full"),e.exports.load=s.load,e.exports.loadAll=s.loadAll,e.exports.safeLoad=s.safeLoad,e.exports.safeLoadAll=s.safeLoadAll,e.exports.dump=r.dump,e.exports.safeDump=r.safeDump,e.exports.YAMLException=t("./js-yaml/exception"),e.exports.MINIMAL_SCHEMA=t("./js-yaml/schema/failsafe"),e.exports.SAFE_SCHEMA=t("./js-yaml/schema/default_safe"),e.exports.DEFAULT_SCHEMA=t("./js-yaml/schema/default_full"),e.exports.scan=i("scan"),e.exports.parse=i("parse"),e.exports.compose=i("compose"),e.exports.addConstructor=i("addConstructor")},{"./js-yaml/dumper":3,"./js-yaml/exception":4,"./js-yaml/loader":5,"./js-yaml/schema":7,"./js-yaml/schema/core":8,"./js-yaml/schema/default_full":9,"./js-yaml/schema/default_safe":10,"./js-yaml/schema/failsafe":11,"./js-yaml/schema/json":12,"./js-yaml/type":13}],2:[function(t,e){"use strict";function i(t){return"undefined"==typeof t||null===t}function s(t){return"object"==typeof t&&null!==t}function r(t){return Array.isArray(t)?t:i(t)?[]:[t]}function a(t,e){var i,s,r,a;if(e)for(a=Object.keys(e),i=0,s=a.length;s>i;i+=1)r=a[i],t[r]=e[r];return t}function n(t,e){var i,s="";for(i=0;e>i;i+=1)s+=t;return s}function o(t){return 0===t&&Number.NEGATIVE_INFINITY===1/t}e.exports.isNothing=i,e.exports.isObject=s,e.exports.toArray=r,e.exports.repeat=n,e.exports.isNegativeZero=o,e.exports.extend=a},{}],3:[function(t,e){"use strict";function i(t,e){var i,s,r,a,n,o,l;if(null===e)return{};for(i={},s=Object.keys(e),r=0,a=s.length;a>r;r+=1)n=s[r],o=String(e[n]),"!!"===n.slice(0,2)&&(n="tag:yaml.org,2002:"+n.slice(2)),l=t.compiledTypeMap[n],l&&w.call(l.styleAliases,o)&&(o=l.styleAliases[o]),i[n]=o;return i}function s(t){var e,i,s;if(e=t.toString(16).toUpperCase(),255>=t)i="x",s=2;else if(65535>=t)i="u",s=4;else{if(!(4294967295>=t))throw new O("code point within a string may not be greater than 0xFFFFFFFF");i="U",s=8}return"\\"+i+S.repeat("0",s-e.length)+e}function r(t){this.schema=t.schema||E,this.indent=Math.max(1,t.indent||2),this.skipInvalid=t.skipInvalid||!1,this.flowLevel=S.isNothing(t.flowLevel)?-1:t.flowLevel,this.styleMap=i(this.schema,t.styles||null),this.sortKeys=t.sortKeys||!1,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function a(t,e){for(var i,s=S.repeat(" ",e),r=0,a=-1,n="",o=t.length;o>r;)a=t.indexOf("\n",r),-1===a?(i=t.slice(r),r=o):(i=t.slice(r,a+1),r=a+1),i.length&&"\n"!==i&&(n+=s),n+=i;return n}function n(t,e){return"\n"+S.repeat(" ",t.indent*e)}function o(t,e){var i,s,r;for(i=0,s=t.implicitTypes.length;s>i;i+=1)if(r=t.implicitTypes[i],r.resolve(e))return!0;return!1}function l(t){this.source=t,this.result="",this.checkpoint=0}function u(t,e,i){var s,r,n,u,h,f,d,g,b,y,v,_,x,A,I,S,O,E,k,T,w;if(0===e.length)return void(t.dump="''");if(-1!==te.indexOf(e))return void(t.dump="'"+e+"'");for(s=!0,r=e.length?e.charCodeAt(0):0,n=L===r||L===e.charCodeAt(e.length-1),(z===r||X===r||H===r||Q===r)&&(s=!1),n?(s=!1,u=!1,h=!1):(u=!0,h=!0),f=!0,d=new l(e),g=!1,b=0,y=0,v=t.indent*i,_=80,40>v?_-=v:_=40,A=0;A<e.length;A++){if(x=e.charCodeAt(A),s){if(c(x))continue;s=!1}f&&x===B&&(f=!1),I=Z[x],S=m(x),(I||S)&&(x!==C&&x!==D&&x!==B?(u=!1,h=!1):x===C&&(g=!0,f=!1,A>0&&(O=e.charCodeAt(A-1),O===L&&(h=!1,u=!1)),u&&(E=A-b,b=A,E>y&&(y=E))),x!==D&&(f=!1),d.takeUpTo(A),d.escapeChar())}if(s&&o(t,e)&&(s=!1),k="",(u||h)&&(T=0,e.charCodeAt(e.length-1)===C&&(T+=1,e.charCodeAt(e.length-2)===C&&(T+=1)),0===T?k="-":2===T&&(k="+")),h&&_>y&&(u=!1),g||(h=!1),s)t.dump=e;else if(f)t.dump="'"+e+"'";else if(u)w=p(e,_),t.dump=">"+k+"\n"+a(w,v);else if(h)k||(e=e.replace(/\n$/,"")),t.dump="|"+k+"\n"+a(e,v);else{if(!d)throw new Error("Failed to dump scalar value");d.finish(),t.dump='"'+d.result+'"'}}function p(t,e){var i,s="",r=0,a=t.length,n=/\n+$/.exec(t);for(n&&(a=n.index+1);a>r;)i=t.indexOf("\n",r),i>a||-1===i?(s&&(s+="\n\n"),s+=h(t.slice(r,a),e),r=a):(s&&(s+="\n\n"),s+=h(t.slice(r,i),e),r=i+1);return n&&"\n"!==n[0]&&(s+=n[0]),s}function h(t,e){if(""===t)return t;for(var i,s,r,a=/[^\s] [^\s]/g,n="",o=0,l=0,u=a.exec(t);u;)i=u.index,i-l>e&&(s=o!==l?o:i,n&&(n+="\n"),r=t.slice(l,s),n+=r,l=s+1),o=i+1,u=a.exec(t);return n&&(n+="\n"),n+=l!==o&&t.length-l>e?t.slice(l,o)+"\n"+t.slice(o+1):t.slice(l)}function c(t){return N!==t&&C!==t&&R!==t&&F!==t&&$!==t&&W!==t&&K!==t&&J!==t&&P!==t&&U!==t&&M!==t&&j!==t&&Y!==t&&V!==t&&B!==t&&D!==t&&q!==t&&G!==t&&!Z[t]&&!m(t)}function m(t){return!(t>=32&&126>=t||133===t||t>=160&&55295>=t||t>=57344&&65533>=t||t>=65536&&1114111>=t)}function f(t,e,i){var s,r,a="",n=t.tag;for(s=0,r=i.length;r>s;s+=1)v(t,e,i[s],!1,!1)&&(0!==s&&(a+=", "),a+=t.dump);t.tag=n,t.dump="["+a+"]"}function d(t,e,i,s){var r,a,o="",l=t.tag;for(r=0,a=i.length;a>r;r+=1)v(t,e+1,i[r],!0,!0)&&(s&&0===r||(o+=n(t,e)),o+="- "+t.dump);t.tag=l,t.dump=o||"[]"}function g(t,e,i){var s,r,a,n,o,l="",u=t.tag,p=Object.keys(i);for(s=0,r=p.length;r>s;s+=1)o="",0!==s&&(o+=", "),a=p[s],n=i[a],v(t,e,a,!1,!1)&&(t.dump.length>1024&&(o+="? "),o+=t.dump+": ",v(t,e,n,!1,!1)&&(o+=t.dump,l+=o));t.tag=u,t.dump="{"+l+"}"}function b(t,e,i,s){var r,a,o,l,u,p,h="",c=t.tag,m=Object.keys(i);if(t.sortKeys===!0)m.sort();else if("function"==typeof t.sortKeys)m.sort(t.sortKeys);else if(t.sortKeys)throw new O("sortKeys must be a boolean or a function");for(r=0,a=m.length;a>r;r+=1)p="",s&&0===r||(p+=n(t,e)),o=m[r],l=i[o],v(t,e+1,o,!0,!0)&&(u=null!==t.tag&&"?"!==t.tag||t.dump&&t.dump.length>1024,u&&(p+=t.dump&&C===t.dump.charCodeAt(0)?"?":"? "),p+=t.dump,u&&(p+=n(t,e)),v(t,e+1,l,!0,u)&&(p+=t.dump&&C===t.dump.charCodeAt(0)?":":": ",p+=t.dump,h+=p));t.tag=c,t.dump=h||"{}"}function y(t,e,i){var s,r,a,n,o,l;for(r=i?t.explicitTypes:t.implicitTypes,a=0,n=r.length;n>a;a+=1)if(o=r[a],(o.instanceOf||o.predicate)&&(!o.instanceOf||"object"==typeof e&&e instanceof o.instanceOf)&&(!o.predicate||o.predicate(e))){if(t.tag=i?o.tag:"?",o.represent){if(l=t.styleMap[o.tag]||o.defaultStyle,"[object Function]"===T.call(o.represent))s=o.represent(e,l);else{if(!w.call(o.represent,l))throw new O("!<"+o.tag+'> tag resolver accepts not "'+l+'" style');s=o.represent[l](e,l)}t.dump=s}return!0}return!1}function v(t,e,i,s,r){t.tag=null,t.dump=i,y(t,i,!1)||y(t,i,!0);var a=T.call(t.dump);s&&(s=0>t.flowLevel||t.flowLevel>e),(null!==t.tag&&"?"!==t.tag||2!==t.indent&&e>0)&&(r=!1);var n,o,l="[object Object]"===a||"[object Array]"===a;if(l&&(n=t.duplicates.indexOf(i),o=-1!==n),o&&t.usedDuplicates[n])t.dump="*ref_"+n;else{if(l&&o&&!t.usedDuplicates[n]&&(t.usedDuplicates[n]=!0),"[object Object]"===a)s&&0!==Object.keys(t.dump).length?(b(t,e,t.dump,r),o&&(t.dump="&ref_"+n+(0===e?"\n":"")+t.dump)):(g(t,e,t.dump),o&&(t.dump="&ref_"+n+" "+t.dump));else if("[object Array]"===a)s&&0!==t.dump.length?(d(t,e,t.dump,r),o&&(t.dump="&ref_"+n+(0===e?"\n":"")+t.dump)):(f(t,e,t.dump),o&&(t.dump="&ref_"+n+" "+t.dump));else{if("[object String]"!==a){if(t.skipInvalid)return!1;throw new O("unacceptable kind of an object to dump "+a)}"?"!==t.tag&&u(t,t.dump,e)}null!==t.tag&&"?"!==t.tag&&(t.dump="!<"+t.tag+"> "+t.dump)}return!0}function _(t,e){var i,s,r=[],a=[];for(x(t,r,a),i=0,s=a.length;s>i;i+=1)e.duplicates.push(r[a[i]]);e.usedDuplicates=new Array(s)}function x(t,e,i){{var s,r,a;T.call(t)}if(null!==t&&"object"==typeof t)if(r=e.indexOf(t),-1!==r)-1===i.indexOf(r)&&i.push(r);else if(e.push(t),Array.isArray(t))for(r=0,a=t.length;a>r;r+=1)x(t[r],e,i);else for(s=Object.keys(t),r=0,a=s.length;a>r;r+=1)x(t[s[r]],e,i)}function A(t,e){e=e||{};var i=new r(e);return _(t,i),v(i,0,t,!0,!0)?i.dump+"\n":""}function I(t,e){return A(t,S.extend({schema:k},e))}var S=t("./common"),O=t("./exception"),E=t("./schema/default_full"),k=t("./schema/default_safe"),T=Object.prototype.toString,w=Object.prototype.hasOwnProperty,N=9,C=10,R=13,L=32,j=33,D=34,P=35,q=37,U=38,B=39,M=42,F=44,z=45,G=58,V=62,X=63,H=64,$=91,W=93,Q=96,K=123,Y=124,J=125,Z={};Z[0]="\\0",Z[7]="\\a",Z[8]="\\b",Z[9]="\\t",Z[10]="\\n",Z[11]="\\v",Z[12]="\\f",Z[13]="\\r",Z[27]="\\e",Z[34]='\\"',Z[92]="\\\\",Z[133]="\\N",Z[160]="\\_",Z[8232]="\\L",Z[8233]="\\P";var te=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"];l.prototype.takeUpTo=function(t){var e;if(t<this.checkpoint)throw e=new Error("position should be > checkpoint"),e.position=t,e.checkpoint=this.checkpoint,e;return this.result+=this.source.slice(this.checkpoint,t),this.checkpoint=t,this},l.prototype.escapeChar=function(){var t,e;return t=this.source.charCodeAt(this.checkpoint),e=Z[t]||s(t),this.result+=e,this.checkpoint+=1,this},l.prototype.finish=function(){this.source.length>this.checkpoint&&this.takeUpTo(this.source.length)},e.exports.dump=A,e.exports.safeDump=I},{"./common":2,"./exception":4,"./schema/default_full":9,"./schema/default_safe":10}],4:[function(t,e){"use strict";function i(t,e){this.name="YAMLException",this.reason=t,this.mark=e,this.message=this.toString(!1)}i.prototype.toString=function(t){var e;return e="JS-YAML: "+(this.reason||"(unknown reason)"),!t&&this.mark&&(e+=" "+this.mark.toString()),e},e.exports=i},{}],5:[function(t,e){"use strict";function i(t){return 10===t||13===t}function s(t){return 9===t||32===t}function r(t){return 9===t||32===t||10===t||13===t}function a(t){return 44===t||91===t||93===t||123===t||125===t}function n(t){var e;return t>=48&&57>=t?t-48:(e=32|t,e>=97&&102>=e?e-97+10:-1)}function o(t){return 120===t?2:117===t?4:85===t?8:0}function l(t){return t>=48&&57>=t?t-48:-1}function u(t){return 48===t?"\x00":97===t?"":98===t?"\b":116===t?"	":9===t?"	":110===t?"\n":118===t?"":102===t?"\f":114===t?"\r":101===t?"":32===t?" ":34===t?'"':47===t?"/":92===t?"\\":78===t?"\x85":95===t?"\xa0":76===t?"\u2028":80===t?"\u2029":""}function p(t){return 65535>=t?String.fromCharCode(t):String.fromCharCode((t-65536>>10)+55296,(t-65536&1023)+56320)}function h(t,e){this.input=t,this.filename=e.filename||null,this.schema=e.schema||G,this.onWarning=e.onWarning||null,this.legacy=e.legacy||!1,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=t.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.documents=[]}function c(t,e){return new M(e,new F(t.filename,t.input,t.position,t.line,t.position-t.lineStart))}function m(t,e){throw c(t,e)}function f(t,e){var i=c(t,e);if(!t.onWarning)throw i;t.onWarning.call(null,i)}function d(t,e,i,s){var r,a,n,o;if(i>e){if(o=t.input.slice(e,i),s)for(r=0,a=o.length;a>r;r+=1)n=o.charCodeAt(r),9===n||n>=32&&1114111>=n||m(t,"expected valid JSON character");t.result+=o}}function g(t,e,i){var s,r,a,n;for(B.isObject(i)||m(t,"cannot merge mappings; the provided source object is unacceptable"),s=Object.keys(i),a=0,n=s.length;n>a;a+=1)r=s[a],V.call(e,r)||(e[r]=i[r])}function b(t,e,i,s,r){var a,n;if(s=String(s),null===e&&(e={}),"tag:yaml.org,2002:merge"===i)if(Array.isArray(r))for(a=0,n=r.length;n>a;a+=1)g(t,e,r[a]);else g(t,e,r);else e[s]=r;return e}function y(t){var e;e=t.input.charCodeAt(t.position),10===e?t.position++:13===e?(t.position++,10===t.input.charCodeAt(t.position)&&t.position++):m(t,"a line break is expected"),t.line+=1,t.lineStart=t.position}function v(t,e,r){for(var a=0,n=t.input.charCodeAt(t.position);0!==n;){for(;s(n);)n=t.input.charCodeAt(++t.position);if(e&&35===n)do n=t.input.charCodeAt(++t.position);while(10!==n&&13!==n&&0!==n);if(!i(n))break;for(y(t),n=t.input.charCodeAt(t.position),a++,t.lineIndent=0;32===n;)t.lineIndent++,n=t.input.charCodeAt(++t.position)}return-1!==r&&0!==a&&t.lineIndent<r&&f(t,"deficient indentation"),a}function _(t){var e,i=t.position;return e=t.input.charCodeAt(i),45!==e&&46!==e||t.input.charCodeAt(i+1)!==e||t.input.charCodeAt(i+2)!==e||(i+=3,e=t.input.charCodeAt(i),0!==e&&!r(e))?!1:!0}function x(t,e){1===e?t.result+=" ":e>1&&(t.result+=B.repeat("\n",e-1))}function A(t,e,n){var o,l,u,p,h,c,m,f,g,b=t.kind,y=t.result;if(g=t.input.charCodeAt(t.position),r(g)||a(g)||35===g||38===g||42===g||33===g||124===g||62===g||39===g||34===g||37===g||64===g||96===g)return!1;if((63===g||45===g)&&(l=t.input.charCodeAt(t.position+1),r(l)||n&&a(l)))return!1;for(t.kind="scalar",t.result="",u=p=t.position,h=!1;0!==g;){if(58===g){if(l=t.input.charCodeAt(t.position+1),r(l)||n&&a(l))break}else if(35===g){if(o=t.input.charCodeAt(t.position-1),r(o))break}else{if(t.position===t.lineStart&&_(t)||n&&a(g))break;if(i(g)){if(c=t.line,m=t.lineStart,f=t.lineIndent,v(t,!1,-1),t.lineIndent>=e){h=!0,g=t.input.charCodeAt(t.position);continue}t.position=p,t.line=c,t.lineStart=m,t.lineIndent=f;break}}h&&(d(t,u,p,!1),x(t,t.line-c),u=p=t.position,h=!1),s(g)||(p=t.position+1),g=t.input.charCodeAt(++t.position)}return d(t,u,p,!1),t.result?!0:(t.kind=b,t.result=y,!1)}function I(t,e){var s,r,a;if(s=t.input.charCodeAt(t.position),39!==s)return!1;for(t.kind="scalar",t.result="",t.position++,r=a=t.position;0!==(s=t.input.charCodeAt(t.position));)if(39===s){if(d(t,r,t.position,!0),s=t.input.charCodeAt(++t.position),39!==s)return!0;r=a=t.position,t.position++}else i(s)?(d(t,r,a,!0),x(t,v(t,!1,e)),r=a=t.position):t.position===t.lineStart&&_(t)?m(t,"unexpected end of the document within a single quoted scalar"):(t.position++,a=t.position);m(t,"unexpected end of the stream within a single quoted scalar")}function S(t,e){var s,r,a,l,u,h;if(h=t.input.charCodeAt(t.position),34!==h)return!1;for(t.kind="scalar",t.result="",t.position++,s=r=t.position;0!==(h=t.input.charCodeAt(t.position));){if(34===h)return d(t,s,t.position,!0),t.position++,!0;if(92===h){if(d(t,s,t.position,!0),h=t.input.charCodeAt(++t.position),i(h))v(t,!1,e);else if(256>h&&se[h])t.result+=re[h],t.position++;else if((u=o(h))>0){for(a=u,l=0;a>0;a--)h=t.input.charCodeAt(++t.position),(u=n(h))>=0?l=(l<<4)+u:m(t,"expected hexadecimal character");t.result+=p(l),t.position++}else m(t,"unknown escape sequence");s=r=t.position}else i(h)?(d(t,s,r,!0),x(t,v(t,!1,e)),s=r=t.position):t.position===t.lineStart&&_(t)?m(t,"unexpected end of the document within a double quoted scalar"):(t.position++,r=t.position)}m(t,"unexpected end of the stream within a double quoted scalar")}function O(t,e){var i,s,a,n,o,l,u,p,h,c,f,d=!0,g=t.tag,y=t.anchor;if(f=t.input.charCodeAt(t.position),91===f)n=93,u=!1,s=[];else{if(123!==f)return!1;n=125,u=!0,s={}}for(null!==t.anchor&&(t.anchorMap[t.anchor]=s),f=t.input.charCodeAt(++t.position);0!==f;){if(v(t,!0,e),f=t.input.charCodeAt(t.position),f===n)return t.position++,t.tag=g,t.anchor=y,t.kind=u?"mapping":"sequence",t.result=s,!0;d||m(t,"missed comma between flow collection entries"),h=p=c=null,o=l=!1,63===f&&(a=t.input.charCodeAt(t.position+1),r(a)&&(o=l=!0,t.position++,v(t,!0,e))),i=t.line,R(t,e,X,!1,!0),h=t.tag,p=t.result,v(t,!0,e),f=t.input.charCodeAt(t.position),!l&&t.line!==i||58!==f||(o=!0,f=t.input.charCodeAt(++t.position),v(t,!0,e),R(t,e,X,!1,!0),c=t.result),u?b(t,s,h,p,c):s.push(o?b(t,null,h,p,c):p),v(t,!0,e),f=t.input.charCodeAt(t.position),44===f?(d=!0,f=t.input.charCodeAt(++t.position)):d=!1}m(t,"unexpected end of the stream within a flow collection")}function E(t,e){var r,a,n,o,u=Q,p=!1,h=e,c=0,f=!1;if(o=t.input.charCodeAt(t.position),124===o)a=!1;else{if(62!==o)return!1;a=!0}for(t.kind="scalar",t.result="";0!==o;)if(o=t.input.charCodeAt(++t.position),43===o||45===o)Q===u?u=43===o?Y:K:m(t,"repeat of a chomping mode identifier");else{if(!((n=l(o))>=0))break;0===n?m(t,"bad explicit indentation width of a block scalar; it cannot be less than one"):p?m(t,"repeat of an indentation width identifier"):(h=e+n-1,p=!0)}if(s(o)){do o=t.input.charCodeAt(++t.position);while(s(o));if(35===o)do o=t.input.charCodeAt(++t.position);while(!i(o)&&0!==o)}for(;0!==o;){for(y(t),t.lineIndent=0,o=t.input.charCodeAt(t.position);(!p||t.lineIndent<h)&&32===o;)t.lineIndent++,o=t.input.charCodeAt(++t.position);if(!p&&t.lineIndent>h&&(h=t.lineIndent),i(o))c++;else{if(t.lineIndent<h){u===Y?t.result+=B.repeat("\n",c):u===Q&&p&&(t.result+="\n");break}for(a?s(o)?(f=!0,t.result+=B.repeat("\n",c+1)):f?(f=!1,t.result+=B.repeat("\n",c+1)):0===c?p&&(t.result+=" "):t.result+=B.repeat("\n",c):p&&(t.result+=B.repeat("\n",c+1)),p=!0,c=0,r=t.position;!i(o)&&0!==o;)o=t.input.charCodeAt(++t.position);d(t,r,t.position,!1)}}return!0}function k(t,e){var i,s,a,n=t.tag,o=t.anchor,l=[],u=!1;for(null!==t.anchor&&(t.anchorMap[t.anchor]=l),a=t.input.charCodeAt(t.position);0!==a&&45===a&&(s=t.input.charCodeAt(t.position+1),r(s));)if(u=!0,t.position++,v(t,!0,-1)&&t.lineIndent<=e)l.push(null),a=t.input.charCodeAt(t.position);else if(i=t.line,R(t,e,$,!1,!0),l.push(t.result),v(t,!0,-1),a=t.input.charCodeAt(t.position),(t.line===i||t.lineIndent>e)&&0!==a)m(t,"bad indentation of a sequence entry");else if(t.lineIndent<e)break;return u?(t.tag=n,t.anchor=o,t.kind="sequence",t.result=l,!0):!1}function T(t,e,i){var a,n,o,l,u=t.tag,p=t.anchor,h={},c=null,f=null,d=null,g=!1,y=!1;for(null!==t.anchor&&(t.anchorMap[t.anchor]=h),l=t.input.charCodeAt(t.position);0!==l;){if(a=t.input.charCodeAt(t.position+1),o=t.line,63!==l&&58!==l||!r(a)){if(!R(t,i,H,!1,!0))break;if(t.line===o){for(l=t.input.charCodeAt(t.position);s(l);)l=t.input.charCodeAt(++t.position);if(58===l)l=t.input.charCodeAt(++t.position),r(l)||m(t,"a whitespace character is expected after the key-value separator within a block mapping"),g&&(b(t,h,c,f,null),c=f=d=null),y=!0,g=!1,n=!1,c=t.tag,f=t.result;else{if(!y)return t.tag=u,t.anchor=p,!0;m(t,"can not read an implicit mapping pair; a colon is missed")}}else{if(!y)return t.tag=u,t.anchor=p,!0;m(t,"can not read a block mapping entry; a multiline key may not be an implicit key")}}else 63===l?(g&&(b(t,h,c,f,null),c=f=d=null),y=!0,g=!0,n=!0):g?(g=!1,n=!0):m(t,"incomplete explicit mapping pair; a key node is missed"),t.position+=1,l=a;if((t.line===o||t.lineIndent>e)&&(R(t,e,W,!0,n)&&(g?f=t.result:d=t.result),g||(b(t,h,c,f,d),c=f=d=null),v(t,!0,-1),l=t.input.charCodeAt(t.position)),t.lineIndent>e&&0!==l)m(t,"bad indentation of a mapping entry");else if(t.lineIndent<e)break}return g&&b(t,h,c,f,null),y&&(t.tag=u,t.anchor=p,t.kind="mapping",t.result=h),y}function w(t){var e,i,s,a,n=!1,o=!1;if(a=t.input.charCodeAt(t.position),33!==a)return!1;if(null!==t.tag&&m(t,"duplication of a tag property"),a=t.input.charCodeAt(++t.position),60===a?(n=!0,a=t.input.charCodeAt(++t.position)):33===a?(o=!0,i="!!",a=t.input.charCodeAt(++t.position)):i="!",e=t.position,n){do a=t.input.charCodeAt(++t.position);while(0!==a&&62!==a);t.position<t.length?(s=t.input.slice(e,t.position),a=t.input.charCodeAt(++t.position)):m(t,"unexpected end of the stream within a verbatim tag")}else{for(;0!==a&&!r(a);)33===a&&(o?m(t,"tag suffix cannot contain exclamation marks"):(i=t.input.slice(e-1,t.position+1),ee.test(i)||m(t,"named tag handle cannot contain such characters"),o=!0,e=t.position+1)),a=t.input.charCodeAt(++t.position);s=t.input.slice(e,t.position),te.test(s)&&m(t,"tag suffix cannot contain flow indicator characters")}return s&&!ie.test(s)&&m(t,"tag name cannot contain such characters: "+s),n?t.tag=s:V.call(t.tagMap,i)?t.tag=t.tagMap[i]+s:"!"===i?t.tag="!"+s:"!!"===i?t.tag="tag:yaml.org,2002:"+s:m(t,'undeclared tag handle "'+i+'"'),!0}function N(t){var e,i;if(i=t.input.charCodeAt(t.position),38!==i)return!1;for(null!==t.anchor&&m(t,"duplication of an anchor property"),i=t.input.charCodeAt(++t.position),e=t.position;0!==i&&!r(i)&&!a(i);)i=t.input.charCodeAt(++t.position);
return t.position===e&&m(t,"name of an anchor node must contain at least one character"),t.anchor=t.input.slice(e,t.position),!0}function C(t){{var e,i,s;t.length,t.input}if(s=t.input.charCodeAt(t.position),42!==s)return!1;for(s=t.input.charCodeAt(++t.position),e=t.position;0!==s&&!r(s)&&!a(s);)s=t.input.charCodeAt(++t.position);return t.position===e&&m(t,"name of an alias node must contain at least one character"),i=t.input.slice(e,t.position),t.anchorMap.hasOwnProperty(i)||m(t,'unidentified alias "'+i+'"'),t.result=t.anchorMap[i],v(t,!0,-1),!0}function R(t,e,i,s,r){var a,n,o,l,u,p,h,c,d=1,g=!1,b=!1;if(t.tag=null,t.anchor=null,t.kind=null,t.result=null,a=n=o=W===i||$===i,s&&v(t,!0,-1)&&(g=!0,t.lineIndent>e?d=1:t.lineIndent===e?d=0:t.lineIndent<e&&(d=-1)),1===d)for(;w(t)||N(t);)v(t,!0,-1)?(g=!0,o=a,t.lineIndent>e?d=1:t.lineIndent===e?d=0:t.lineIndent<e&&(d=-1)):o=!1;if(o&&(o=g||r),(1===d||W===i)&&(h=X===i||H===i?e:e+1,c=t.position-t.lineStart,1===d?o&&(k(t,c)||T(t,c,h))||O(t,h)?b=!0:(n&&E(t,h)||I(t,h)||S(t,h)?b=!0:C(t)?(b=!0,(null!==t.tag||null!==t.anchor)&&m(t,"alias node should not have any properties")):A(t,h,X===i)&&(b=!0,null===t.tag&&(t.tag="?")),null!==t.anchor&&(t.anchorMap[t.anchor]=t.result)):0===d&&(b=o&&k(t,c))),null!==t.tag&&"!"!==t.tag)if("?"===t.tag){for(l=0,u=t.implicitTypes.length;u>l;l+=1)if(p=t.implicitTypes[l],p.resolve(t.result)){t.result=p.construct(t.result),t.tag=p.tag,null!==t.anchor&&(t.anchorMap[t.anchor]=t.result);break}}else V.call(t.typeMap,t.tag)?(p=t.typeMap[t.tag],null!==t.result&&p.kind!==t.kind&&m(t,"unacceptable node kind for !<"+t.tag+'> tag; it should be "'+p.kind+'", not "'+t.kind+'"'),p.resolve(t.result)?(t.result=p.construct(t.result),null!==t.anchor&&(t.anchorMap[t.anchor]=t.result)):m(t,"cannot resolve a node with !<"+t.tag+"> explicit tag")):f(t,"unknown tag !<"+t.tag+">");return null!==t.tag||null!==t.anchor||b}function L(t){var e,a,n,o,l=t.position,u=!1;for(t.version=null,t.checkLineBreaks=t.legacy,t.tagMap={},t.anchorMap={};0!==(o=t.input.charCodeAt(t.position))&&(v(t,!0,-1),o=t.input.charCodeAt(t.position),!(t.lineIndent>0||37!==o));){for(u=!0,o=t.input.charCodeAt(++t.position),e=t.position;0!==o&&!r(o);)o=t.input.charCodeAt(++t.position);for(a=t.input.slice(e,t.position),n=[],a.length<1&&m(t,"directive name must not be less than one character in length");0!==o;){for(;s(o);)o=t.input.charCodeAt(++t.position);if(35===o){do o=t.input.charCodeAt(++t.position);while(0!==o&&!i(o));break}if(i(o))break;for(e=t.position;0!==o&&!r(o);)o=t.input.charCodeAt(++t.position);n.push(t.input.slice(e,t.position))}0!==o&&y(t),V.call(ne,a)?ne[a](t,a,n):f(t,'unknown document directive "'+a+'"')}return v(t,!0,-1),0===t.lineIndent&&45===t.input.charCodeAt(t.position)&&45===t.input.charCodeAt(t.position+1)&&45===t.input.charCodeAt(t.position+2)?(t.position+=3,v(t,!0,-1)):u&&m(t,"directives end mark is expected"),R(t,t.lineIndent-1,W,!1,!0),v(t,!0,-1),t.checkLineBreaks&&Z.test(t.input.slice(l,t.position))&&f(t,"non-ASCII line breaks are interpreted as content"),t.documents.push(t.result),t.position===t.lineStart&&_(t)?void(46===t.input.charCodeAt(t.position)&&(t.position+=3,v(t,!0,-1))):void(t.position<t.length-1&&m(t,"end of the stream or a document separator is expected"))}function j(t,e){t=String(t),e=e||{},0!==t.length&&(10!==t.charCodeAt(t.length-1)&&13!==t.charCodeAt(t.length-1)&&(t+="\n"),65279===t.charCodeAt(0)&&(t=t.slice(1)));var i=new h(t,e);for(J.test(i.input)&&m(i,"the stream contains non-printable characters"),i.input+="\x00";32===i.input.charCodeAt(i.position);)i.lineIndent+=1,i.position+=1;for(;i.position<i.length-1;)L(i);return i.documents}function D(t,e,i){var s,r,a=j(t,i);for(s=0,r=a.length;r>s;s+=1)e(a[s])}function P(t,e){var i=j(t,e);if(0===i.length)return void 0;if(1===i.length)return i[0];throw new M("expected a single document in the stream, but found more")}function q(t,e,i){D(t,e,B.extend({schema:z},i))}function U(t,e){return P(t,B.extend({schema:z},e))}for(var B=t("./common"),M=t("./exception"),F=t("./mark"),z=t("./schema/default_safe"),G=t("./schema/default_full"),V=Object.prototype.hasOwnProperty,X=1,H=2,$=3,W=4,Q=1,K=2,Y=3,J=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,Z=/[\x85\u2028\u2029]/,te=/[,\[\]\{\}]/,ee=/^(?:!|!!|![a-z\-]+!)$/i,ie=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i,se=new Array(256),re=new Array(256),ae=0;256>ae;ae++)se[ae]=u(ae)?1:0,re[ae]=u(ae);var ne={YAML:function(t,e,i){var s,r,a;null!==t.version&&m(t,"duplication of %YAML directive"),1!==i.length&&m(t,"YAML directive accepts exactly one argument"),s=/^([0-9]+)\.([0-9]+)$/.exec(i[0]),null===s&&m(t,"ill-formed argument of the YAML directive"),r=parseInt(s[1],10),a=parseInt(s[2],10),1!==r&&m(t,"unacceptable YAML version of the document"),t.version=i[0],t.checkLineBreaks=2>a,1!==a&&2!==a&&f(t,"unsupported YAML version of the document")},TAG:function(t,e,i){var s,r;2!==i.length&&m(t,"TAG directive accepts exactly two arguments"),s=i[0],r=i[1],ee.test(s)||m(t,"ill-formed tag handle (first argument) of the TAG directive"),V.call(t.tagMap,s)&&m(t,'there is a previously declared suffix for "'+s+'" tag handle'),ie.test(r)||m(t,"ill-formed tag prefix (second argument) of the TAG directive"),t.tagMap[s]=r}};e.exports.loadAll=D,e.exports.load=P,e.exports.safeLoadAll=q,e.exports.safeLoad=U},{"./common":2,"./exception":4,"./mark":6,"./schema/default_full":9,"./schema/default_safe":10}],6:[function(t,e){"use strict";function i(t,e,i,s,r){this.name=t,this.buffer=e,this.position=i,this.line=s,this.column=r}var s=t("./common");i.prototype.getSnippet=function(t,e){var i,r,a,n,o;if(!this.buffer)return null;for(t=t||4,e=e||75,i="",r=this.position;r>0&&-1==="\x00\r\n\x85\u2028\u2029".indexOf(this.buffer.charAt(r-1));)if(r-=1,this.position-r>e/2-1){i=" ... ",r+=5;break}for(a="",n=this.position;n<this.buffer.length&&-1==="\x00\r\n\x85\u2028\u2029".indexOf(this.buffer.charAt(n));)if(n+=1,n-this.position>e/2-1){a=" ... ",n-=5;break}return o=this.buffer.slice(r,n),s.repeat(" ",t)+i+o+a+"\n"+s.repeat(" ",t+this.position-r+i.length)+"^"},i.prototype.toString=function(t){var e,i="";return this.name&&(i+='in "'+this.name+'" '),i+="at line "+(this.line+1)+", column "+(this.column+1),t||(e=this.getSnippet(),e&&(i+=":\n"+e)),i},e.exports=i},{"./common":2}],7:[function(t,e){"use strict";function i(t,e,s){var r=[];return t.include.forEach(function(t){s=i(t,e,s)}),t[e].forEach(function(t){s.forEach(function(e,i){e.tag===t.tag&&r.push(i)}),s.push(t)}),s.filter(function(t,e){return-1===r.indexOf(e)})}function s(){function t(t){s[t.tag]=t}var e,i,s={};for(e=0,i=arguments.length;i>e;e+=1)arguments[e].forEach(t);return s}function r(t){this.include=t.include||[],this.implicit=t.implicit||[],this.explicit=t.explicit||[],this.implicit.forEach(function(t){if(t.loadKind&&"scalar"!==t.loadKind)throw new n("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.")}),this.compiledImplicit=i(this,"implicit",[]),this.compiledExplicit=i(this,"explicit",[]),this.compiledTypeMap=s(this.compiledImplicit,this.compiledExplicit)}var a=t("./common"),n=t("./exception"),o=t("./type");r.DEFAULT=null,r.create=function(){var t,e;switch(arguments.length){case 1:t=r.DEFAULT,e=arguments[0];break;case 2:t=arguments[0],e=arguments[1];break;default:throw new n("Wrong number of arguments for Schema.create function")}if(t=a.toArray(t),e=a.toArray(e),!t.every(function(t){return t instanceof r}))throw new n("Specified list of super schemas (or a single Schema object) contains a non-Schema object.");if(!e.every(function(t){return t instanceof o}))throw new n("Specified list of YAML types (or a single Type object) contains a non-Type object.");return new r({include:t,explicit:e})},e.exports=r},{"./common":2,"./exception":4,"./type":13}],8:[function(t,e){var i=t("../schema");e.exports=new i({include:[t("./json")]})},{"../schema":7,"./json":12}],9:[function(t,e){var i=t("../schema");e.exports=i.DEFAULT=new i({include:[t("./default_safe")],explicit:[t("../type/js/undefined"),t("../type/js/regexp"),t("../type/js/function")]})},{"../schema":7,"../type/js/function":18,"../type/js/regexp":19,"../type/js/undefined":20,"./default_safe":10}],10:[function(t,e){var i=t("../schema");e.exports=new i({include:[t("./core")],implicit:[t("../type/timestamp"),t("../type/merge")],explicit:[t("../type/binary"),t("../type/omap"),t("../type/pairs"),t("../type/set")]})},{"../schema":7,"../type/binary":14,"../type/merge":22,"../type/omap":24,"../type/pairs":25,"../type/set":27,"../type/timestamp":29,"./core":8}],11:[function(t,e){var i=t("../schema");e.exports=new i({explicit:[t("../type/str"),t("../type/seq"),t("../type/map")]})},{"../schema":7,"../type/map":21,"../type/seq":26,"../type/str":28}],12:[function(t,e){var i=t("../schema");e.exports=new i({include:[t("./failsafe")],implicit:[t("../type/null"),t("../type/bool"),t("../type/int"),t("../type/float")]})},{"../schema":7,"../type/bool":15,"../type/float":16,"../type/int":17,"../type/null":23,"./failsafe":11}],13:[function(t,e){"use strict";function i(t){var e={};return null!==t&&Object.keys(t).forEach(function(i){t[i].forEach(function(t){e[String(t)]=i})}),e}function s(t,e){if(e=e||{},Object.keys(e).forEach(function(e){if(-1===a.indexOf(e))throw new r('Unknown option "'+e+'" is met in definition of "'+t+'" YAML type.')}),this.tag=t,this.kind=e.kind||null,this.resolve=e.resolve||function(){return!0},this.construct=e.construct||function(t){return t},this.instanceOf=e.instanceOf||null,this.predicate=e.predicate||null,this.represent=e.represent||null,this.defaultStyle=e.defaultStyle||null,this.styleAliases=i(e.styleAliases||null),-1===n.indexOf(this.kind))throw new r('Unknown kind "'+this.kind+'" is specified for "'+t+'" YAML type.')}var r=t("./exception"),a=["kind","resolve","construct","instanceOf","predicate","represent","defaultStyle","styleAliases"],n=["scalar","sequence","mapping"];e.exports=s},{"./exception":4}],14:[function(t,e){"use strict";function i(t){if(null===t)return!1;var e,i,s=0,r=t.length,a=l;for(i=0;r>i;i++)if(e=a.indexOf(t.charAt(i)),!(e>64)){if(0>e)return!1;s+=6}return s%8===0}function s(t){var e,i,s=t.replace(/[\r\n=]/g,""),r=s.length,a=l,o=0,u=[];for(e=0;r>e;e++)e%4===0&&e&&(u.push(o>>16&255),u.push(o>>8&255),u.push(255&o)),o=o<<6|a.indexOf(s.charAt(e));return i=r%4*6,0===i?(u.push(o>>16&255),u.push(o>>8&255),u.push(255&o)):18===i?(u.push(o>>10&255),u.push(o>>2&255)):12===i&&u.push(o>>4&255),n?new n(u):u}function r(t){var e,i,s="",r=0,a=t.length,n=l;for(e=0;a>e;e++)e%3===0&&e&&(s+=n[r>>18&63],s+=n[r>>12&63],s+=n[r>>6&63],s+=n[63&r]),r=(r<<8)+t[e];return i=a%3,0===i?(s+=n[r>>18&63],s+=n[r>>12&63],s+=n[r>>6&63],s+=n[63&r]):2===i?(s+=n[r>>10&63],s+=n[r>>4&63],s+=n[r<<2&63],s+=n[64]):1===i&&(s+=n[r>>2&63],s+=n[r<<4&63],s+=n[64],s+=n[64]),s}function a(t){return n&&n.isBuffer(t)}var n=t("buffer").Buffer,o=t("../type"),l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\n\r";e.exports=new o("tag:yaml.org,2002:binary",{kind:"scalar",resolve:i,construct:s,predicate:a,represent:r})},{"../type":13,buffer:30}],15:[function(t,e){"use strict";function i(t){if(null===t)return!1;var e=t.length;return 4===e&&("true"===t||"True"===t||"TRUE"===t)||5===e&&("false"===t||"False"===t||"FALSE"===t)}function s(t){return"true"===t||"True"===t||"TRUE"===t}function r(t){return"[object Boolean]"===Object.prototype.toString.call(t)}var a=t("../type");e.exports=new a("tag:yaml.org,2002:bool",{kind:"scalar",resolve:i,construct:s,predicate:r,represent:{lowercase:function(t){return t?"true":"false"},uppercase:function(t){return t?"TRUE":"FALSE"},camelcase:function(t){return t?"True":"False"}},defaultStyle:"lowercase"})},{"../type":13}],16:[function(t,e){"use strict";function i(t){if(null===t)return!1;return l.test(t)?!0:!1}function s(t){var e,i,s,r;return e=t.replace(/_/g,"").toLowerCase(),i="-"===e[0]?-1:1,r=[],0<="+-".indexOf(e[0])&&(e=e.slice(1)),".inf"===e?1===i?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:".nan"===e?0/0:0<=e.indexOf(":")?(e.split(":").forEach(function(t){r.unshift(parseFloat(t,10))}),e=0,s=1,r.forEach(function(t){e+=t*s,s*=60}),i*e):i*parseFloat(e,10)}function r(t,e){if(isNaN(t))switch(e){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===t)switch(e){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===t)switch(e){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(n.isNegativeZero(t))return"-0.0";return t.toString(10)}function a(t){return"[object Number]"===Object.prototype.toString.call(t)&&(0!==t%1||n.isNegativeZero(t))}var n=t("../common"),o=t("../type"),l=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)\\.[0-9_]*(?:[eE][-+][0-9]+)?|\\.[0-9_]+(?:[eE][-+][0-9]+)?|[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\\.[0-9_]*|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");e.exports=new o("tag:yaml.org,2002:float",{kind:"scalar",resolve:i,construct:s,predicate:a,represent:r,defaultStyle:"lowercase"})},{"../common":2,"../type":13}],17:[function(t,e){"use strict";function i(t){return t>=48&&57>=t||t>=65&&70>=t||t>=97&&102>=t}function s(t){return t>=48&&55>=t}function r(t){return t>=48&&57>=t}function a(t){if(null===t)return!1;var e,a=t.length,n=0,o=!1;if(!a)return!1;if(e=t[n],("-"===e||"+"===e)&&(e=t[++n]),"0"===e){if(n+1===a)return!0;if(e=t[++n],"b"===e){for(n++;a>n;n++)if(e=t[n],"_"!==e){if("0"!==e&&"1"!==e)return!1;o=!0}return o}if("x"===e){for(n++;a>n;n++)if(e=t[n],"_"!==e){if(!i(t.charCodeAt(n)))return!1;o=!0}return o}for(;a>n;n++)if(e=t[n],"_"!==e){if(!s(t.charCodeAt(n)))return!1;o=!0}return o}for(;a>n;n++)if(e=t[n],"_"!==e){if(":"===e)break;if(!r(t.charCodeAt(n)))return!1;o=!0}return o?":"!==e?!0:/^(:[0-5]?[0-9])+$/.test(t.slice(n)):!1}function n(t){var e,i,s=t,r=1,a=[];return-1!==s.indexOf("_")&&(s=s.replace(/_/g,"")),e=s[0],("-"===e||"+"===e)&&("-"===e&&(r=-1),s=s.slice(1),e=s[0]),"0"===s?0:"0"===e?"b"===s[1]?r*parseInt(s.slice(2),2):"x"===s[1]?r*parseInt(s,16):r*parseInt(s,8):-1!==s.indexOf(":")?(s.split(":").forEach(function(t){a.unshift(parseInt(t,10))}),s=0,i=1,a.forEach(function(t){s+=t*i,i*=60}),r*s):r*parseInt(s,10)}function o(t){return"[object Number]"===Object.prototype.toString.call(t)&&0===t%1&&!l.isNegativeZero(t)}var l=t("../common"),u=t("../type");e.exports=new u("tag:yaml.org,2002:int",{kind:"scalar",resolve:a,construct:n,predicate:o,represent:{binary:function(t){return"0b"+t.toString(2)},octal:function(t){return"0"+t.toString(8)},decimal:function(t){return t.toString(10)},hexadecimal:function(t){return"0x"+t.toString(16).toUpperCase()}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}})},{"../common":2,"../type":13}],18:[function(t,e){"use strict";function i(t){if(null===t)return!1;try{var e="("+t+")",i=n.parse(e,{range:!0});return"Program"!==i.type||1!==i.body.length||"ExpressionStatement"!==i.body[0].type||"FunctionExpression"!==i.body[0].expression.type?!1:!0}catch(s){return!1}}function s(t){var e,i="("+t+")",s=n.parse(i,{range:!0}),r=[];if("Program"!==s.type||1!==s.body.length||"ExpressionStatement"!==s.body[0].type||"FunctionExpression"!==s.body[0].expression.type)throw new Error("Failed to resolve function");return s.body[0].expression.params.forEach(function(t){r.push(t.name)}),e=s.body[0].expression.body.range,new Function(r,i.slice(e[0]+1,e[1]-1))}function r(t){return t.toString()}function a(t){return"[object Function]"===Object.prototype.toString.call(t)}var n;try{n=t("esprima")}catch(o){"undefined"!=typeof window&&(n=window.esprima)}var l=t("../../type");e.exports=new l("tag:yaml.org,2002:js/function",{kind:"scalar",resolve:i,construct:s,predicate:a,represent:r})},{"../../type":13,esprima:"esprima"}],19:[function(t,e){"use strict";function i(t){if(null===t)return!1;if(0===t.length)return!1;var e=t,i=/\/([gim]*)$/.exec(t),s="";if("/"===e[0]){if(i&&(s=i[1]),s.length>3)return!1;if("/"!==e[e.length-s.length-1])return!1;e=e.slice(1,e.length-s.length-1)}try{{new RegExp(e,s)}return!0}catch(r){return!1}}function s(t){var e=t,i=/\/([gim]*)$/.exec(t),s="";return"/"===e[0]&&(i&&(s=i[1]),e=e.slice(1,e.length-s.length-1)),new RegExp(e,s)}function r(t){var e="/"+t.source+"/";return t.global&&(e+="g"),t.multiline&&(e+="m"),t.ignoreCase&&(e+="i"),e}function a(t){return"[object RegExp]"===Object.prototype.toString.call(t)}var n=t("../../type");e.exports=new n("tag:yaml.org,2002:js/regexp",{kind:"scalar",resolve:i,construct:s,predicate:a,represent:r})},{"../../type":13}],20:[function(t,e){"use strict";function i(){return!0}function s(){return void 0}function r(){return""}function a(t){return"undefined"==typeof t}var n=t("../../type");e.exports=new n("tag:yaml.org,2002:js/undefined",{kind:"scalar",resolve:i,construct:s,predicate:a,represent:r})},{"../../type":13}],21:[function(t,e){"use strict";var i=t("../type");e.exports=new i("tag:yaml.org,2002:map",{kind:"mapping",construct:function(t){return null!==t?t:{}}})},{"../type":13}],22:[function(t,e){"use strict";function i(t){return"<<"===t||null===t}var s=t("../type");e.exports=new s("tag:yaml.org,2002:merge",{kind:"scalar",resolve:i})},{"../type":13}],23:[function(t,e){"use strict";function i(t){if(null===t)return!0;var e=t.length;return 1===e&&"~"===t||4===e&&("null"===t||"Null"===t||"NULL"===t)}function s(){return null}function r(t){return null===t}var a=t("../type");e.exports=new a("tag:yaml.org,2002:null",{kind:"scalar",resolve:i,construct:s,predicate:r,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"}},defaultStyle:"lowercase"})},{"../type":13}],24:[function(t,e){"use strict";function i(t){if(null===t)return!0;var e,i,s,r,o,l=[],u=t;for(e=0,i=u.length;i>e;e+=1){if(s=u[e],o=!1,"[object Object]"!==n.call(s))return!1;for(r in s)if(a.call(s,r)){if(o)return!1;o=!0}if(!o)return!1;if(-1!==l.indexOf(r))return!1;l.push(r)}return!0}function s(t){return null!==t?t:[]}var r=t("../type"),a=Object.prototype.hasOwnProperty,n=Object.prototype.toString;e.exports=new r("tag:yaml.org,2002:omap",{kind:"sequence",resolve:i,construct:s})},{"../type":13}],25:[function(t,e){"use strict";function i(t){if(null===t)return!0;var e,i,s,r,n,o=t;for(n=new Array(o.length),e=0,i=o.length;i>e;e+=1){if(s=o[e],"[object Object]"!==a.call(s))return!1;if(r=Object.keys(s),1!==r.length)return!1;n[e]=[r[0],s[r[0]]]}return!0}function s(t){if(null===t)return[];var e,i,s,r,a,n=t;for(a=new Array(n.length),e=0,i=n.length;i>e;e+=1)s=n[e],r=Object.keys(s),a[e]=[r[0],s[r[0]]];return a}var r=t("../type"),a=Object.prototype.toString;e.exports=new r("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:i,construct:s})},{"../type":13}],26:[function(t,e){"use strict";var i=t("../type");e.exports=new i("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(t){return null!==t?t:[]}})},{"../type":13}],27:[function(t,e){"use strict";function i(t){if(null===t)return!0;var e,i=t;for(e in i)if(a.call(i,e)&&null!==i[e])return!1;return!0}function s(t){return null!==t?t:{}}var r=t("../type"),a=Object.prototype.hasOwnProperty;e.exports=new r("tag:yaml.org,2002:set",{kind:"mapping",resolve:i,construct:s})},{"../type":13}],28:[function(t,e){"use strict";var i=t("../type");e.exports=new i("tag:yaml.org,2002:str",{kind:"scalar",construct:function(t){return null!==t?t:""}})},{"../type":13}],29:[function(t,e){"use strict";function i(t){if(null===t)return!1;var e;return e=n.exec(t),null===e?!1:!0}function s(t){var e,i,s,r,a,o,l,u,p,h,c=0,m=null;if(e=n.exec(t),null===e)throw new Error("Date resolve error");if(i=+e[1],s=+e[2]-1,r=+e[3],!e[4])return new Date(Date.UTC(i,s,r));if(a=+e[4],o=+e[5],l=+e[6],e[7]){for(c=e[7].slice(0,3);c.length<3;)c+="0";c=+c}return e[9]&&(u=+e[10],p=+(e[11]||0),m=6e4*(60*u+p),"-"===e[9]&&(m=-m)),h=new Date(Date.UTC(i,s,r,a,o,l,c)),m&&h.setTime(h.getTime()-m),h}function r(t){return t.toISOString()}var a=t("../type"),n=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?)?$");e.exports=new a("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:i,construct:s,instanceOf:Date,represent:r})},{"../type":13}],30:[function(){},{}],"/":[function(t,e){"use strict";var i=t("./lib/js-yaml.js");e.exports=i},{"./lib/js-yaml.js":1}]},{},[])("/")}),function(t){function e(){var t=arguments[0],i=e.cache;return i[t]&&i.hasOwnProperty(t)||(i[t]=e.parse(t)),e.format.call(null,i[t],arguments)}function i(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()}function s(t,e){return Array(e+1).join(t)}var r={not_string:/[^s]/,number:/[diefg]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijosuxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[\+\-]/};e.format=function(t,a){var n,o,l,u,p,h,c,m=1,f=t.length,d="",g=[],b=!0,y="";for(o=0;f>o;o++)if(d=i(t[o]),"string"===d)g[g.length]=t[o];else if("array"===d){if(u=t[o],u[2])for(n=a[m],l=0;l<u[2].length;l++){if(!n.hasOwnProperty(u[2][l]))throw new Error(e("[sprintf] property '%s' does not exist",u[2][l]));n=n[u[2][l]]}else n=u[1]?a[u[1]]:a[m++];if("function"==i(n)&&(n=n()),r.not_string.test(u[8])&&r.not_json.test(u[8])&&"number"!=i(n)&&isNaN(n))throw new TypeError(e("[sprintf] expecting number but found %s",i(n)));switch(r.number.test(u[8])&&(b=n>=0),u[8]){case"b":n=n.toString(2);break;case"c":n=String.fromCharCode(n);break;case"d":case"i":n=parseInt(n,10);break;case"j":n=JSON.stringify(n,null,u[6]?parseInt(u[6]):0);break;case"e":n=u[7]?n.toExponential(u[7]):n.toExponential();break;case"f":n=u[7]?parseFloat(n).toFixed(u[7]):parseFloat(n);break;case"g":n=u[7]?parseFloat(n).toPrecision(u[7]):parseFloat(n);break;case"o":n=n.toString(8);break;case"s":n=(n=String(n))&&u[7]?n.substring(0,u[7]):n;break;case"u":n>>>=0;break;case"x":n=n.toString(16);break;case"X":n=n.toString(16).toUpperCase()}r.json.test(u[8])?g[g.length]=n:(!r.number.test(u[8])||b&&!u[3]?y="":(y=b?"+":"-",n=n.toString().replace(r.sign,"")),h=u[4]?"0"===u[4]?"0":u[4].charAt(1):" ",c=u[6]-(y+n).length,p=u[6]&&c>0?s(h,c):"",g[g.length]=u[5]?y+n+p:"0"===h?y+p+n:p+y+n)}return g.join("")},e.cache={},e.parse=function(t){for(var e=t,i=[],s=[],a=0;e;){if(null!==(i=r.text.exec(e)))s[s.length]=i[0];else if(null!==(i=r.modulo.exec(e)))s[s.length]="%";else{if(null===(i=r.placeholder.exec(e)))throw new SyntaxError("[sprintf] unexpected placeholder");if(i[2]){a|=1;var n=[],o=i[2],l=[];if(null===(l=r.key.exec(o)))throw new SyntaxError("[sprintf] failed to parse named argument key");for(n[n.length]=l[1];""!==(o=o.substring(l[0].length));)if(null!==(l=r.key_access.exec(o)))n[n.length]=l[1];else{if(null===(l=r.index_access.exec(o)))throw new SyntaxError("[sprintf] failed to parse named argument key");n[n.length]=l[1]}i[2]=n}else a|=2;if(3===a)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");s[s.length]=i}e=e.substring(i[0].length)}return s};var a=function(t,i,s){return s=(i||[]).slice(0),s.splice(0,0,t),e.apply(null,s)};"undefined"!=typeof exports?(exports.sprintf=e,exports.vsprintf=a):(t.sprintf=e,t.vsprintf=a,"function"==typeof define&&define.amd&&define("sprintf-vendor",[],function(){return{sprintf:e,vsprintf:a}}))}("undefined"==typeof window?this:window),define("sprintf",["sprintf-vendor"],function(t){return t.sprintf}),function(t){"object"==typeof exports?module.exports=t(require("backbone")):"function"==typeof define&&define.amd?define("models/metadata/object",["backbone"],t):"undefined"!=typeof Backbone&&(window.MetadataObject=t(Backbone))}(function(t){var e=t.Model.extend({defaults:{string:"",original:""},to_s:function(){return this.attributes.string},raw:function(){return this.attributes.original},initialize:function(){}});return e}),function(t){"object"==typeof exports?module.exports=t(require("underscore"),require("backbone"),require("sprintf")):"function"==typeof define&&define.amd?define("models/metadata/author",["underscore","backbone","sprintf","models/metadata/object"],t):"undefined"!=typeof _&&"undefined"!=typeof Backbone&&"undefined"!=typeof sprintf&&"undefined"!=typeof MetadataObject&&(window.MetadataAuthor=t(_,Backbone,sprintf,MetadataObject))}(function(t,e,i,s){var r=s.extend({defaults:{orignal:""},initialize:function(t){t||(t=this.defaults.orignal),this.attributes.original=t},to_s:function(e){var s="";return"string"==typeof this.attributes.original?s=this.attributes.original:"object"==typeof this.attributes.original&&(this.attributes.original instanceof Array?(s=e?i("%s %s",this.attributes.original[0].given,this.attributes.original[0].family):i("%s, %s",author[0].family,author[0].given),this.attributes.original.length>1&&(this.attributes.original.length>2&&(s+=", "+t.range(1,this.attributes.original.length-1).map(function(t){i("%s %s",this.attributes.original[t].given,this.attributes.original[t].family)}).join(",")),s+=i(", and %s %s",t.last(this.attributes.original).given,t.last(this.attributes.original).family))):s="family"in author&&"given"in this.attributes.original?e?i("%s %s",this.attributes.original.given,this.attributes.original.family):i("%s, %s",author.family,author.given):"Error Parsing Author"),s}});return r}),function(t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define("writedown",[],t):window.Writedown=t()}(function(){function t(t,e){for(var i=0;i<t.length;i++)e(t[i])}function e(e,i){var s=[];return t(i,function(t){s.push(e(t))}),s}function i(e,i,s){return t(s,function(t){i=e(i,t)}),i}function s(t){for(var e=0;"#"==t.charAt(0);)t=t.slice(1),e++;return{type:0==e?"p":"h"+e,content:r(t)}}function r(t){function s(e){var i=t.indexOf(e);return-1==i?t.length:i}function r(e){var i=t.indexOf(e,1);if(-1==i)throw new Error("Mangler et "+e+"-tegn");var s=t.slice(e.length,i);return t=t.slice(i+e.length),s}function a(){var r=i(Math.min,t.length,e(s,["_","*","**","`","[","]","![","(",")"])),a=t.slice(0,r);return t=t.slice(r),a}for(var c=[];""!=t;)if("*"==t.charAt(0)&&"*"!=t.charAt(1))c.push(h(u(r("*"))));else if("_"==t.charAt(0)&&"_"!=t.charAt(1))c.push(h(u(r("_"))));else if("*"==t.charAt(0)&&"*"==t.charAt(1))c.push(h(l(r("**"))));else if("`"==t.charAt(0))c.push(h(p(r("`"))));else if("["==t.charAt(0)){var m=r("]"),f=r(")");c.push(h(n(m,f)))}else if("!"==t.charAt(0)&&"["==t.charAt(1)){var d=r("]").slice(1),g=r(")");c.push(h(o(g,d)))}else c.push(a());return c.join("")}function a(t,e,i){return{name:t,attributes:i,content:e}}function n(t,e){return a("a",[t],{href:e})}function o(t,e){return a("img",[],{src:t,alt:e})}function l(t){return a("strong",[t],{})}function u(t){return a("em",[t],{})}function p(t){return a("pre",[a("code",[t])])}function h(e){function i(t){var e=[];if(t)for(var i in t)e.push(" "+i+'="'+t[i]+'"');return e.join("")}function s(e){"string"==typeof e?r.push(e):e.content&&0!=e.content.length?(r.push("<"+e.name+i(e.attributes)+">"),t(e.content,s),r.push("</"+e.name+">")):r.push("<"+e.name+i(e.attributes)+"/>")}var r=[];return s(e),r.join("")}function c(t){for(var i=e(s,t.split("\n\n")),r="",n=0;n<i.length;n++)r+=h(a(i[n].type,i[n].content))+"\n";return 1==i.length?r.replace(/^\<p\>/,"").replace(/\<\/p\>\s+/,""):r}return{html:function(t){return c(t)}}}),function(t){"object"==typeof exports?module.exports=t(require("backbone")):"function"==typeof define&&define.amd?define("models/metadata/title",["backbone","writedown","models/metadata/object"],t):"undefined"!=typeof Backbone&&"undefined"!=typeof MetadataObject&&(window.MetadataTitle=t(Backbone,Writedown,MetadataObject))}(function(t,e,i){var s=i.extend({initialize:function(t){t||(t=this.defaults.original),this.attributes.original=t,this.attributes.string="string"==typeof t?e.html(this.attributes.original):"Error Parsing Title"}});return s}),function(t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define("citeproc/xmldom",[],t):"undefined"!=typeof _&&(window.CSL_CHROME=t())}(function(){if("undefined"==typeof t)var t;var e=["font-style","font-variant","font-weight","text-decoration","text-case"],i=function(){"undefined"==typeof DOMParser||t?(t=!0,DOMParser=function(){},DOMParser.prototype.parseFromString=function(t,e){if("undefined"!=typeof ActiveXObject){var i=new ActiveXObject("MSXML.DomDocument");return i.async=!1,i.loadXML(t),i}if("undefined"!=typeof XMLHttpRequest){var i=new XMLHttpRequest;return e||(e="text/xml"),i.open("GET","data:"+e+";charset=utf-8,"+encodeURIComponent(t),!1),i.overrideMimeType&&i.overrideMimeType(e),i.send(null),i.responseXML}},this.hasAttributes=function(t){var e;return e=t.attributes&&t.attributes.length?!0:!1}):this.hasAttributes=function(t){var e;return e=t.attributes&&t.attributes.length?!0:!1},this.importNode=function(t,e){if("undefined"==typeof t.importNode)var i=this._importNode(t,e,!0);else var i=t.importNode(e,!0);return i},this._importNode=function(t,e,i){switch(e.nodeType){case 1:var s=t.createElement(e.nodeName);if(e.attributes&&e.attributes.length>0)for(var r=0,a=e.attributes.length;a>r;)s.setAttribute(e.attributes[r].nodeName,e.getAttribute(e.attributes[r++].nodeName));if(i&&e.childNodes&&e.childNodes.length>0)for(var r=0,a=e.childNodes.length;a>r;)s.appendChild(this._importNode(t,e.childNodes[r++],i));return s;case 3:case 4:case 8:}},this.parser=new DOMParser;var e='<docco><institution institution-parts="long" delimiter=", " substitute-use-first="1" use-last="1"><institution-part name="long"/></institution></docco>',i=this.parser.parseFromString(e,"text/xml"),s=i.getElementsByTagName("institution");this.institution=s.item(0);var r=i.getElementsByTagName("institution-part");this.institutionpart=r.item(0),this.ns="http://purl.org/net/xbiblio/csl"};return i.prototype.clean=function(t){return t=t.replace(/<\?[^?]+\?>/g,""),t=t.replace(/<![^>]+>/g,""),t=t.replace(/^\s+/,""),t=t.replace(/\s+$/,""),t=t.replace(/^\n*/,"")},i.prototype.getStyleId=function(t){var e="",i=t.getElementsByTagName("id");return i&&i.length&&(i=i.item(0)),i&&(e=i.textContent),e||(e=i.innerText),e||(e=i.innerHTML),e},i.prototype.children=function(t){var e,i,s,r;if(t){for(r=[],e=t.childNodes,i=0,s=e.length;s>i;i+=1)"#text"!=e[i].nodeName&&r.push(e[i]);return r}return[]},i.prototype.nodename=function(t){var e=t.nodeName;return e},i.prototype.attributes=function(t){var e,i,s,r,a;if(e=new Object,t&&this.hasAttributes(t))for(i=t.attributes,r=0,a=i.length;a>r;r+=1)s=i[r],e["@"+s.name]=s.value;return e},i.prototype.content=function(t){var e;return e="undefined"!=typeof t.textContent?t.textContent:"undefined"!=typeof t.innerText?t.innerText:t.txt},i.prototype.namespace={xml:"http://www.w3.org/XML/1998/namespace"},i.prototype.numberofnodes=function(t){return t?t.length:0},i.prototype.getAttributeName=function(t){var e=t.name;return e},i.prototype.getAttributeValue=function(t,e,i){var s="";return i&&(e=i+":"+e),t&&this.hasAttributes(t)&&t.getAttribute(e)&&(s=t.getAttribute(e)),s},i.prototype.getNodeValue=function(t,e){var i="";if(e){var s=t.getElementsByTagName(e);s.length>0&&(i="undefined"!=typeof s[0].textContent?s[0].textContent:"undefined"!=typeof s[0].innerText?s[0].innerText:s[0].text)}else i=t;return i&&i.childNodes&&(0==i.childNodes.length||1==i.childNodes.length&&"#text"==i.firstChild.nodeName)&&(i="undefined"!=typeof i.textContent?i.textContent:"undefined"!=typeof i.innerText?i.innerText:i.text),i},i.prototype.setAttributeOnNodeIdentifiedByNameAttribute=function(t,e,i,s,r){var a,n,o,l;for("@"===s.slice(0,1)&&(s=s.slice(1)),o=t.getElementsByTagName(e),a=0,n=o.length;n>a;a+=1)l=o[a],l.getAttribute("name")==i&&l.setAttribute(s,r)},i.prototype.deleteNodeByNameAttribute=function(t,e){var i,s,r,a;for(a=t.childNodes,i=0,s=a.length;s>i;i+=1)r=a[i],r&&r.nodeType!=r.TEXT_NODE&&this.hasAttributes(r)&&r.getAttribute("name")==e&&t.removeChild(a[i])},i.prototype.deleteAttribute=function(t,e){t.removeAttribute(e)},i.prototype.setAttribute=function(t,e,i){return t.ownerDocument||(t=t.firstChild),["function","unknown"].indexOf(typeof t.setAttribute)>-1&&t.setAttribute(e,i),!1},i.prototype.nodeCopy=function(t){var e=t.cloneNode(!0);return e},i.prototype.getNodesByName=function(t,e,i){var s,r,a,n,o;for(s=[],r=t.getElementsByTagName(e),n=0,o=r.length;o>n;n+=1)a=r.item(n),(!i||this.hasAttributes(a)&&a.getAttribute("name")==i)&&s.push(a);return s},i.prototype.nodeNameIs=function(t,e){return e==t.nodeName?!0:!1},i.prototype.makeXml=function(t){t||(t="<docco><bogus/></docco>"),t=t.replace(/\s*<\?[^>]*\?>\s*\n*/g,"");
var e=this.parser.parseFromString(t,"application/xml");return e.firstChild},i.prototype.insertChildNodeAfter=function(t,e,i,s){var r;return r=this.importNode(e.ownerDocument,s),t.replaceChild(r,e),t},i.prototype.insertPublisherAndPlace=function(t){for(var e=t.getElementsByTagName("group"),i=0,s=e.length;s>i;i+=1){for(var r=e.item(i),a=[],n=0,o=r.childNodes.length;o>n;n+=1)1!==r.childNodes.item(n).nodeType&&a.push(n);if(r.childNodes.length-a.length===2){for(var l=[],n=0,o=2;o>n;n+=1)if(!(a.indexOf(n)>-1)){for(var u=r.childNodes.item(n),p=[],h=0,c=u.childNodes.length;c>h;h+=1)1!==u.childNodes.item(h).nodeType&&p.push(h);if(u.childNodes.length-p.length===0&&(l.push(u.getAttribute("variable")),u.getAttribute("suffix")||u.getAttribute("prefix"))){l=[];break}}l.indexOf("publisher")>-1&&l.indexOf("publisher-place")>-1&&r.setAttribute("has-publisher-and-publisher-place",!0)}}},i.prototype.addMissingNameNodes=function(t){for(var e=t.getElementsByTagName("names"),i=0,s=e.length;s>i;i+=1){var r=e.item(i),a=r.getElementsByTagName("name");if((!a||0===a.length)&&"substitute"!==r.parentNode.tagName.toLowerCase()){var n=r.ownerDocument,o=n.createElement("name");r.appendChild(o)}}},i.prototype.addInstitutionNodes=function(t){var i,s,r,a,n,o,l,u;for(i=t.getElementsByTagName("names"),l=0,u=i.length;u>l;l+=1)if(s=i.item(l),n=s.getElementsByTagName("name"),0!=n.length&&(r=s.getElementsByTagName("institution"),0==r.length)){a=this.importNode(t.ownerDocument,this.institution),theinstitutionpart=a.getElementsByTagName("institution-part").item(0),o=n.item(0),s.insertBefore(a,o.nextSibling);for(var p=0,h=e.length;h>p;p+=1){var c=e[p],m=o.getAttribute(c);m&&theinstitutionpart.setAttribute(c,m)}for(var f=o.getElementsByTagName("name-part"),p=0,h=f.length;h>p;p+=1)if("family"===f[p].getAttribute("name"))for(var d=0,g=e.length;g>d;d+=1){var c=e[d],m=f[p].getAttribute(c);m&&theinstitutionpart.setAttribute(c,m)}}},i.prototype.flagDateMacros=function(t){var e,i,s,r;for(nodes=t.getElementsByTagName("macro"),e=0,i=nodes.length;i>e;e+=1)s=nodes.item(e),r=s.getElementsByTagName("date"),r.length&&s.setAttribute("macro-has-date","true")},i}),/*
 * Copyright (c) 2009, 2010 and 2011 Frank G. Bennett, Jr. All Rights
 * Reserved.
 *
 * The contents of this file are subject to the Common Public
 * Attribution License Version 1.0 (the “License”); you may not use
 * this file except in compliance with the License. You may obtain a
 * copy of the License at:
 *
 * http://bitbucket.org/fbennett/citeproc-js/src/tip/LICENSE.
 *
 * The License is based on the Mozilla Public License Version 1.1 but
 * Sections 14 and 15 have been added to cover use of software over a
 * computer network and provide for limited attribution for the
 * Original Developer. In addition, Exhibit A has been modified to be
 * consistent with Exhibit B.
 *
 * Software distributed under the License is distributed on an “AS IS”
 * basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See
 * the License for the specific language governing rights and limitations
 * under the License.
 *
 * The Original Code is the citation formatting software known as
 * "citeproc-js" (an implementation of the Citation Style Language
 * [CSL]), including the original test fixtures and software located
 * under the ./std subdirectory of the distribution archive.
 *
 * The Original Developer is not the Initial Developer and is
 * __________. If left blank, the Original Developer is the Initial
 * Developer.
 *
 * The Initial Developer of the Original Code is Frank G. Bennett,
 * Jr. All portions of the code written by Frank G. Bennett, Jr. are
 * Copyright (c) 2009, 2010 and 2011 Frank G. Bennett, Jr. All Rights Reserved.
 *
 * Alternatively, the contents of this file may be used under the
 * terms of the GNU Affero General Public License (the [AGPLv3]
 * License), in which case the provisions of [AGPLv3] License are
 * applicable instead of those above. If you wish to allow use of your
 * version of this file only under the terms of the [AGPLv3] License
 * and not to allow others to use your version of this file under the
 * CPAL, indicate your decision by deleting the provisions above and
 * replace them with the notice and other provisions required by the
 * [AGPLv3] License. If you do not delete the provisions above, a
 * recipient may use your version of this file under either the CPAL
 * or the [AGPLv3] License.”
 */
function(t){"object"==typeof exports?module.exports=t(require("xmldom")):"function"==typeof define&&define.amd?define("citeproc/citeproc",["citeproc/xmldom"],t):"undefined"!=typeof _&&"undefined"!=typeof CSL_CHROME&&(window.CSL=t(CSL_CHROME))}(function(t){Array.indexOf||(Array.prototype.indexOf=function(t){var e,i;for(e=0,i=this.length;i>e;e+=1)if(this[e]===t)return e;return-1});var e={PROCESSOR_VERSION:"1.0.552",CONDITION_LEVEL_TOP:1,CONDITION_LEVEL_BOTTOM:2,PLAIN_HYPHEN_REGEX:/(?:[^\\]-|\u2013)/,LOCATOR_LABELS_REGEXP:new RegExp("^((art|ch|Ch|subch|col|fig|l|n|no|op|p|pp|para|subpara|pt|r|sec|subsec|Sec|sv|sch|tit|vrs|vol)\\.)\\s+(.*)"),STATUTE_SUBDIV_GROUPED_REGEX:/((?:^| )(?:art|ch|Ch|subch|p|pp|para|subpara|pt|r|sec|subsec|Sec|sch|tit)\.)/g,STATUTE_SUBDIV_PLAIN_REGEX:/(?:(?:^| )(?:art|ch|Ch|subch|p|pp|para|subpara|pt|r|sec|subsec|Sec|sch|tit)\.)/,STATUTE_SUBDIV_STRINGS:{"art.":"article","bk.":"book","ch.":"chapter","Ch.":"Chapter","subch.":"subchapter","p.":"page","pp.":"page","para.":"paragraph","subpara.":"subparagraph","pt.":"part","r.":"rule","sec.":"section","subsec.":"subsection","Sec.":"Section","sch.":"schedule","tit.":"title","col.":"column","fig.":"figure","fol.":"folio","l.":"line","n.":"note","no.":"issue","op.":"opus","sv.":"sub-verbo","vrs.":"verse","vol.":"volume"},STATUTE_SUBDIV_STRINGS_REVERSE:{article:"art.",book:"bk.",chapter:"ch.",Chapter:"Ch.",subchapter:"subch.",page:"p.",paragraph:"para.",subparagraph:"subpara.",part:"pt.",rule:"r.",section:"sec.",subsection:"subsec.",Section:"Sec.",schedule:"sch.",title:"tit.",column:"col.",figure:"fig.",folio:"fol.",line:"l.",note:"n.",issue:"no.",opus:"op.","sub-verbo":"sv.","sub verbo":"sv.",verse:"vrs.",volume:"vol."},LOCATOR_LABELS_MAP:{art:"article",bk:"book",ch:"chapter",Ch:"Chapter",subch:"subchapter",col:"column",fig:"figure",fol:"folio",l:"line",n:"note",no:"issue",op:"opus",p:"page",pp:"page",para:"paragraph",subpara:"subparagraph",pt:"part",r:"rule",sec:"section",subsec:"subsection",Sec:"Section",sv:"sub-verbo",sch:"schedule",tit:"title",vrs:"verse",vol:"volume"},NestedBraces:[["(","["],[")","]"]],checkNestedBraceOpen:new RegExp(".*\\("),checkNestedBraceClose:new RegExp(".*\\)"),LangPrefsMap:{title:"titles","title-short":"titles","container-title":"journals","collection-title":"journals",publisher:"publishers",authority:"publishers","publisher-place":"places","event-place":"places",number:"number",edition:"number",issue:"number",volume:"number"},AbbreviationSegments:function(){this["container-title"]={},this["collection-title"]={},this["institution-entire"]={},this["institution-part"]={},this.nickname={},this.number={},this.title={},this.place={},this.hereinafter={},this.classic={},this["container-phrase"]={},this["title-phrase"]={}},GENDERS:["masculine","feminine"],ERROR_NO_RENDERED_FORM:1,PREVIEW:"Just for laughs.",ASSUME_ALL_ITEMS_REGISTERED:2,START:0,END:1,SINGLETON:2,SEEN:6,SUCCESSOR:3,SUCCESSOR_OF_SUCCESSOR:4,SUPPRESS:5,SINGULAR:0,PLURAL:1,LITERAL:!0,BEFORE:1,AFTER:2,DESCENDING:1,ASCENDING:2,ONLY_FIRST:1,ALWAYS:2,ONLY_LAST:3,FINISH:1,POSITION_FIRST:0,POSITION_SUBSEQUENT:1,POSITION_IBID:2,POSITION_IBID_WITH_LOCATOR:3,MARK_TRAILING_NAMES:!0,POSITION_TEST_VARS:["position","first-reference-note-number","near-note"],AREAS:["citation","citation_sort","bibliography","bibliography_sort"],MULTI_FIELDS:["event","publisher","publisher-place","event-place","title","container-title","collection-title","authority","edition","genre","title-short","medium","jurisdiction","archive","archive-place"],CITE_FIELDS:["first-reference-note-number","locator","locator-revision"],MINIMAL_NAME_FIELDS:["literal","family"],SWAPPING_PUNCTUATION:[".","!","?",":",","],TERMINAL_PUNCTUATION:[":",".",";","!","?"," "],NONE:0,NUMERIC:1,POSITION:2,COLLAPSE_VALUES:["citation-number","year","year-suffix"],DATE_PARTS:["year","month","day"],DATE_PARTS_ALL:["year","month","day","season"],DATE_PARTS_INTERNAL:["year","month","day","year_end","month_end","day_end"],NAME_PARTS:["family","given","dropping-particle","non-dropping-particle","suffix","literal"],DECORABLE_NAME_PARTS:["given","family","suffix"],DISAMBIGUATE_OPTIONS:["disambiguate-add-names","disambiguate-add-givenname","disambiguate-add-year-suffix"],GIVENNAME_DISAMBIGUATION_RULES:["all-names","all-names-with-initials","primary-name","primary-name-with-initials","by-cite"],NAME_ATTRIBUTES:["and","delimiter-precedes-last","delimiter-precedes-et-al","initialize-with","initialize","name-as-sort-order","sort-separator","et-al-min","et-al-use-first","et-al-subsequent-min","et-al-subsequent-use-first","form","prefix","suffix","delimiter"],PARALLEL_MATCH_VARS:["container-title"],PARALLEL_TYPES:["bill","gazette","regulation","legislation","legal_case","treaty","article-magazine","article-journal"],PARALLEL_COLLAPSING_MID_VARSET:["volume","issue","container-title","section","collection-number"],LOOSE:0,STRICT:1,TOLERANT:2,PREFIX_PUNCTUATION:/[.;:]\s*$/,SUFFIX_PUNCTUATION:/^\s*[.;:,\(\)]/,NUMBER_REGEXP:/(?:^\d+|\d+$)/,NAME_INITIAL_REGEXP:/^([A-Z\u0590-\u05ff\u0080-\u017f\u0400-\u042f\u0600-\u06ff\u0370\u0372\u0376\u0386\u0388-\u03ab\u03e2\u03e4\u03e6\u03e8\u03ea\u03ec\u03ee\u03f4\u03f7\u03fd-\u03ff])([a-zA-Z\u0080-\u017f\u0400-\u052f\u0600-\u06ff\u0370-\u03ff\u1f00-\u1fff]*|)/,ROMANESQUE_REGEXP:/[-0-9a-zA-Z\u0590-\u05d4\u05d6-\u05ff\u0080-\u017f\u0400-\u052f\u0370-\u03ff\u1f00-\u1fff\u0600-\u06ff\u200c\u200d\u200e\u0218\u0219\u021a\u021b\u202a-\u202e]/,ROMANESQUE_NOT_REGEXP:/[^a-zA-Z\u0590-\u05ff\u0080-\u017f\u0400-\u052f\u0370-\u03ff\u1f00-\u1fff\u0600-\u06ff\u200c\u200d\u200e\u0218\u0219\u021a\u021b\u202a-\u202e]/g,STARTSWITH_ROMANESQUE_REGEXP:/^[&a-zA-Z\u0590-\u05d4\u05d6-\u05ff\u0080-\u017f\u0400-\u052f\u0370-\u03ff\u1f00-\u1fff\u0600-\u06ff\u200c\u200d\u200e\u0218\u0219\u021a\u021b\u202a-\u202e]/,ENDSWITH_ROMANESQUE_REGEXP:/[.;:&a-zA-Z\u0590-\u05d4\u05d6-\u05ff\u0080-\u017f\u0400-\u052f\u0370-\u03ff\u1f00-\u1fff\u0600-\u06ff\u200c\u200d\u200e\u0218\u0219\u021a\u021b\u202a-\u202e]$/,ALL_ROMANESQUE_REGEXP:/^[a-zA-Z\u0590-\u05ff\u0080-\u017f\u0400-\u052f\u0370-\u03ff\u1f00-\u1fff\u0600-\u06ff\u200c\u200d\u200e\u0218\u0219\u021a\u021b\u202a-\u202e]+$/,VIETNAMESE_SPECIALS:/[\u00c0-\u00c3\u00c8-\u00ca\u00cc\u00cd\u00d2-\u00d5\u00d9\u00da\u00dd\u00e0-\u00e3\u00e8-\u00ea\u00ec\u00ed\u00f2-\u00f5\u00f9\u00fa\u00fd\u0101\u0103\u0110\u0111\u0128\u0129\u0168\u0169\u01a0\u01a1\u01af\u01b0\u1ea0-\u1ef9]/,VIETNAMESE_NAMES:/^(?:(?:[.AaBbCcDdEeGgHhIiKkLlMmNnOoPpQqRrSsTtUuVvXxYy \u00c0-\u00c3\u00c8-\u00ca\u00cc\u00cd\u00d2-\u00d5\u00d9\u00da\u00dd\u00e0-\u00e3\u00e8-\u00ea\u00ec\u00ed\u00f2-\u00f5\u00f9\u00fa\u00fd\u0101\u0103\u0110\u0111\u0128\u0129\u0168\u0169\u01a0\u01a1\u01af\u01b0\u1ea0-\u1ef9]{2,6})(\s+|$))+$/,NOTE_FIELDS_REGEXP:/\{:(?:[\-_a-z]+|[A-Z]+):[^\}]+\}/g,NOTE_FIELD_REGEXP:/\{:([\-_a-z]+|[A-Z]+):\s*([^\}]+)\}/,DISPLAY_CLASSES:["block","left-margin","right-inline","indent"],NAME_VARIABLES:["author","editor","translator","contributor","collection-editor","composer","container-author","director","editorial-director","interviewer","original-author","recipient"],NUMERIC_VARIABLES:["call-number","chapter-number","collection-number","edition","page","issue","locator","number","number-of-pages","number-of-volumes","volume","citation-number"],DATE_VARIABLES:["locator-date","issued","event-date","accessed","container","original-date","publication-date","original-date","available-date","submitted"],TAG_ESCAPE:function(t){var e,i,s,r,a;for(e=t.match(/((?:\"|\')|(?:(?:<span\s+class=\"no(?:case|decor)\">).*?(?:<\/span>|<\/?(?:i|sc|b)>)))/g),i=t.split(/(?:(?:\"|\')|(?:(?:<span\s+class=\"no(?:case|decor)\">).*?(?:<\/span>|<\/?(?:i|sc|b)>)))/g),a=[i[0]],r=1,s=i.length;s>r;r+=1)a.push(e[r-1]),a.push(i[r]);return i=a.slice()},TAG_USEALL:function(t){var e,i,s,r;for(e=[""],i=t.indexOf("<"),s=t.indexOf(">");i>-1&&s>-1;)r=i>s?i+1:s+1,s>i&&-1===t.slice(i+1,s).indexOf("<")?(e[e.length-1]+=t.slice(0,i),e.push(t.slice(i,s+1)),e.push(""),t=t.slice(r)):(e[e.length-1]+=t.slice(0,s+1),t=t.slice(r)),i=t.indexOf("<"),s=t.indexOf(">");return e[e.length-1]+=t,e},SKIP_WORDS:["about","above","across","afore","after","against","along","alongside","amid","amidst","among","amongst","anenst","apropos","apud","around","as","aside","astride","at","athwart","atop","barring","before","behind","below","beneath","beside","besides","between","beyond","but","by","circa","despite","down","during","except","for","forenenst","from","given","in","inside","into","lest","like","modulo","near","next","notwithstanding","of","off","on","onto","out","over","per","plus","pro","qua","sans","since","than","through"," thru","throughout","thruout","till","to","toward","towards","under","underneath","until","unto","up","upon","versus","vs.","v.","vs","v","via","vis-\xe0-vis","with","within","without","according to","ahead of","apart from","as for","as of","as per","as regards","aside from","back to","because of","close to","due to","except for","far from","inside of","instead of","near to","next to","on to","out from","out of","outside of","prior to","pursuant to","rather than","regardless of","such as","that of","up to","where as","or","yet","so","for","and","nor","a","an","the","de","d'","von","van","c","et","ca"],FORMAT_KEY_SEQUENCE:["@strip-periods","@font-style","@font-variant","@font-weight","@text-decoration","@vertical-align","@quotes"],INSTITUTION_KEYS:["font-style","font-variant","font-weight","text-decoration","text-case"],SUFFIX_CHARS:"a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z",ROMAN_NUMERALS:[["","i","ii","iii","iv","v","vi","vii","viii","ix"],["","x","xx","xxx","xl","l","lx","lxx","lxxx","xc"],["","c","cc","ccc","cd","d","dc","dcc","dccc","cm"],["","m","mm","mmm","mmmm","mmmmm"]],CREATORS:["author","editor","contributor","translator","recipient","interviewer","composer","original-author","container-author","collection-editor"],LANGS:{"af-ZA":"Afrikaans","ar-AR":"Arabic","bg-BG":"Bulgarian","ca-AD":"Catalan","cs-CZ":"Czech","da-DK":"Danish","de-AT":"Austrian","de-CH":"German (CH)","de-DE":"German (DE)","el-GR":"Greek","en-GB":"English (GB)","en-US":"English (US)","es-ES":"Spanish","et-EE":"Estonian",eu:"European","fa-IR":"Persian","fi-FI":"Finnish","fr-CA":"French (CA)","fr-FR":"French (FR)","he-IL":"Hebrew","hr-HR":"Croatian","hu-HU":"Hungarian","is-IS":"Icelandic","it-IT":"Italian","ja-JP":"Japanese","km-KH":"Khmer","ko-KR":"Korean","lt-LT":"Lithuanian","lv-LV":"Latvian","mn-MN":"Mongolian","nb-NO":"Norwegian (Bokm\xe5l)","nl-NL":"Dutch","nn-NO":"Norwegian (Nynorsk)","pl-PL":"Polish","pt-BR":"Portuguese (BR)","pt-PT":"Portuguese (PT)","ro-RO":"Romanian","ru-RU":"Russian","sk-SK":"Slovak","sl-SI":"Slovenian","sr-RS":"Serbian","sv-SE":"Swedish","th-TH":"Thai","tr-TR":"Turkish","uk-UA":"Ukranian","vi-VN":"Vietnamese","zh-CN":"Chinese (CN)","zh-TW":"Chinese (TW)"},LANG_BASES:{af:"af_ZA",ar:"ar_AR",bg:"bg_BG",ca:"ca_AD",cs:"cs_CZ",da:"da_DK",de:"de_DE",el:"el_GR",en:"en_US",es:"es_ES",et:"et_EE",eu:"eu",fa:"fa_IR",fi:"fi_FI",fr:"fr_FR",he:"he_IL",hu:"hu_HU",is:"is_IS",it:"it_IT",ja:"ja_JP",km:"km_KH",ko:"ko_KR",lt:"lt_LT",mn:"mn_MN",nb:"nb_NO",nl:"nl_NL",nn:"nn-NO",pl:"pl_PL",pt:"pt_PT",ro:"ro_RO",ru:"ru_RU",sk:"sk_SK",sl:"sl_SI",sr:"sr_RS",sv:"sv_SE",th:"th_TH",tr:"tr_TR",uk:"uk_UA",vi:"vi_VN",zh:"zh_CN"},SUPERSCRIPTS:{"\xaa":"a","\xb2":"2","\xb3":"3","\xb9":"1","\xba":"o","\u02b0":"h","\u02b1":"\u0266","\u02b2":"j","\u02b3":"r","\u02b4":"\u0279","\u02b5":"\u027b","\u02b6":"\u0281","\u02b7":"w","\u02b8":"y","\u02e0":"\u0263","\u02e1":"l","\u02e2":"s","\u02e3":"x","\u02e4":"\u0295","\u1d2c":"A","\u1d2d":"\xc6","\u1d2e":"B","\u1d30":"D","\u1d31":"E","\u1d32":"\u018e","\u1d33":"G","\u1d34":"H","\u1d35":"I","\u1d36":"J","\u1d37":"K","\u1d38":"L","\u1d39":"M","\u1d3a":"N","\u1d3c":"O","\u1d3d":"\u0222","\u1d3e":"P","\u1d3f":"R","\u1d40":"T","\u1d41":"U","\u1d42":"W","\u1d43":"a","\u1d44":"\u0250","\u1d45":"\u0251","\u1d46":"\u1d02","\u1d47":"b","\u1d48":"d","\u1d49":"e","\u1d4a":"\u0259","\u1d4b":"\u025b","\u1d4c":"\u025c","\u1d4d":"g","\u1d4f":"k","\u1d50":"m","\u1d51":"\u014b","\u1d52":"o","\u1d53":"\u0254","\u1d54":"\u1d16","\u1d55":"\u1d17","\u1d56":"p","\u1d57":"t","\u1d58":"u","\u1d59":"\u1d1d","\u1d5a":"\u026f","\u1d5b":"v","\u1d5c":"\u1d25","\u1d5d":"\u03b2","\u1d5e":"\u03b3","\u1d5f":"\u03b4","\u1d60":"\u03c6","\u1d61":"\u03c7","\u2070":"0","\u2071":"i","\u2074":"4","\u2075":"5","\u2076":"6","\u2077":"7","\u2078":"8","\u2079":"9","\u207a":"+","\u207b":"\u2212","\u207c":"=","\u207d":"(","\u207e":")","\u207f":"n","\u2120":"SM","\u2122":"TM","\u3192":"\u4e00","\u3193":"\u4e8c","\u3194":"\u4e09","\u3195":"\u56db","\u3196":"\u4e0a","\u3197":"\u4e2d","\u3198":"\u4e0b","\u3199":"\u7532","\u319a":"\u4e59","\u319b":"\u4e19","\u319c":"\u4e01","\u319d":"\u5929","\u319e":"\u5730","\u319f":"\u4eba","\u02c0":"\u0294","\u02c1":"\u0295","\u06e5":"\u0648","\u06e6":"\u064a"},SUPERSCRIPTS_REGEXP:new RegExp("[\xaa\xb2\xb3\xb9\xba\u02b0\u02b1\u02b2\u02b3\u02b4\u02b5\u02b6\u02b7\u02b8\u02e0\u02e1\u02e2\u02e3\u02e4\u1d2c\u1d2d\u1d2e\u1d30\u1d31\u1d32\u1d33\u1d34\u1d35\u1d36\u1d37\u1d38\u1d39\u1d3a\u1d3c\u1d3d\u1d3e\u1d3f\u1d40\u1d41\u1d42\u1d43\u1d44\u1d45\u1d46\u1d47\u1d48\u1d49\u1d4a\u1d4b\u1d4c\u1d4d\u1d4f\u1d50\u1d51\u1d52\u1d53\u1d54\u1d55\u1d56\u1d57\u1d58\u1d59\u1d5a\u1d5b\u1d5c\u1d5d\u1d5e\u1d5f\u1d60\u1d61\u2070\u2071\u2074\u2075\u2076\u2077\u2078\u2079\u207a\u207b\u207c\u207d\u207e\u207f\u2120\u2122\u3192\u3193\u3194\u3195\u3196\u3197\u3198\u3199\u319a\u319b\u319c\u319d\u319e\u319f\u02c0\u02c1\u06e5\u06e6]","g"),locale:{},locale_opts:{},locale_dates:{}};if("undefined"!=typeof require&&"undefined"!=typeof module&&"exports"in module){var s=!0,r=require("./csl_nodejs_jsdom").CSL_NODEJS_JSDOM;exports.CSL=e}e.TERMINAL_PUNCTUATION_REGEXP=new RegExp("^(["+e.TERMINAL_PUNCTUATION.slice(0,-1).join("")+"])(.*)"),e.CLOSURES=new RegExp(".*[\\]\\)]"),"object"==typeof console&&"function"==typeof console.log?(e.debug=function(t){console.log("CSL: "+t)},e.error=function(t){console.log("CSL error: "+t)}):(e.debug=function(){},e.error=function(t){throw"CSL error: "+t});var a;return a="undefined"!=typeof s?r:"undefined"!=typeof CSL_E4X?CSL_E4X:"undefined"!=typeof CSL_JSON?CSL_JSON:t,e.System={},e.System.Xml={Parsing:a},e.getSortCompare=function(t){if(e.stringCompare)return e.stringCompare;var i,s={sensitivity:"base",ignorePunctuation:!0,numeric:!0};t||(t="en-US"),i=function(e,i){return e.toLocaleLowerCase().localeCompare(i.toLocaleLowerCase(),t,s)};var r=function(t){return t.replace(/^[\[\]\'\"]*/g,"")},a=function(){return i("[x","x")?function(t,e){return i(r(t),r(e))}:!1},n=a(),o=function(t,e){return n?n(t,e):i(t,e)};return o},e.ambigConfigDiff=function(t,e){var i,s,r,a;if(t.names.length!==e.names.length)return 1;for(i=0,s=t.names.length;s>i;i+=1){if(t.names[i]!==e.names[i])return 1;for(r=0,a=t.givens[i];a>r;r+=1)if(t.givens[i][r]!==e.givens[i][r])return 1}return t.disambiguate!=e.disambiguate?1:t.year_suffix!==e.year_suffix?1:0},e.cloneAmbigConfig=function(t,e){var i,s,r,a,n,o={};for(o.names=[],o.givens=[],o.year_suffix=!1,o.disambiguate=!1,i=0,s=t.names.length;s>i;i+=1)n=t.names[i],o.names[i]=n;for(i=0,s=t.givens.length;s>i;i+=1){for(n=[],r=0,a=t.givens[i].length;a>r;r+=1)n.push(t.givens[i][r]);o.givens.push(n)}return e?(o.year_suffix=e.year_suffix,o.disambiguate=e.disambiguate):(o.year_suffix=t.year_suffix,o.disambiguate=t.disambiguate),o},e.getAmbigConfig=function(){var t,i;return t=this.tmp.disambig_request,t||(t=this.tmp.disambig_settings),i=e.cloneAmbigConfig(t)},e.getMaxVals=function(){return this.tmp.names_max.mystack.slice()},e.getMinVal=function(){return this.tmp["et-al-min"]},e.tokenExec=function(t,e,i){var s,r,a,n,o,l;l=!1,s=t.next,r=!1;var u=function(e){return e?(this.tmp.jump.replace("succeed"),t.succeed):(this.tmp.jump.replace("fail"),t.fail)};for(t.test&&(s=u.call(this,t.test(e,i))),o=t.execs.length,n=0;o>n;n+=1)a=t.execs[n],r=a.call(t,this,e,i),r&&(s=r);return s},e.expandMacro=function(t){var i,s,r,a;if(i=t.postponed_macro,this.build.macro_stack.indexOf(i)>-1)throw'CSL processor error: call to macro "'+i+'" would cause an infinite loop';this.build.macro_stack.push(i);var n=!1,o=!1;if(s=this.sys.xml.getNodesByName(this.cslXml,"macro",i),s.length&&(o=this.sys.xml.getAttributeValue(s[0],"cslid"),n=this.sys.xml.getAttributeValue(s[0],"macro-has-date")),n&&(a=function(t){t.tmp.extension&&(t.tmp["doing-macro-with-date"]=!0)},t.execs.push(a)),t.tokentype=e.START,t.cslid=o,e.Node.group.build.call(t,this,this[this.build.area].tokens,!0),!this.sys.xml.getNodeValue(s))throw'CSL style error: undefined macro "'+i+'"';var l=e.makeBuilder(this);l(s[0]),r=new e.Token("group",e.END),t.decorations&&(r.decorations=t.decorations.slice()),n&&(a=function(t){t.tmp.extension&&(t.tmp["doing-macro-with-date"]=!1)},r.execs.push(a)),e.Node.group.build.call(r,this,this[this.build.area].tokens,!0),this.build.macro_stack.pop()},e.XmlToToken=function(t,i){var s,r,a,n,o,l,u,p;if(s=t.sys.xml.nodename(this),!t.build.skip||t.build.skip===s){if(!s)return r=t.sys.xml.content(this),void(r&&(t.build.text=r));if(!e.Node[t.sys.xml.nodename(this)])throw'Undefined node name "'+s+'".';if(a=[],n=t.sys.xml.attributes(this),o=e.setDecorations.call(this,t,n),l=new e.Token(s,i),i!==e.END||"if"===s||"else-if"===s||"layout"===s){for(u in n)if(n.hasOwnProperty(u)){if(i===e.END&&"@language"!==u&&"@locale"!==u)continue;if(n.hasOwnProperty(u))if(e.Attributes[u])try{e.Attributes[u].call(l,t,""+n[u])}catch(h){throw e.error(h),"CSL processor error, "+u+" attribute: "+h}else e.debug('warning: undefined attribute "'+u+'" in style')}l.decorations=o}else i===e.END&&n["@variable"]&&(l.hasVariable=!0);p=t[t.build.area].tokens,e.Node[s].build.call(l,t,p)}},e.DateParser=function(){var t,i,s,r,a,n,o,l,u,p,h,c,m,f,d,g,b,y,v,_,x,A,I,S,O;for(t=[["\u660e\u6cbb",1867],["\u5927\u6b63",1911],["\u662d\u548c",1925],["\u5e73\u6210",1988]],i={},I=t.length,o=0;I>o;o+=1)l=t[o][0],u=t[o][1],i[l]=u;for(S=[],o=0;I>o;o+=1)u=t[o][0],S.push(u);for(S=S.join("|"),s="(?:"+S+")(?:[0-9]+)",s=new RegExp(s),O="(?:"+S+")(?:[0-9]+)",O=new RegExp(O,"g"),a=/(\u6708|\u5E74)/g,r=/\u65E5/,n=/\u301c/g,p="(?:[?0-9]{1,2}%%NUMD%%){0,2}[?0-9]{4}(?![0-9])",h="[?0-9]{4}(?:%%NUMD%%[?0-9]{1,2}){0,2}(?![0-9])",c="[?0-9]{1,3}",m="[%%DATED%%]",f="[?~]",d="[a-zA-Z]+",g="("+h+"|"+p+"|"+c+"|"+m+"|"+f+"|"+d+")",b=new RegExp(g.replace(/%%NUMD%%/g,"-").replace(/%%DATED%%/g,"-")),y=new RegExp(g.replace(/%%NUMD%%/g,"-").replace(/%%DATED%%/g,"/")),v=new RegExp(g.replace(/%%NUMD%%/g,"/").replace(/%%DATED%%/g,"-")),_=[],x=[],I=_.length,o=0;I>o;o+=1)A=new RegExp(_[o]+".*"),x.push(A);this.mstrings="january february march april may june july august september october november december spring summer fall winter spring summer",this.mstrings=this.mstrings.split(" "),this.setOrderDayMonth=function(){this.monthguess=1,this.dayguess=0},this.setOrderMonthDay=function(){this.monthguess=0,this.dayguess=1},this.setOrderMonthDay(),this.resetMonths=function(){var t,e,i,s;for(this.msets=[],t=0,e=this.mstrings.length;e>t;t+=1)this.msets.push([this.mstrings[t]]);for(this.mabbrevs=[],t=0,e=this.msets.length;e>t;t+=1)for(this.mabbrevs.push([]),i=0,s=this.msets[t].length;s>i;i+=1)this.mabbrevs[t].push(this.msets[t][0].slice(0,3));for(this.mrexes=[],t=0,e=this.mabbrevs.length;e>t;t+=1)this.mrexes.push(new RegExp("(?:"+this.mabbrevs[t].join("|")+")"))},this.resetMonths(),this.addMonths=function(t){var i,s,r,a,n,o,l,u;if("string"==typeof t&&(t=t.split(/\s+/)),12!==t.length&&16!==t.length)return void e.debug("month [+season] list of "+t.length+", expected 12 or 16. Ignoring.");for(i=0,s=t.length;s>i;i+=1){var p=!1,h=!1,c=3,m={};for(r=0,a=this.mabbrevs.length;a>r;r+=1){if(m[r]={},r===i){for(n=0,o=this.mabbrevs[i].length;o>n;n+=1)if(this.mabbrevs[i][n]===t[i].slice(0,this.mabbrevs[i][n].length)){h=!0;break}}else for(n=0,o=this.mabbrevs[r].length;o>n;n+=1)if(p=this.mabbrevs[r][n].length,this.mabbrevs[r][n]===t[i].slice(0,p)){for(;this.msets[r][n].slice(0,p)===t[i].slice(0,p);){if(p>t[i].length||p>this.msets[r][n].length){e.debug("unable to disambiguate month string in date parser: "+t[i]);break}p+=1}c=p,m[r][n]=p}for(l in m)if(m.hasOwnProperty(l))for(u in m[l])m[l].hasOwnProperty(u)&&(p=m[l][u],l=parseInt(l,10),u=parseInt(u,10),this.mabbrevs[l][u]=this.msets[l][u].slice(0,p))}h||(this.msets[i].push(t[i]),this.mabbrevs[i].push(t[i].slice(0,c)))}for(this.mrexes=[],i=0,s=this.mabbrevs.length;s>i;i+=1)this.mrexes.push(new RegExp("(?:"+this.mabbrevs[i].join("|")+")"))},this.parse=function(t){var l,u,p,h,c,m,f,d,g,_,A,S,E,k,T,w,N,C,R,L,j,D,P,q,U,B,M,F,z,G;if(t&&(t=""+t,t=t.replace(/\s*[0-9]{2}:[0-9]{2}(?::[0-9]+)/,""),c=t.match(a))){if(t=t.replace(/\s+/,"","g"),t=t.replace(r,"","g"),t=t.replace(a,"-","g"),t=t.replace(n,"/","g"),t=t.replace("-/","/","g"),t=t.replace(/-$/,"","g"),P=t.split(s),p=[],D=t.match(O)){var V=[];for(o=0,I=D.length;I>o;o+=1)V=V.concat(D[o].match(/([^0-9]+)([0-9]+)/).slice(1));for(o=0,I=P.length;I>o;o+=1)p.push(P[o]),o!==I-1&&(q=2*o,p.push(V[q]),p.push(V[q+1]))}else p=P;for(h=p.length,o=1;h>o;o+=3)p[o+1]=i[p[o]]+parseInt(p[o+1],10),p[o]="";t=p.join(""),t=t.replace(/\s*-\s*$/,"").replace(/\s*-\s*\//,"/"),t=t.replace(/\.\s*$/,""),t=t.replace(/\.(?! )/,""),l=t.indexOf("/"),u=t.indexOf("-")}if(t=t.replace(/([A-Za-z])\./g,"$1"),m="",f="",d={},'"'===t.slice(0,1)&&'"'===t.slice(-1))return d.literal=t.slice(1,-1),d;for(l>-1&&u>-1?(g=t.split("/"),g.length>3?(_="-",A="/",p=t.split(v)):(_="/",A="-",p=t.split(y))):(t=t.replace("/","-"),_="-",A="-",p=t.split(b)),S=[],I=p.length,o=0;I>o;o+=1)R=p[o],c=R.match(/^\s*([\-\/]|[a-zA-Z]+|[\-~?0-9]+)\s*$/),c&&S.push(c[1]);for(E=S.indexOf(_),k=[],T=!1,E>-1?(k.push([0,E]),k.push([E+1,S.length]),T=!0):k.push([0,S.length]),w="",U=0,B=k.length;B>U;U+=1){for(L=k[U],N=S.slice(L[0],L[1]),M=0,F=N.length;F>M;M+=1)if(j=N[M],j.indexOf(A)>-1)this.parseNumericDate(d,A,w,j);else if(j.match(/[0-9]{4}/))d["year"+w]=j.replace(/^0*/,"");else{for(C=!1,z=0,G=this.mrexes.length;G>z;z+=1){if(j.toLocaleLowerCase().match(this.mrexes[z])){d["month"+w]=""+(parseInt(z,10)+1),C=!0;break}C||(j.match(/^[0-9]+$/)&&(m=parseInt(j,10)),j.toLocaleLowerCase().match(/^bc/)&&m?(d["year"+w]=""+-1*m,m=""):j.toLocaleLowerCase().match(/^ad/)&&m&&(d["year"+w]=""+m,m=""))}for(C=!1,z=0,G=x.length;G>z;z+=1)if(j.toLocaleLowerCase().match(x[z])){d["season"+w]=""+(parseInt(z,10)+1),C=!0;break}C||("~"===j||"?"===j||"c"===j||j.match(/^cir/)?d.circa="1":!j.toLocaleLowerCase().match(/(?:mic|tri|hil|eas)/)||d["season"+w]||(f=j))}m&&(d["day"+w]=m,m=""),f&&!d["season"+w]&&(d["season"+w]=f,f=""),w="_end"}if(T)for(M=0,F=e.DATE_PARTS_ALL.length;F>M;M+=1)R=e.DATE_PARTS_ALL[M],d[R]&&!d[R+"_end"]?d[R+"_end"]=d[R]:!d[R]&&d[R+"_end"]&&(d[R]=d[R+"_end"]);return d.year||(d={literal:t}),this.use_array&&this.toArray(d),d},this.returnAsArray=function(){this.use_array=!0},this.returnAsKeys=function(){this.use_array=!1},this.toArray=function(t){var e,i,s;t["date-parts"]=[],t["date-parts"].push([]);var r=0;for(e=0,i=3;i>e&&(s=["year","month","day"][e],t[s]);e+=1)r+=1,t["date-parts"][0].push(t[s]),delete t[s];for(t["date-parts"].push([]),e=0,i=r;i>e&&(s=["year_end","month_end","day_end"][e],t[s]);e+=1)t["date-parts"][1].push(t[s]),delete t[s];t["date-parts"][0].length!==t["date-parts"][1].length&&t["date-parts"].pop()},this.parseNumericDate=function(t,e,i,s){var r,a,n;for(r=s.split(e),a=0,n=r.length;n>a;a+=1)if(4===r[a].length){t["year"+i]=r[a].replace(/^0*/,""),r=a?r.slice(0,a):r.slice(1);break}for(a=0,n=r.length;n>a;a+=1)r[a]=parseInt(r[a],10);1===r.length||2===r.length&&!r[1]?t["month"+i]=""+r[0]:2===r.length&&(r[this.monthguess]>12?(t["month"+i]=""+r[this.dayguess],t["day"+i]=""+r[this.monthguess]):(t["month"+i]=""+r[this.monthguess],t["day"+i]=""+r[this.dayguess]))}},e.Engine=function(t,i,s,r){function a(t){var t=t.slice(),e=new RegExp("((?:[?!:]*\\s+|-|^)(?:"+t.join("|")+")(?=[!?:]*\\s+|-|$))");return e}var n,o;this.processor_version=e.PROCESSOR_VERSION,this.csl_version="1.0",this.sys=t,t.variableWrapper&&(e.VARIABLE_WRAPPER_PREPUNCT_REX=new RegExp("^(["+[" "].concat(e.SWAPPING_PUNCTUATION).join("")+"]*)(.*)")),this.sys.xml=new e.System.Xml.Parsing,"undefined"==typeof CSL_JSON&&"string"!=typeof i&&(i=""),e.getAbbreviation&&(this.sys.getAbbreviation=e.getAbbreviation),this.sys.stringCompare&&(e.stringCompare=this.sys.stringCompare),this.sys.AbbreviationSegments=e.AbbreviationSegments,this.parallel=new e.Parallel(this),this.transform=new e.Transform(this),this.setParseNames=function(t){this.opt["parse-names"]=t},this.opt=new e.Engine.Opt,this.tmp=new e.Engine.Tmp,this.build=new e.Engine.Build,this.fun=new e.Engine.Fun(this),this.configure=new e.Engine.Configure,this.citation_sort=new e.Engine.CitationSort,this.bibliography_sort=new e.Engine.BibliographySort,this.citation=new e.Engine.Citation(this),this.bibliography=new e.Engine.Bibliography,this.output=new e.Output.Queue(this),this.dateput=new e.Output.Queue(this),this.cslXml=this.sys.xml.makeXml(i),(this.opt.development_extensions.csl_reverse_lookup_support||this.sys.csl_reverse_lookup_support)&&(this.build.cslNodeId=0,this.setCslNodeIds=function(t,e){var i=this.sys.xml.children(t);this.sys.xml.setAttribute(t,"cslid",this.build.cslNodeId),this.opt.nodenames.push(e),this.build.cslNodeId+=1;for(var s=0,r=this.sys.xml.numberofnodes(i);r>s;s+=1)e=this.sys.xml.nodename(i[s]),e&&this.setCslNodeIds(i[s],e)},this.setCslNodeIds(this.cslXml,"style")),this.sys.xml.addMissingNameNodes(this.cslXml),this.sys.xml.addInstitutionNodes(this.cslXml),this.sys.xml.insertPublisherAndPlace(this.cslXml),this.sys.xml.flagDateMacros(this.cslXml),n=this.sys.xml.attributes(this.cslXml),"undefined"==typeof n["@sort-separator"]&&this.sys.xml.setAttribute(this.cslXml,"sort-separator",", "),this.opt["initialize-with-hyphen"]=!0,this.setStyleAttributes(),this.opt.xclass=t.xml.getAttributeValue(this.cslXml,"class"),this.opt["class"]=this.opt.xclass,this.opt.styleID=this.sys.xml.getStyleId(this.cslXml),this.opt.styleName=this.sys.xml.getStyleId(this.cslXml,!0),e.getSuppressJurisdictions&&(this.opt.suppressJurisdictions=e.getSuppressJurisdictions(this.opt.styleID)),"1.1m"===this.opt.version.slice(0,4)&&(this.opt.development_extensions.static_statute_locator=!0,this.opt.development_extensions.handle_parallel_articles=!0,this.opt.development_extensions.main_title_from_short_title=!0,this.opt.development_extensions.strict_page_numbers=!0,this.opt.development_extensions.rtl_support=!0,this.opt.development_extensions.expect_and_symbol_form=!0,this.opt.development_extensions.require_explicit_legal_case_title_short=!0),s&&(s=s.replace("_","-")),this.opt["default-locale"][0]&&(this.opt["default-locale"][0]=this.opt["default-locale"][0].replace("_","-")),s&&r&&(this.opt["default-locale"]=[s]),s&&!r&&this.opt["default-locale"][0]&&(s=this.opt["default-locale"][0]),0===this.opt["default-locale"].length&&(s||(s="en-US"),this.opt["default-locale"].push("en-US")),s||(s=this.opt["default-locale"][0]),o=e.localeResolve(s),this.opt.lang=o.best,this.opt["default-locale"][0]=o.best,this.locale={},this.opt["default-locale-sort"]||(this.opt["default-locale-sort"]=this.opt["default-locale"][0]),this.localeConfigure(o),this.locale[this.opt.lang].opts["skip-words-regexp"]=a(this.locale[this.opt.lang].opts["skip-words"]),this.output.adjust=new e.Output.Queue.adjust(this.getOpt("punctuation-in-quote")),this.registry=new e.Registry(this),this.buildTokenLists("citation"),this.buildTokenLists("bibliography"),this.configureTokenLists(),this.disambiguate=new e.Disambiguation(this),this.splice_delimiter=!1,this.fun.dateparser=new e.DateParser,this.fun.flipflopper=new e.Util.FlipFlopper(this),this.setCloseQuotesArray(),this.fun.ordinalizer.init(this),this.fun.long_ordinalizer.init(this),this.fun.page_mangler=e.Util.PageRangeMangler.getFunction(this,"page"),this.fun.year_mangler=e.Util.PageRangeMangler.getFunction(this,"year"),this.setOutputFormat("html")},e.Engine.prototype.setCloseQuotesArray=function(){var t;t=[],t.push(this.getTerm("close-quote")),t.push(this.getTerm("close-inner-quote")),t.push('"'),t.push("'"),this.opt.close_quotes_array=t},e.makeBuilder=function(t){function i(i){e.XmlToToken.call(i,t,e.START)}function s(i){e.XmlToToken.call(i,t,e.END)}function r(i){e.XmlToToken.call(i,t,e.SINGLETON)}function a(n){var o;if(t.sys.xml.numberofnodes(t.sys.xml.children(n))){o=n,i(o);for(var l=0;l<t.sys.xml.numberofnodes(t.sys.xml.children(o));l+=1)n=t.sys.xml.children(o)[l],null!==t.sys.xml.nodename(n)&&("date"===t.sys.xml.nodename(n)&&(e.Util.fixDateNode.call(t,o,l,n),n=t.sys.xml.children(o)[l]),a(n,i,s,r));s(o)}else r(n)}return a},e.Engine.prototype.buildTokenLists=function(t){var i,s=e.makeBuilder(this);if(i=this.sys.xml.getNodesByName(this.cslXml,t),this.sys.xml.getNodeValue(i)){this.build.area=t;var r=i[0];s(r)}},e.Engine.prototype.setStyleAttributes=function(){var t,i,s;t={};var r=this.cslXml,a=this.cslXml.tagName?(""+this.cslXml.tagName).toLowerCase():"";if("style"!==a&&"cslstyle"!==a&&this.cslXml.getElementsByTagName)var r=this.cslXml.getElementsByTagName("style")[0];t.name=this.sys.xml.nodename(r),i=this.sys.xml.attributes(r);for(s in i)i.hasOwnProperty(s)&&e.Attributes[s].call(t,this,i[s])},e.Engine.prototype.getTerm=function(t,i,s,r,a,n){t&&t.match(/[A-Z]/)&&t===t.toUpperCase()&&(e.debug("Warning: term key is in uppercase form: "+t),t=t.toLowerCase());var o;o=n?this.opt["default-locale"][0]:this.opt.lang;var l=e.Engine.getField(e.LOOSE,this.locale[o].terms,t,i,s,r);if(l||"range-delimiter"!==t||(l="\u2013"),"undefined"==typeof l){if(a===e.STRICT)throw'Error in getTerm: term "'+t+'" does not exist.';a===e.TOLERANT&&(l="")}return l&&(this.tmp.cite_renders_content=!0),l},e.Engine.prototype.getDate=function(t,e){var i;return i=e?this.opt["default-locale"]:this.opt.lang,this.locale[i].dates[t]?this.locale[i].dates[t]:!1},e.Engine.prototype.getOpt=function(t){return"undefined"!=typeof this.locale[this.opt.lang].opts[t]?this.locale[this.opt.lang].opts[t]:!1},e.Engine.prototype.getVariable=function(t,i,s,r){return e.Engine.getField(e.LOOSE,t,i,s,r)},e.Engine.prototype.getDateNum=function(t,e){return"undefined"==typeof t?0:t[e]},e.Engine.getField=function(t,i,s,r,a,n){var o,l,u,p,h,c;if(o="","undefined"==typeof i[s]){if(t===e.STRICT)throw'Error in getField: term "'+s+'" does not exist.';return void 0}for(c=n&&i[s][n]?i[s][n]:i[s],l=[],"symbol"===r?l=["symbol","short"]:"verb-short"===r?l=["verb-short","verb"]:"long"!==r&&(l=[r]),l=l.concat(["long"]),h=l.length,p=0;h>p;p+=1)if(u=l[p],"string"==typeof c||"number"==typeof c)o=c;else if("undefined"!=typeof c[u]){o="string"==typeof c[u]||"number"==typeof c[u]?c[u]:"number"==typeof a?c[u][a]:c[u][0];break}return o},e.Engine.prototype.configureTokenLists=function(){var t,i,s,r,a,n,o,l,u,p,h;for(t=["year","month","day"],u=e.AREAS.length,s=0;u>s;s+=1)for(i=e.AREAS[s],p=this[i].tokens.length-1,o=p;o>-1;o+=-1){if(r=this[i].tokens[o],"date"===r.name&&e.END===r.tokentype&&(a=[]),"date-part"===r.name&&r.strings.name)for(h=t.length,l=0;h>l;l+=1)n=t[l],n===r.strings.name&&a.push(r.strings.name);"date"===r.name&&e.START===r.tokentype&&(a.reverse(),r.dateparts=a),r.next=o+1,r.name&&e.Node[r.name].configure&&e.Node[r.name].configure.call(r,this,o)}return this.version=e.version,this.state},e.Engine.prototype.retrieveItems=function(t){var e;e=[];for(var i=0,s=t.length;s>i;i+=1)e.push(this.retrieveItem(""+t[i]));return e},e.ITERATION=0,e.Engine.prototype.retrieveItem=function(t){var i,s,r,a,n;if(this.opt.development_extensions.normalize_lang_keys_to_lowercase&&"boolean"==typeof this.opt.development_extensions.normalize_lang_keys_to_lowercase){for(var o=0,l=this.opt["default-locale"].length;l>o;o+=1)this.opt["default-locale"][o]=this.opt["default-locale"][o].toLowerCase();for(var o=0,l=this.opt["locale-translit"].length;l>o;o+=1)this.opt["locale-translit"][o]=this.opt["locale-translit"][o].toLowerCase();for(var o=0,l=this.opt["locale-translat"].length;l>o;o+=1)this.opt["locale-translat"][o]=this.opt["locale-translat"][o].toLowerCase();this.opt.development_extensions.normalize_lang_keys_to_lowercase=100}if(e.ITERATION+=1,i=this.sys.retrieveItem(""+t),this.opt.development_extensions.normalize_lang_keys_to_lowercase){if(i.multi){if(i.multi._keys)for(var u in i.multi._keys)for(var p in i.multi._keys[u])p!==p.toLowerCase()&&(i.multi._keys[u][p.toLowerCase()]=i.multi._keys[u][p],delete i.multi._keys[u][p]);if(i.multi.main)for(var u in i.multi.main)i.multi.main[u]=i.multi.main[u].toLowerCase()}for(var o=0,l=e.CREATORS.length;o>l;o+=1){var h=e.CREATORS[o];if(i[h]&&i[h].multi)for(var c=0,m=i[h].length;m>c;c+=1){var f=i[h][c];if(f.multi){if(f.multi._key)for(var p in f.multi._key)p!==p.toLowerCase()&&(f.multi._key[p.toLowerCase()]=f.multi._key[p],delete f.multi._key[p]);f.multi.main&&(f.multi.main=f.multi.main.toLowerCase())}}}}if(i.page){i["page-first"]=i.page;var d=""+i.page;
s=d.split(/\s*(?:&|,|-|\u2013)\s*/),"\\"!==s[0].slice(-1)&&(i["page-first"]=s[0])}if(this.opt.development_extensions.field_hack&&i.note&&(s=i.note.match(e.NOTE_FIELDS_REGEXP))){for(r=0,a=s.length;a>r;r+=1){if(n=s[r].match(e.NOTE_FIELD_REGEXP),!i[n[1]]&&e.DATE_VARIABLES.indexOf(n[1])>-1)i[n[1]]={raw:n[2]};else if(!i[n[1]]&&e.NAME_VARIABLES.indexOf(n[1])>-1){i[n[1]]||(i[n[1]]=[]);var g=n[2].split(/\s*\|\|\s*/);1===g.length?i[n[1]].push({family:g[0],isInstitution:!0}):2===g.length&&i[n[1]].push({family:g[0],given:g[1]})}else i[n[1]]&&"type"!==n[1]||(i[n[1]]=n[2].replace(/^\s+/,"").replace(/\s+$/,""));i.note.replace(e.NOTE_FIELD_REGEXP,"")}}for(var o=1,l=e.DATE_VARIABLES.length;l>o;o+=1){var b=i[e.DATE_VARIABLES[o]];b&&(this.opt.development_extensions.raw_date_parsing&&b.raw&&(b=this.fun.dateparser.parse(b.raw)),i[e.DATE_VARIABLES[o]]=this.dateParseArray(b))}if(this.opt.development_extensions.static_statute_locator&&i.type&&["bill","gazette","legislation","treaty"].indexOf(i.type)>-1){var y,v=["type","title","jurisdiction","genre","volume","container-title"],_=[];for(o=0,l=v.length;l>o;o+=1)y=v[o],i[y]&&_.push(i[y]);for(v=["original-date","issued"],o=0,v.length;l>o;o+=1)if(y=v[o],i[y]&&i[y].year){var x=i[y].year;_.push(x);break}i.legislation_id=_.join("::")}if(i["title-short"]||(i["title-short"]=i.shortTitle),this.opt.development_extensions.main_title_from_short_title&&(i["title-main"]=i.title,i["title-sub"]=!1,i.title&&i["title-short"])){var A=i["title-short"];if(offset=A.length,i.title.slice(0,offset)===A&&i.title.slice(offset).match(/^\s*:/)){if(i["title-main"]=i.title.slice(0,offset).replace(/\s+$/,""),i["title-sub"]=i.title.slice(offset).replace(/^\s*:\s*/,""),this.opt.development_extensions.uppercase_subtitles&&i["title-sub"])for(var I=i["title-sub"],o=0,l=I.length;l>o;o++)if(I.charAt(o).toLowerCase()!==I.charAt(o).toUpperCase()){i["title-sub"]=I.slice(0,o)+I.charAt(o).toUpperCase()+I.slice(o+1);break}var S=offset+i.title.length-i["title-main"].length-i["title-sub"].length;i.title=i.title.slice(0,S)+i["title-sub"]}}var O=["legal_case","legislation","gazette","regulation"].indexOf(i.type)>-1;if(!O&&i.title&&this.sys.getAbbreviation){var E=!1;i.jurisdiction||(E=!0);var k=this.transform.loadAbbreviation(i.jurisdiction,"title",i.title,i.type,!0);this.transform.abbrevs[k].title&&this.transform.abbrevs[k].title[i.title]&&(i["title-short"]=this.transform.abbrevs[k].title[i.title])}if(i["container-title-short"]=i.journalAbbreviation,i["container-title"]&&this.sys.getAbbreviation){var k=this.transform.loadAbbreviation(i.jurisdiction,"container-title",i["container-title"]);this.transform.abbrevs[k]["container-title"]&&this.transform.abbrevs[k]["container-title"][i["container-title"]]&&(i["container-title-short"]=this.transform.abbrevs[k]["container-title"][i["container-title"]])}return i},e.Engine.prototype.setOpt=function(t,e,i){"style"===t.name||"cslstyle"===t.name?this.opt[e]=i:["citation","bibliography"].indexOf(t.name)>-1?this[t.name].opt[e]=i:-1===["name-form","name-delimiter","names-delimiter"].indexOf(e)&&(t.strings[e]=i)},e.Engine.prototype.fixOpt=function(t,e,i){["citation","bibliography"].indexOf(t.name)>-1&&(this[t.name].opt[e]||"undefined"==typeof this.opt[e]||(this[t.name].opt[e]=this.opt[e])),("name"===t.name||"names"===t.name)&&"undefined"==typeof t.strings[i]&&"undefined"!=typeof this[this.build.root].opt[e]&&(t.strings[i]=this[this.build.root].opt[e])},e.Engine.prototype.remapSectionVariable=function(t){for(var i=0,s=t.length;s>i;i+=1){var r=t[i][0],a=t[i][1],n=!1;if(["bill","gazette","legislation","treaty"].indexOf(r.type)>-1){a.force_pluralism=0,a.label||(a.label="page");var o=["section","","",""];if(this.opt.development_extensions.static_statute_locator&&r.section?(l=r.section.replace(/^\s+/,"").replace(/\s+$/,"").split(/\s+/),e.STATUTE_SUBDIV_STRINGS[l[0]]?(o[0]=" "+l[0]+" ",o[1]=l.slice(1).join(" ")):(o[0]=" sec. ",o[1]=l.slice(0).join(" "))):this.opt.development_extensions.clobber_locator_if_no_statute_section&&(a.locator=void 0,a.label=void 0),a.locator){var l=a.locator.replace(/^\s+/,"").replace(/\s+$/,"").split(/\s+/);e.STATUTE_SUBDIV_STRINGS[l[0]]?(o[2]=" "+l[0]+" ",o[3]=l.slice(1).join(" ")):a.label?(o[2]=" "+e.STATUTE_SUBDIV_STRINGS_REVERSE[a.label]+" ",o[3]=l.slice(0).join(" ")):o[3]=l.join(" "),o[3]&&"&"===o[3].slice(0,1)&&(o[3]=" "+o[3])}if(o[2]||(o[2]=o[0]),o[3]){if(o[3].match(/^[^0-9a-zA-Z]/)){var u=o[3].split(/\s+/);o[0]===o[2]&&u[1]&&!e.STATUTE_SUBDIV_STRINGS[u[1].replace(/\s+/,"").replace(/\s+/,"")]&&(a.force_pluralism=1),o[2]=""}}else o[2]="";o[1]||(o[0]="");var n=o.join("");if(n=n.replace(/^\s+/,"").replace(/\s+$/,""))if(l=n.split(/\s+/),e.STATUTE_SUBDIV_STRINGS[l[0]]){for(var p=l.length-2;p>0;p+=-2)l[p]===l[0]&&(a.force_pluralism=1,l=l.slice(0,p).concat(l.slice(p+1)));a.label=e.STATUTE_SUBDIV_STRINGS[l[0]],a.locator=l.slice(1).join(" "),0===a.force_pluralism&&delete a.force_pluralism}else a.locator=l.slice(0).join(" ")}}},e.Engine.prototype.setNumberLabels=function(t){if(t.number&&["bill","gazette","legislation","treaty"].indexOf(t.type)>-1&&this.opt.development_extensions.static_statute_locator&&!this.tmp.shadow_numbers.number){this.tmp.shadow_numbers.number={},this.tmp.shadow_numbers.number.values=[],this.tmp.shadow_numbers.number.plural=0,this.tmp.shadow_numbers.number.numeric=!1,this.tmp.shadow_numbers.number.label=!1;var i=""+t.number;i=i.replace("\\","","g");var s=i.split(/\s/)[0],r=e.STATUTE_SUBDIV_STRINGS[s];if(r){var a=i.match(e.STATUTE_SUBDIV_GROUPED_REGEX),n=i.split(e.STATUTE_SUBDIV_PLAIN_REGEX);if(n.length>1){for(var o=[],l=1,u=n.length;u>l;l+=1){var p=a[l-1].replace(/^\s*/,"");o.push(p.replace("sec.","Sec.").replace("ch.","Ch.")),o.push(n[l].replace(/\s*$/,"").replace(/^\s*/,""))}i=o.join(" ")}else i=n[0];this.tmp.shadow_numbers.number.values.push(["Blob",i,!1]),this.tmp.shadow_numbers.number.numeric=!1}else this.tmp.shadow_numbers.number.values.push(["Blob",i,!1]),this.tmp.shadow_numbers.number.numeric=!0}},e.substituteOne=function(t){return function(e,i){return i?t.replace("%%STRING%%",i):""}},e.substituteTwo=function(t){return function(e){var i=t.replace("%%PARAM%%",e);return function(t,e){return e?i.replace("%%STRING%%",e):""}}},e.Mode=function(t){var i,s,r,a,n,o;i={},s=e.Output.Formats[t];for(r in s)if("@"===r.slice(0,1)){if(a=!1,n=s[r],o=r.split("/"),"string"==typeof n&&n.indexOf("%%STRING%%")>-1)a=n.indexOf("%%PARAM%%")>-1?e.substituteTwo(n):e.substituteOne(n);else if("boolean"!=typeof n||n){if("function"!=typeof n)throw"CSL.Compiler: Bad "+t+" config entry for "+r+": "+n;a=n}else a=e.Output.Formatters.passthrough;1===o.length?i[o[0]]=a:2===o.length&&(i[o[0]]||(i[o[0]]={}),i[o[0]][o[1]]=a)}else i[r]=s[r];return i},e.setDecorations=function(t,i){var s,r,a;s=[];for(a in e.FORMAT_KEY_SEQUENCE)r=e.FORMAT_KEY_SEQUENCE[a],i[r]&&(s.push([r,i[r]]),delete i[r]);return s},e.Engine.prototype.normalDecorIsOrphan=function(t,e){if("normal"===e[1]){var i,s=!1;i="citation"===this.tmp.area?[this.citation.opt.layout_decorations].concat(t.alldecor):t.alldecor;for(var r=i.length-1;r>-1;r+=-1)for(var a=i[r].length-1;a>-1;a+=-1)i[r][a][0]===e[0]&&"normal"!==i[r][a][1]&&(s=!0);if(!s)return!0}return!1},e.Engine.prototype.getCitationLabel=function(t){var i="",s=this.getTrigraphParams(),r=s[0],a=this.getTerm("reference","short",0);"undefined"==typeof a&&(a="reference"),a=a.replace(".",""),a=a.slice(0,1).toUpperCase()+a.slice(1);for(var n=0,o=e.CREATORS.length;o>n;n+=1){var l=e.CREATORS[n];if(t[l]){var u=t[l];r=u.length>s.length?s[s.length-1]:s[u.length-1];for(var p=0,h=u.length;h>p&&p!==r.authors.length;p+=1){var c=this.nameOutput.getName(u[p],"locale-translit",!0),m=c.name;m&&m.family?(a=m.family,a=a.replace(/^([ \'\u2019a-z]+\s+)/,"")):m&&m.literal&&(a=m.literal);var f=a.toLowerCase().match(/^(a\s+|the\s+|an\s+)/);if(f&&(a=a.slice(f[1].length)),a=a.replace(e.ROMANESQUE_NOT_REGEXP,"","g"),!a)break;a=a.slice(0,r.authors[p]),a.length>1?a=a.slice(0,1).toUpperCase()+a.slice(1).toLowerCase():1===a.length&&(a=a.toUpperCase()),i+=a}break}}var d="0000";return t.issued&&t.issued.year&&(d=""+t.issued.year),d=d.slice(-1*r.year),i+=d},e.Engine.prototype.getTrigraphParams=function(){var t=[],e=this.opt.trigraph.split(":");if(!this.opt.trigraph||"A"!==this.opt.trigraph.slice(0,1))throw"Bad trigraph definition: "+this.opt.trigraph;for(var i=0,s=e.length;s>i;i+=1){for(var r=e[i],a={authors:[],year:0},n=0,o=r.length;o>n;n+=1)switch(r.slice(n,n+1)){case"A":a.authors.push(1);break;case"a":a.authors[a.authors.length-1]+=1;break;case"0":a.year+=1;break;default:throw"Invalid character in trigraph definition: "+this.opt.trigraph}t.push(a)}return t},e.Engine.prototype.setOutputFormat=function(t){this.opt.mode=t,this.fun.decorate=e.Mode(t),this.output[t]||(this.output[t]={},this.output[t].tmp={})},e.Engine.prototype.getSortFunc=function(){return function(t,e){return t=t.split("-"),e=e.split("-"),t.length<e.length?1:t.length>e.length?-1:(t=t.slice(-1)[0],e=e.slice(-1)[0],t.length<e.length?1:t.length>e.length?-1:0)}},e.Engine.prototype.setLangTagsForCslSort=function(t){var e,i;if(t)for(this.opt["locale-sort"]=[],e=0,i=t.length;i>e;e+=1)this.opt["locale-sort"].push(t[e]);this.opt["locale-sort"].sort(this.getSortFunc())},e.Engine.prototype.setLangTagsForCslTransliteration=function(t){var e,i;if(this.opt["locale-translit"]=[],t)for(e=0,i=t.length;i>e;e+=1)this.opt["locale-translit"].push(t[e]);this.opt["locale-translit"].sort(this.getSortFunc())},e.Engine.prototype.setLangTagsForCslTranslation=function(t){var e,i;if(this.opt["locale-translat"]=[],t)for(e=0,i=t.length;i>e;e+=1)this.opt["locale-translat"].push(t[e]);this.opt["locale-translat"].sort(this.getSortFunc())},e.Engine.prototype.setLangPrefsForCites=function(t,e){var i=this.opt["cite-lang-prefs"];e||(e=function(t){return t.toLowerCase()});for(var s=["Persons","Institutions","Titles","Journals","Publishers","Places"],r=0,a=s.length;a>r;r+=1){var n=e(s[r]),o=s[r].toLowerCase();if(t[n]){for(var l=[];t[n].length>1;)l.push(t[n].pop());var u={orig:1,translit:2,translat:3};for(2===l.length&&u[l[0]]<u[l[1]]&&l.reverse();l.length;)t[n].push(l.pop());for(var p=i[o];p.length;)p.pop();for(var h=0,c=t[n].length;c>h;h+=1)p.push(t[n][h])}}},e.Engine.prototype.setLangPrefsForCiteAffixes=function(t){if(t&&48===t.length){for(var e,i=this.opt.citeAffixes,s=0,r=["persons","institutions","titles","journals","publishers","places"],a=["translit","orig","translit","translat"],n=0,o=r.length;o>n;n+=1)for(var l=0,u=a.length;u>l;l+=1)e="",s%8===4?i[r[n]]["locale-"+a[l]].prefix||i[r[n]]["locale-"+a[l]].suffix||(e=t[s]?t[s]:"",i[r[n]]["locale-"+a[l]].prefix=e,e=t[s]?t[s+1]:"",i[r[n]]["locale-"+a[l]].suffix=e):(e=t[s]?t[s]:"",i[r[n]]["locale-"+a[l]].prefix=e,e=t[s]?t[s+1]:"",i[r[n]]["locale-"+a[l]].suffix=e),s+=2;this.opt.citeAffixes=i}},e.Engine.prototype.setAutoVietnameseNamesOption=function(t){this.opt["auto-vietnamese-names"]=t?!0:!1},e.Engine.prototype.setAbbreviations=function(t){this.sys.setAbbreviations&&this.sys.setAbbreviations(t)},e.Engine.prototype.setSuppressTrailingPunctuation=function(t){this.citation.opt.suppressTrailingPunctuation=!!t},e.Output={},e.Output.Queue=function(t){this.levelname=["top"],this.state=t,this.queue=[],this.empty=new e.Token("empty");var i={};i.empty=this.empty,this.formats=new e.Stack(i),this.current=new e.Stack(this.queue)},e.Output.Queue.prototype.pop=function(){var t=this.current.value();return t.length?t.pop():t.blobs.pop()},e.Output.Queue.prototype.getToken=function(t){var e=this.formats.value()[t];return e},e.Output.Queue.prototype.mergeTokenStrings=function(t,i){var s,r,a,n;if(s=this.formats.value()[t],r=this.formats.value()[i],a=s,r){s||(s=new e.Token(t,e.SINGLETON),s.decorations=[]),a=new e.Token(t,e.SINGLETON),n="";for(n in s.strings)s.strings.hasOwnProperty(n)&&(a.strings[n]=s.strings[n]);for(n in r.strings)r.strings.hasOwnProperty(n)&&(a.strings[n]=r.strings[n]);a.decorations=s.decorations.concat(r.decorations)}return a},e.Output.Queue.prototype.addToken=function(t,i,s){var r,a;if(r=new e.Token("output"),"string"==typeof s&&(s=this.formats.value()[s]),s&&s.strings){for(a in s.strings)s.strings.hasOwnProperty(a)&&(r.strings[a]=s.strings[a]);r.decorations=s.decorations}"string"==typeof i&&(r.strings.delimiter=i),this.formats.value()[t]=r},e.Output.Queue.prototype.pushFormats=function(t){t||(t={}),t.empty=this.empty,this.formats.push(t)},e.Output.Queue.prototype.popFormats=function(){this.formats.pop()},e.Output.Queue.prototype.startTag=function(t,e){var i={};this.state.tmp["doing-macro-with-date"]&&this.state.tmp.extension&&(e=this.empty,t="empty"),i[t]=e,this.pushFormats(i),this.openLevel(t)},e.Output.Queue.prototype.endTag=function(){this.closeLevel(),this.popFormats()},e.Output.Queue.prototype.openLevel=function(t){var i,s;if("object"==typeof t)i=new e.Blob(void 0,t);else if("undefined"==typeof t)i=new e.Blob(void 0,this.formats.value().empty,"empty");else{if(!this.formats.value()||!this.formats.value()[t])throw'CSL processor error: call to nonexistent format token "'+t+'"';i=new e.Blob(void 0,this.formats.value()[t],t)}this.nestedBraces&&(i.strings.prefix=i.strings.prefix.replace(this.nestedBraces[0][0],this.nestedBraces[0][1]),i.strings.prefix=i.strings.prefix.replace(this.nestedBraces[1][0],this.nestedBraces[1][1]),i.strings.suffix=i.strings.suffix.replace(this.nestedBraces[0][0],this.nestedBraces[0][1]),i.strings.suffix=i.strings.suffix.replace(this.nestedBraces[1][0],this.nestedBraces[1][1])),s=this.current.value(),s.push(i),this.current.push(i)},e.Output.Queue.prototype.closeLevel=function(t){t&&t!==this.current.value().levelname&&e.error("Level mismatch error:  wanted "+t+" but found "+this.current.value().levelname),this.current.pop()},e.Output.Queue.prototype.append=function(t,i,s,r,a){var n,o,l,u=!0;if(s&&(r=!0),this.state.tmp["doing-macro-with-date"]&&!s){if("macro-with-date"!==i)return!1;"macro-with-date"===i&&(i="empty")}if("undefined"==typeof t)return!1;if("number"==typeof t&&(t=""+t),!s&&this.state.tmp.element_trace&&"suppress-me"===this.state.tmp.element_trace.value())return!1;if(o=!1,i?"literal"===i?(n=!0,u=!1):n="string"==typeof i?this.formats.value()[i]:i:n=this.formats.value().empty,!n)throw"CSL processor error: unknown format token name: "+i;if(n.strings&&"undefined"==typeof n.strings.delimiter&&(n.strings.delimiter=""),"string"==typeof t&&t.length&&(t=t.replace(/ ([:;?!\u00bb])/g,"\u202f$1").replace(/\u00ab /g,"\xab\u202f"),this.last_char_rendered=t.slice(-1),t=t.replace(/\s+'/g,"  '").replace(/^'/g," '"),r?s&&(this.state.tmp.term_predecessor_name=!0):this.state.tmp.term_predecessor=!0),o=new e.Blob(t,n),this.nestedBraces&&(o.strings.prefix=o.strings.prefix.replace(this.nestedBraces[0][0],this.nestedBraces[0][1]),o.strings.prefix=o.strings.prefix.replace(this.nestedBraces[1][0],this.nestedBraces[1][1]),o.strings.suffix=o.strings.suffix.replace(this.nestedBraces[0][0],this.nestedBraces[0][1]),o.strings.suffix=o.strings.suffix.replace(this.nestedBraces[1][0],this.nestedBraces[1][1])),l=this.current.value(),"undefined"==typeof l&&0===this.current.mystack.length&&(this.current.mystack.push([]),l=this.current.value()),"string"==typeof o.blobs&&(r?s&&(this.state.tmp.term_predecessor_name=!0):this.state.tmp.term_predecessor=!0),s||this.state.parallel.AppendBlobPointer(l),"string"==typeof t){l.push(o),o.strings["text-case"]&&(o.blobs=e.Output.Formatters[o.strings["text-case"]](this.state,t)),this.state.tmp.strip_periods&&!a&&(o.blobs=o.blobs.replace(/\.([^a-z]|$)/g,"$1"));for(var p=o.decorations.length-1;p>-1;p+=-1)"@quotes"===o.decorations[p][0]&&"true"===o.decorations[p][1]&&(o.punctuation_in_quote=this.state.getOpt("punctuation-in-quote")),o.blobs.match(e.ROMANESQUE_REGEXP)||"@font-style"===o.decorations[p][0]&&(o.decorations=o.decorations.slice(0,p).concat(o.decorations.slice(p+1)));this.state.fun.flipflopper.init(t,o),this.state.fun.flipflopper.processTags()}else l.push(u?o:t);return!0},e.Output.Queue.prototype.string=function(t,i,s){var r,a,n,o,l,u=e.getSafeEscape(this.state),p=i.slice(),h=[];if(0===p.length)return h;var c="";s?c=s.strings.delimiter:(t.tmp.count_offset_characters=!1,t.tmp.offset_characters=0),s&&s.new_locale&&(s.old_locale=t.opt.lang,t.opt.lang=s.new_locale);var m,f,d,g;for(r=0,a=p.length;a>r;r+=1){if(m=p[r],m.strings.first_blob&&(t.tmp.count_offset_characters=m.strings.first_blob),"string"==typeof m.blobs){if("number"==typeof m.num)h.push(m);else if(m.blobs){l=u(m.blobs);var b=l.length;if(!t.tmp.suppress_decorations)for(n=0,o=m.decorations.length;o>n;n+=1)g=m.decorations[n],"@showid"!==g[0]&&(t.normalDecorIsOrphan(m,g)||(l=t.fun.decorate[g[0]][g[1]].call(m,t,l,g[2])));if(l&&l.length){if(l=u(m.strings.prefix,t.tmp.nestedBraces)+l+u(m.strings.suffix,t.tmp.nestedBraces),(t.opt.development_extensions.csl_reverse_lookup_support||t.sys.csl_reverse_lookup_support)&&!t.tmp.suppress_decorations)for(n=0,o=m.decorations.length;o>n;n+=1)g=m.decorations[n],"@showid"===g[0]&&(l=t.fun.decorate[g[0]][g[1]].call(m,t,l,g[2]));h.push(l),t.tmp.count_offset_characters&&(t.tmp.offset_characters+=b+m.strings.suffix.length+m.strings.prefix.length)}}}else if(m.blobs.length){var y=t.output.string(t,m.blobs,m);h=h.concat(y)}m.strings.first_blob&&(t.registry.registry[m.strings.first_blob].offset=t.tmp.offset_characters,t.tmp.count_offset_characters=!1)}for(r=0,a=h.length-1;a>r;r+=1)"number"!=typeof h[r].num||"number"!=typeof h[r+1].num||h[r+1].UGLY_DELIMITER_SUPPRESS_HACK||(h[r].strings.suffix=h[r].strings.suffix+(c?c:""),h[r+1].successor_prefix="",h[r+1].UGLY_DELIMITER_SUPPRESS_HACK=!0);var v=0;for(r=0,a=h.length;a>r;r+=1)"string"==typeof h[r]&&(v=parseInt(r,10)+1,r<h.length-1&&"object"==typeof h[r+1]&&(c&&!h[r+1].UGLY_DELIMITER_SUPPRESS_HACK&&(h[r]+=u(c)),h[r+1].UGLY_DELIMITER_SUPPRESS_HACK=!0));s&&(s.decorations.length||s.strings.suffix||s.strings.prefix)&&(v=h.length);var _=t.output.renderBlobs(h.slice(0,v),c,!0,s);if(_&&s&&(s.decorations.length||s.strings.suffix||s.strings.prefix)){if(!t.tmp.suppress_decorations)for(r=0,a=s.decorations.length;a>r;r+=1)g=s.decorations[r],["@cite","@bibliography","@display","@showid"].indexOf(g[0])>-1||t.normalDecorIsOrphan(m,g)||"string"==typeof _&&(_=t.fun.decorate[g[0]][g[1]].call(s,t,_,g[2]));if(l=_,f=s.strings.suffix,l&&l.length&&(d=s.strings.prefix,l=u(d,t.tmp.nestedBraces)+l+u(f,t.tmp.nestedBraces),t.tmp.count_offset_characters&&(t.tmp.offset_characters+=d.length+f.length)),_=l,!t.tmp.suppress_decorations)for(r=0,a=s.decorations.length;a>r;r+=1)g=s.decorations[r],-1!==["@cite","@bibliography","@display","@showid"].indexOf(g[0])&&"string"==typeof _&&(_=t.fun.decorate[g[0]][g[1]].call(s,t,_,g[2]))}var x=h.slice(v,h.length);return!x.length&&_?h=[_]:x.length&&!_?h=x:_&&x.length&&(h=[_].concat(x)),"undefined"==typeof s?(this.queue=[],this.current.mystack=[],this.current.mystack.push(this.queue),t.tmp.suppress_decorations&&(h=t.output.renderBlobs(h,void 0,!0))):"boolean"==typeof s&&(h=t.output.renderBlobs(h,void 0,!0)),s&&s.new_locale&&(t.opt.lang=s.old_locale),h},e.Output.Queue.prototype.clearlevel=function(){var t,e,i;for(t=this.current.value(),i=t.blobs.length,e=0;i>e;e+=1)t.blobs.pop()},e.Output.Queue.prototype.renderBlobs=function(t,i,s,r){var a,n,o,l,u,p,h,c,m,f,d,g;if(g=e.getSafeEscape(this.state),i||(i=""),a=this.state,n="",o=[],l="",h=t.length,"citation"===this.state.tmp.area&&!this.state.tmp.just_looking&&1===h&&"object"==typeof t[0]&&r)return t[0].strings.prefix=r.strings.prefix+t[0].strings.prefix,t[0].strings.suffix=t[0].strings.suffix+r.strings.suffix,t[0].decorations=t[0].decorations.concat(r.decorations),t[0].params=r.params,t[0];var b=!0;for(p=0;h>p;p+=1)t[p].checkNext?(t[p].checkNext(t[p+1],b),b=!1):b=!0;var y=!0;for(p=t.length-1;p>0;p+=-1)t[p].checkLast?y&&t[p].checkLast(t[p-1])&&(y=!1):y=!0;for(h=t.length,p=0;h>p;p+=1)if(u=t[p],n&&(l=i),"string"==typeof u)n+=g(l),n+=u,a.tmp.count_offset_characters&&(a.tmp.offset_characters+=l.length);else if(u.status!==e.SUPPRESS){f=u.formatter.format(u.num,u.gender);var v=f.replace(/<[^>]*>/g,"").length;this.append(f,"empty",!0);var _=this.pop(),x=a.tmp.count_offset_characters;if(f=this.string(a,[_],!1),a.tmp.count_offset_characters=x,u.strings["text-case"]&&(f=e.Output.Formatters[u.strings["text-case"]](this.state,f)),f&&this.state.tmp.strip_periods&&(f=f.replace(/\.([^a-z]|$)/g,"$1")),!a.tmp.suppress_decorations)for(m=u.decorations.length,c=0;m>c;c+=1)d=u.decorations[c],a.normalDecorIsOrphan(u,d)||(f=a.fun.decorate[d[0]][d[1]].call(u,a,f,d[2]));f=g(u.strings.prefix)+f+g(u.strings.suffix);var A="";u.status===e.END?A=g(u.range_prefix):u.status===e.SUCCESSOR?A=g(u.successor_prefix):u.status===e.START?A="":u.status===e.SEEN&&(A=g(u.splice_prefix)),n+=A,n+=f,a.tmp.count_offset_characters&&(a.tmp.offset_characters+=A.length+u.strings.prefix.length+v+u.strings.suffix.length)}return n},e.Output.Queue.purgeEmptyBlobs=function(t){if("object"==typeof t&&"object"==typeof t.blobs&&t.blobs.length)for(var i=t.blobs.length-1;i>-1;i--){e.Output.Queue.purgeEmptyBlobs(t.blobs[i]);var s=t.blobs[i];if(!s||!s.blobs||!s.blobs.length){for(var r=[];t.blobs.length-1>i;)r.push(t.blobs.pop());for(t.blobs.pop();r.length;)t.blobs.push(r.pop())}}},e.Output.Queue.adjust=function(t){function e(t){return"number"==typeof t.num||t.blobs&&1===t.blobs.length&&"number"==typeof t.blobs[0].num}function i(t){return"number"==typeof t.num?!0:t.blobs&&"object"==typeof t.blobs?i(t.blobs[t.blobs.length-1])?!0:void 0:!1}function s(t,e){var i=!1,s=["@font-style","@font-variant","@font-weight","@text-decoration","@vertical-align"];if(e&&s.push("@quotes"),t.decorations)for(var r=0,a=t.decorations.length;a>r;r++)if(s.indexOf(t.decorations[r][0])>-1){i=!0;break}return i}function r(t){if(t.decorations)for(var e=0,i=t.decorations.length;i>e;e++)if("@quotes"===t.decorations[e][0])return!0;return"object"!=typeof t.blobs?!1:r(t.blobs[t.blobs.length-1])?!0:!1}function a(t,e){var i=e.strings.suffix.slice(-1);i||"string"!=typeof e.blobs||(i=e.blobs.slice(-1));var s=A[t][i];return s&&1===s.length?!0:"object"!=typeof e.blobs?!1:a(t,e.blobs[e.blobs.length-1])?!0:!1}function n(t,e){if(!v[e])return!1;if("string"==typeof t.blobs)return t.blobs.slice(-1)===e?!0:!1;var i=t.blobs[t.blobs.length-1];if(i){var s=i.strings.suffix.slice(-1);return s?i.strings.suffix.slice(-1)==e?!0:!1:n(i,e)}return!1}function o(t,e,i,s,r){function a(){SecondStrings[s]=SecondStrings[s].slice(1)}function n(){FirstStrings[e]=FirstStrings[e].slice(0,-1)}function o(t){SecondStrings[s]=t+SecondStrings[s]}function l(t){FirstStrings[e]+=t}function u(){return A[f]}function p(){return g[m]}function h(){var t=g[m][f];"string"==typeof t?(n(),a(),o(t)):(o(m),n())}function c(){var t=A[f][m];"string"==typeof t?(n(),a(),l(t)):(l(f),a())}FirstStrings="blobs"===e?t:t.strings,SecondStrings="blobs"===s?i:i.strings;var m=FirstStrings[e].slice(-1),f=SecondStrings[s].slice(0,1),d=r?n:a,b=r?p:u,y=r?h:c,v=m===f;v?d():b()&&y()}function l(t){if(t.blobs&&"string"==typeof t.blobs)return void(v[t.strings.suffix.slice(0,1)]&&t.strings.suffix.slice(0,1)===t.blobs.slice(-1)&&(t.strings.suffix=t.strings.suffix.slice(1)));if("object"==typeof t&&"object"==typeof t.blobs&&t.blobs.length)for(var e=s(t,!0),i=t.blobs.length-1;i>-1;i--){{i===t.blobs.length-1}this.upward(t.blobs[i]);var r=t.strings,a=t.blobs[i].strings;if(0===i){" "===r.prefix.slice(-1)&&" "===a.prefix.slice(0,1)&&(a.prefix=a.prefix.slice(1));var n=a.prefix.slice(0,1);e||!_[n]||r.prefix||(r.prefix+=n,a.prefix=a.prefix.slice(1))}if(i===t.blobs.length-1){var n=a.suffix.slice(-1);!e&&[" "].indexOf(n)>-1&&(r.suffix.slice(0,1)!==n&&(r.suffix=n+r.suffix),a.suffix=a.suffix.slice(0,-1))}r.delimiter&&i>0&&_[r.delimiter.slice(-1)]&&r.delimiter.slice(-1)===a.prefix.slice(0,1)&&(a.prefix=a.prefix.slice(1))}}function u(t){if("object"==typeof t&&"object"==typeof t.blobs&&t.blobs.length)for(var e=t.blobs.length-1;e>-1;e--)if(this.leftward(t.blobs[e]),e<t.blobs.length-1&&!t.strings.delimiter){var i=t.blobs[e],r=i.strings.suffix.slice(-1),a=t.blobs[e+1],n=a.strings.prefix.slice(0,1),l=s(i)||s(a),u="number"==typeof r||"number"==typeof n;if(!l&&!u&&v[n]&&!u){var p=n===i.strings.suffix.slice(-1),h=!i.strings.suffix&&"string"==typeof i.blobs&&i.blobs.slice(-1)===n;p||h?a.strings.prefix=a.strings.prefix.slice(1):o(i,"suffix",a,"prefix")}}}function p(t){if(t.blobs&&"string"==typeof t.blobs)return void(v[t.strings.suffix.slice(0,1)]&&t.strings.suffix.slice(0,1)===t.blobs.slice(-1)&&(t.strings.suffix=t.strings.suffix.slice(1)));if("object"==typeof t&&"object"==typeof t.blobs&&t.blobs.length){for(var l=t.strings,u=!1,p=0,h=t.blobs.length;h>p;p++)if(e(t.blobs[p])){u=!0;break}if(!u&&l.delimiter&&v[l.delimiter.slice(0,1)]){for(var c=l.delimiter.slice(0,1),p=t.blobs.length-2;p>-1;p--){var m=t.blobs[p].strings;m.suffix.slice(-1)!==c&&(m.suffix+=c)}l.delimiter=l.delimiter.slice(1)}for(var p=(s(t,!0),e(t),t.blobs.length-1);p>-1;p--){var f=t.blobs[p],m=t.blobs[p].strings,d=s(f,!0),g=e(f);if(p===t.blobs.length-1){var b=l.suffix.slice(0,1),y=r(f);!y&&v[b]&&(y=a(b,f)),y&&v[b]&&(i(f)||("string"==typeof f.blobs?o(f,"blobs",t,"suffix"):o(f,"suffix",t,"suffix"),"."===l.suffix.slice(0,1)&&(m.suffix+=l.suffix.slice(0,1),l.suffix=l.suffix.slice(1)))),"\xa0"===m.suffix.slice(-1)&&" "===l.suffix.slice(0,1)&&(l.suffix=l.suffix.slice(1)),_[m.suffix.slice(0,1)]&&("string"==typeof f.blobs&&f.blobs.slice(-1)===m.suffix.slice(0,1)&&(m.suffix=m.suffix.slice(1)),m.suffix.slice(-1)===l.suffix.slice(0,1)&&(l.suffix=l.suffix.slice(0,-1))),n(t,t.strings.suffix.slice(0,1))&&(t.strings.suffix=t.strings.suffix.slice(1))}else if(l.delimiter)_[l.delimiter.slice(0,1)]&&l.delimiter.slice(0,1)===m.suffix.slice(-1)&&(t.blobs[p].strings.suffix=t.blobs[p].strings.suffix.slice(0,-1));else{var x=t.blobs[p+1].strings;e(f)||d||!_[m.suffix.slice(-1)]||m.suffix.slice(-1)!==x.prefix.slice(0,1)||(x.prefix=x.prefix.slice(1))}g||d||!v[m.suffix.slice(0,1)]||"string"!=typeof f.blobs||o(f,"blobs",f,"suffix"),this.downward(t.blobs[p])}}}function h(t){var e=t.strings.suffix.slice(0,1);if("string"==typeof t.blobs)for(;b[e];)o(t,"blobs",t,"suffix"),e=t.strings.suffix.slice(0,1);else for(;b[e];)o(t.blobs[t.blobs.length-1],"suffix",t,"suffix"),e=t.strings.suffix.slice(0,1)}function c(t){if("string"==typeof t.blobs)for(var e=t.blobs.slice(-1);y[e];)o(t,"blobs",t,"suffix",!0),e=t.blobs.slice(-1);else for(var e=t.blobs[t.blobs.length-1].strings.suffix.slice(-1);y[e];)o(t.blobs[t.blobs.length-1],"suffix",t,"suffix",!0),e=t.blobs[t.blobs.length-1].strings.suffix.slice(-1)}function m(e){if("object"==typeof e&&"object"==typeof e.blobs&&e.blobs.length){for(var i,s=0,r=e.blobs.length;r>s;s++){for(var a=e.blobs[s],n=!1,o=0,l=a.decorations.length;l>o;o++){var u=a.decorations[o];"@quotes"===u[0]&&(n=!0)}n&&(t?h(a):c(a)),i=this.fix(e.blobs[s]),a.blobs&&"string"==typeof a.blobs&&(i=a.blobs.slice(-1))}return i}}var f={";":!0,":":!0},d={".":!0,"!":!0,"?":!0};this.upward=l,this.leftward=u,this.downward=p,this.fix=m;var g={"!":{".":"!","?":"!?",":":"!",",":"!,",";":"!;"},"?":{"!":"?!",".":"?",":":"?",",":"?,",";":"?;"},".":{"!":".!","?":".?",":":".:",",":".,",";":".;"},":":{"!":"!","?":"?",".":":",",":":,",";":":;"},",":{"!":",!","?":",?",":":",:",".":",.",";":",;"},";":{"!":"!","?":"?",":":";",",":";,",".":";"}},b={},y={},v={},_={};for(var x in g)v[x]=!0,_[x]=!0,f[x]||(b[x]=!0),d[x]||(y[x]=!0);_[" "]=!0,_["\xa0"]=!0;var A={};for(var x in g)for(var I in g[x])A[I]||(A[I]={}),A[I][x]=g[x][I]},e.Engine.Opt=function(){this.has_disambiguate=!1,this.mode="html",this.dates={},this["locale-sort"]=[],this["locale-translit"]=[],this["locale-translat"]=[],this.citeAffixes={persons:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}},institutions:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}},titles:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}},journals:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}},publishers:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}},places:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}}},this["default-locale"]=[],this.update_mode=e.NONE,this.bib_mode=e.NONE,this.sort_citations=!1,this["et-al-min"]=0,this["et-al-use-first"]=1,this["et-al-use-last"]=!1,this["et-al-subsequent-min"]=!1,this["et-al-subsequent-use-first"]=!1,this["demote-non-dropping-particle"]="display-and-sort",this["parse-names"]=!0,this.citation_number_slug=!1,this.trigraph="Aaaa00:AaAa00:AaAA00:AAAA00",this.nodenames=[],this.gender={},this["cite-lang-prefs"]={persons:["orig"],institutions:["orig"],titles:["orig","translat"],journals:["translit"],publishers:["orig"],places:["orig"],number:["translat"]},this.has_layout_locale=!1,this.development_extensions={},this.development_extensions.field_hack=!0,this.development_extensions.locator_date_and_revision=!0,this.development_extensions.locator_parsing_for_plurals=!0,this.development_extensions.locator_label_parse=!0,this.development_extensions.raw_date_parsing=!0,this.development_extensions.clean_up_csl_flaws=!0,this.development_extensions.flip_parentheses_to_braces=!0,this.development_extensions.jurisdiction_subfield=!0,this.development_extensions.static_statute_locator=!1,this.development_extensions.csl_reverse_lookup_support=!1,this.development_extensions.clobber_locator_if_no_statute_section=!1,this.development_extensions.wrap_url_and_doi=!1,this.development_extensions.allow_force_lowercase=!1,this.development_extensions.handle_parallel_articles=!1,this.development_extensions.thin_non_breaking_space_html_hack=!1,this.development_extensions.apply_citation_wrapper=!1,this.development_extensions.main_title_from_short_title=!1,this.development_extensions.uppercase_subtitles=!1,this.development_extensions.normalize_lang_keys_to_lowercase=!1,this.development_extensions.strict_text_case_locales=!1,this.development_extensions.rtl_support=!1,this.development_extensions.strict_page_numbers=!1,this.development_extensions.expect_and_symbol_form=!1,this.development_extensions.require_explicit_legal_case_title_short=!1},e.Engine.Tmp=function(){this.names_max=new e.Stack,this.names_base=new e.Stack,this.givens_base=new e.Stack,this.value=[],this.namepart_decorations={},this.namepart_type=!1,this.area="citation",this.root="citation",this.extension="",this.can_substitute=new e.Stack(0,e.LITERAL),this.element_rendered_ok=!1,this.element_trace=new e.Stack("style"),this.nameset_counter=0,this.group_context=new e.Stack([!1,!1,!1],e.LITERAL),this.term_predecessor=!1,this.jump=new e.Stack(0,e.LITERAL),this.decorations=new e.Stack,this.tokenstore_stack=new e.Stack,this.last_suffix_used="",this.last_names_used=[],this.last_years_used=[],this.years_used=[],this.names_used=[],this.taintedItemIDs={},this.taintedCitationIDs={},this.initialize_with=new e.Stack,this.disambig_request=!1,this["name-as-sort-order"]=!1,this.suppress_decorations=!1,this.disambig_settings=new e.AmbigConfig,this.bib_sort_keys=[],this.prefix=new e.Stack("",e.LITERAL),this.suffix=new e.Stack("",e.LITERAL),this.delimiter=new e.Stack("",e.LITERAL),this.cite_locales=[],this.cite_affixes={citation:!1,bibliography:!1,citation_sort:!1,bibliography_sort:!1},this.strip_periods=0,this.shadow_numbers={}},e.Engine.Fun=function(t){this.match=new e.Util.Match,this.suffixator=new e.Util.Suffixator(e.SUFFIX_CHARS),this.romanizer=new e.Util.Romanizer,this.ordinalizer=new e.Util.Ordinalizer(t),this.long_ordinalizer=new e.Util.LongOrdinalizer},e.Engine.Build=function(){this["alternate-term"]=!1,this.in_bibliography=!1,this.in_style=!1,this.skip=!1,this.postponed_macro=!1,this.layout_flag=!1,this.name=!1,this.form=!1,this.term=!1,this.macro={},this.macro_stack=[],this.text=!1,this.lang=!1,this.area="citation",this.root="citation",this.extension="",this.substitute_level=new e.Stack(0,e.LITERAL),this.names_level=0,this.render_nesting_level=0,this.render_seen=!1},e.Engine.Configure=function(){this.fail=[],this.succeed=[]},e.Engine.Citation=function(t){this.opt={},this.tokens=[],this.srt=new e.Registry.Comparifier(t,"citation_sort"),this.opt.collapse=[],this.opt["disambiguate-add-names"]=!1,this.opt["disambiguate-add-givenname"]=!1,this.opt["disambiguate-add-year-suffix"]=!1,this.opt["givenname-disambiguation-rule"]="by-cite",this.opt["near-note-distance"]=5,this.opt.topdecor=[],this.opt.layout_decorations=[],this.opt.layout_prefix="",this.opt.layout_suffix="",this.opt.layout_delimiter="",this.opt.sort_locales=[],this.opt.max_number_of_names=0,this.root="citation"},e.Engine.Bibliography=function(){this.opt={},this.tokens=[],this.opt.collapse=[],this.opt.topdecor=[],this.opt.layout_decorations=[],this.opt.layout_prefix="",this.opt.layout_suffix="",this.opt.layout_delimiter="",this.opt["line-spacing"]=1,this.opt["entry-spacing"]=1,this.opt.sort_locales=[],this.opt.max_number_of_names=0,this.root="bibliography"
},e.Engine.BibliographySort=function(){this.tokens=[],this.opt={},this.opt.sort_directions=[],this.keys=[],this.opt.topdecor=[],this.root="bibliography"},e.Engine.CitationSort=function(){this.tokens=[],this.opt={},this.opt.sort_directions=[],this.keys=[],this.opt.topdecor=[],this.root="citation"},e.Engine.prototype.previewCitationCluster=function(t,i,s,r){var a=this.opt.mode;this.setOutputFormat(r);var n=this.processCitationCluster(t,i,s,e.PREVIEW);return this.setOutputFormat(a),n[1]},e.Engine.prototype.appendCitationCluster=function(t){for(var e=[],i=this.registry.citationreg.citationByIndex.length,s=0;i>s;s+=1){var r=this.registry.citationreg.citationByIndex[s];e.push([""+r.citationID,r.properties.noteIndex])}return this.processCitationCluster(t,e,[])[1]},e.Engine.prototype.processCitationCluster=function(t,i,s,r){var a,n,o,l,u,p,h,c,m,f,d,g,b,y,v,_;this.debug=!1,this.tmp.citation_errors=[];var x={bibchange:!1};this.setCitationId(t);var A,I,S;if(r===e.PREVIEW){A=this.registry.citationreg.citationByIndex.slice(),I=this.registry.reflist.slice();var O=i.concat([[""+t.citationID,t.properties.noteIndex]]).concat(s),E={},k=[];for(n=0,o=O.length;o>n;n+=1)for(a=this.registry.citationreg.citationById[O[n][0]],l=0,u=a.citationItems.length;u>l;l+=1)E[a.citationItems[l].id]=!0,k.push(""+a.citationItems[l].id);for(S={},n=0,o=I.length;o>n;n+=1)if(!E[I[n].id]){var T=this.registry.registry[I[n].id].ambig,w=this.registry.ambigcites[T];if(w)for(l=0,u=w.length;u>l;l+=1)S[w[l]]=e.cloneAmbigConfig(this.registry.registry[w[l]].disambig)}}this.tmp.taintedCitationIDs={};var N=[],C={};for(n=0,o=t.citationItems.length;o>n;n+=1){g={};for(f in t.citationItems[n])g[f]=t.citationItems[n][f];if(d=this.retrieveItem(""+g.id),d.id&&this.transform.loadAbbreviation("default","hereinafter",d.id),this.remapSectionVariable([[d,g]]),this.opt.development_extensions.locator_date_and_revision&&g.locator){g.locator=""+g.locator;var R=g.locator.indexOf("|");if(R>-1){var L=g.locator;g.locator=L.slice(0,R),L=L.slice(R+1),v=L.match(/^([0-9]{4}-[0-9]{2}-[0-9]{2}).*/),v&&(g["locator-date"]=this.fun.dateparser.parse(v[1]),L=L.slice(v[1].length)),g["locator-revision"]=L.replace(/^\s+/,"").replace(/\s+$/,"")}}this.opt.development_extensions.locator_label_parse&&(!g.locator||-1!==["bill","gazette","legislation","treaty"].indexOf(d.type)||g.label&&"page"!==g.label||(v=e.LOCATOR_LABELS_REGEXP.exec(g.locator),v&&(g.label=e.LOCATOR_LABELS_MAP[v[2]],g.locator=v[3])));var j=[d,g];N.push(j),t.citationItems[n].item=d}t.sortedItems=N;var D=[];for(n=0,o=i.length;o>n;n+=1)a=i[n],this.registry.citationreg.citationById[a[0]].properties.noteIndex=a[1],D.push(this.registry.citationreg.citationById[a[0]]);for(D.push(t),n=0,o=s.length;o>n;n+=1)a=s[n],this.registry.citationreg.citationById[a[0]].properties.noteIndex=a[1],D.push(this.registry.citationreg.citationById[a[0]]);this.registry.citationreg.citationByIndex=D,this.registry.citationreg.citationsByItemId={},this.opt.update_mode===e.POSITION&&(y=[],b=[],_={});var P=[];for(n=0,o=D.length;o>n;n+=1){for(D[n].properties.index=n,l=0,u=D[n].sortedItems.length;u>l;l+=1)g=D[n].sortedItems[l],this.registry.citationreg.citationsByItemId[g[1].id]||(this.registry.citationreg.citationsByItemId[g[1].id]=[],P.push(""+g[1].id)),-1===this.registry.citationreg.citationsByItemId[g[1].id].indexOf(D[n])&&this.registry.citationreg.citationsByItemId[g[1].id].push(D[n]);this.opt.update_mode===e.POSITION&&(D[n].properties.noteIndex?b.push(D[n]):(D[n].properties.noteIndex=0,y.push(D[n])))}if(r!==e.ASSUME_ALL_ITEMS_REGISTERED&&this.updateItems(P),!this.opt.citation_number_sort&&N&&N.length>1&&this.citation_sort.tokens.length>0){for(n=0,o=N.length;o>n;n+=1)N[n][1].sortkeys=e.getSortKeys.call(this,N[n][0],"citation_sort");if(this.opt.grouped_sort&&!t.properties.unsorted){for(n=0,o=N.length;o>n;n+=1){var q=N[n][1].sortkeys;this.tmp.authorstring_request=!0;var U=this.registry.registry[N[n][0].id].disambig;this.tmp.authorstring_request=!0,e.getAmbiguousCite.call(this,N[n][0],U);var B=this.registry.authorstrings[N[n][0].id];this.tmp.authorstring_request=!1,N[n][1].sortkeys=[B].concat(q)}N.sort(this.citation.srt.compareCompositeKeys);var M=!1,F=!1,z=!1;for(n=0,o=N.length;o>n;n+=1)N[n][1].sortkeys[0]!==M&&(z=N[n][1].sortkeys[0],F=N[n][1].sortkeys[1]),N[n][1].sortkeys[0]=""+F+n,M=z}t.properties.unsorted||N.sort(this.citation.srt.compareCompositeKeys)}var G;if(this.opt.update_mode===e.POSITION)for(n=0;2>n;n+=1){G=[y,b][n];var V={},X={};for(l=0,u=G.length;u>l;l+=1){var H=G[l];for(G[l].properties.noteIndex||(G[l].properties.noteIndex=0),G[l].properties.noteIndex=parseInt(G[l].properties.noteIndex,10),l>0&&G[l-1].properties.noteIndex>G[l].properties.noteIndex&&(_={},V={},X={}),p=0,h=H.sortedItems.length;h>p;p+=1)this.registry.registry[H.sortedItems[p][1].id].parallel||(_[H.properties.noteIndex]?_[H.properties.noteIndex]+=1:_[H.properties.noteIndex]=1);for(p=0,h=G[l].sortedItems.length;h>p;p+=1){g=G[l].sortedItems[p];var $=g[0].id,W=g[1].locator,Q=g[1].label;g[0].legislation_id&&($=g[0].legislation_id);var K;if(p>0&&(K=H.sortedItems[p-1][0].legislation_id?H.sortedItems[p-1][0].legislation_id:H.sortedItems[p-1][1].id),r!==e.PREVIEW||H.citationID==t.citationID){var Y={};if(Y.position=g[1].position,Y["first-reference-note-number"]=g[1]["first-reference-note-number"],Y["near-note"]=g[1]["near-note"],g[1]["first-reference-note-number"]=0,g[1]["near-note"]=!1,this.registry.citationreg.citationsByItemId[$]&&"note"===this.opt.xclass&&this.opt.has_disambiguate){var J=this.registry.registry[$]["citation-count"],Z=this.registry.citationreg.citationsByItemId[$].length;if(this.registry.registry[$]["citation-count"]=this.registry.citationreg.citationsByItemId[$].length,"number"==typeof J){var te=2>J,ee=2>Z;if(te!==ee)for(var ie=0,se=this.registry.citationreg.citationsByItemId[$].length;se>ie;ie++)C[this.registry.registry[$].ambig]=!0,this.tmp.taintedCitationIDs[this.registry.citationreg.citationsByItemId[$][ie].citationID]=!0}else for(var ie=0,se=this.registry.citationreg.citationsByItemId[$].length;se>ie;ie++)C[this.registry.registry[$].ambig]=!0,this.tmp.taintedCitationIDs[this.registry.citationreg.citationsByItemId[$][ie].citationID]=!0}var re;if("undefined"==typeof V[$])V[$]=H.properties.noteIndex,this.registry.registry[$]&&(this.registry.registry[$]["first-reference-note-number"]=H.properties.noteIndex),X[$]=H.properties.noteIndex,g[1].position=e.POSITION_FIRST;else{var ae=!1,ne=!1;if(l>0&&(re=G[l-1].sortedItems.slice(-1)[0][1].id,G[l-1].sortedItems[0].slice(-1)[0].legislation_id&&(re=G[l-1].sortedItems[0].slice(-1)[0].legislation_id)),l>0&&0===parseInt(p,10)&&G[l-1].properties.noteIndex!==G[l].properties.noteIndex){var oe=G[l-1].sortedItems,le=!1,ue=G[l-1].sortedItems[0][0].id;for(G[l-1].sortedItems[0][0].legislation_id&&(ue=G[l-1].sortedItems[0][0].legislation_id),(ue==$&&G[l-1].properties.noteIndex>=G[l].properties.noteIndex-1||G[l-1].sortedItems[0][1].id==this.registry.registry[g[1].id].parallel)&&(1===_[G[l-1].properties.noteIndex]||0===G[l-1].properties.noteIndex)&&(le=!0),c=0,m=oe.slice(1).length;m>c;c+=1){var pe=oe.slice(1)[c];this.registry.registry[pe[1].id].parallel&&this.registry.registry[pe[1].id].parallel!=this.registry.registry[pe[1].id]||(le=!1)}le?ae=!0:ne=!0}else p>0&&K==$?ae=!0:0===p&&G[l-1].properties.noteIndex==G[l].properties.noteIndex&&G[l-1].sortedItems.length&&re==$?ae=!0:ne=!0;var he,ce,me,fe,de;if(ae&&(he=p>0?H.sortedItems[p-1][1]:G[l-1].sortedItems[0][1],he.locator?(me=he.label?he.label:"",ce=""+he.locator+me):ce=he.locator,W?(de=Q?Q:"",fe=""+W+de):fe=W),ae&&ce&&!fe&&(ae=!1,ne=!0),ae&&(!ce&&fe?g[1].position=e.POSITION_IBID_WITH_LOCATOR:ce||fe?ce&&fe===ce?g[1].position=e.POSITION_IBID:ce&&fe&&fe!==ce?g[1].position=e.POSITION_IBID_WITH_LOCATOR:(ae=!1,ne=!0):g[1].position=e.POSITION_IBID),ne&&(g[1].position=e.POSITION_SUBSEQUENT),(ne||ae)&&V[$]!=H.properties.noteIndex&&(g[1]["first-reference-note-number"]=V[$],this.registry.registry[$])){var ge=this.registry.citationreg.citationsByItemId[$][0].properties.noteIndex,be=H.properties.noteIndex;this.registry.registry[$]["first-reference-note-number"]=ge>be?be:ge}}if(H.properties.noteIndex){var ye=parseInt(H.properties.noteIndex,10)-parseInt(X[$],10);g[1].position!==e.POSITION_FIRST&&ye<=this.citation.opt["near-note-distance"]&&(g[1]["near-note"]=!0),X[$]=H.properties.noteIndex}if(H.citationID!=t.citationID)for(c=0,m=e.POSITION_TEST_VARS.length;m>c;c+=1){var ve=e.POSITION_TEST_VARS[c];g[1][ve]!==Y[ve]&&("first-reference-note-number"===ve&&(C[this.registry.registry[$].ambig]=!0),this.tmp.taintedCitationIDs[H.citationID]=!0,"first-reference-note-number"===ve&&(this.tmp.taintedItemIDs[$]=!0))}this.sys.variableWrapper&&(g[1].index=H.properties.index,g[1].noteIndex=H.properties.noteIndex)}else"undefined"==typeof V[g[1].id]?(V[$]=H.properties.noteIndex,X[$]=H.properties.noteIndex):X[$]=H.properties.noteIndex}}}if(this.opt.citation_number_sort&&N&&N.length>1&&this.citation_sort.tokens.length>0){for(n=0,o=N.length;o>n;n+=1)N[n][1].sortkeys=e.getSortKeys.call(this,N[n][0],"citation_sort");t.properties.unsorted||N.sort(this.citation.srt.compareCompositeKeys)}for(f in this.tmp.taintedItemIDs)if(this.tmp.taintedItemIDs.hasOwnProperty(f)&&(G=this.registry.citationreg.citationsByItemId[f]))for(n=0,o=G.length;o>n;n+=1)this.tmp.taintedCitationIDs[G[n].citationID]=!0;var _e=[];if(r===e.PREVIEW){try{_e=this.process_CitationCluster.call(this,t.sortedItems,t.citationID)}catch(xe){e.error("Error running CSL processor for preview: "+xe)}for(this.registry.citationreg.citationByIndex=A,this.registry.citationreg.citationById={},n=0,o=A.length;o>n;n+=1)this.registry.citationreg.citationById[A[n].citationID]=A[n];var Ae=[];for(n=0,o=I.length;o>n;n+=1)Ae.push(""+I[n].id);this.updateItems(Ae);for(f in S)S.hasOwnProperty(f)&&(this.registry.registry[f].disambig=S[f])}else{for(var Ie in C)this.disambiguate.run(Ie,t);var Se;for(f in this.tmp.taintedCitationIDs)if(f!=t.citationID){var Oe=this.registry.citationreg.citationById[f];this.tmp.citation_pos=Oe.properties.index,this.tmp.citation_note_index=Oe.properties.noteIndex,this.tmp.citation_id=""+Oe.citationID,Se=[],Se.push(Oe.properties.index),Se.push(this.process_CitationCluster.call(this,Oe.sortedItems,Oe.citationID)),_e.push(Se)}this.tmp.taintedItemIDs={},this.tmp.taintedCitationIDs={},this.tmp.citation_pos=t.properties.index,this.tmp.citation_note_index=t.properties.noteIndex,this.tmp.citation_id=""+t.citationID,Se=[],Se.push(i.length),Se.push(this.process_CitationCluster.call(this,N,t.citationID)),_e.push(Se),_e.sort(function(t,e){return t[0]>e[0]?1:t[0]<e[0]?-1:0})}return x.citation_errors=this.tmp.citation_errors.slice(),[x,_e]},e.Engine.prototype.process_CitationCluster=function(t,i){var s;return this.parallel.StartCitation(t),s=e.getCitationCluster.call(this,t,i)},e.Engine.prototype.makeCitationCluster=function(t){var i,s,r,a,n,o,l;for(i=[],n=t.length,a=0;n>a;a+=1){o={};for(var u in t[a])o[u]=t[a][u];if(l=this.retrieveItem(""+o.id),this.opt.development_extensions.locator_label_parse&&o.locator&&-1===["bill","gazette","legislation","treaty"].indexOf(l.type)&&(!o.label||"page"===o.label)){var p=e.LOCATOR_LABELS_REGEXP.exec(o.locator);p&&(o.label=e.LOCATOR_LABELS_MAP[p[2]],o.locator=p[3])}s=[l,o],i.push(s)}if(this.remapSectionVariable(i),i&&i.length>1&&this.citation_sort.tokens.length>0){for(n=i.length,a=0;n>a;a+=1)i[a][1].sortkeys=e.getSortKeys.call(this,i[a][0],"citation_sort");i.sort(this.citation.srt.compareCompositeKeys)}return this.tmp.citation_errors=[],this.parallel.StartCitation(i),r=e.getCitationCluster.call(this,i)},e.getAmbiguousCite=function(t,i,s){var r,a,n=this.tmp.group_context.value().slice();this.tmp.disambig_request=i?i:!1;var o={position:1};this.registry.registry[t.id]&&this.registry.citationreg.citationsByItemId&&this.registry.citationreg.citationsByItemId[t.id]&&this.registry.citationreg.citationsByItemId[t.id].length&&s&&"by-cite"===this.citation.opt["givenname-disambiguation-rule"]&&(o["first-reference-note-number"]=this.registry.registry[t.id]["first-reference-note-number"]),this.tmp.area="citation",r=this.parallel.use_parallels,this.parallel.use_parallels=!1,this.tmp.suppress_decorations=!0,this.tmp.just_looking=!0,e.getCite.call(this,t,o);for(var l=0,u=this.output.queue.length;u>l;l+=1)e.Output.Queue.purgeEmptyBlobs(this.output.queue[l]);if(this.opt.development_extensions.clean_up_csl_flaws)for(var p=0,h=this.output.queue.length;h>p;p+=1)this.output.adjust.upward(this.output.queue[p]),this.output.adjust.leftward(this.output.queue[p]),this.output.adjust.downward(this.output.queue[p]),this.output.adjust.fix(this.output.queue[p]);return a=this.output.string(this,this.output.queue),this.tmp.just_looking=!1,this.tmp.suppress_decorations=!1,this.parallel.use_parallels=r,this.tmp.group_context.replace(n,"literal"),a},e.getSpliceDelimiter=function(t,i){if(t&&!this.tmp.have_collapsed&&"string"==typeof this.citation.opt["after-collapse-delimiter"])this.tmp.splice_delimiter=this.citation.opt["after-collapse-delimiter"];else if(this.tmp.have_collapsed&&"in-text"===this.opt.xclass&&this.opt.update_mode!==e.NUMERIC)this.tmp.splice_delimiter=", ";else if(this.tmp.use_cite_group_delimiter)this.tmp.splice_delimiter=this.citation.opt.cite_group_delimiter;else if(this.tmp.cite_locales[i-1]){var s=this.tmp.cite_affixes[this.tmp.area][this.tmp.cite_locales[i-1]];s&&s.delimiter&&(this.tmp.splice_delimiter=s.delimiter)}return this.tmp.splice_delimiter||(this.tmp.splice_delimiter=""),this.tmp.splice_delimiter},e.getCitationCluster=function(t,i){var s,r,a,n,o,l,u,p,h,c,m,f,d,g,b,y,v,_,x;this.tmp.last_primary_names_string=!1,this.tmp.nestedBraces=!1,_=e.getSafeEscape(this),this.tmp.area="citation",s="",r=[],this.tmp.last_suffix_used="",this.tmp.last_names_used=[],this.tmp.last_years_used=[],this.tmp.backref_index=[],this.tmp.cite_locales=[];var A=!1;if("note"===this.opt.xclass&&this.citation.opt.suppressTrailingPunctuation&&(A=!0),i&&this.registry.citationreg.citationById[i].properties["suppress-trailing-punctuation"]&&(A=!0),"note"===this.opt.xclass){for(var I=[],S=!1,O=!1,E=!1,k=[],T=0,w=t.length;w>T;T+=1){var N=t[T][0].type,C=t[T][0].title,R=t[T][1].position,L=t[T][0].id;C&&"legal_case"===N&&L!==E&&R&&((C!==S||0===I.length)&&(k=[],I.push(k)),k.push(t[T][1])),S=C,O=R,E=L}for(T=0,w=I.length;w>T;T+=1)if(k=I[T],!(k.length<2)){var j=k.slice(-1)[0].locator;if(j)for(var D=0,P=k.length-1;P>D;D+=1)k[D].locator&&(j=!1);j&&(k[0].locator=j,delete k.slice(-1)[0].locator,k[0].label=k.slice(-1)[0].label,k.slice(-1)[0].label&&delete k.slice(-1)[0].label)}}for(a=[],n=t.length,o=0;n>o;o+=1){if(d=t[o][0],l=t[o][1],u=this.tmp.have_collapsed,p={},o>0?e.getCite.call(this,d,l,""+t[o-1][0].id):(this.tmp.term_predecessor=!1,e.getCite.call(this,d,l)),this.tmp.cite_renders_content||(x={citationID:""+this.tmp.citation_id,index:this.tmp.citation_pos,noteIndex:this.tmp.citation_note_index,itemID:""+d.id,citationItems_pos:o,error_code:e.ERROR_NO_RENDERED_FORM},this.tmp.citation_errors.push(x)),o===t.length-1&&this.parallel.ComposeSet(),p.splice_delimiter=e.getSpliceDelimiter.call(this,u,o),l&&l["author-only"]&&(this.tmp.suppress_decorations=!0),o>0){v=t[o-1][1];var q=v.suffix&&"."===v.suffix.slice(-1),U=!v.suffix&&l.prefix&&"."===l.prefix.slice(0,1);if(q||U){var B=p.splice_delimiter.indexOf(" ");p.splice_delimiter=B>-1&&!U?p.splice_delimiter.slice(B):""}}p.suppress_decorations=this.tmp.suppress_decorations,p.have_collapsed=this.tmp.have_collapsed,a.push(p)}this.tmp.has_purged_parallel=!1,this.parallel.PruneOutputQueue(this),h=0,f=this.output.queue.slice();var M=({strings:{suffix:this.citation.opt.layout_suffix,delimiter:this.citation.opt.layout_delimiter}},this.citation.opt.layout_suffix),F=this.tmp.cite_locales[this.tmp.cite_locales.length-1];F&&this.tmp.cite_affixes[this.tmp.area][F]&&this.tmp.cite_affixes[this.tmp.area][F].suffix&&(M=this.tmp.cite_affixes[this.tmp.area][F].suffix),e.TERMINAL_PUNCTUATION.slice(0,-1).indexOf(M.slice(0,1))>-1&&(M=M.slice(0,1));var z=this.citation.opt.layout_delimiter;z||(z=""),e.TERMINAL_PUNCTUATION.slice(0,-1).indexOf(z.slice(0,1))>-1&&(z=z.slice(0,1));for(var G=M,T=0,w=this.output.queue.length;w>T;T+=1)e.Output.Queue.purgeEmptyBlobs(this.output.queue[T]);if(!this.tmp.suppress_decorations&&this.output.queue.length&&(this.opt.development_extensions.apply_citation_wrapper&&this.sys.wrapCitationEntry&&!this.tmp.just_looking&&"citation"===this.tmp.area||(A||(this.output.queue[this.output.queue.length-1].strings.suffix=G),this.output.queue[0].strings.prefix=this.citation.opt.layout_prefix)),this.opt.development_extensions.clean_up_csl_flaws)for(var D=0,P=this.output.queue.length;P>D;D+=1)this.output.adjust.upward(this.output.queue[D]),this.output.adjust.leftward(this.output.queue[D]),this.output.adjust.downward(this.output.queue[D]),this.tmp.last_chr=this.output.adjust.fix(this.output.queue[D]);for(o=0,n=f.length;n>o;o+=1){if(this.output.queue=[f[o]],this.tmp.suppress_decorations=a[o].suppress_decorations,this.tmp.splice_delimiter=a[o].splice_delimiter,f[o].parallel_delimiter&&(this.tmp.splice_delimiter=f[o].parallel_delimiter),this.tmp.have_collapsed=a[o].have_collapsed,c=this.output.string(this,this.output.queue),this.tmp.suppress_decorations=!1,"string"==typeof c)return this.tmp.suppress_decorations=!1,c;if("object"==typeof c&&0===c.length&&!l["suppress-author"])if(this.tmp.has_purged_parallel)c.push("");else{var V="[CSL STYLE ERROR: reference with no printed form.]",X=0===o?_(this.citation.opt.layout_prefix):"",H=o===f.length-1?_(this.citation.opt.layout_suffix):"";c.push(X+V+H)}if(r.length&&"string"==typeof c[0]){c.reverse();var $=c.pop();$&&","===$.slice(0,1)?r.push($):"string"==typeof r.slice(-1)[0]&&","===r.slice(-1)[0].slice(-1)?r.push(" "+$):$&&r.push(_(this.tmp.splice_delimiter)+$)}else c.reverse(),m=c.pop(),"undefined"!=typeof m&&(r.length&&"string"==typeof r[r.length-1]&&(r[r.length-1]+=m.successor_prefix),r.push(m));for(g=c.length,b=0;g>b;b+=1)y=c[b],"string"!=typeof y?(m=c.pop(),"undefined"!=typeof m&&r.push(m)):r.push(_(this.tmp.splice_delimiter)+y);0!==r.length||t[o][1]["suppress-author"]||(h+=1)}if(s+=this.output.renderBlobs(r),s&&(this.output.nestedBraces=!1,!this.tmp.suppress_decorations))for(n=this.citation.opt.layout_decorations.length,o=0;n>o;o+=1)p=this.citation.opt.layout_decorations[o],"normal"!==p[1]&&(s=this.fun.decorate[p[0]][p[1]](this,s));return this.tmp.suppress_decorations=!1,s},e.getCite=function(t,i,s){var r,a;for(this.tmp.cite_renders_content=!1,this.parallel.StartCite(t,i,s),e.citeStart.call(this,t,i),r=0,this.nameOutput=new e.NameOutput(this,t,i);r<this[this.tmp.area].tokens.length;)r=e.tokenExec.call(this,this[this.tmp.area].tokens[r],t,i);return e.citeEnd.call(this,t,i),this.parallel.CloseCite(this),this.tmp.cite_renders_content||this.tmp.just_looking||"bibliography"===this.tmp.area&&(a={index:this.tmp.bibliography_pos,itemID:""+t.id,error_code:e.ERROR_NO_RENDERED_FORM},this.tmp.bibliography_errors.push(a)),""+t.id},e.citeStart=function(t,i){if(this.tmp.disambiguate_count=0,this.tmp.disambiguate_maxMax=0,this.tmp.same_author_as_previous_cite=!1,this.tmp.subsequent_author_substitute_ok=this.tmp.suppress_decorations?!1:!0,this.tmp.lastchr="",this.tmp.have_collapsed="citation"===this.tmp.area&&this.citation.opt.collapse&&this.citation.opt.collapse.length?!0:!1,this.tmp.render_seen=!1,this.tmp.disambig_request&&!this.tmp.disambig_override?this.tmp.disambig_settings=this.tmp.disambig_request:this.registry.registry[t.id]&&!this.tmp.disambig_override?(this.tmp.disambig_request=this.registry.registry[t.id].disambig,this.tmp.disambig_settings=this.registry.registry[t.id].disambig):this.tmp.disambig_settings=new e.AmbigConfig,"citation"!==this.tmp.area&&this.registry.registry[t.id]&&(this.tmp.disambig_restore=e.cloneAmbigConfig(this.registry.registry[t.id].disambig),"bibliography"===this.tmp.area&&this.tmp.disambig_settings&&this.tmp.disambig_override&&(this.opt["disambiguate-add-names"]&&(this.tmp.disambig_settings.names=this.registry.registry[t.id].disambig.names.slice(),this.tmp.disambig_request.names=this.registry.registry[t.id].disambig.names.slice()),this.opt["disambiguate-add-givenname"]))){this.tmp.disambig_request=this.tmp.disambig_settings,this.tmp.disambig_settings.givens=this.registry.registry[t.id].disambig.givens.slice(),this.tmp.disambig_request.givens=this.registry.registry[t.id].disambig.givens.slice();for(var s=0,r=this.tmp.disambig_settings.givens.length;r>s;s+=1)this.tmp.disambig_settings.givens[s]=this.registry.registry[t.id].disambig.givens[s].slice();for(var s=0,r=this.tmp.disambig_request.givens.length;r>s;s+=1)this.tmp.disambig_request.givens[s]=this.registry.registry[t.id].disambig.givens[s].slice()}if(this.tmp.names_used=[],this.tmp.nameset_counter=0,this.tmp.years_used=[],this.tmp.names_max.clear(),this.tmp.splice_delimiter=this[this.tmp.area].opt.layout_delimiter,this.bibliography_sort.keys=[],this.citation_sort.keys=[],this.tmp.has_done_year_suffix=!1,this.tmp.last_cite_locale=!1,!this.tmp.just_looking&&i&&!i.position&&this.registry.registry[t.id]&&(this.tmp.disambig_restore=e.cloneAmbigConfig(this.registry.registry[t.id].disambig)),this.tmp.shadow_numbers={},this.setNumberLabels(t),this.tmp.first_name_string=!1,this.opt.development_extensions.flip_parentheses_to_braces&&i&&i.prefix){var a=e.checkNestedBraceOpen.exec(i.prefix),n=e.checkNestedBraceClose.exec(i.prefix);a?this.output.nestedBraces=n?n[0].length<a[0].length?e.NestedBraces:!1:e.NestedBraces:n&&(this.output.nestedBraces=!1)}},e.citeEnd=function(t,i){if(this.tmp.disambig_restore){this.registry.registry[t.id].disambig.names=this.tmp.disambig_restore.names.slice(),this.registry.registry[t.id].disambig.givens=this.tmp.disambig_restore.givens.slice();for(var s=0,r=this.registry.registry[t.id].disambig.givens.length;r>s;s+=1)this.registry.registry[t.id].disambig.givens[s]=this.tmp.disambig_restore.givens[s].slice()}if(this.tmp.disambig_restore=!1,this.tmp.last_suffix_used=i&&i.suffix?i.suffix:"",this.tmp.last_years_used=this.tmp.years_used.slice(),this.tmp.last_names_used=this.tmp.names_used.slice(),this.tmp.cut_var=!1,this.tmp.disambig_request=!1,this.tmp.cite_locales.push(this.tmp.last_cite_locale),this.tmp.issued_date&&this.tmp.renders_collection_number){for(var a=[],s=this.tmp.issued_date.list.length-1;s>this.tmp.issued_date.pos;s+=-1)a.push(this.tmp.issued_date.list.pop());for(this.tmp.issued_date.list.pop(),s=a.length-1;s>-1;s+=-1)this.tmp.issued_date.list.push(a.pop());this.parallel.use_parallels&&(this.parallel.cite.issued=!1)}if(this.tmp.issued_date=!1,this.tmp.renders_collection_number=!1,this.opt.development_extensions.flip_parentheses_to_braces&&i&&i.suffix){var n=e.checkNestedBraceOpen.exec(i.suffix),o=e.checkNestedBraceClose.exec(i.suffix);o?this.output.nestedBraces=n?n[0].length<o[0].length?!1:e.NestedBraces:!1:n&&(this.output.nestedBraces=e.NestedBraces)}},e.Engine.prototype.makeBibliography=function(t){var i,s,r,a,n,o,l,u,p;if(i=!1,!this.bibliography.tokens.length)return!1;"string"==typeof t&&(this.opt.citation_number_slug=t,t=!1),s=e.getBibliographyEntries.call(this,t),u=s[0],p=s[1];var h=s[2];for(r={maxoffset:0,entryspacing:this.bibliography.opt["entry-spacing"],linespacing:this.bibliography.opt["line-spacing"],"second-field-align":!1,entry_ids:u,bibliography_errors:this.tmp.bibliography_errors.slice(),done:h},this.bibliography.opt["second-field-align"]&&(r["second-field-align"]=this.bibliography.opt["second-field-align"]),a=0,o=this.registry.reflist.length,l=0;o>l;l+=1)n=this.registry.reflist[l],n.offset>r.maxoffset&&(r.maxoffset=n.offset);return this.bibliography.opt.hangingindent&&(r.hangingindent=this.bibliography.opt.hangingindent),r.bibstart=this.fun.decorate.bibstart,r.bibend=this.fun.decorate.bibend,this.opt.citation_number_slug=!1,[r,p]},e.getBibliographyEntries=function(t){function i(t,e){return t===e?!0:!1}function s(t,e){for(f=e.length,d=0;f>d;d+=1)if(i(t,e[d]))return!0;return!1}function r(t,e){return"none"!==t&&t||e?"string"==typeof e?i(t,e):e?s(t,e):!1:!0}var a,n,o,l,u,p,h,c,m,f,d,g,b,y,v,_,x,A,I,S,O,E,k,T;a=[],E=[],this.tmp.area="bibliography",this.tmp.last_rendered_name=!1,this.tmp.bibliography_errors=[],this.tmp.bibliography_pos=0,n=t&&t.page_start&&t.page_length?this.registry.getSortedIds():this.retrieveItems(this.registry.getSortedIds()),this.tmp.disambig_override=!0,A={};var w;if(t&&t.page_start&&t.page_length&&(w=0,t.page_start!==!0))for(v=0,_=n.length;_>v&&(A[n[v]]=!0,t.page_start!=n[v]);v+=1);var N=[];for(v=0,_=n.length;_>v;v+=1){if(t&&t.page_start&&t.page_length){if(A[n[v]])continue;if(c=this.retrieveItem(n[v]),w===t.page_length)break}else if(c=n[v],A[c.id])continue;if(t){if(o=!0,t.include){for(o=!1,k=0,T=t.include.length;T>k;k+=1)if(m=t.include[k],r(m.value,c[m.field])){o=!0;break}}else if(t.exclude){for(l=!1,k=0,T=t.exclude.length;T>k;k+=1)if(m=t.exclude[k],r(m.value,c[m.field])){l=!0;break}l&&(o=!1)}else if(t.select){for(o=!1,u=!0,k=0,T=t.select.length;T>k;k+=1)m=t.select[k],r(m.value,c[m.field])||(u=!1);u&&(o=!0)}if(t.quash){for(u=!0,k=0,T=t.quash.length;T>k;k+=1)m=t.quash[k],r(m.value,c[m.field])||(u=!1);u&&(o=!1)}if(!o)continue}if(p=new e.Token("group",e.START),p.decorations=[["@bibliography","entry"]].concat(this.bibliography.opt.layout_decorations),this.output.startTag("bib_entry",p),c.system_id&&this.sys.embedBibliographyEntry?this.output.current.value().item_id=c.system_id:this.output.current.value().system_id=c.id,I=[[{id:""+c.id},c]],b=[],!this.registry.registry[c.id].master||t&&t.page_start&&t.page_length)this.registry.registry[c.id].siblings||(this.parallel.StartCitation(I),this.tmp.term_predecessor=!1,b.push(""+e.getCite.call(this,c)),t&&t.page_start&&t.page_length&&(w+=1));else{for(y=!0,this.parallel.StartCitation(I),this.output.queue[0].strings.delimiter=", ",this.tmp.term_predecessor=!1,b.push(""+e.getCite.call(this,c)),A[c.id]=!0,x=this.registry.registry[c.id].siblings,k=0,T=x.length;T>k;k+=1){var C=this.registry.registry[c.id].siblings[k];S=this.retrieveItem(C),b.push(""+e.getCite.call(this,S)),A[S.id]=!0}this.parallel.ComposeSet(),this.parallel.PruneOutputQueue()}if(E.push(""),this.tmp.bibliography_pos+=1,N.push(b),this.output.endTag("bib_entry"),this.output.queue[0].blobs.length&&this.output.queue[0].blobs[0].blobs.length){for(y||!this.output.queue[0].blobs[0].blobs[0].strings?(g=this.output.queue[0].blobs,y=!1):g=this.output.queue[0].blobs[0].blobs,k=g.length-1;k>-1;k+=-1)if(g[k].blobs&&0!==g[k].blobs.length){var R,L=this.tmp.cite_locales[this.tmp.cite_locales.length-1];R=this.tmp.cite_affixes[this.tmp.area][L]?this.tmp.cite_affixes[this.tmp.area][L].suffix:this.bibliography.opt.layout_suffix,O=R.slice(0,1),O&&g[k].strings.suffix.slice(-1)===O&&(g[k].strings.suffix=g[k].strings.suffix.slice(0,-1)),g[k].strings.suffix+=R;break}g[0].strings.prefix=this.bibliography.opt.layout_prefix+g[0].strings.prefix}for(var k=0,T=this.output.queue.length;T>k;k+=1)e.Output.Queue.purgeEmptyBlobs(this.output.queue[k]);for(var k=0,T=this.output.queue.length;T>k;k+=1)this.output.adjust.upward(this.output.queue[k]),this.output.adjust.leftward(this.output.queue[k]),this.output.adjust.downward(this.output.queue[k],!0),this.output.adjust.fix(this.output.queue[k]);h=this.output.string(this,this.output.queue)[0],h||(h="\n[CSL STYLE ERROR: reference with no printed form.]\n"),a.push(h)}var j=!1;if(t&&t.page_start&&t.page_length){var D=n.slice(-1)[0],P=N.slice(-1)[0];D&&P&&D!=P||(j=!0)}return this.tmp.disambig_override=!1,[N,a,j]},e.Engine.prototype.setCitationId=function(t,e){var i,s,r;if(i=!1,!t.citationID||e){for(s=Math.floor(1e14*Math.random());;){if(r=0,!this.registry.citationreg.citationById[s]){t.citationID=s.toString(32);break}r=!r&&5e13>s?1:-1,s+=1===r?1:-1}i=""+s}return this.registry.citationreg.citationById[t.citationID]=t,i},e.Engine.prototype.rebuildProcessorState=function(t,i,s){t||(t=[]),i||(i="html");for(var r={},a=[],n=0,o=t.length;o>n;n+=1)for(var l=0,u=t[n].citationItems.length;u>l;l+=1){var p=""+t[n].citationItems[l].id;r[p]||a.push(p),r[p]=!0}this.updateItems(a);var h=[],c=[],m=[],f=this.opt.mode;this.setOutputFormat(i);for(var n=0,o=t.length;o>n;n+=1){var d=this.processCitationCluster(t[n],h,c,e.ASSUME_ALL_ITEMS_REGISTERED);h.push([t[n].citationID,t[n].properties.noteIndex]);for(var l=0,u=d[1].length;u>l;l+=1){var g=d[1][l][0];m[g]=[h[g][0],h[g][1],d[1][l][1]]}}return this.updateUncitedItems(s),this.setOutputFormat(f),m},e.Engine.prototype.restoreProcessorState=function(t){var i,s,r,a,n,o,l,u,p,h;u=[],p=[],t||(t=[]);var c=[],m={};for(i=0,s=t.length;s>i;i+=1)m[t[i].citationID]&&this.setCitationId(t[i],!0),m[t[i].citationID]=!0,c.push(t[i].properties.index);var f=t.slice();for(f.sort(function(t,e){return t.properties.index<e.properties.index?-1:t.properties.index>e.properties.index?1:0}),i=0,s=f.length;s>i;i+=1)f[i].properties.index=i;for(i=0,s=f.length;s>i;i+=1){for(h=[],r=0,a=f[i].citationItems.length;a>r;r+=1)n=f[i].citationItems[r],"undefined"==typeof n.sortkeys&&(n.sortkeys=[]),o=this.retrieveItem(""+n.id),l=[o,n],h.push(l),f[i].citationItems[r].item=o,p.push(""+n.id);f[i].properties.unsorted||h.sort(this.citation.srt.compareCompositeKeys),f[i].sortedItems=h,this.registry.citationreg.citationById[f[i].citationID]=f[i]}for(this.updateItems(p),i=0,s=t.length;s>i;i+=1)u.push([""+t[i].citationID,t[i].properties.noteIndex]);var d=[];return t&&t.length?d=this.processCitationCluster(t[0],[],u.slice(1)):(this.registry=new e.Registry(this),this.tmp=new e.Engine.Tmp,this.disambiguate=new e.Disambiguation(this)),d},e.Engine.prototype.updateItems=function(t,e,i){var s=this.tmp.area;if(this.registry.init(t),i)for(var r in this.registry.ambigcites)this.registry.ambigsTouched[r]=!0;return this.registry.dodeletes(this.registry.myhash),this.registry.doinserts(this.registry.mylist),this.registry.dorefreshes(),this.registry.rebuildlist(),this.registry.setsortkeys(),this.registry.setdisambigs(),e||this.registry.sorttokens(),this.registry.renumber(),this.tmp.area=s,this.registry.getSortedIds()},e.Engine.prototype.updateUncitedItems=function(t,e){if(t||(t=[]),"object"==typeof t)if("undefined"==typeof t.length){var i=t;t=[];for(var s in i)t.push(s)}else if("number"==typeof t.length)for(var i={},r=0,a=t.length;a>r;r+=1)i[t[r]]=!0;return this.registry.init(t,!0),this.registry.dopurge(i),this.registry.doinserts(this.registry.mylist),this.registry.dorefreshes(),this.registry.rebuildlist(),this.registry.setsortkeys(),this.registry.setdisambigs(),e||this.registry.sorttokens(),this.registry.renumber(),this.registry.getSortedIds()},e.localeResolve=function(t,i){var s,r;return i||(i="en-US"),t||(t=i),s={},r=t.split(/[\-_]/),s.base=e.LANG_BASES[r[0]],"undefined"==typeof s.base?(e.debug("Warning: unknown locale "+t+", setting fallback to "+i),{base:i,best:t,bare:r[0]}):(1===r.length&&(s.generic=!0),s.best=1===r.length||"x"===r[1]?s.base.replace("_","-"):r.slice(0,2).join("-"),s.base=s.base.replace("_","-"),s.bare=r[0],s)},e.Engine.prototype.localeConfigure=function(t,e){var i;if(this.opt.development_extensions.normalize_lang_keys_to_lowercase&&(t.best=t.best.toLowerCase(),t.bare=t.bare.toLowerCase(),t.base=t.base.toLowerCase()),(!e||!this.locale[t.best])&&(i=this.sys.xml.makeXml(this.sys.retrieveLocale("en-US")),this.localeSet(i,"en-US",t.best),"en-US"!==t.best&&(t.base!==t.best&&(i=this.sys.xml.makeXml(this.sys.retrieveLocale(t.base)),this.localeSet(i,t.base,t.best)),i=this.sys.xml.makeXml(this.sys.retrieveLocale(t.best)),this.localeSet(i,t.best,t.best)),this.localeSet(this.cslXml,"",t.best),this.localeSet(this.cslXml,t.bare,t.best),t.base!==t.best&&this.localeSet(this.cslXml,t.base,t.best),this.localeSet(this.cslXml,t.best,t.best),"undefined"==typeof this.locale[t.best].terms["page-range-delimiter"]&&(this.locale[t.best].terms["page-range-delimiter"]=["fr","pt"].indexOf(t.best.slice(0,2).toLowerCase())>-1?"-":"\u2013"),"undefined"==typeof this.locale[t.best].terms["year-range-delimiter"]&&(this.locale[t.best].terms["year-range-delimiter"]="\u2013"),"undefined"==typeof this.locale[t.best].terms["citation-range-delimiter"]&&(this.locale[t.best].terms["citation-range-delimiter"]="\u2013"),this.opt.development_extensions.normalize_lang_keys_to_lowercase)){for(var s=["default-locale","locale-sort","locale-translit","locale-translat"],r=0,a=s.length;a>r;r+=1)for(var n=0,o=this.opt[s[r]].length;o>n;n+=1)this.opt[s[r]][n]=this.opt[s[r]][n].toLowerCase();this.opt.lang=this.opt.lang.toLowerCase()}},e.Engine.prototype.localeSet=function(t,i,s){var r,a,n,o,l,u,p,h,c,m,f,d,g,b,y,v;if(i=i.replace("_","-"),s=s.replace("_","-"),this.opt.development_extensions.normalize_lang_keys_to_lowercase&&(i=i.toLowerCase(),s=s.toLowerCase()),this.locale[s]||(this.locale[s]={},this.locale[s].terms={},this.locale[s].opts={},this.locale[s].opts["skip-words"]=e.SKIP_WORDS,this.locale[s].opts["leading-noise-words"]||(this.locale[s].opts["leading-noise-words"]=[]),this.locale[s].dates={},this.locale[s].ord={"1.0.1":!1,keys:{}},this.locale[s]["noun-genders"]={}),a=this.sys.xml.makeXml(),this.sys.xml.nodeNameIs(t,"locale"))a=t;
else for(n=this.sys.xml.getNodesByName(t,"locale"),l=0,d=this.sys.xml.numberofnodes(n);d>l;l+=1)if(r=n[l],this.sys.xml.getAttributeValue(r,"lang","xml")===i){a=r;break}for(n=this.sys.xml.getNodesByName(a,"type"),y=0,v=this.sys.xml.numberofnodes(n);v>y;y+=1){var _=n[y],x=this.sys.xml.getAttributeValue(_,"name"),A=this.sys.xml.getAttributeValue(_,"gender");this.opt.gender[x]=A}var I=this.sys.xml.getNodesByName(a,"term","ordinal").length;if(I){for(var S in this.locale[s].ord.keys)delete this.locale[s].terms[S];this.locale[s].ord={"1.0.1":!1,keys:{}}}n=this.sys.xml.getNodesByName(a,"term");var O={"last-digit":{},"last-two-digits":{},"whole-number":{}},E=!1,k={};for(l=0,d=this.sys.xml.numberofnodes(n);d>l;l+=1){if(u=n[l],h=this.sys.xml.getAttributeValue(u,"name"),"sub verbo"===h&&(h="sub-verbo"),"ordinal"===h.slice(0,7)){{this.sys.xml.getNodeValue(u)}if("ordinal"===h)E=!0;else{var T=this.sys.xml.getAttributeValue(u,"match"),w=h.slice(8),g=this.sys.xml.getAttributeValue(u,"gender-form");g||(g="neuter"),T||(T="last-two-digits","0"===w.slice(0,1)&&(T="last-digit")),"0"===w.slice(0,1)&&(w=w.slice(1)),O[T][w]||(O[T][w]={}),O[T][w][g]=h}this.locale[s].ord.keys[h]=!0}"undefined"==typeof this.locale[s].terms[h]&&(this.locale[s].terms[h]={}),p="long",g=!1,this.sys.xml.getAttributeValue(u,"form")&&(p=this.sys.xml.getAttributeValue(u,"form")),this.sys.xml.getAttributeValue(u,"gender-form")&&(g=this.sys.xml.getAttributeValue(u,"gender-form")),this.sys.xml.getAttributeValue(u,"gender")&&(this.locale[s]["noun-genders"][h]=this.sys.xml.getAttributeValue(u,"gender")),g?(this.locale[s].terms[h][g]={},this.locale[s].terms[h][g][p]=[],b=this.locale[s].terms[h][g],k[h]=!0):(this.locale[s].terms[h][p]=[],b=this.locale[s].terms[h]),this.sys.xml.numberofnodes(this.sys.xml.getNodesByName(u,"multiple"))?(b[p][0]=this.sys.xml.getNodeValue(u,"single"),b[p][1]=this.sys.xml.getNodeValue(u,"multiple")):b[p]=this.sys.xml.getNodeValue(u)}if(E){for(var N in k){var C={},R=0;for(var L in this.locale[s].terms[N])["masculine","feminine"].indexOf(L)>-1?C[L]=this.locale[s].terms[N][L]:R+=1;if(!R)if(C.feminine)for(var L in C.feminine)this.locale[s].terms[N][L]=C.feminine[L];else if(C.masculine)for(var L in C.masculine)this.locale[s].terms[N][L]=C.masculine[L]}this.locale[s].ord["1.0.1"]=O}for(h in this.locale[s].terms)for(y=0,v=2;v>y;y+=1)if(g=e.GENDERS[y],this.locale[s].terms[h][g])for(p in this.locale[s].terms[h])this.locale[s].terms[h][g][p]||(this.locale[s].terms[h][g][p]=this.locale[s].terms[h][p]);for(n=this.sys.xml.getNodesByName(a,"style-options"),l=0,d=this.sys.xml.numberofnodes(n);d>l;l+=1){c=n[l],o=this.sys.xml.attributes(c);for(f in o)if(o.hasOwnProperty(f))if("@punctuation-in-quote"===f||"@limit-day-ordinals-to-day-1"===f)this.locale[s].opts[f.slice(1)]="true"===o[f]?!0:!1;else if("@skip-words"===f){var j=o[f].split(/\s*,\s*/);this.locale[s].opts[f.slice(1)]=j}else if("@leading-noise-words"===f&&i===s){var D=o[f].split(/\s*,\s*/);this.locale[s].opts["leading-noise-words"]=D}else if("@name-as-sort-order"===f){this.locale[s].opts["name-as-sort-order"]={};for(var P=o[f].split(/\s+/),y=0,v=P.length;v>y;y+=1)this.locale[s].opts["name-as-sort-order"][P[y]]=!0}else if("@name-as-reverse-order"===f){this.locale[s].opts["name-as-reverse-order"]={};for(var P=o[f].split(/\s+/),y=0,v=P.length;v>y;y+=1)this.locale[s].opts["name-as-reverse-order"][P[y]]=!0}else if("@name-never-short"===f){this.locale[s].opts["name-never-short"]={};for(var P=o[f].split(/\s+/),y=0,v=P.length;v>y;y+=1)this.locale[s].opts["name-never-short"][P[y]]=!0}}for(n=this.sys.xml.getNodesByName(a,"date"),l=0,d=this.sys.xml.numberofnodes(n);d>l;l+=1)m=n[l],this.locale[s].dates[this.sys.xml.getAttributeValue(m,"form")]=m},e.Node={},e.Node.bibliography={build:function(t,i){this.tokentype===e.START&&(t.build.area="bibliography",t.build.root="bibliography",t.fixOpt(this,"names-delimiter","delimiter"),t.fixOpt(this,"name-delimiter","delimiter"),t.fixOpt(this,"name-form","form"),t.fixOpt(this,"and","and"),t.fixOpt(this,"delimiter-precedes-last","delimiter-precedes-last"),t.fixOpt(this,"delimiter-precedes-et-al","delimiter-precedes-et-al"),t.fixOpt(this,"initialize-with","initialize-with"),t.fixOpt(this,"initialize","initialize"),t.fixOpt(this,"name-as-sort-order","name-as-sort-order"),t.fixOpt(this,"sort-separator","sort-separator"),t.fixOpt(this,"and","and"),t.fixOpt(this,"et-al-min","et-al-min"),t.fixOpt(this,"et-al-use-first","et-al-use-first"),t.fixOpt(this,"et-al-use-last","et-al-use-last"),t.fixOpt(this,"et-al-subsequent-min","et-al-subsequent-min"),t.fixOpt(this,"et-al-subsequent-use-first","et-al-subsequent-use-first")),i.push(this)}},e.Node.choose={build:function(t,i){var s;this.tokentype===e.START&&(s=function(t){t.tmp.jump.push(void 0,e.LITERAL)}),this.tokentype===e.END&&(s=function(t){t.tmp.jump.pop()}),this.execs.push(s),i.push(this)},configure:function(t,i){this.tokentype===e.END?(t.configure.fail.push(i),t.configure.succeed.push(i)):(t.configure.fail.pop(),t.configure.succeed.pop())}},e.Node.citation={build:function(t){if(this.tokentype===e.START&&(t.fixOpt(this,"names-delimiter","delimiter"),t.fixOpt(this,"name-delimiter","delimiter"),t.fixOpt(this,"name-form","form"),t.fixOpt(this,"and","and"),t.fixOpt(this,"delimiter-precedes-last","delimiter-precedes-last"),t.fixOpt(this,"delimiter-precedes-et-al","delimiter-precedes-et-al"),t.fixOpt(this,"initialize-with","initialize-with"),t.fixOpt(this,"initialize","initialize"),t.fixOpt(this,"name-as-sort-order","name-as-sort-order"),t.fixOpt(this,"sort-separator","sort-separator"),t.fixOpt(this,"and","and"),t.fixOpt(this,"et-al-min","et-al-min"),t.fixOpt(this,"et-al-use-first","et-al-use-first"),t.fixOpt(this,"et-al-use-last","et-al-use-last"),t.fixOpt(this,"et-al-subsequent-min","et-al-subsequent-min"),t.fixOpt(this,"et-al-subsequent-use-first","et-al-subsequent-use-first"),t.build.area="citation"),this.tokentype===e.END){if(t.opt.grouped_sort="in-text"===t.opt.xclass&&t.citation.opt.collapse&&t.citation.opt.collapse.length||t.citation.opt.cite_group_delimiter&&t.citation.opt.cite_group_delimiter.length&&t.opt.update_mode!==e.POSITION&&t.opt.update_mode!==e.NUMERIC,t.opt.grouped_sort&&t.citation_sort.opt.sort_directions.length){var i=t.citation_sort.opt.sort_directions[0].slice();t.citation_sort.opt.sort_directions=[i].concat(t.citation_sort.opt.sort_directions)}t.citation.srt=new e.Registry.Comparifier(t,"citation_sort")}}},e.Node["#comment"]={build:function(){}},e.Node.date={build:function(t,i){var s,r,a,n,o,l,u,p,h,c;(this.tokentype===e.START||this.tokentype===e.SINGLETON)&&(t.build.date_parts=[],t.build.date_variables=this.variables,t.build.extension||e.Util.substituteStart.call(this,t,i),s=t.build.extension?e.dateMacroAsSortKey:function(t,e,i){var s;if(t.tmp.element_rendered_ok=!1,t.tmp.donesies=[],t.tmp.dateparts=[],s=[],!this.variables.length||t.tmp.just_looking&&"issued"!==this.variables[0])t.tmp.date_object=!1;else{for(t.parallel.StartVariable(this.variables[0]),r=e[this.variables[0]],"undefined"==typeof r&&(r={"date-parts":[[0]]},t.opt.development_extensions.locator_date_and_revision&&i&&"locator-date"===this.variables[0]&&i["locator-date"]&&(r=i["locator-date"])),t.tmp.date_object=r,a=this.dateparts.length,n=0;a>n;n+=1)o=this.dateparts[n],"undefined"!=typeof t.tmp.date_object[o+"_end"]?s.push(o):"month"===o&&"undefined"!=typeof t.tmp.date_object.season_end&&s.push(o);for(l=[],u=["year","month","day"],a=u.length,n=0;a>n;n+=1)s.indexOf(u[n])>-1&&l.push(u[n]);for(s=l.slice(),p=2,a=s.length,n=0;a>n;n+=1)if(o=s[n],h=t.tmp.date_object[o],c=t.tmp.date_object[o+"_end"],h!==c){p=n;break}t.tmp.date_collapse_at=s.slice(p)}},this.execs.push(s),s=function(t,e){if(t.output.startTag("date",this),"issued"===this.variables[0]&&"legal_case"===e.type&&!t.tmp.extension&&""+e["collection-number"]==""+t.tmp.date_object.year&&1===this.dateparts.length&&"year"===this.dateparts[0])for(var i in t.tmp.date_object)if(t.tmp.date_object.hasOwnProperty(i)&&"year"===i.slice(0,4)){t.tmp.issued_date={};var s=t.output.current.mystack.slice(-2)[0].blobs;t.tmp.issued_date.list=s,t.tmp.issued_date.pos=s.length-1}},this.execs.push(s)),t.build.extension||this.tokentype!==e.END&&this.tokentype!==e.SINGLETON||(s=function(t){t.output.endTag(),t.parallel.CloseVariable("date")},this.execs.push(s)),i.push(this),(this.tokentype===e.END||this.tokentype===e.SINGLETON)&&(t.build.extension||e.Util.substituteEnd.call(this,t,i))}},e.Node["date-part"]={build:function(t,i){var s,r,a,n,o,l,u,p,h,c,m,f,d,g,b,y,v,_,x,A,I,S,O,E;this.strings.form||(this.strings.form="long"),t.build.date_parts.push(this.strings.name);var k=t.build.date_variables[0];s=function(t,i){if(t.tmp.date_object){if(n=!0,o="",l="",t.tmp.donesies.push(this.strings.name),t.tmp.date_object.literal&&"year"===this.strings.name&&(t.parallel.AppendToVariable(t.tmp.date_object.literal),t.output.append(t.tmp.date_object.literal,this)),t.tmp.date_object&&(o=t.tmp.date_object[this.strings.name],l=t.tmp.date_object[this.strings.name+"_end"]),"year"!==this.strings.name||0!==o||t.tmp.suppress_decorations||(o=!1),u=!t.tmp.suppress_decorations,p=t.tmp.have_collapsed,h="year-suffix"===t[t.tmp.area].opt.collapse||"year-suffix-ranged"===t[t.tmp.area].opt.collapse,c=t.opt["disambiguate-add-year-suffix"],u&&c&&h&&(t.tmp.years_used.push(o),m=t.tmp.last_years_used.length>=t.tmp.years_used.length,m&&p&&t.tmp.last_years_used[t.tmp.years_used.length-1]===o&&(o=!1)),"undefined"!=typeof o){f=!1,d=!1,g=!1,b=!1,"year"===this.strings.name&&(parseInt(o,10)<500&&parseInt(o,10)>0&&(d=t.getTerm("ad")),parseInt(o,10)<0&&(f=t.getTerm("bc"),o=-1*parseInt(o,10)),l&&(parseInt(l,10)<500&&parseInt(l,10)>0&&(b=t.getTerm("ad")),parseInt(l,10)<0&&(g=t.getTerm("bc"),l=-1*parseInt(l,10)))),t.parallel.AppendToVariable(o);for(var s=""+t.tmp.date_object.month;s.length<2;)s="0"+s;s="month-"+s;var T=t.locale[t.opt.lang]["noun-genders"][s];if(this.strings.form){var w=this.strings.form;if("day"===this.strings.name&&"ordinal"===w&&t.locale[t.opt.lang].opts["limit-day-ordinals-to-day-1"]&&""+o!="1"&&(w="numeric"),o=e.Util.Dates[this.strings.name][w](t,o,T,"accessed"===k),"month"===this.strings.name)if(t.tmp.strip_periods)o=o.replace(/\./g,"");else for(O=0,E=this.decorations.length;E>O;O+=1)if("@strip-periods"===this.decorations[O][0]&&"true"===this.decorations[O][1]){o=o.replace(/\./g,"");break}if(l)if(l=e.Util.Dates[this.strings.name][w](t,l,T,"accessed"===k,"_end"),t.tmp.strip_periods)l=l.replace(/\./g,"");else for(O=0,E=this.decorations.length;E>O;O+=1)if("@strip-periods"===this.decorations[O][0]&&"true"===this.decorations[O][1]){l=l.replace(/\./g,"");break}}if(t.output.openLevel("empty"),t.tmp.date_collapse_at.length){for(y=!0,a=t.tmp.date_collapse_at.length,r=0;a>r;r+=1)if(S=t.tmp.date_collapse_at[r],-1===t.tmp.donesies.indexOf(S)){y=!1;break}if(y){if(""+l!="0"){if(0===t.dateput.queue.length&&(n=!0),t.opt["year-range-format"]&&"expanded"!==t.opt["year-range-format"]&&!t.tmp.date_object.day&&!t.tmp.date_object.month&&!t.tmp.date_object.season&&"year"===this.strings.name&&o&&l){l=t.fun.year_mangler(o+"-"+l,!0);var N=t.getTerm("year-range-delimiter");l=l.slice(l.indexOf(N)+1)}t.dateput.append(l,this),n&&(t.dateput.current.value()[0].strings.prefix="")}t.output.append(o,this),v=t.output.current.value(),v.blobs[v.blobs.length-1].strings.suffix="",t.output.append(t.getTerm("year-range-delimiter"),"empty"),_=t.dateput.current.value(),v.blobs=v.blobs.concat(_),t.dateput.string(t,t.dateput.queue),t.tmp.date_collapse_at=[]}else t.output.append(o,this),t.tmp.date_collapse_at.indexOf(this.strings.name)>-1&&""+l!="0"&&(0===t.dateput.queue.length&&(n=!0),t.dateput.openLevel("empty"),t.dateput.append(l,this),n&&(t.dateput.current.value().blobs[0].strings.prefix=""),f&&t.dateput.append(f),d&&t.dateput.append(d),t.dateput.closeLevel())}else t.output.append(o,this);f&&t.output.append(f),d&&t.output.append(d),t.output.closeLevel()}else"month"===this.strings.name&&t.tmp.date_object.season&&(o=""+t.tmp.date_object.season,o&&o.match(/^[1-4]$/)?(t.tmp.group_context.replace([!1,!1,!0]),t.output.append(t.getTerm("season-0"+o),this)):o&&t.output.append(o,this));t.tmp.value=[],!o&&!t.tmp.have_collapsed||t.opt.has_year_suffix||"year"!==this.strings.name||t.tmp.just_looking||t.registry.registry[i.id]&&t.registry.registry[i.id].disambig.year_suffix!==!1&&!t.tmp.has_done_year_suffix&&(t.tmp.has_done_year_suffix=!0,A=parseInt(t.registry.registry[i.id].disambig.year_suffix,10),x=new e.NumericBlob(A,this,i.id),this.successor_prefix=t[t.build.area].opt.layout_delimiter,this.splice_prefix=t[t.build.area].opt.layout_delimiter,I=new e.Util.Suffixator(e.SUFFIX_CHARS),x.setFormatter(I),"year-suffix-ranged"===t[t.tmp.area].opt.collapse&&(x.range_prefix=t.getTerm("citation-range-delimiter")),x.successor_prefix=t[t.tmp.area].opt["year-suffix-delimiter"]?t[t.tmp.area].opt["year-suffix-delimiter"]:t[t.tmp.area].opt.layout_delimiter,x.UGLY_DELIMITER_SUPPRESS_HACK=!0,t.output.append(x,"literal"))}},this.execs.push(s),i.push(this)}},e.Node["else-if"]={build:function(t,i){e.Conditions.TopNode.call(this,t,i),i.push(this)},configure:function(t,i){e.Conditions.Configure.call(this,t,i)}},e.Node["else"]={build:function(t,e){e.push(this)},configure:function(t,i){this.tokentype===e.START&&(t.configure.fail[t.configure.fail.length-1]=i)}},e.Node["et-al"]={build:function(t,e){if("citation"===t.build.area||"bibliography"===t.build.area){var i=function(t){t.tmp.etal_node=this,"string"==typeof this.strings.term&&(t.tmp.etal_term=this.strings.term)};this.execs.push(i)}e.push(this)}},e.Node.group={build:function(t,i){var s,r;this.tokentype===e.START?(e.Util.substituteStart.call(this,t,i),t.build.substitute_level.value()&&t.build.substitute_level.replace(t.build.substitute_level.value()+1),s=function(t){t.output.startTag("group",this),t.tmp.group_context.mystack.length&&(t.output.current.value().parent=t.tmp.group_context.value()[4]);var i=t.tmp.group_context.value()[5];!i&&this.strings.label_form_override&&(i=this.strings.label_form_override),t.tmp.group_context.push([!1,!1,!1,!1,t.output.current.value(),i,this.strings.set_parallel_condition],e.LITERAL),this.strings.oops&&(t.tmp.group_context.value()[3]=this.strings.oops)},r=[],r.push(s),this.execs=r.concat(this.execs),this.strings["has-publisher-and-publisher-place"]&&(t.build["publisher-special"]=!0,s=function(t,i){if(this.strings["subgroup-delimiter"]&&i.publisher&&i["publisher-place"]){var s=i.publisher.split(/;\s*/),r=i["publisher-place"].split(/;\s*/);s.length>1&&s.length===r.length&&(t.publisherOutput=new e.PublisherOutput(t,this),t.publisherOutput["publisher-list"]=s,t.publisherOutput["publisher-place-list"]=r)}},this.execs.push(s))):(t.build["publisher-special"]&&(t.build["publisher-special"]=!1,"string"==typeof t[t.build.root].opt["name-delimiter"]&&(s=function(t){t.publisherOutput&&(t.publisherOutput.render(),t.publisherOutput=!1)},this.execs.push(s))),s=function(t,e){var i=t.tmp.group_context.pop();t.output.endTag();t.tmp.group_context.value();if(i[1]&&(t.tmp.group_context.value()[1]=!0),i[2]||i[0]&&!i[1]){t.tmp.group_context.value()[2]=!0;var s=t.output.current.value().blobs,r=t.output.current.value().blobs.length-1;if(!t.tmp.just_looking&&"undefined"!=typeof i[6]){var a={blobs:s,conditions:i[6],id:e.id,pos:r};t.parallel.parallel_conditional_blobs_list.push(a)}}else t.output.current.value().blobs&&t.output.current.value().blobs.pop(),t.tmp.group_context.value()[3]&&(t.output.current.mystack[t.output.current.mystack.length-2].strings.delimiter=t.tmp.group_context.value()[3])},this.execs.push(s)),i.push(this),this.tokentype===e.END&&(t.build.substitute_level.value()&&t.build.substitute_level.replace(t.build.substitute_level.value()-1),e.Util.substituteEnd.call(this,t,i))}},e.Node["if"]={build:function(t,i){e.Conditions.TopNode.call(this,t,i),i.push(this)},configure:function(t,i){e.Conditions.Configure.call(this,t,i)}},e.Node.conditions={build:function(t){this.tokentype===e.START&&t.tmp.conditions.addMatch(this.match),this.tokentype===e.END&&t.tmp.conditions.matchCombine()}},e.Node.condition={build:function(t){if(this.tokentype===e.SINGLETON){var i=t.fun.match[this.match](this,t,this.tests);t.tmp.conditions.addTest(i)}}},e.Conditions={},e.Conditions.TopNode=function(t){var i;(this.tokentype===e.START||this.tokentype===e.SINGLETON)&&(this.locale&&(t.opt.lang=this.locale),this.tests&&this.tests.length?this.test=t.fun.match[this.match](this,t,this.tests):t.tmp.conditions=new e.Conditions.Engine(t,this)),(this.tokentype===e.END||this.tokentype===e.SINGLETON)&&(i=function(t){this.locale_default&&(t.output.current.value().old_locale=this.locale_default,t.output.closeLevel("empty"),t.opt.lang=this.locale_default);var e=this[t.tmp.jump.value()];return e},this.execs.push(i),this.locale_default&&(t.opt.lang=this.locale_default))},e.Conditions.Configure=function(t,i){this.tokentype===e.START?(this.fail=t.configure.fail.slice(-1)[0],this.succeed=this.next,t.configure.fail[t.configure.fail.length-1]=i):this.tokentype===e.SINGLETON?(this.fail=this.next,this.succeed=t.configure.succeed.slice(-1)[0],t.configure.fail[t.configure.fail.length-1]=i):(this.succeed=t.configure.succeed.slice(-1)[0],this.fail=this.next)},e.Conditions.Engine=function(t,e){this.token=e,this.state=t},e.Conditions.Engine.prototype.addTest=function(t){this.token.tests.push(t)},e.Conditions.Engine.prototype.addMatch=function(t){this.token.match=t},e.Conditions.Engine.prototype.matchCombine=function(){this.token.test=this.state.fun.match[this.token.match](this.token,this.state,this.token.tests)},e.Node.info={build:function(t){t.build.skip=this.tokentype===e.START?"info":!1}},e.Node.institution={build:function(t,i){if([e.SINGLETON,e.START].indexOf(this.tokentype)>-1){var s=function(t){"string"!=typeof t.build.name_delimiter||this.strings.delimiter||(this.strings.delimiter=t.tmp.name_delimiter);"text"===this.strings.and?this.and_term=t.getTerm("and","long",0):"symbol"===this.strings.and?this.and_term=t.opt.development_extensions.expect_and_symbol_form?t.getTerm("and","symbol",0):"&":"none"===this.strings.and&&(this.and_term=this.strings.delimiter),"undefined"==typeof this.and_term&&t.tmp.and_term&&(this.and_term=t.getTerm("and","long",0)),e.STARTSWITH_ROMANESQUE_REGEXP.test(this.and_term)?(this.and_prefix_single=" ",this.and_prefix_multiple=", ","string"==typeof this.strings.delimiter&&(this.and_prefix_multiple=this.strings.delimiter),this.and_suffix=" "):(this.and_prefix_single="",this.and_prefix_multiple="",this.and_suffix=""),"always"===this.strings["delimiter-precedes-last"]?this.and_prefix_single=this.strings.delimiter:"never"===this.strings["delimiter-precedes-last"]&&this.and_prefix_multiple&&(this.and_prefix_multiple=" "),this.and={},"undefined"!=typeof this.and_term?(t.output.append(this.and_term,"empty",!0),this.and.single=t.output.pop(),this.and.single.strings.prefix=this.and_prefix_single,this.and.single.strings.suffix=this.and_suffix,t.output.append(this.and_term,"empty",!0),this.and.multiple=t.output.pop(),this.and.multiple.strings.prefix=this.and_prefix_multiple,this.and.multiple.strings.suffix=this.and_suffix):"undefined"!==this.strings.delimiter&&(this.and.single=new e.Blob(this.strings.delimiter),this.and.single.strings.prefix="",this.and.single.strings.suffix="",this.and.multiple=new e.Blob(this.strings.delimiter),this.and.multiple.strings.prefix="",this.and.multiple.strings.suffix=""),t.nameOutput.institution=this};this.execs.push(s)}i.push(this)},configure:function(t){[e.SINGLETON,e.START].indexOf(this.tokentype)>-1&&(t.build.has_institution=!0)}},e.Node["institution-part"]={build:function(t,e){var i;"long"===this.strings.name?i=this.strings["if-short"]?function(t){t.nameOutput.institutionpart["long-with-short"]=this}:function(t){t.nameOutput.institutionpart["long"]=this}:"short"===this.strings.name&&(i=function(t){t.nameOutput.institutionpart["short"]=this}),this.execs.push(i),e.push(this)}},e.Node.key={build:function(t,i){var s,r=new e.Token("key",e.START);r.strings["et-al-min"]=this.strings["et-al-min"],r.strings["et-al-use-first"]=this.strings["et-al-use-first"],r.strings["et-al-use-last"]=this.strings["et-al-use-last"],s=function(t){t.tmp.done_vars=[]},r.execs.push(s),t.opt.citation_number_sort_direction=this.strings.sort_direction,s=function(t){t.output.openLevel("empty")},r.execs.push(s);var a=[];if(this.strings.sort_direction===e.DESCENDING?(a.push(1),a.push(-1)):(a.push(-1),a.push(1)),t[t.build.area].opt.sort_directions.push(a),e.DATE_VARIABLES.indexOf(this.variables[0])>-1&&(t.build.date_key=!0),s=function(t){t.tmp.sort_key_flag=!0,this.strings["et-al-min"]&&(t.tmp["et-al-min"]=this.strings["et-al-min"]),this.strings["et-al-use-first"]&&(t.tmp["et-al-use-first"]=this.strings["et-al-use-first"]),"boolean"==typeof this.strings["et-al-use-last"]&&(t.tmp["et-al-use-last"]=this.strings["et-al-use-last"])},r.execs.push(s),i.push(r),this.variables.length){var n=this.variables[0];if("citation-number"===n&&("citation_sort"===t.build.area&&(t.opt.citation_number_sort=!0),"bibliography_sort"===t.build.area&&(t.opt.citation_number_sort_used=!0)),e.CREATORS.indexOf(n)>-1){var o=new e.Token("names",e.START);o.tokentype=e.START,o.variables=this.variables,e.Node.names.build.call(o,t,i);var l=new e.Token("name",e.SINGLETON);l.tokentype=e.SINGLETON,l.strings["name-as-sort-order"]="all",l.strings["sort-separator"]=" ",l.strings["et-al-use-last"]=this.strings["et-al-use-last"],l.strings["et-al-min"]=this.strings["et-al-min"],l.strings["et-al-use-first"]=this.strings["et-al-use-first"],e.Node.name.build.call(l,t,i);var u=new e.Token("institution",e.SINGLETON);u.tokentype=e.SINGLETON,e.Node.institution.build.call(u,t,i);var p=new e.Token("names",e.END);p.tokentype=e.END,e.Node.names.build.call(p,t,i)}else{var h=new e.Token("text",e.SINGLETON);if(h.dateparts=this.dateparts,e.NUMERIC_VARIABLES.indexOf(n)>-1)s=function(t,i){var s;s=!1,s="citation-number"===n?t.registry.registry[i.id].seq.toString():i[n],s&&(s=e.Util.padding(s)),t.output.append(s,this)};else if("citation-label"===n)s=function(t,e){var i=t.getCitationLabel(e);t.output.append(i,this)};else if(e.DATE_VARIABLES.indexOf(n)>-1)s=e.dateAsSortKey,h.variables=this.variables;else if("title"===n){var c="title",m=!1,f=!1,d=!0;s=t.transform.getOutputFunction(this.variables,c,m,f,d)}else s=function(t,e){var i=e[n];t.output.append(i,"empty")};h.execs.push(s),i.push(h)}}else{var g=new e.Token("text",e.SINGLETON);g.postponed_macro=this.postponed_macro,e.expandMacro.call(t,g)}var b=new e.Token("key",e.END);s=function(t){var e=t.output.string(t,t.output.queue);t.sys.normalizeUnicode&&(e=t.sys.normalizeUnicode(e)),""===e&&(e=void 0),("string"!=typeof e||t.tmp.empty_date)&&(e=void 0,t.tmp.empty_date=!1),t[t.tmp.area].keys.push(e),t.tmp.value=[]},b.execs.push(s),t.build.date_key&&("citation_sort"===t.build.area&&(t[t.build.area].opt.sort_directions.push([-1,1]),s=function(t,i){var s=t.registry.registry[i.id].disambig.year_suffix;s||(s=0);var r=e.Util.padding(""+s);t[t.tmp.area].keys.push(r)},b.execs.push(s)),t.build.date_key=!1),s=function(t){t.tmp["et-al-min"]=void 0,t.tmp["et-al-use-first"]=void 0,t.tmp["et-al-use-last"]=void 0,t.tmp.sort_key_flag=!1},b.execs.push(s),i.push(b)}},e.Node.label={build:function(t,i){if(this.strings.term){this.strings.form||(this.strings.form="long");var s=function(t,i,s){var r=e.evaluateLabel(this,t,i,s);s&&"locator"===this.strings.term&&(t.parallel.StartVariable("label"),t.parallel.AppendToVariable(s.label),s.section_form_override=this.strings.form),t.output.append(r,this),s&&"locator"===this.strings.term&&t.parallel.CloseVariable()};this.execs.push(s)}else{var r=t.build.names_variables.slice(-1)[0];t.build.name_label||(t.build.name_label={});for(var a=0,n=r.length;n>a;a+=1)t.build.name_label[r[a]]||(t.build.name_label[r[a]]={});if(t.build.name_flag)for(var a=0,n=r.length;n>a;a+=1)t.build.name_label[r[a]].after=this;else for(var a=0,n=r.length;n>a;a+=1)t.build.name_label[r[a]].before=this}i.push(this)}},e.Node.layout={build:function(t,i){var s,r,a,n;this.tokentype===e.START&&(s=function(t,i,s){t.opt.development_extensions.apply_citation_wrapper&&t.sys.wrapCitationEntry&&!t.tmp.just_looking&&i.system_id&&"citation"===t.tmp.area&&(cite_entry=new e.Token("group",e.START),cite_entry.decorations=[["@cite","entry"]],t.output.startTag("cite_entry",cite_entry),t.output.current.value().item_id=i.system_id,s&&(t.output.current.value().locator_txt=s.locator_txt,t.output.current.value().suffix_txt=s.suffix_txt))},this.execs.push(s)),this.tokentype!==e.START||t.tmp.cite_affixes[t.build.area]||(s=function(t,e){t.tmp.done_vars=[],!t.tmp.just_looking&&t.registry.registry[e.id].parallel&&t.tmp.done_vars.push("first-reference-note-number"),t.tmp.rendered_name=!1,t.tmp.name_node={}},this.execs.push(s),s=function(t){t.tmp.sort_key_flag=!1},this.execs.push(s),s=function(t){t.tmp.nameset_counter=0},this.execs.push(s),s=function(t,i){var s="empty";t.opt.development_extensions.rtl_support&&["ar","he","fa","ur","yi","ps","syr"].indexOf(i.language)>-1&&(s=new e.Token,s.strings.prefix="\u202b",s.strings.suffix="\u202c"),t.output.openLevel(s)},this.execs.push(s),i.push(this),"citation"===t.build.area&&(r=new e.Token("text",e.SINGLETON),s=function(t,i,s){var r;if(s&&s.prefix){r="";var a=s.prefix.replace(/<[^>]+>/g,"").replace(/["'\u201d\u2019\u00bb\u202f\u00a0 ]+$/g,""),n=a.slice(-1);a.match(e.ENDSWITH_ROMANESQUE_REGEXP)?r=" ":e.TERMINAL_PUNCTUATION.slice(0,-1).indexOf(n)>-1?r=" ":n.match(/[\)\],0-9]/)&&(r=" ");var o=!1;e.TERMINAL_PUNCTUATION.slice(0,-1).indexOf(n)>-1&&s.prefix.indexOf(" ")>-1&&(t.tmp.term_predecessor=!1,o=!0),prefix=(s.prefix+r).replace(/\s+/g," "),t.output.append(prefix,this,!1,o)}},r.execs.push(s),i.push(r)));var o;if(this.locale_raw&&(o=new e.Token("dummy",e.START),o.locale=this.locale_raw,o.strings.delimiter=this.strings.delimiter,o.strings.suffix=this.strings.suffix,t.tmp.cite_affixes[t.build.area]||(t.tmp.cite_affixes[t.build.area]={})),this.tokentype===e.START&&(t.build.layout_flag=!0,this.locale_raw||(t[t.tmp.area].opt.topdecor=[this.decorations],t[t.tmp.area+"_sort"].opt.topdecor=[this.decorations],t[t.build.area].opt.layout_prefix=this.strings.prefix,t[t.build.area].opt.layout_suffix=this.strings.suffix,t[t.build.area].opt.layout_delimiter=this.strings.delimiter,t[t.build.area].opt.layout_decorations=this.decorations,t.tmp.cite_affixes[t.build.area]&&(n=new e.Token("else",e.START),e.Node["else"].build.call(n,t,i))),this.locale_raw)){if(t.build.layout_locale_flag)o.name="else-if",e.Attributes["@locale-internal"].call(o,t,this.locale_raw),e.Node["else-if"].build.call(o,t,i);else{var l=new e.Token("choose",e.START);e.Node.choose.build.call(l,t,i),o.name="if",e.Attributes["@locale-internal"].call(o,t,this.locale_raw),e.Node["if"].build.call(o,t,i)}t.tmp.cite_affixes[t.build.area][o.locale]={},t.tmp.cite_affixes[t.build.area][o.locale].delimiter=this.strings.delimiter,t.tmp.cite_affixes[t.build.area][o.locale].suffix=this.strings.suffix}this.tokentype===e.END&&(this.locale_raw&&(t.build.layout_locale_flag?(o.name="else-if",o.tokentype=e.END,e.Attributes["@locale-internal"].call(o,t,this.locale_raw),e.Node["else-if"].build.call(o,t,i)):(o.name="if",o.tokentype=e.END,e.Attributes["@locale-internal"].call(o,t,this.locale_raw),e.Node["if"].build.call(o,t,i),t.build.layout_locale_flag=!0)),this.locale_raw||(t.tmp.cite_affixes[t.build.area]&&t.build.layout_locale_flag&&(n=new e.Token("else",e.END),e.Node["else"].build.call(n,t,i),n=new e.Token("choose",e.END),e.Node.choose.build.call(n,t,i)),t.build_layout_locale_flag=!0,"citation"===t.build.area&&(a=new e.Token("text",e.SINGLETON),s=function(t,i,s){var r;s&&s.suffix&&(r="",(s.suffix.match(e.STARTSWITH_ROMANESQUE_REGEXP)||["[","("].indexOf(s.suffix.slice(0,1))>-1)&&(r=" "),t.output.append(r+s.suffix,this))},a.execs.push(s),i.push(a)),s=function(t){"bibliography"===t.tmp.area&&t.bibliography.opt["second-field-align"]&&t.output.endTag(),t.output.closeLevel()},this.execs.push(s),s=function(t,e){t.opt.development_extensions.apply_citation_wrapper&&t.sys.wrapCitationEntry&&!t.tmp.just_looking&&e.system_id&&"citation"===t.tmp.area&&t.output.endTag()},this.execs.push(s),i.push(this),t.build.layout_flag=!1,t.build.layout_locale_flag=!1))}},e.Node.macro={build:function(){}},e.NameOutput=function(t,e,i){this.debug=!1,this.state=t,this.Item=e,this.item=i,this.nameset_base=0,this.etal_spec={},this._first_creator_variable=!1,this._please_chop=!1},e.NameOutput.prototype.init=function(t){this.state.tmp.term_predecessor&&(this.state.tmp.subsequent_author_substitute_ok=!1),this.nameset_offset&&(this.nameset_base=this.nameset_base+this.nameset_offset),this.nameset_offset=0,this.names=t,this.variables=t.variables,this.state.tmp.value=[],this.state.tmp.rendered_name=[],this.state.tmp.label_blob=!1,this.state.tmp.etal_node=!1,this.state.tmp.etal_term=!1;for(var e=0,i=this.variables.length;i>e;e+=1)this.Item[this.variables[e]]&&this.Item[this.variables[e]].length&&(this.state.tmp.value=this.state.tmp.value.concat(this.Item[this.variables[e]]));this["et-al"]=void 0,this["with"]=void 0,this.name=void 0,this.institutionpart={},this.state.tmp.group_context.value()[1]=!0,!this.state.tmp.value.length},e.NameOutput.prototype.reinit=function(t){if(this.state.tmp.can_substitute.value()){this.nameset_offset=0,this.variables=t.variables;var i=this.state.tmp.value.slice();this.state.tmp.value=[];for(var s=0,r=this.variables.length;r>s;s+=1)this.Item[this.variables[s]]&&this.Item[this.variables[s]].length&&(this.state.tmp.value=this.state.tmp.value.concat(this.Item[this.variables[s]]));this.state.tmp.value.length&&this.state.tmp.can_substitute.replace(!1,e.LITERAL),this.state.tmp.value=i}},e.NameOutput.prototype.outputNames=function(){var t,i,s=this.variables;if(this.institution.and&&(this.institution.and.single.blobs&&this.institution.and.single.blobs.length||(this.institution.and.single.blobs=this.name.and.single.blobs),this.institution.and.multiple.blobs&&this.institution.and.multiple.blobs.length||(this.institution.and.multiple.blobs=this.name.and.multiple.blobs)),this.variable_offset={},this.family)for(this.family_decor=e.Util.cloneToken(this.family),this.family_decor.strings.prefix="",this.family_decor.strings.suffix="",t=0,i=this.family.execs.length;i>t;t+=1)this.family.execs[t].call(this.family_decor,this.state,this.Item);else this.family_decor=!1;if(this.given)for(this.given_decor=e.Util.cloneToken(this.given),this.given_decor.strings.prefix="",this.given_decor.strings.suffix="",t=0,i=this.given.execs.length;i>t;t+=1)this.given.execs[t].call(this.given_decor,this.state,this.Item);else this.given_decor=!1;if(this.getEtAlConfig(),this.divideAndTransliterateNames(),this.truncatePersonalNameLists(),this.disambigNames(),this.constrainNames(),"count"===this.name.strings.form)return void((this.state.tmp.extension||0!=this.names_count)&&(this.state.output.append(this.names_count,"empty"),this.state.tmp.group_context.value()[2]=!0));this.setEtAlParameters(),this.setCommonTerm(),this.state.tmp.name_node={},this.state.tmp.name_node.children=[],this.renderAllNames();var r=[];for(t=0,i=s.length;i>t;t+=1){for(var a=s[t],n=[],o=!1,l=0,u=this.institutions[a].length;u>l;l+=1)n.push(this.joinPersonsAndInstitutions([this.persons[a][l],this.institutions[a][l]]));if(this.institutions[a].length){var p=this.nameset_base+this.variable_offset[a];this.freeters[a].length&&(p+=1),o=this.joinInstitutionSets(n,p)}var h=this.joinFreetersAndInstitutionSets([this.freeters[a],o]);if(h&&("_sort"!==this.state.tmp.area.slice(-5)&&(h=this._applyLabels(h,a)),r.push(h)),this.common_term)break}for(this.state.output.openLevel("empty"),this.state.output.current.value().strings.delimiter=this.names.strings.delimiter,t=0,i=r.length;i>t;t+=1)this.state.output.append(r[t],"literal",!0);this.state.output.closeLevel("empty");var c=this.state.output.pop();if(this.state.output.append(c,this.names),this.state.tmp.term_predecessor_name&&(this.state.tmp.term_predecessor=!0),this.state.tmp.name_node.top=this.state.output.current.value(),"authority"!==s[0]){var m=[],f=this.Item[s[0]];if(f)for(var t=0,i=f.length;i>t;t+=1)substring=e.Util.Names.getRawName(f[t]),substring&&m.push(substring);m=m.join(", "),m&&(this.state.tmp.name_node.string=m)}if(this.state.tmp.name_node.string&&!this.state.tmp.first_name_string&&(this.state.tmp.first_name_string=this.state.tmp.name_node.string),"classic"===this.Item.type){var d=[];this.state.tmp.first_name_string&&d.push(this.state.tmp.first_name_string),this.Item.title&&d.push(this.Item.title),d=d.join(", "),d&&this.state.sys.getAbbreviation&&(this.state.transform.loadAbbreviation("default","classic",d),this.state.transform.abbrevs["default"].classic[d]&&(this.state.tmp.done_vars.push("title"),this.state.output.append(this.state.transform.abbrevs["default"].classic[d],"empty",!0),c=this.state.output.pop(),this.state.tmp.name_node.top.blobs.pop(),this.state.tmp.name_node.top.blobs.push(c)))
}this._collapseAuthor(),this.variables=[]},e.NameOutput.prototype._applyLabels=function(t,e){var i;if(!this.label||!this.label[e])return t;var s=0,r=this.freeters_count[e]+this.institutions_count[e];if(r>1)s=1;else{for(var a=0,n=this.persons[e].length;n>a;a+=1)r+=this.persons_count[e][a];r>1&&(s=1)}return this.label[e].before&&("number"==typeof this.label[e].before.strings.plural&&(s=this.label[e].before.strings.plural),i=this._buildLabel(e,s,"before",e),this.state.output.openLevel("empty"),this.state.output.append(i,this.label[e].before,!0),this.state.output.append(t,"literal",!0),this.state.output.closeLevel("empty"),t=this.state.output.pop()),this.label[e].after&&("number"==typeof this.label[e].after.strings.plural&&(s=this.label[e].after.strings.plural),i=this._buildLabel(e,s,"after",e),this.state.output.openLevel("empty"),this.state.output.append(t,"literal",!0),this.state.output.append(i,this.label[e].after,!0),this.state.tmp.label_blob=this.state.output.pop(),this.state.output.append(this.state.tmp.label_blob,"literal",!0),this.state.output.closeLevel("empty"),t=this.state.output.pop()),t},e.NameOutput.prototype._buildLabel=function(t,i,s,r){this.common_term&&(t=this.common_term);var a=!1,n=this.label[r][s];return n&&(a=e.castLabel(this.state,n,t,i,e.TOLERANT)),a},e.NameOutput.prototype._collapseAuthor=function(){var t,e,i;0===this.nameset_base&&this.Item[this.variables[0]]&&!this._first_creator_variable&&(this._first_creator_variable=this.variables[0]),(this.item&&this.item["suppress-author"]&&this._first_creator_variable==this.variables[0]||this.state[this.state.tmp.area].opt.collapse&&this.state[this.state.tmp.area].opt.collapse.length||this.state[this.state.tmp.area].opt.cite_group_delimiter&&this.state[this.state.tmp.area].opt.cite_group_delimiter.length)&&(this.state.tmp.authorstring_request?(e="",t=this.state.tmp.name_node.top.blobs.slice(-1)[0].blobs,i=this.state.tmp.offset_characters,t&&(e=this.state.output.string(this.state,t,!1)),this.state.tmp.offset_characters=i,this.state.registry.authorstrings[this.Item.id]=e):this.state.tmp.just_looking||this.state.tmp.suppress_decorations||!(this.item["suppress-author"]||this.state[this.state.tmp.area].opt.collapse&&this.state[this.state.tmp.area].opt.collapse.length||this.state[this.state.tmp.area].opt.cite_group_delimiter&&this.state[this.state.tmp.area].opt.cite_group_delimiter)||(e="",t=this.state.tmp.name_node.top.blobs.slice(-1)[0].blobs,i=this.state.tmp.offset_characters,t&&(e=this.state.output.string(this.state,t,!1)),e===this.state.tmp.last_primary_names_string?((this.item["suppress-author"]||this.state[this.state.tmp.area].opt.collapse&&this.state[this.state.tmp.area].opt.collapse.length)&&(this.state.tmp.name_node.top.blobs.pop(),this.state.tmp.name_node.children=[],this.state.tmp.offset_characters=i),this.state[this.state.tmp.area].opt.cite_group_delimiter&&this.state[this.state.tmp.area].opt.cite_group_delimiter&&(this.state.tmp.use_cite_group_delimiter=!0)):(this.state.tmp.last_primary_names_string=e,this.variables.indexOf(this._first_creator_variable)>-1&&this.item&&this.item["suppress-author"]&&"legal_case"!==this.Item.type&&(this.state.tmp.name_node.top.blobs.pop(),this.state.tmp.name_node.children=[],this.state.tmp.offset_characters=i,this.state.tmp.term_predecessor=!1),this.state.tmp.have_collapsed=!1,this.state[this.state.tmp.area].opt.cite_group_delimiter&&this.state[this.state.tmp.area].opt.cite_group_delimiter&&(this.state.tmp.use_cite_group_delimiter=!1))))},e.NameOutput.prototype.isPerson=function(t){return t.literal||!t.given&&t.family&&t.isInstitution?!1:!0},e.NameOutput.prototype.truncatePersonalNameLists=function(){var t,e,i,s,r,a,n;this.freeters_count={},this.persons_count={},this.institutions_count={};for(t in this.freeters)this.freeters.hasOwnProperty(t)&&(this.freeters_count[t]=this.freeters[t].length,this.freeters[t]=this._truncateNameList(this.freeters,t));for(t in this.persons)if(this.persons.hasOwnProperty(t))for(this.institutions_count[t]=this.institutions[t].length,this._truncateNameList(this.institutions,t),this.persons[t]=this.persons[t].slice(0,this.institutions[t].length),this.persons_count[t]=[],s=0,r=this.persons[t].length;r>s;s+=1)this.persons_count[t][s]=this.persons[t][s].length,this.persons[t][s]=this._truncateNameList(this.persons,t,s);if(a=1!==this.etal_min||1!==this.etal_use_first||this.state.tmp.extension||this.state.tmp.just_looking?!1:t,a||this._please_chop)for(e=0,i=this.variables.length;i>e;e+=1){for(t=this.variables[e],this.freeters[t].length&&(this._please_chop===t?(this.freeters[t]=this.freeters[t].slice(1),this.freeters_count[t]+=-1,this._please_chop=!1):a&&!this._please_chop&&(this.freeters[t]=this.freeters[t].slice(0,1),this.freeters_count[t]=1,this.institutions[t]=[],this.persons[t]=[],this._please_chop=a)),e=0,i=this.persons[t].length;i>e;e+=1)if(this.persons[t][e].length){if(this._please_chop===t){this.persons[t][e]=this.persons[t][e].slice(1),this.persons_count[t][e]+=-1,this._please_chop=!1;break}if(a&&!this._please_chop){this.freeters[t]=this.persons[t][e].slice(0,1),this.freeters_count[t]=1,this.institutions[t]=[],this.persons[t]=[],n=[],this._please_chop=a;break}}this.institutions[t].length&&(this._please_chop===t?(this.institutions[t]=this.institutions[t].slice(1),this.institutions_count[t]+=-1,this._please_chop=!1):a&&!this._please_chop&&(this.institutions[t]=this.institutions[t].slice(0,1),this.institutions_count[t]=1,n=[],this._please_chop=a))}for(e=0,i=this.variables.length;i>e;e+=1)for(this.institutions[t].length&&(this.nameset_offset+=1),e=0,i=this.persons[t].length;i>e;e+=1)this.persons[t][e].length&&(this.nameset_offset+=1)},e.NameOutput.prototype._truncateNameList=function(t,e,i){var s;return s="undefined"==typeof i?t[e]:t[e][i],this.state[this.state[this.state.tmp.area].root].opt.max_number_of_names&&s.length>50&&s.length>this.state[this.state[this.state.tmp.area].root].opt.max_number_of_names+2&&(s=s.slice(0,this.state[this.state[this.state.tmp.area].root].opt.max_number_of_names+2)),s},e.NameOutput.prototype.divideAndTransliterateNames=function(){var t,e,i,s,r=this.Item,a=this.variables;for(this.varnames=a.slice(),this.freeters={},this.persons={},this.institutions={},t=0,e=a.length;e>t;t+=1){var n=a[t];this.variable_offset[n]=this.nameset_offset;var o=this._normalizeVariableValue(r,n);if(this.name.strings["suppress-min"]&&o.length>=this.name.strings["suppress-min"]&&(o=[]),this.name.strings["suppress-max"]&&o.length<=this.name.strings["suppress-max"]&&(o=[]),this._getFreeters(n,o),this._getPersonsAndInstitutions(n,o),0===this.name.strings["suppress-min"])for(this.freeters[n]=[],i=0,s=this.persons[n].length;s>i;i+=1)this.persons[n][i]=[];else if(0===this.institution.strings["suppress-min"]){for(this.institutions[n]=[],this.freeters[n]=this.freeters[n].concat(this.persons[n]),i=0,s=this.persons[n].length;s>i;i+=1)for(var l=0,u=this.persons[n][i].length;u>l;l+=1)this.freeters[n].push(this.persons[n][i][l]);this.persons[n]=[]}}},e.NameOutput.prototype._normalizeVariableValue=function(t,e){var i;return i="string"==typeof t[e]?[{literal:t[e]}]:t[e]?t[e].slice():[]},e.NameOutput.prototype._getFreeters=function(t,e){this.freeters[t]=[];for(var i=e.length-1;i>-1&&this.isPerson(e[i]);i+=-1){var s=this._checkNickname(e.pop());s&&this.freeters[t].push(s)}this.freeters[t].reverse(),this.freeters[t].length&&(this.nameset_offset+=1)},e.NameOutput.prototype._getPersonsAndInstitutions=function(t,e){this.persons[t]=[],this.institutions[t]=[];for(var i=[],s=!1,r=!0,a=e.length-1;a>-1;a+=-1)if(this.isPerson(e[a])){var n=this._checkNickname(e[a]);n&&i.push(n)}else s=!0,this.institutions[t].push(e[a]),r||(i.reverse(),this.persons[t].push(i),i=[]),r=!1;s&&(i.reverse(),this.persons[t].push(i),this.persons[t].reverse(),this.institutions[t].reverse())},e.NameOutput.prototype._clearValues=function(t){for(var e=t.length-1;e>-1;e+=-1)t.pop()},e.NameOutput.prototype._checkNickname=function(t){if(["interview","personal_communication"].indexOf(this.Item.type)>-1){var i="";if(i=e.Util.Names.getRawName(t),i&&this.state.sys.getAbbreviation&&(!this.item||!this.item["suppress-author"])){this.state.transform.loadAbbreviation("default","nickname",i);var s=this.state.transform.abbrevs["default"].nickname[i];s&&(t="!here>>>"===s?!1:{family:s,given:""})}}return t},e.NameOutput.prototype.joinPersons=function(t,e,i){var s;return s="undefined"==typeof i?1===this.etal_spec[e].freeters?this._joinEtAl(t,"name"):2===this.etal_spec[e].freeters?this._joinEllipsis(t,"name"):this.state.tmp.sort_key_flag?this._join(t," "):this._joinAnd(t,"name"):1===this.etal_spec[e].persons[i]?this._joinEtAl(t,"name"):2===this.etal_spec[e].persons[i]?this._joinEllipsis(t,"name"):this.state.tmp.sort_key_flag?this._join(t," "):this._joinAnd(t,"name")},e.NameOutput.prototype.joinInstitutionSets=function(t,e){var i;return i=1===this.etal_spec[e].institutions?this._joinEtAl(t,"institution"):2===this.etal_spec[e].institutions?this._joinEllipsis(t,"institution"):this._joinAnd(t,"institution")},e.NameOutput.prototype.joinPersonsAndInstitutions=function(t){return this._join(t,this.name.strings.delimiter)},e.NameOutput.prototype.joinFreetersAndInstitutionSets=function(t){var e=this._join(t,"[never here]",this["with"].single,this["with"].multiple);return e},e.NameOutput.prototype._joinEtAl=function(t,e){var i=this._join(t,this.name.strings.delimiter);return this.state.output.openLevel(this._getToken(e)),this.state.output.current.value().strings.delimiter="",this.state.output.append(i,"literal",!0),t.length>1?this.state.output.append(this["et-al"].multiple,"literal",!0):1===t.length&&this.state.output.append(this["et-al"].single,"literal",!0),this.state.output.closeLevel(),this.state.output.pop()},e.NameOutput.prototype._joinEllipsis=function(t,e){return this._join(t,this.name.strings.delimiter,this.name.ellipsis.single,this.name.ellipsis.multiple,e)},e.NameOutput.prototype._joinAnd=function(t,e){return this._join(t,this[e].strings.delimiter,this[e].and.single,this[e].and.multiple,e)},e.NameOutput.prototype._join=function(t,i,s,r,a){var n,o;if(!t)return!1;for(n=t.length-1;n>-1;n+=-1)t[n]&&0!==t[n].length&&t[n].blobs.length||(t=t.slice(0,n).concat(t.slice(n+1)));if(!t.length)return!1;if(s&&2===t.length)s&&(s=new e.Blob(s.blobs,s)),t=[t[0],s,t[1]];else{var l;for(l=r?2:1,n=0,o=t.length-l;o>n;n+=1)t[n].strings.suffix+=i;if(t.length>1){var u=t.pop();r?(r=new e.Blob(r.blobs,r),t.push(r)):(s&&(s=new e.Blob(s.blobs,s)),t.push(s)),t.push(u)}}for(this.state.output.openLevel(this._getToken(a)),s&&r&&(this.state.output.current.value().strings.delimiter=""),n=0,o=t.length;o>n;n+=1)this.state.output.append(t[n],!1,!0);return this.state.output.closeLevel(),this.state.output.pop()},e.NameOutput.prototype._getToken=function(t){var i=this[t];if("institution"===t){var s=new e.Token;return s}return i},e.NameOutput.prototype.setCommonTerm=function(){var t=this.variables,e=t.slice();if(e.sort(),this.common_term=e.join(""),!this.common_term)return!1;var i=!1;if(this.label&&this.label[this.variables[0]]&&(this.label[this.variables[0]].before?i=this.state.getTerm(this.common_term,this.label[this.variables[0]].before.strings.form,0):this.label[this.variables[0]].after&&(i=this.state.getTerm(this.common_term,this.label[this.variables[0]].after.strings.form,0))),!this.state.locale[this.state.opt.lang].terms[this.common_term]||!i||this.variables.length<2)return void(this.common_term=!1);for(var s=0,r=0,a=this.variables.length-1;a>r;r+=1){var n=this.variables[r],o=this.variables[r+1];if(this.freeters[n].length||this.freeters[o].length){if(this.etal_spec[n].freeters!==this.etal_spec[o].freeters||!this._compareNamesets(this.freeters[n],this.freeters[o]))return void(this.common_term=!1);s+=1}if(this.persons[n].length!==this.persons[o].length)return void(this.common_term=!1);for(var l=0,u=this.persons[n].length;u>l;l+=1)if(this.etal_spec[n].persons[l]!==this.etal_spec[o].persons[l]||!this._compareNamesets(this.persons[n][l],this.persons[o][l]))return void(this.common_term=!1)}},e.NameOutput.prototype._compareNamesets=function(t,i){if(t.length!==i.length)return!1;for(var s=0,r=i.length;r>s;s+=1)for(var a=(i[s],0),n=e.NAME_PARTS.length;n>a;a+=1){var o=e.NAME_PARTS[a];if(!t[s]||t[s][o]!=i[s][o])return!1}return!0},e.NameOutput.prototype.constrainNames=function(){this.names_count=0;for(var t,e=0,i=this.variables.length;i>e;e+=1){var s=this.variables[e];t=this.nameset_base+e,this.freeters[s].length&&(this.state.tmp.names_max.push(this.freeters[s].length,"literal"),this._imposeNameConstraints(this.freeters,this.freeters_count,s,t),this.names_count+=this.freeters[s].length),this.institutions[s].length&&(this.state.tmp.names_max.push(this.institutions[s].length,"literal"),this._imposeNameConstraints(this.institutions,this.institutions_count,s,t),this.persons[s]=this.persons[s].slice(0,this.institutions[s].length),this.names_count+=this.institutions[s].length);for(var r=0,a=this.persons[s].length;a>r;r+=1)this.persons[s][r].length&&(this.state.tmp.names_max.push(this.persons[s][r].length,"literal"),this._imposeNameConstraints(this.persons[s],this.persons_count[s],r,t),this.names_count+=this.persons[s][r].length)}},e.NameOutput.prototype._imposeNameConstraints=function(t,e,i,s){var r=t[i],a=this.state.tmp["et-al-min"];this.state.tmp.suppress_decorations?this.state.tmp.disambig_request&&this.state.tmp.disambig_request.names[s]?a=this.state.tmp.disambig_request.names[s]:e[i]>=this.etal_min&&(a=this.etal_use_first):(this.state.tmp.disambig_request&&this.state.tmp.disambig_request.names[s]>this.etal_use_first?a=e[i]<this.etal_min?e[i]:this.state.tmp.disambig_request.names[s]:e[i]>=this.etal_min&&(a=this.etal_use_first),this.etal_use_last&&a>this.etal_min-2&&(a=this.etal_min-2));var n=this.etal_min>=this.etal_use_first,o=e[i]>a;a>e[i]&&(a=r.length),n&&o&&(t[i]=this.etal_use_last?r.slice(0,a).concat(r.slice(-1)):r.slice(0,a)),this.state.tmp.disambig_settings.names[s]=t[i].length,this.state.disambiguate.padBase(this.state.tmp.disambig_settings)},e.NameOutput.prototype.disambigNames=function(){for(var t,e=0,i=this.variables.length;i>e;e+=1){var s=this.variables[e];if(t=this.nameset_base+e,this.freeters[s].length&&this._runDisambigNames(this.freeters[s],t),this.institutions[s].length){"undefined"==typeof this.state.tmp.disambig_settings.givens[t]&&(this.state.tmp.disambig_settings.givens[t]=[]);for(var r=0,a=this.institutions[s].length;a>r;r+=1)"undefined"==typeof this.state.tmp.disambig_settings.givens[t][r]&&this.state.tmp.disambig_settings.givens[t].push(2)}for(var r=0,a=this.persons[s].length;a>r;r+=1)this.persons[s][r].length&&this._runDisambigNames(this.persons[s][r],t)}},e.NameOutput.prototype._runDisambigNames=function(t,i){var s,r,a,n,o,l,u;for(o=0,l=t.length;l>o;o+=1)if(t[o].given||t[o].family){if(a=this.name.strings["initialize-with"],this.state.registry.namereg.addname(""+this.Item.id,t[o],o),s=this.state.tmp.disambig_settings.givens[i],"undefined"==typeof s)for(var p=0,h=i+1;h>p;p+=1)this.state.tmp.disambig_settings.givens[p]||(this.state.tmp.disambig_settings.givens[p]=[]);if(s=this.state.tmp.disambig_settings.givens[i][o],"undefined"==typeof s&&(r=this.name.strings.form,n=this.state.registry.namereg.evalname(""+this.Item.id,t[o],o,0,r,a),this.state.tmp.disambig_settings.givens[i].push(n)),r=this.name.strings.form,u=this.state.registry.namereg.evalname(""+this.Item.id,t[o],o,0,r,a),this.state.tmp.disambig_request){var c=this.state.tmp.disambig_settings.givens[i][o];1!==c||"by-cite"!==this.state.citation.opt["givenname-disambiguation-rule"]||"undefined"!=typeof this.name.strings["initialize-with"]&&"undefined"!=typeof t[o].given||(c=2),n=c,this.state.opt["disambiguate-add-givenname"]&&t[o].given&&(n=this.state.registry.namereg.evalname(""+this.Item.id,t[o],o,n,this.name.strings.form,this.name.strings["initialize-with"]))}else n=u;!this.state.tmp.just_looking&&this.item&&this.item.position===e.POSITION_FIRST&&u>n&&(n=u),this.state.tmp.sort_key_flag||(this.state.tmp.disambig_settings.givens[i][o]=n,"string"!=typeof a||"undefined"!=typeof this.name.strings.initialize&&!0!==this.name.strings.initialize||(this.state.tmp.disambig_settings.use_initials=!0))}},e.NameOutput.prototype.getEtAlConfig=function(){var t=this.item;this["et-al"]={},this.state.output.append(this.etal_term,this.etal_style,!0),this["et-al"].single=this.state.output.pop(),this["et-al"].single.strings.suffix=this.etal_suffix,this["et-al"].single.strings.prefix=this.etal_prefix_single,this.state.output.append(this.etal_term,this.etal_style,!0),this["et-al"].multiple=this.state.output.pop(),this["et-al"].multiple.strings.suffix=this.etal_suffix,this["et-al"].multiple.strings.prefix=this.etal_prefix_multiple,"undefined"==typeof t&&(t={}),t.position?(this.etal_min=this.name.strings["et-al-subsequent-min"]?this.name.strings["et-al-subsequent-min"]:this.name.strings["et-al-min"],this.etal_use_first=this.name.strings["et-al-subsequent-use-first"]?this.name.strings["et-al-subsequent-use-first"]:this.name.strings["et-al-use-first"]):(this.etal_min=this.state.tmp["et-al-min"]?this.state.tmp["et-al-min"]:this.name.strings["et-al-min"],this.etal_use_first=this.state.tmp["et-al-use-first"]?this.state.tmp["et-al-use-first"]:this.name.strings["et-al-use-first"],this.etal_use_last="boolean"==typeof this.state.tmp["et-al-use-last"]?this.state.tmp["et-al-use-last"]:this.name.strings["et-al-use-last"]),this.state.tmp["et-al-min"]||(this.state.tmp["et-al-min"]=this.etal_min)},e.NameOutput.prototype.setEtAlParameters=function(){var t,e,i,s;for(t=0,e=this.variables.length;e>t;t+=1){var r=this.variables[t];for("undefined"==typeof this.etal_spec[r]&&(this.etal_spec[r]={freeters:0,institutions:0,persons:[]}),this.etal_spec[this.nameset_base+t]=this.etal_spec[r],this.freeters[r].length&&this._setEtAlParameter("freeters",r),i=0,s=this.persons[r].length;s>i;i+=1)"undefined"==typeof this.etal_spec[r][i]&&(this.etal_spec[r].persons[i]=0),this._setEtAlParameter("persons",r,i);this.institutions[r].length&&this._setEtAlParameter("institutions",r)}},e.NameOutput.prototype._setEtAlParameter=function(t,e,i){var s,r;"persons"===t?(s=this.persons[e][i],r=this.persons_count[e][i]):(s=this[t][e],r=this[t+"_count"][e]),s.length<r&&!this.state.tmp.sort_key_flag?this.etal_use_last?"persons"===t?this.etal_spec[e].persons[i]=2:this.etal_spec[e][t]=2:"persons"===t?this.etal_spec[e].persons[i]=1:this.etal_spec[e][t]=1:"persons"===t?this.etal_spec[e].persons[i]=0:this.etal_spec[e][t]=0},e.NameOutput.prototype.renderAllNames=function(){for(var t,e=0,i=this.variables.length;i>e;e+=1){var s=this.variables[e];t=this.nameset_base+e,this.freeters[s].length&&(this.freeters[s]=this._renderPersonalNames(this.freeters[s],t));for(var r=0,a=this.institutions[s].length;a>r;r+=1)this.persons[s][r]=this._renderPersonalNames(this.persons[s][r],t,r)}this.renderInstitutionNames()},e.NameOutput.prototype.renderInstitutionNames=function(){for(var t=0,e=this.variables.length;e>t;t+=1)for(var i=this.variables[t],s=0,r=this.institutions[i].length;r>s;s+=1){var a,n,o,l,u,s,r,p,h=this.institutions[i][s];if(p=this.state.tmp.extension?["sort"]:h.isInstitution?this.state.opt["cite-lang-prefs"].institutions:this.state.opt["cite-lang-prefs"].persons,slot={primary:"locale-orig",secondary:!1,tertiary:!1},p)for(var c=["primary","secondary","tertiary"],m=0,f=c.length;f>m&&!(p.length-1<m);m+=1)p[m]&&(slot[c[m]]="locale-"+p[m]);else slot.primary="locale-translat";"bibliography"===this.state.tmp.area||"citation"===this.state.tmp.area&&"note"===this.state.opt.xclass&&this.item&&!this.item.position||(slot.secondary=!1,slot.tertiary=!1);var d;this.setRenderedName(h),d=this.getName(h,slot.primary,!0);var g=d.name,b=d.usedOrig;switch(g&&(g=this.fixupInstitution(g,i,s)),secondary=!1,slot.secondary&&(d=this.getName(h,slot.secondary,!1,b),secondary=d.name,b=d.usedOrig,secondary&&(secondary=this.fixupInstitution(secondary,i,s))),tertiary=!1,slot.tertiary&&(d=this.getName(h,slot.tertiary,!1,b),tertiary=d.name,tertiary&&(tertiary=this.fixupInstitution(tertiary,i,s))),this.institution.strings["institution-parts"]){case"short":g["short"].length?(l=this._getShortStyle(),a=[this._renderOneInstitutionPart(g["short"],l)]):(u=this._getLongStyle(g,i,s),a=[this._renderOneInstitutionPart(g["long"],u)]);break;case"short-long":u=this._getLongStyle(g,i,s),l=this._getShortStyle(),n=this._renderOneInstitutionPart(g["short"],l),o=this._composeOneInstitutionPart([g,secondary,tertiary],slot,u),a=[n,o];break;case"long-short":u=this._getLongStyle(g,i,s),l=this._getShortStyle(),n=this._renderOneInstitutionPart(g["short"],l),o=this._composeOneInstitutionPart([g,secondary,tertiary],slot,u,!0),a=[o,n];break;default:u=this._getLongStyle(g,i,s),a=[this._composeOneInstitutionPart([g,secondary,tertiary],slot,u)]}this.institutions[i][s]=this._join(a,"")}},e.NameOutput.prototype._composeOneInstitutionPart=function(t,i,s){var r=!1,a=!1,n=!1;t[0]&&(r=this._renderOneInstitutionPart(t[0]["long"],s)),t[1]&&(a=this._renderOneInstitutionPart(t[1]["long"],s)),t[2]&&(n=this._renderOneInstitutionPart(t[2]["long"],s));var o;return a||n?(this.state.output.openLevel("empty"),this.state.output.append(r),secondary_tok=e.Util.cloneToken(s),i.secondary&&(secondary_tok.strings.prefix=this.state.opt.citeAffixes.institutions[i.secondary].prefix,secondary_tok.strings.suffix=this.state.opt.citeAffixes.institutions[i.secondary].suffix,secondary_tok.strings.prefix||(secondary_tok.strings.prefix=" ")),this.state.output.append(a,secondary_tok),tertiary_tok=e.Util.cloneToken(s),i.tertiary&&(tertiary_tok.strings.prefix=this.state.opt.citeAffixes.institutions[i.tertiary].prefix,tertiary_tok.strings.suffix=this.state.opt.citeAffixes.institutions[i.tertiary].suffix,tertiary_tok.strings.prefix||(tertiary_tok.strings.prefix=" ")),this.state.output.append(n,tertiary_tok),this.state.output.closeLevel(),o=this.state.output.pop()):o=r,o},e.NameOutput.prototype._renderOneInstitutionPart=function(t,i){for(var s=0,r=t.length;r>s;s+=1)if(t[s]){var a=t[s];if(this.state.tmp.strip_periods)a=a.replace(/\./g,"");else for(var n=0,o=i.decorations.length;o>n;n+=1)if("@strip-periods"===i.decorations[n][0]&&"true"===i.decorations[n][1]){a=a.replace(/\./g,"");break}this.state.tmp.group_context.value()[2]=!0,this.state.tmp.can_substitute.replace(!1,e.LITERAL),"!here>>>"===a?t[s]=!1:(this.state.output.append(a,i,!0),t[s]=this.state.output.pop())}return"undefined"==typeof this.institution.strings["part-separator"]&&(this.institution.strings["part-separator"]=this.name.strings.delimiter),this._join(t,this.institution.strings["part-separator"])},e.NameOutput.prototype._renderPersonalNames=function(t,i,s){var r=!1;if(t.length){for(var a=[],n=0,o=t.length;o>n;n+=1){var r,l,u=t[n];if(l=this.state.tmp.extension?["sort"]:u.isInstitution?this.state.opt["cite-lang-prefs"].institutions:this.state.opt["cite-lang-prefs"].persons,slot={primary:"locale-orig",secondary:!1,tertiary:!1},l)for(var p=["primary","secondary","tertiary"],h=0,c=p.length;c>h&&!(l.length-1<h);h+=1)slot[p[h]]="locale-"+l[h];else slot.primary="locale-translat";(this.state.tmp.sort_key_flag||"bibliography"!==this.state.tmp.area&&("citation"!==this.state.tmp.area||"note"!==this.state.opt.xclass||!this.item||this.item.position))&&(slot.secondary=!1,slot.tertiary=!1),this.setRenderedName(u);var m=this.getName(u,slot.primary,!0),f=this._renderOnePersonalName(m.name,i,n,s);secondary=!1,slot.secondary&&(m=this.getName(u,slot.secondary,!1,m.usedOrig),m.name&&(secondary=this._renderOnePersonalName(m.name,i,n,s))),tertiary=!1,slot.tertiary&&(m=this.getName(u,slot.tertiary,!1,m.usedOrig),m.name&&(tertiary=this._renderOnePersonalName(m.name,i,n,s)));var d;secondary||tertiary?(this.state.output.openLevel("empty"),this.state.output.append(f),secondary_tok=new e.Token,slot.secondary&&(secondary_tok.strings.prefix=this.state.opt.citeAffixes.persons[slot.secondary].prefix,secondary_tok.strings.suffix=this.state.opt.citeAffixes.persons[slot.secondary].suffix,secondary_tok.strings.prefix||(secondary_tok.strings.prefix=" ")),this.state.output.append(secondary,secondary_tok),tertiary_tok=new e.Token,slot.tertiary&&(tertiary_tok.strings.prefix=this.state.opt.citeAffixes.persons[slot.tertiary].prefix,tertiary_tok.strings.suffix=this.state.opt.citeAffixes.persons[slot.tertiary].suffix,tertiary_tok.strings.prefix||(tertiary_tok.strings.prefix=" ")),this.state.output.append(tertiary,tertiary_tok),this.state.output.closeLevel(),d=this.state.output.pop()):d=f,a.push(d)}r=this.joinPersons(a,i,s)}return r},e.NameOutput.prototype._isRomanesque=function(t){var i=2;if(t.family.replace('"',"","g").match(e.ROMANESQUE_REGEXP)||(i=0),!i&&t.given&&t.given.match(e.STARTSWITH_ROMANESQUE_REGEXP)&&(i=1),2==i){if(t.multi&&t.multi.main)var s=t.multi.main.slice(0,2);else this.Item.language&&(s=this.Item.language.slice(0,2));["ja","zh"].indexOf(s)>-1&&(i=1)}return i},e.NameOutput.prototype._renderOnePersonalName=function(t,i,s,r){var a=t,n=this._droppingParticle(a,i,r),o=this._familyName(a),l=this._nonDroppingParticle(a),u=this._givenName(a,i,s),p=this._nameSuffix(a);this._isShort(i,s)&&!a["full-form-always"]&&(n=!1,u=!1,p=!1);var h=this.name.strings["sort-separator"];h||(h="");var c;c=a["comma-suffix"]?", ":" ";var m,f,d,g,b=this._isRomanesque(a),y=l&&"-"===l.blobs.slice(-1);return 0===b?m=this._join([l,o,u],""):1===b||a["static-ordering"]?m=this._join([l,o,u]," "):a["reverse-ordering"]?m=this._join([u,l,o]," "):this.state.tmp.sort_key_flag?"never"===this.state.opt["demote-non-dropping-particle"]?(d=this._join([l,o,n]," "),f=this._join([d,u]," "),m=this._join([f,p]," ")):(g=this._join([u,n,l]," "),f=this._join([o,g]," "),m=this._join([f,p]," ")):"all"===this.name.strings["name-as-sort-order"]||"first"===this.name.strings["name-as-sort-order"]&&0===s&&(0===r||"undefined"==typeof r)?(["Lord","Lady"].indexOf(a.given)>-1&&(h=", "),["always","display-and-sort"].indexOf(this.state.opt["demote-non-dropping-particle"])>-1&&!y?(g=this._join([u,n],a["comma-dropping-particle"]+" "),g=this._join([g,l]," "),g&&this.given&&(g.strings.prefix=this.given.strings.prefix,g.strings.suffix=this.given.strings.suffix),o&&this.family&&(o.strings.prefix=this.family.strings.prefix,o.strings.suffix=this.family.strings.suffix),f=this._join([o,g],h),m=this._join([f,p],h)):("bibliography"===this.state.tmp.area&&!this.state.tmp.term_predecessor&&l&&(y||(l.blobs=e.Output.Formatters["capitalize-first"](this.state,l.blobs))),d=y?this._join([l,o],""):this._join([l,o]," "),d&&this.family&&(d.strings.prefix=this.family.strings.prefix,d.strings.suffix=this.family.strings.suffix),g=this._join([u,n],a["comma-dropping-particle"]+" "),g&&this.given&&(g.strings.prefix=this.given.strings.prefix,g.strings.suffix=this.given.strings.suffix),f=this._join([d,g],h),m=this._join([f,p],h))):(a["dropping-particle"]&&a.family&&!a["non-dropping-particle"]&&["'","\u02bc","\u2019"].indexOf(a["dropping-particle"].slice(-1))>-1&&(o=this._join([n,o],""),n=!1),this.state.tmp.term_predecessor||u||"bibliography"!==this.state.tmp.area||(!n&&l?y||(l.blobs=e.Output.Formatters["capitalize-first"](this.state,l.blobs)):n&&(n.blobs=e.Output.Formatters["capitalize-first"](this.state,n.blobs))),y?(g=this._join([l,o],""),g=this._join([n,g]," ")):g=this._join([n,l,o]," "),g=this._join([g,p],c),g&&this.family&&(g.strings.prefix=this.family.strings.prefix,g.strings.suffix=this.family.strings.suffix),u&&this.given&&(u.strings.prefix=this.given.strings.prefix,u.strings.suffix=this.given.strings.suffix),g.strings.prefix&&(a["comma-dropping-particle"]=""),m=this._join([u,g],a["comma-dropping-particle"]+" ")),this.state.tmp.group_context.value()[2]=!0,this.state.tmp.can_substitute.replace(!1,e.LITERAL),this.state.tmp.term_predecessor=!0,this.state.tmp.name_node.children.push(m),m},e.NameOutput.prototype._isShort=function(t,e){return 0===this.state.tmp.disambig_settings.givens[t][e]?!0:!1},e.NameOutput.prototype._normalizeNameInput=function(t){var e={literal:t.literal,family:t.family,isInstitution:t.isInstitution,given:t.given,suffix:t.suffix,"comma-suffix":t["comma-suffix"],"non-dropping-particle":t["non-dropping-particle"],"dropping-particle":t["dropping-particle"],"static-ordering":t["static-ordering"],"reverse-ordering":t["reverse-ordering"],"full-form-always":t["full-form-always"],"parse-names":t["parse-names"],"comma-dropping-particle":"",block_initialize:t.block_initialize,multi:t.multi};return this._parseName(e),e},e.NameOutput.prototype._stripPeriods=function(t,e){var i=this[t+"_decor"];if(e)if(this.state.tmp.strip_periods)e=e.replace(/\./g,"");else if(i)for(var s=0,r=i.decorations.length;r>s;s+=1)if("@strip-periods"===i.decorations[s][0]&&"true"===i.decorations[s][1]){e=e.replace(/\./g,"");break}return e},e.NameOutput.prototype._nonDroppingParticle=function(t){var e=t["non-dropping-particle"];e&&this.state.tmp.sort_key_flag&&(e=e.replace(/[\'\u2019]/,""));var i=this._stripPeriods("family",e);return this.state.output.append(i,this.family_decor,!0)?this.state.output.pop():!1},e.NameOutput.prototype._droppingParticle=function(t,e,i){var s=t["dropping-particle"];s&&this.state.tmp.sort_key_flag&&(s=s.replace(/[\'\u2019]/,""));var r=this._stripPeriods("given",s);if(t["dropping-particle"]&&t["dropping-particle"].match(/^et.?al[^a-z]$/))this.name.strings["et-al-use-last"]?"undefined"==typeof i?this.etal_spec[e].freeters=2:this.etal_spec[e].persons=2:"undefined"==typeof i?this.etal_spec[e].freeters=1:this.etal_spec[e].persons=1,t["comma-dropping-particle"]="";else if(this.state.output.append(r,this.given_decor,!0))return this.state.output.pop();return!1},e.NameOutput.prototype._familyName=function(t){var e=this._stripPeriods("family",t.family);return this.state.output.append(e,this.family_decor,!0)?this.state.output.pop():!1},e.NameOutput.prototype._givenName=function(t,i,s){if(this.name.strings.initialize===!1)t.family&&t.given&&this.name.strings.initialize===!1&&(t.given=e.Util.Names.initializeWith(this.state,t.given,this.name.strings["initialize-with"],!0)),t.given=e.Util.Names.unInitialize(this.state,t.given);else if(t.family&&1===this.state.tmp.disambig_settings.givens[i][s]&&!t.block_initialize){var r=this.name.strings["initialize-with"];t.given=e.Util.Names.initializeWith(this.state,t.given,r)}else t.given=e.Util.Names.unInitialize(this.state,t.given);var a=this._stripPeriods("given",t.given),n=this.state.output.append(a,this.given_decor,!0);return n?(ret=this.state.output.pop(),ret):!1},e.NameOutput.prototype._nameSuffix=function(t){var i=t.suffix;"string"==typeof this.name.strings["initialize-with"]&&(i=e.Util.Names.initializeWith(this.state,t.suffix,this.name.strings["initialize-with"],!0)),i=this._stripPeriods("family",i);var s="";i&&"."===i.slice(-1)&&(i=i.slice(0,-1),s=".");var r=this.state.output.append(i,"empty",!0);return r?(ret=this.state.output.pop(),ret.strings.suffix=s+ret.strings.suffix,ret):!1},e.NameOutput.prototype._getLongStyle=function(t){var i;return i=t["short"].length&&this.institutionpart["long-with-short"]?this.institutionpart["long-with-short"]:this.institutionpart["long"],i||(i=new e.Token),i},e.NameOutput.prototype._getShortStyle=function(){var t;return t=this.institutionpart["short"]?this.institutionpart["short"]:new e.Token},e.NameOutput.prototype._parseName=function(t){var e,i;if(!t["parse-names"]&&"undefined"!=typeof t["parse-names"])return t;t.family&&!t.given&&t.isInstitution&&(t.literal=t.family,t.family=void 0,t.isInstitution=void 0);var s;if(t.family&&'"'===t.family.slice(0,1)&&'"'===t.family.slice(-1)||!t["parse-names"]&&"undefined"!=typeof t["parse-names"]?(t.family=t.family.slice(1,-1),s=!0,t["parse-names"]=0):s=!1,!t["non-dropping-particle"]&&t.family&&!s&&t.given&&(e=t.family.match(/^((?:[\'\u2019a-z][ \'\u2019a-z]*[-\s\'\u2019]+|[ABDVL][^ ][-\s]+[a-z]*\s*|[ABDVL][^ ][^ ][-\s]+[a-z]*\s*))/),e&&(t.family=t.family.slice(e[1].length),t["non-dropping-particle"]=e[1].replace(/\s+$/,"").replace("'","\u2019"))),!t.suffix&&t.given&&(e=t.given.match(/(\s*,!*\s*)/))){i=t.given.indexOf(e[1]);var r=t.given.slice(i+e[1].length),a=t.given.slice(i,i+e[1].length).replace(/\s*/g,"");r.length<=3?(2===a.length&&(t["comma-suffix"]=!0),t.suffix=r):!t["dropping-particle"]&&t.given&&(t["dropping-particle"]=r,t["comma-dropping-particle"]=","),t.given=t.given.slice(0,i)}!t["dropping-particle"]&&t.given&&(e=t.given.match(/(\s+)([a-z][ \'\u2019a-z]*)$/),e&&(t.given=t.given.slice(0,-1*(e[1].length+e[2].length)),t["dropping-particle"]=e[2]))},e.NameOutput.prototype.getName=function(t,e,s,r){if(r&&"locale-orig"===e)return{name:!1,usedOrig:r};t.family||(t.family=""),t.given||(t.given="");var a={};a["static-ordering"]=this.getStaticOrder(t);var n=!0;if("locale-orig"!==e&&(n=!1,t.multi)){var o=this.state.opt[e];for(i=0,ilen=o.length;i<ilen;i+=1)if(l=o[i],t.multi._key[l]){n=!0,t=t.multi._key[l],a=this.getNameParams(l),a.transliterated=!0;
break}}if(!n){var l=!1;t.multi&&t.multi.main?l=t.multi.main:this.Item.language&&(l=this.Item.language),l&&(a=this.getNameParams(l))}if(!s&&!n)return{name:!1,usedOrig:r};t.family||(t.family=""),t.given||(t.given=""),t={family:t.family,given:t.given,"non-dropping-particle":t["non-dropping-particle"],"dropping-particle":t["dropping-particle"],suffix:t.suffix,"static-ordering":a["static-ordering"],"reverse-ordering":a["reverse-ordering"],"full-form-always":a["full-form-always"],"parse-names":t["parse-names"],"comma-suffix":t["comma-suffix"],"comma-dropping-particle":t["comma-dropping-particle"],transliterated:a.transliterated,block_initialize:a["block-initialize"],literal:t.literal,isInstitution:t.isInstitution,multi:t.multi},!t.literal&&!t.given&&t.family&&t.isInstitution&&(t.literal=t.family),t.literal&&(delete t.family,delete t.given),t=this._normalizeNameInput(t);var u;return u=r?r:!n,{name:t,usedOrig:u}},e.NameOutput.prototype.getNameParams=function(t){var i={},s=e.localeResolve(this.Item.language,this.state.opt["default-locale"][0]),r=this.state.locale[s.best]?s.best:this.state.opt["default-locale"][0],a=this.state.locale[r].opts["name-as-sort-order"],n=this.state.locale[r].opts["name-as-reverse-order"],o=this.state.locale[r].opts["name-never-short"],l=t.split("-")[0];return a&&a[l]&&(i["static-ordering"]=!0,i["reverse-ordering"]=!1),n&&n[l]&&(i["reverse-ordering"]=!0,i["static-ordering"]=!1),o&&o[l]&&(i["full-form-always"]=!0),i["static-ordering"]&&(i["block-initialize"]=!0),i},e.NameOutput.prototype.setRenderedName=function(t){if("bibliography"===this.state.tmp.area){for(var i="",s=0,r=e.NAME_PARTS.length;r>s;s+=1)t[e.NAME_PARTS[s]]&&(i+=t[e.NAME_PARTS[s]]);this.state.tmp.rendered_name.push(i)}},e.NameOutput.prototype.fixupInstitution=function(t,e,i){this.state.sys.getHumanForm&&"legal_case"===this.Item.type&&"authority"===e&&(t.literal=this.state.sys.getHumanForm(this.Item.jurisdiction,t.literal)),t=this._splitInstitution(t,e,i),this.institution.strings["reverse-order"]&&t["long"].reverse();var s=t["long"],r=s.slice();if(this.state.sys.getAbbreviation)for(var a=this.Item.jurisdiction,n=0,o=s.length;o>n;n+=1)a=this.state.transform.loadAbbreviation(a,"institution-part",s[n]),this.state.transform.abbrevs[a]["institution-part"][s[n]]&&(r[n]=this.state.transform.abbrevs[a]["institution-part"][s[n]]);return t["short"]=r,t},e.NameOutput.prototype.getStaticOrder=function(t,i){var s=!1;return!i&&t["static-ordering"]?s=!0:0===this._isRomanesque(t)?s=!0:(!t.multi||!t.multi.main)&&this.Item.language&&["vi","hu"].indexOf(this.Item.language)>-1?s=!0:t.multi&&t.multi.main&&["vi","hu"].indexOf(t.multi.main.slice(0,2))>-1?s=!0:this.state.opt["auto-vietnamese-names"]&&e.VIETNAMESE_NAMES.exec(t.family+" "+t.given)&&e.VIETNAMESE_SPECIALS.exec(t.family+t.given)&&(s=!0),s},e.NameOutput.prototype._splitInstitution=function(t,e,i){var s={},r=t.literal.replace(/\s*\|\s*/g,"|");if(r=r.split("|"),"short"===this.institution.strings.form&&this.state.sys.getAbbreviation)for(var a=this.Item.jurisdiction,n=r.length;n>0;n+=-1){var o=r.slice(0,n).join("|");if(a=this.state.transform.loadAbbreviation(a,"institution-entire",o),this.state.transform.abbrevs[a]["institution-entire"][o]){var l=this.state.transform.abbrevs[a]["institution-entire"][o];l=this.state.transform.quashCheck(l);var u=l.split(/>>[0-9]{4}>>/),p=l.match(/>>([0-9]{4})>>/);if(l=u.pop(),u.length>0&&this.Item["original-date"]&&this.Item["original-date"].year)for(var h=p.length-1;h>0&&!(parseInt(this.Item["original-date"].year,10)>=parseInt(p[h],10));h+=-1)l=u.pop();l=l.replace(/\s*\|\s*/g,"|"),r=[l]}}return r.reverse(),s["long"]=this._trimInstitution(r,e,i),s},e.NameOutput.prototype._trimInstitution=function(t,e){var i=!1,s=!1,r=!1,a=t.slice();return this.institution&&("undefined"!=typeof this.institution.strings["use-first"]&&(i=this.institution.strings["use-first"]),"undefined"!=typeof this.institution.strings["stop-last"]&&(a=a.slice(0,this.institution.strings["stop-last"]),t=t.slice(0,this.institution.strings["stop-last"])),"undefined"!=typeof this.institution.strings["use-last"]&&(s=this.institution.strings["use-last"])),!1===i&&(0===this.persons[e].length&&(i=this.institution.strings["substitute-use-first"]),i||(i=0)),!1===s&&(s=i?0:t.length),i>t.length-s&&(i=t.length-s),r&&(s=0),t=t.slice(0,i),a=a.slice(i),s&&(s>a.length&&(s=a.length),s&&(t=t.concat(a.slice(a.length-s)))),t},e.PublisherOutput=function(t,e){this.state=t,this.group_tok=e,this.varlist=[]},e.PublisherOutput.prototype.render=function(){this.clearVars(),this.composeAndBlob(),this.composeElements(),this.composePublishers(),this.joinPublishers()},e.PublisherOutput.prototype.composeAndBlob=function(){this.and_blob={};var t=!1;"text"===this.group_tok.strings.and?t=this.state.getTerm("and"):"symbol"===this.group_tok.strings.and&&(t="&");var i=new e.Token;i.strings.suffix=" ",i.strings.prefix=" ",this.state.output.append(t,i,!0);var s=this.state.output.pop();i.strings.prefix=this.group_tok.strings["subgroup-delimiter"],this.state.output.append(t,i,!0);var r=this.state.output.pop();this.and_blob.single=!1,this.and_blob.multiple=!1,t&&("always"===this.group_tok.strings["subgroup-delimiter-precedes-last"]?this.and_blob.single=r:"never"===this.group_tok.strings["subgroup-delimiter-precedes-last"]?(this.and_blob.single=s,this.and_blob.multiple=s):(this.and_blob.single=s,this.and_blob.multiple=r))},e.PublisherOutput.prototype.composeElements=function(){for(var t=0,e=2;e>t;t+=1)for(var i=["publisher","publisher-place"][t],s=0,r=this["publisher-list"].length;r>s;s+=1){var a=this[i+"-list"][s],n=this[i+"-token"];this.state.output.append(a,n,!0),this[i+"-list"][s]=this.state.output.pop()}},e.PublisherOutput.prototype.composePublishers=function(){for(var t,e=0,i=this["publisher-list"].length;i>e;e+=1){t=[this[this.varlist[0]+"-list"][e],this[this.varlist[1]+"-list"][e]],this["publisher-list"][e]=this._join(t,this.group_tok.strings.delimiter)}},e.PublisherOutput.prototype.joinPublishers=function(){var t=this["publisher-list"],e=(this.name_delimiter,this._join(t,this.group_tok.strings["subgroup-delimiter"],this.and_blob.single,this.and_blob.multiple,this.group_tok));this.state.output.append(e,"literal")},e.PublisherOutput.prototype._join=e.NameOutput.prototype._join,e.PublisherOutput.prototype._getToken=e.NameOutput.prototype._getToken,e.PublisherOutput.prototype.clearVars=function(){this.state.tmp["publisher-list"]=!1,this.state.tmp["publisher-place-list"]=!1,this.state.tmp["publisher-group-token"]=!1,this.state.tmp["publisher-token"]=!1,this.state.tmp["publisher-place-token"]=!1},e.evaluateLabel=function(t,i,s,r){var a;"locator"===t.strings.term?(r&&r.label&&(a="sub verbo"===r.label?"sub-verbo":r.label),a||(a="page")):a=t.strings.term;var n=t.strings.plural;return r&&"number"==typeof r.force_pluralism?n=r.force_pluralism:"number"!=typeof n&&("locator"===t.strings.term?r&&r.locator&&(i.opt.development_extensions.locator_parsing_for_plurals?(i.tmp.shadow_numbers.locator||i.processNumber(!1,r,"locator",s.type),n=i.tmp.shadow_numbers.locator.plural):n=e.evaluateStringPluralism(r.locator)):["page","page-first"].indexOf(t.variables[0])>-1?(i.processNumber(!1,s,a,s.type),n=i.tmp.shadow_numbers[a].plural,a=i.tmp.shadow_numbers[a].label):(i.tmp.shadow_numbers[a]||i.processNumber(!1,s,a,s.type),n=i.tmp.shadow_numbers[a].plural),t.decorations&&(i.opt.development_extensions.csl_reverse_lookup_support||i.sys.csl_reverse_lookup_support)&&(t.decorations.reverse(),t.decorations.push(["@showid","true",t.cslid]),t.decorations.reverse())),e.castLabel(i,t,a,n,e.TOLERANT)},e.evaluateStringPluralism=function(t){if(t){var e=t.match(/(?:[0-9],\s*[0-9]|\s+and\s+|&|([0-9]+)\s*[\-\u2013]\s*([0-9]+))/);if(e&&(!e[1]||parseInt(e[1],10)<parseInt(e[2],10)))return 1}return 0},e.castLabel=function(t,e,i,s,r){var a=e.strings.form;t.tmp.group_context.value()[5]&&(a=t.tmp.group_context.value()[5]);var n=t.getTerm(i,a,s,!1,r);if(t.tmp.strip_periods)n=n.replace(/\./g,"");else for(var o=0,l=e.decorations.length;l>o;o+=1)if("@strip-periods"===e.decorations[o][0]&&"true"===e.decorations[o][1]){n=n.replace(/\./g,"");break}return n},e.Node.name={build:function(t,i){var s;[e.SINGLETON,e.START].indexOf(this.tokentype)>-1&&(t.fixOpt(this,"name-delimiter","name_delimiter"),t.fixOpt(this,"name-form","form"),t.fixOpt(this,"and","and"),t.fixOpt(this,"delimiter-precedes-last","delimiter-precedes-last"),t.fixOpt(this,"delimiter-precedes-et-al","delimiter-precedes-et-al"),t.fixOpt(this,"initialize-with","initialize-with"),t.fixOpt(this,"initialize","initialize"),t.fixOpt(this,"name-as-sort-order","name-as-sort-order"),t.fixOpt(this,"sort-separator","sort-separator"),t.fixOpt(this,"and","and"),t.fixOpt(this,"et-al-min","et-al-min"),t.fixOpt(this,"et-al-use-first","et-al-use-first"),t.fixOpt(this,"et-al-use-last","et-al-use-last"),t.fixOpt(this,"et-al-subsequent-min","et-al-subsequent-min"),t.fixOpt(this,"et-al-subsequent-use-first","et-al-subsequent-use-first"),this.strings["et-al-subsequent-min"]&&this.strings["et-al-subsequent-min"]!==this.strings["et-al-min"]&&(t.opt.update_mode=e.POSITION),this.strings["et-al-subsequent-use-first"]&&this.strings["et-al-subsequent-use-first"]!==this.strings["et-al-use-first"]&&(t.opt.update_mode=e.POSITION),this.strings.delimiter="undefined"==typeof this.strings.name_delimiter?", ":this.strings.name_delimiter,this.strings["et-al-use-last"]&&(this.ellipsis_term="\u2026",this.ellipsis_prefix_single=" ",this.ellipsis_prefix_multiple=this.strings.delimiter,this.ellipsis_suffix=" "),s=function(t){t.tmp.etal_term="et-al",t.tmp.name_delimiter=this.strings.delimiter,t.tmp["delimiter-precedes-et-al"]=this.strings["delimiter-precedes-et-al"],"text"===this.strings.and?this.and_term=t.getTerm("and","long",0):"symbol"===this.strings.and&&(this.and_term=t.opt.development_extensions.expect_and_symbol_form?t.getTerm("and","symbol",0):"&"),t.tmp.and_term=this.and_term,e.STARTSWITH_ROMANESQUE_REGEXP.test(this.and_term)?(this.and_prefix_single=" ",this.and_prefix_multiple=", ","string"==typeof this.strings.delimiter&&(this.and_prefix_multiple=this.strings.delimiter),this.and_suffix=" ",t.build.name_delimiter=this.strings.delimiter):(this.and_prefix_single="",this.and_prefix_multiple="",this.and_suffix=""),"always"===this.strings["delimiter-precedes-last"]?this.and_prefix_single=this.strings.delimiter:"never"===this.strings["delimiter-precedes-last"]?this.and_prefix_multiple&&(this.and_prefix_multiple=" "):"after-inverted-name"===this.strings["delimiter-precedes-last"]&&(this.and_prefix_single&&(this.and_prefix_single=this.strings.delimiter),this.and_prefix_multiple&&(this.and_prefix_multiple=" ")),this.and={},this.strings.and?(t.output.append(this.and_term,"empty",!0),this.and.single=t.output.pop(),this.and.single.strings.prefix=this.and_prefix_single,this.and.single.strings.suffix=this.and_suffix,t.output.append(this.and_term,"empty",!0),this.and.multiple=t.output.pop(),this.and.multiple.strings.prefix=this.and_prefix_multiple,this.and.multiple.strings.suffix=this.and_suffix):this.strings.delimiter&&(this.and.single=new e.Blob(this.strings.delimiter),this.and.single.strings.prefix="",this.and.single.strings.suffix="",this.and.multiple=new e.Blob(this.strings.delimiter),this.and.multiple.strings.prefix="",this.and.multiple.strings.suffix=""),this.ellipsis={},this.strings["et-al-use-last"]&&(this.ellipsis.single=new e.Blob(this.ellipsis_term),this.ellipsis.single.strings.prefix=this.ellipsis_prefix_single,this.ellipsis.single.strings.suffix=this.ellipsis_suffix,this.ellipsis.multiple=new e.Blob(this.ellipsis_term),this.ellipsis.multiple.strings.prefix=this.ellipsis_prefix_multiple,this.ellipsis.multiple.strings.suffix=this.ellipsis_suffix),"undefined"==typeof t.tmp["et-al-min"]&&(t.tmp["et-al-min"]=this.strings["et-al-min"]),"undefined"==typeof t.tmp["et-al-use-first"]&&(t.tmp["et-al-use-first"]=this.strings["et-al-use-first"]),"undefined"==typeof t.tmp["et-al-use-last"]&&(t.tmp["et-al-use-last"]=this.strings["et-al-use-last"]),t.nameOutput.name=this},t.build.name_flag=!0,this.execs.push(s)),i.push(this)}},e.Node["name-part"]={build:function(t){t.build[this.strings.name]=this}},e.Node.names={build:function(t,i){var s;if((this.tokentype===e.START||this.tokentype===e.SINGLETON)&&(e.Util.substituteStart.call(this,t,i),t.build.substitute_level.push(1),t.fixOpt(this,"names-delimiter","delimiter")),this.tokentype===e.SINGLETON){t.build.names_variables.push(this.variables);for(var r=0,a=this.variables.length;a>r;r+=1)t.build.name_label[this.variables[r]]=t.build.name_label[t.build.names_variables.slice(0)[0]];s=function(t){t.nameOutput.reinit(this)},this.execs.push(s)}if(this.tokentype===e.START&&(t.build.names_flag=!0,t.build.names_level+=1,1===t.build.names_level&&(t.build.names_variables=[],t.build.name_label={}),t.build.names_variables.push(this.variables),s=function(t){t.tmp.can_substitute.push(!0),t.parallel.StartVariable("names",this.variables[0]),t.nameOutput.init(this)},this.execs.push(s)),this.tokentype===e.END){for(var r=0,a=3;a>r;r+=1){var n=["family","given","et-al"][r];this[n]=t.build[n],1===t.build.names_level&&(t.build[n]=void 0)}this.label=t.build.name_label,1===t.build.names_level&&(t.build.name_label={}),t.build.names_level+=-1,t.build.names_variables.pop();var o="with",l="",u="";e.STARTSWITH_ROMANESQUE_REGEXP.test(o)&&(l=" ",u=" "),this["with"]={},this["with"].single=new e.Blob(o),this["with"].single.strings.suffix=u,this["with"].multiple=new e.Blob(o),this["with"].multiple.strings.suffix=u,"always"===this.strings["delimiter-precedes-last"]?(this["with"].single.strings.prefix=this.strings.delimiter,this["with"].multiple.strings.prefix=this.strings.delimiter):"contextual"===this.strings["delimiter-precedes-last"]?(this["with"].single.strings.prefix=l,this["with"].multiple.strings.prefix=this.strings.delimiter):"after-inverted-name"===this.strings["delimiter-precedes-last"]?(this["with"].single.strings.prefix=this.strings.delimiter,this["with"].multiple.strings.prefix=l):(this["with"].single.strings.prefix=l,this["with"].multiple.strings.prefix=l),s=function(t){this.etal_style=t.tmp.etal_node?t.tmp.etal_node:"empty",this.etal_term=t.getTerm(t.tmp.etal_term,"long",0),e.STARTSWITH_ROMANESQUE_REGEXP.test(this.etal_term)?(this.etal_prefix_single=" ",this.etal_prefix_multiple=t.tmp.name_delimiter,"always"===t.tmp["delimiter-precedes-et-al"]?this.etal_prefix_single=t.tmp.name_delimiter:"never"===t.tmp["delimiter-precedes-et-al"]?this.etal_prefix_multiple=" ":"after-inverted-name"===t.tmp["delimiter-precedes-et-al"]&&(this.etal_prefix_single=t.tmp.name_delimiter,this.etal_prefix_multiple=" "),this.etal_suffix=""):(this.etal_prefix_single="",this.etal_prefix_multiple="",this.etal_suffix="");for(var i=0,s=3;s>i;i+=1){var r=["family","given"][i];t.nameOutput[r]=this[r]}t.nameOutput["with"]=this["with"],t.nameOutput.label=this.label,t.nameOutput.etal_style=this.etal_style,t.nameOutput.etal_term=this.etal_term,t.nameOutput.etal_prefix_single=this.etal_prefix_single,t.nameOutput.etal_prefix_multiple=this.etal_prefix_multiple,t.nameOutput.etal_suffix=this.etal_suffix,t.nameOutput.outputNames(),t.tmp["et-al-use-first"]=void 0,t.tmp["et-al-min"]=void 0,t.tmp["et-al-use-last"]=void 0},this.execs.push(s),s=function(t){t.tmp.can_substitute.pop()||t.tmp.can_substitute.replace(!1,e.LITERAL),t.parallel.CloseVariable("names"),1===t.tmp.can_substitute.mystack.length&&(t.tmp.can_block_substitute=!1)},this.execs.push(s),t.build.name_flag=!1}i.push(this),(this.tokentype===e.END||this.tokentype===e.SINGLETON)&&(t.build.substitute_level.pop(),e.Util.substituteEnd.call(this,t,i))}},e.Node.number={build:function(t,i){var s;e.Util.substituteStart.call(this,t,i),"roman"===this.strings.form?this.formatter=t.fun.romanizer:"ordinal"===this.strings.form?this.formatter=t.fun.ordinalizer:"long-ordinal"===this.strings.form&&(this.formatter=t.fun.long_ordinalizer),"undefined"==typeof this.successor_prefix&&(this.successor_prefix=t[t.build.area].opt.layout_delimiter),"undefined"==typeof this.splice_prefix&&(this.splice_prefix=t[t.build.area].opt.layout_delimiter),s=function(t,i,s){var r,a,n,o;if(0!==this.variables.length){if("undefined"==typeof s)var s={};var l,u;if(l=this.variables[0],"locator"!==l||!t.tmp.just_looking){t.parallel.StartVariable(this.variables[0]),t.parallel.AppendToVariable("locator"===this.variables[0]?i.section:i[this.variables[0]]);var p=new RegExp("(?:&|, | and |"+t.getTerm("page-range-delimiter")+")");"collection-number"===l&&"legal_case"===i.type&&(t.tmp.renders_collection_number=!0);var h=i[this.variables[0]],c="long";if(this.strings.label_form_override&&(c=this.strings.label_form_override),"locator"===l&&s.locator)if(s.locator=s.locator.replace(/([^\\])\s*-\s*/,"$1"+t.getTerm("page-range-delimiter")),u=s.locator.match(e.STATUTE_SUBDIV_GROUPED_REGEX)){for(o=s.locator.split(e.STATUTE_SUBDIV_PLAIN_REGEX),r=0,a=o.length;a>r;r+=1)o[r]=t.fun.page_mangler(o[r]);for(n=[o[0]],!this.strings.label_form_override&&t.tmp.group_context.value()[5]&&(c=t.tmp.group_context.value()[5]),r=1,a=o.length;a>r;r+=1){var m=0;o[r].match(p)&&(m=1);var f=e.STATUTE_SUBDIV_STRINGS[u[r-1].replace(/^\s*/,"")],d=c;s.section_label_count>r&&s.section_form_override&&(d=s.section_form_override),n.push(t.getTerm(f,d,m)),n.push(o[r].replace(/^\s*/,""))}h=n.join(" "),h=h.replace(/\\/,"","g"),t.output.append(h,this)}else h=t.fun.page_mangler(s.locator),h=h.replace(/\\/,"","g"),t.output.append(h,this);else{var g=this;(!t.tmp.shadow_numbers[l]||t.tmp.shadow_numbers[l].values.length&&t.tmp.shadow_numbers[l].values[0][2]===!1)&&("locator"===l?t.processNumber(g,s,l,i.type):t.processNumber(g,i,l,i.type));var b,y=t.tmp.shadow_numbers[l].values,v="",_="page";if(["bill","gazette","legislation","legal_case","treaty"].indexOf(i.type)>-1&&"collection-number"===l&&(_="year"),("number"===l&&["bill","gazette","legislation","treaty"].indexOf(i.type)>-1||t.opt[_+"-range-format"])&&!this.strings.prefix&&!this.strings.suffix&&!this.strings.form)for(r=0,a=y.length;a>r;r+=1)v+=y[r][1];if(v&&!v.match(/^[\-.\u20130-9]+$/)){if("number"===l&&["bill","gazette","legislation","treaty"].indexOf(i.type)>-1){var x=v.split(/\s/)[0];if(x&&(n=[],u=v.match(e.STATUTE_SUBDIV_GROUPED_REGEX))){for(o=v.split(e.STATUTE_SUBDIV_PLAIN_REGEX),r=1,a=o.length;a>r;r+=1)n.push(t.getTerm(e.STATUTE_SUBDIV_STRINGS[u[r-1].replace(/^\s+/,"")],this.strings.label_form_override)),n.push(o[r].replace(/^\s+/,""));v=n.join(" ")}}t.output.append(v,this)}else if(y.length){for(t.output.openLevel("empty"),r=0,a=y.length;a>r;r+=1)b=new e[y[r][0]](y[r][1],y[r][2],i.id),r>0&&(b.strings.prefix=b.strings.prefix.replace(/^\s*/,"")),r<y.length-1&&(b.strings.suffix=b.strings.suffix.replace(/\s*$/,"")),"undefined"==typeof b.gender&&(b.gender=t.locale[t.opt.lang]["noun-genders"][l]),t.output.append(b,"literal",!1,!1,!0);t.output.closeLevel("empty")}}"locator"===l&&t.tmp.done_vars.push("locator"),t.parallel.CloseVariable("number")}}},this.execs.push(s),i.push(this),e.Util.substituteEnd.call(this,t,i)}},e.Node.sort={build:function(t,i){if(i=t[t.build.root+"_sort"].tokens,this.tokentype===e.START){"citation"===t.build.area&&(t.parallel.use_parallels=!1,t.opt.sort_citations=!0),t.build.area=t.build.root+"_sort",t.build.extension="_sort";var s=function(t,i){if(t.opt.has_layout_locale){for(var s,r=e.localeResolve(i.language,t.opt["default-locale"][0]),a=t[t.tmp.area.slice(0,-5)].opt.sort_locales,n=0,o=a.length;o>n&&(s=a[n][r.bare],s||(s=a[n][r.best]),!s);n+=1);s||(s=t.opt["default-locale"][0]),t.tmp.lang_sort_hold=t.opt.lang,t.opt.lang=s}};this.execs.push(s)}if(this.tokentype===e.END){t.build.area=t.build.root,t.build.extension="";var s=function(t){t.opt.has_layout_locale&&(t.opt.lang=t.tmp.lang_sort_hold,delete t.tmp.lang_sort_hold)};this.execs.push(s)}i.push(this)}},e.Node.substitute={build:function(t,i){var s;this.tokentype===e.START&&(s=function(t){t.tmp.can_block_substitute=!0,t.tmp.value.length&&t.tmp.can_substitute.replace(!1,e.LITERAL)},this.execs.push(s)),i.push(this)}},e.Node.text={build:function(t,i){var s,r,a,n,o,l,u,p,h,c,m,f,d,g,b;if(this.postponed_macro)return e.expandMacro.call(t,this);if(e.Util.substituteStart.call(this,t,i),this.variables_real||(this.variables_real=[]),this.variables||(this.variables=[]),r="long",a=0,this.strings.form&&(r=this.strings.form),this.strings.plural&&(a=this.strings.plural),"citation-number"===this.variables_real[0]||"year-suffix"===this.variables_real[0]||"citation-label"===this.variables_real[0])"citation-number"===this.variables_real[0]?("citation"===t.build.root&&(t.opt.update_mode=e.NUMERIC),"bibliography"===t.build.root&&(t.opt.bib_mode=e.NUMERIC),"bibliography_sort"===t.build.area&&(t.opt.citation_number_sort_used=!0),"citation-number"===t[t.tmp.area].opt.collapse&&(this.range_prefix=t.getTerm("citation-range-delimiter")),this.successor_prefix=t[t.build.area].opt.layout_delimiter,this.splice_prefix=t[t.build.area].opt.layout_delimiter,s=function(t,i,s){if(n=""+i.id,!t.tmp.just_looking){if(s&&s["author-only"]){t.tmp.element_trace.replace("do-not-suppress-me");var r=t.getTerm("reference","long","singular");"undefined"==typeof r&&(r="reference"),f=e.Output.Formatters["capitalize-first"](t,r),t.output.append(f+" "),t.tmp.last_element_trace=!0}s&&s["suppress-author"]&&(t.tmp.last_element_trace&&t.tmp.element_trace.replace("suppress-me"),t.tmp.last_element_trace=!1),o=t.registry.registry[n].seq,t.opt.citation_number_slug?t.output.append(t.opt.citation_number_slug,this):(l=new e.NumericBlob(o,this,i.id),t.output.append(l,"literal"))}},this.execs.push(s)):"year-suffix"===this.variables_real[0]?(t.opt.has_year_suffix=!0,"year-suffix-ranged"===t[t.tmp.area].opt.collapse&&(this.range_prefix=t.getTerm("citation-range-delimiter")),this.successor_prefix=t[t.build.area].opt.layout_delimiter,t[t.tmp.area].opt["year-suffix-delimiter"]&&(this.successor_prefix=t[t.build.area].opt["year-suffix-delimiter"]),s=function(t,i){if(t.registry.registry[i.id]&&t.registry.registry[i.id].disambig.year_suffix!==!1&&!t.tmp.just_looking){for(o=parseInt(t.registry.registry[i.id].disambig.year_suffix,10),l=new e.NumericBlob(o,this,i.id),u=new e.Util.Suffixator(e.SUFFIX_CHARS),l.setFormatter(u),t.output.append(l,"literal"),p=!1,d=t.tmp.group_context.mystack.length,g=0;d>g;g+=1)if(b=t.tmp.group_context.mystack[g],!b[2]&&(b[1]||!b[1]&&!b[0])){p=!0;break}h=t[t.tmp.area].opt["year-suffix-delimiter"],p&&h&&!t.tmp.sort_key_flag&&(t.tmp.splice_delimiter=t[t.tmp.area].opt["year-suffix-delimiter"])}},this.execs.push(s)):"citation-label"===this.variables_real[0]&&(t.opt.has_year_suffix=!0,s=function(t,e){c=e["citation-label"],c||(c=t.getCitationLabel(e)),t.tmp.just_looking||(m="",t.registry.registry[e.id]&&t.registry.registry[e.id].disambig.year_suffix!==!1&&(o=parseInt(t.registry.registry[e.id].disambig.year_suffix,10),m=t.fun.suffixator.format(o)),c+=m),t.output.append(c,this)},this.execs.push(s));else if(this.strings.term)s=function(t,i){var s=t.opt.gender[i.type],n=this.strings.term;n=t.getTerm(n,r,a,s,!1,"accessed"===n);var o;if(""!==n&&(b=t.tmp.group_context.value(),b[0]=!0,t.tmp.group_context.replace(b)),o=t.tmp.term_predecessor||"in-text"===t.opt["class"]&&"citation"===t.tmp.area?n:e.Output.Formatters["capitalize-first"](t,n),t.tmp.strip_periods)o=o.replace(/\./g,"");else for(var l=0,u=this.decorations.length;u>l;l+=1)if("@strip-periods"===this.decorations[l][0]&&"true"===this.decorations[l][1]){o=o.replace(/\./g,"");break}t.output.append(o,this)},this.execs.push(s),t.build.term=!1,t.build.form=!1,t.build.plural=!1;else if(this.variables_real.length){if(s=function(t,e){var i=this.variables[0];"title"!==i||"short"!==r&&!e["title-short"]||(i="title-short"),t.parallel.StartVariable(i),t.parallel.AppendToVariable(e[i],i)},this.execs.push(s),e.MULTI_FIELDS.indexOf(this.variables_real[0])>-1){var y=this.variables[0],v=!1,_=!1,x=!1;"short"===r?"container-title"===this.variables_real[0]?_="journalAbbreviation":"title"===this.variables_real[0]&&(_="title-short"):y=!1,t.build.extension?x=!0:(x=!0,v=!0),s=t.transform.getOutputFunction(this.variables,y,v,_,x)}else s=e.CITE_FIELDS.indexOf(this.variables_real[0])>-1?function(t,e,i){if(i&&i[this.variables[0]]){var s=""+i[this.variables[0]];s=s.replace(/([^\\])--*/g,"$1"+t.getTerm("page-range-delimiter")),s=s.replace(/\\-/g,"-"),t.output.append(s,this,!1,!1,!0),"locator-revision"===this.variables[0]&&t.tmp.done_vars.push("locator-revision")}}:"page-first"===this.variables_real[0]?function(t,e){var i;i=t.getVariable(e,"page-first",r),i&&(i=i.replace("\\",""),t.output.append(i,this,!1,!1,!0))}:"page"===this.variables_real[0]?function(t,e){var i=t.getVariable(e,"page",r);i&&(i=""+i,i=i.replace(/([^\\])--*/g,"$1"+t.getTerm("page-range-delimiter")),i=i.replace(/\\-/g,"-"),i=t.fun.page_mangler(i),t.output.append(i,this,!1,!1,!0))}:"volume"===this.variables_real[0]?function(t,e){if(this.variables[0]){var i=t.getVariable(e,this.variables[0],r);i&&t.output.append(i,this)}}:["URL","DOI"].indexOf(this.variables_real[0])>-1?function(t,e){var i;this.variables[0]&&(i=t.getVariable(e,this.variables[0],r),i&&(t.opt.development_extensions.wrap_url_and_doi?this.decorations.length&&this.decorations[0][0]==="@"+this.variables[0]||(this.decorations=[["@"+this.variables[0],"true"]].concat(this.decorations)):this.decorations.length&&this.decorations[0][0]==="@"+this.variables[0]&&(this.decorations=this.decorations.slice(1)),t.output.append(i,this,!1,!1,!0)))}:"section"===this.variables_real[0]?function(t,e){var i;i=t.getVariable(e,this.variables[0],r),i&&t.output.append(i,this)}:"hereinafter"===this.variables_real[0]?function(t,e){var i=t.transform.abbrevs["default"].hereinafter[e.id];i&&(t.output.append(i,this),t.tmp.group_context.value()[2]=!0)}:function(t,e){var i;this.variables[0]&&(i=t.getVariable(e,this.variables[0],r),i&&(i=""+i,i=i.replace("\\","","g"),t.output.append(i,this)))};this.execs.push(s),s=function(t){t.parallel.CloseVariable("text")},this.execs.push(s)}else this.strings.value&&(s=function(t){var e;e=t.tmp.group_context.value(),e[0]=!0,t.tmp.group_context.replace(e),t.output.append(this.strings.value,this)},this.execs.push(s));i.push(this),e.Util.substituteEnd.call(this,t,i)}},e.Attributes={},e.Attributes["@genre"]=function(t,e){e=e.replace("-"," ");var i=function(t){return e===t.genre?!0:!1};this.tests.push(i)},e.Attributes["@disambiguate"]=function(t,e){if("true"===e){t.opt.has_disambiguate=!0;var i=function(){return t.tmp.disambiguate_maxMax+=1,t.tmp.disambig_settings.disambiguate&&t.tmp.disambiguate_count<t.tmp.disambig_settings.disambiguate?(t.tmp.disambiguate_count+=1,!0):!1};this.tests.push(i)}else if("check-ambiguity-and-backreference"===e){var i=function(e){return t.registry.registry[e.id].disambig.disambiguate&&t.registry.registry[e.id]["citation-count"]>1?!0:!1};this.tests.push(i)}},e.Attributes["@is-numeric"]=function(t,i){for(var s=i.split(/\s+/),r=function(i){return function(s,r){var a=s;if(["locator","locator-revision"].indexOf(i)>-1&&(a=r),"undefined"==typeof a)return!1;if(e.NUMERIC_VARIABLES.indexOf(i)>-1){if(t.tmp.shadow_numbers[i]||t.processNumber(!1,a,i,s.type),a[i]&&t.tmp.shadow_numbers[i].numeric)return!0}else if(["title","locator-revision","version"].indexOf(i)>-1&&a[i]&&a[i].slice(-1)===""+parseInt(a[i].slice(-1),10))return!0;return!1}},a=0;a<s.length;a+=1)this.tests.push(r(s[a]))},e.Attributes["@is-uncertain-date"]=function(t,e){for(var i=e.split(/\s+/),s=function(t){return function(e){return e[t]&&e[t].circa?!0:!1}},r=0,a=i.length;a>r;r+=1)this.tests.push(s(i[r]))},e.Attributes["@locator"]=function(t,e){var i=e.replace("sub verbo","sub-verbo");i=i.split(/\s+/);for(var s=function(t){return function(e,i){var s;return s="undefined"!=typeof i&&i.label?"sub verbo"===i.label?"sub-verbo":i.label:"page",t===s?!0:!1}},r=0,a=i.length;a>r;r+=1)this.tests.push(s(i[r]))},e.Attributes["@position"]=function(t,i){var s;t.opt.update_mode=e.POSITION,t.parallel.use_parallels=!0;for(var r=i.split(/\s+/),a=function(e){return function(i,s){if("bibliography"===t.tmp.area)return!1;if(s&&"undefined"==typeof s.position&&(s.position=0),s&&"number"==typeof s.position){if(0===s.position&&0===e)return!0;if(e>0&&s.position>=e)return!0}else if(0===e)return!0;return!1}},n=0,o=r.length;o>n;n+=1){var s=r[n];"first"===s?s=e.POSITION_FIRST:"subsequent"===s?s=e.POSITION_SUBSEQUENT:"ibid"===s?s=e.POSITION_IBID:"ibid-with-locator"===s&&(s=e.POSITION_IBID_WITH_LOCATOR),this.tests.push("near-note"===s?function(t,i){return i&&i.position>=e.POSITION_SUBSEQUENT&&i["near-note"]?!0:!1}:a(s))}},e.Attributes["@type"]=function(t,e){for(var i=e.split(/\s+/),s=function(t){return function(e){var i=e.type===t;return i?!0:!1}},r=[],a=0,n=i.length;n>a;a+=1)r.push(s(i[a]));this.tests.push(t.fun.match.any(this,t,r))},e.Attributes["@variable"]=function(t,i){var s;if(this.variables=i.split(/\s+/),this.variables_real=this.variables.slice(),"label"===this.name&&this.variables[0])this.strings.term=this.variables[0];else if(["names","date","text","number"].indexOf(this.name)>-1)s=function(t,e,i){variables=this.variables_real.slice();for(var s=this.variables.length-1;s>-1;s+=-1)this.variables.pop();for(len=variables.length,pos=0;pos<len;pos+=1)-1!==t.tmp.done_vars.indexOf(variables[pos])||i&&"legal_case"===e.type&&i["suppress-author"]&&"title"===variables[pos]||this.variables.push(variables[pos]),t.tmp.can_block_substitute&&t.tmp.done_vars.push(variables[pos])},this.execs.push(s),s=function(t,i,s){for(output=!1,len=this.variables.length,pos=0;pos<len;pos+=1){if(variable=this.variables[pos],"authority"===variable&&"string"==typeof i[variable]&&"names"===this.name){var r={family:i[variable],isInstitution:!0,multi:{_key:{}}};if(i.multi&&i.multi._keys&&i.multi._keys[variable])for(var a in i.multi._keys[variable])creatorChild={family:i.multi._keys[variable][a],isInstitution:!0},r.multi._key[a]=creatorChild;i[variable]=[r]}if("short"!==this.strings.form||i[variable]||("title"===variable?variable="title-short":"container-title"===variable&&(variable="journalAbbreviation")),"year-suffix"===variable){output=!0;break}if(e.DATE_VARIABLES.indexOf(variable)>-1){if(t.opt.development_extensions.locator_date_and_revision&&"locator-date"===variable){output=!0;break}if(i[variable]){for(var n in i[variable])if((-1!==this.dateparts.indexOf(n)||"literal"===n)&&i[variable][n]){output=!0;break}if(output)break}}else{if("locator"===variable){s&&s.locator&&(output=!0);break}if("locator-revision"===variable){s&&s["locator-revision"]&&(output=!0);break}if(["citation-number","citation-label"].indexOf(variable)>-1){output=!0;break}if("first-reference-note-number"===variable){s&&s["first-reference-note-number"]&&(output=!0);break}if("hereinafter"===variable){t.transform.abbrevs["default"].hereinafter[i.id]&&t.sys.getAbbreviation&&i.id&&(output=!0);break}if("object"==typeof i[variable]){i[variable].length;break}if("string"==typeof i[variable]&&i[variable]){output=!0;break}if("number"==typeof i[variable]){output=!0;break}}if(output)break}flag=t.tmp.group_context.value(),output?(("citation-number"!==variable||"bibliography"!==t.tmp.area)&&(t.tmp.cite_renders_content=!0),flag[2]=!0,t.tmp.group_context.replace(flag),t.tmp.can_substitute.value()&&"bibliography"===t.tmp.area&&"string"==typeof i[variable]&&t.tmp.rendered_name.push(i[variable]),t.tmp.can_substitute.replace(!1,e.LITERAL)):flag[1]=!0},this.execs.push(s);else if(["if","else-if","condition"].indexOf(this.name)>-1)for(var r=function(e){return function(i,s){var r=i;if(s&&["locator","locator-revision","first-reference-note-number","locator-date"].indexOf(e)>-1&&(r=s),"hereinafter"===e&&t.sys.getAbbreviation&&r.id){if(t.transform.abbrevs["default"].hereinafter[r.id])return!0}else if(r[e]){if("number"==typeof r[e]||"string"==typeof r[e])return!0;if("object"==typeof r[e])for(key in r[e])if(r[e][key])return!0}return!1}},a=0,n=this.variables.length;n>a;a+=1)this.tests.push(r(this.variables[a]))},e.Attributes["@page"]=function(t,e){var i=e.replace("sub verbo","sub-verbo");i=i.split(/\s+/);for(var s=function(e){return function(i){var s;return t.processNumber(!1,i,"page",i.type),s=t.tmp.shadow_numbers.page.label?"sub verbo"===t.tmp.shadow_numbers.page.label?"sub-verbo":t.tmp.shadow_numbers.page.label:"page",e===s?!0:!1}},r=0,a=i.length;a>r;r+=1)this.tests.push(s(i[r]))},e.Attributes["@jurisdiction"]=function(t,e){for(var i=e.split(/\s+/),s=0,r=i.length;r>s;s+=1)i[s]=i[s].split(";");for(var a=function(t){return function(e){if(!e.jurisdiction)return!1;for(var i=e.jurisdiction.split(";"),s=0,r=i.length;r>s;s+=1)i[s]=i[s].split(";");for(s=t.length;s>0;s+=-1){var a=t.slice(0,s).join(";"),n=i.slice(0,s).join(";");if(a!==n)return!1}return!0}},s=0,r=i.length;r>s;s+=1){var n=i[s].slice();this.tests.push(a(n))}},e.Attributes["@context"]=function(t,e){var i=function(){var i=t.tmp.area.slice(0,e.length);
return i===e?!0:!1};this.tests.push(i)},e.Attributes["@has-year-only"]=function(t,e){for(var i=e.split(/\s+/),s=function(t){return function(e){var i=e[t];return!i||i.month||i.season?!1:!0}},r=0,a=i.length;a>r;r+=1)this.tests.push(s(i[r]))},e.Attributes["@has-to-month-or-season"]=function(t,e){for(var i=e.split(/\s+/),s=function(t){return function(e){var i=e[t];return!i||!i.month&&!i.season||i.day?!1:!0}},r=0,a=i.length;a>r;r+=1)this.tests.push(s(i[r]))},e.Attributes["@has-day"]=function(t,e){for(var i=e.split(/\s+/),s=function(t){return function(e){var i=e[t];return i&&i.day?!0:!1}},r=0,a=i.length;a>r;r+=1)this.tests.push(s(i[r]))},e.Attributes["@subjurisdictions"]=function(t,e){var i=parseInt(e,10),s=function(t){var e=0;return t.jurisdiction&&(e=t.jurisdiction.split(";").length),e&&(e+=-1),e>=i?!0:!1};this.tests.push(s)},e.Attributes["@is-plural"]=function(t,e){var i=function(t){var i=t[e];if(i&&i.length){for(var s=0,r=0,a=!1,n=0,o=i.length;o>n;n+=1)i[n].isInstitution&&(i[n].literal||i[n].family&&!i[n].given)?(r+=1,a=!1):(s+=1,a=!0);if(s>1)return!0;if(r>1)return!0;if(r&&a)return!0}return!1};this.tests.push(i)},e.Attributes["@locale"]=function(t,i){var s,r,a,n,o,l,u=t.opt["default-locale"][0];if("layout"===this.name){if(this.locale_raw=i,this.tokentype===e.START){var p=i.split(/\s+/),h={},c=e.localeResolve(p[0],u);c.generic?h[c.generic]=c.best:h[c.best]=c.best;for(var o=1,l=p.length;l>o;o+=1){var m=e.localeResolve(p[o],u);m.generic?h[m.generic]=c.best:h[m.best]=c.best}t[t.build.area].opt.sort_locales.push(h)}t.opt.has_layout_locale=!0}else{n=i.split(/\s+/);var f=[];for(o=0,l=n.length;l>o;o+=1)a=n[o],r=e.localeResolve(a,u),2===n[o].length&&f.push(r.bare),t.localeConfigure(r,!0),n[o]=r;var d=n.slice(),g=function(t,i,r){return function(a){var n;s=[],n=!1;var u,p=!1;for(u=a.language?a.language:i,p=e.localeResolve(u,i),o=0,l=t.length;l>o;o+=1)if(p.best===t[o].best){n=!0;break}return!n&&r.indexOf(p.bare)>-1&&(n=!0),n}};this.tests.push(g(d,u,f))}},e.Attributes["@locale-internal"]=function(t,i){var s,r,a,n,o,l;for(n=i.split(/\s+/),this.locale_bares=[],o=0,l=n.length;l>o;o+=1)a=n[o],r=e.localeResolve(a,t.opt["default-locale"][0]),2===n[o].length&&this.locale_bares.push(r.bare),t.localeConfigure(r),n[o]=r;this.locale_default=t.opt["default-locale"][0],this.locale=n[0].best,this.locale_list=n.slice();var u=function(i){return function(r){var n;s=[],n=!1;var u=!1;if(r.language&&(a=r.language,u=e.localeResolve(a,t.opt["default-locale"][0]),u.best===t.opt["default-locale"][0]&&(u=!1)),u){for(o=0,l=i.locale_list.length;l>o;o+=1)if(u.best===i.locale_list[o].best){t.opt.lang=i.locale,t.tmp.last_cite_locale=i.locale,t.output.openLevel("empty"),t.output.current.value().new_locale=i.locale,n=!0;break}!n&&i.locale_bares.indexOf(u.bare)>-1&&(t.opt.lang=i.locale,t.tmp.last_cite_locale=i.locale,t.output.openLevel("empty"),t.output.current.value().new_locale=i.locale,n=!0)}return n}},p=this;this.tests.push(u(p))},e.Attributes["@is-parallel"]=function(t,e){for(var i=e.split(" "),s=0,r=i.length;r>s;s+=1)"true"===i[s]?i[s]=!0:"false"===i[s]&&(i[s]=!1);this.strings.set_parallel_condition=i},e.Attributes["@gender"]=function(t,e){this.gender=e},e.Attributes["@cslid"]=function(t,e){this.cslid=parseInt(e,10)},e.Attributes["@label-form"]=function(t,e){this.strings.label_form_override=e},e.Attributes["@part-separator"]=function(t,e){this.strings["part-separator"]=e},e.Attributes["@leading-noise-words"]=function(t,e){this["leading-noise-words"]=e},e.Attributes["@name-never-short"]=function(t,e){this["name-never-short"]=e},e.Attributes["@class"]=function(t,e){t.opt["class"]=e},e.Attributes["@version"]=function(t,e){t.opt.version=e},e.Attributes["@value"]=function(t,e){this.strings.value=e},e.Attributes["@name"]=function(t,e){this.strings.name=e},e.Attributes["@form"]=function(t,e){this.strings.form=e},e.Attributes["@date-parts"]=function(t,e){this.strings["date-parts"]=e},e.Attributes["@range-delimiter"]=function(t,e){this.strings["range-delimiter"]=e},e.Attributes["@macro"]=function(t,e){this.postponed_macro=e},e.Attributes["@term"]=function(t,e){this.strings.term="sub verbo"===e?"sub-verbo":e},e.Attributes["@xmlns"]=function(){},e.Attributes["@lang"]=function(t,e){e&&(t.build.lang=e)},e.Attributes["@lingo"]=function(){},e.Attributes["@macro-has-date"]=function(){this["macro-has-date"]=!0},e.Attributes["@suffix"]=function(t,e){this.strings.suffix=e},e.Attributes["@prefix"]=function(t,e){this.strings.prefix=e},e.Attributes["@delimiter"]=function(t,e){"name"==this.name?this.strings.name_delimiter=e:this.strings.delimiter=e},e.Attributes["@match"]=function(t,e){this.match=e},e.Attributes["@names-min"]=function(t,e){var i=parseInt(e,10);t[t.tmp.area].opt.max_number_of_names<i&&(t[t.tmp.area].opt.max_number_of_names=i),this.strings["et-al-min"]=i},e.Attributes["@names-use-first"]=function(t,e){this.strings["et-al-use-first"]=parseInt(e,10)},e.Attributes["@names-use-last"]=function(t,e){this.strings["et-al-use-last"]="true"===e?!0:!1},e.Attributes["@sort"]=function(t,i){"descending"===i&&(this.strings.sort_direction=e.DESCENDING)},e.Attributes["@plural"]=function(t,e){"always"===e||"true"===e?this.strings.plural=1:"never"===e||"false"===e?this.strings.plural=0:"contextual"===e&&(this.strings.plural=!1)},e.Attributes["@number"]=function(t,e){var i,s=e.replace("sub verbo","sub-verbo");s=s.split(/\s+/),["if","else-if"].indexOf(this.name)>-1&&(i=function(t,e){var i,r=[];t.processNumber(!1,e,"number",e.type),i=t.tmp.shadow_numbers.number.label?"sub verbo"===t.tmp.shadow_numbers.number.label?"sub-verbo":t.tmp.shadow_numbers.number.label:"number";for(var a=0,n=s.length;n>a;a+=1)r.push(s[a]===i?!0:!1);return r},this.tests.push(i))},e.Attributes["@has-publisher-and-publisher-place"]=function(){this.strings["has-publisher-and-publisher-place"]=!0},e.Attributes["@publisher-delimiter-precedes-last"]=function(t,e){this.strings["publisher-delimiter-precedes-last"]=e},e.Attributes["@publisher-delimiter"]=function(t,e){this.strings["publisher-delimiter"]=e},e.Attributes["@publisher-and"]=function(t,e){this.strings["publisher-and"]=e},e.Attributes["@newdate"]=function(){},e.Attributes["@givenname-disambiguation-rule"]=function(t,i){e.GIVENNAME_DISAMBIGUATION_RULES.indexOf(i)>-1&&(t.citation.opt["givenname-disambiguation-rule"]=i)},e.Attributes["@collapse"]=function(t,e){e&&(t[this.name].opt.collapse=e)},e.Attributes["@cite-group-delimiter"]=function(t,e){e&&(t[t.tmp.area].opt.cite_group_delimiter=e)},e.Attributes["@names-delimiter"]=function(t,e){t.setOpt(this,"names-delimiter",e)},e.Attributes["@name-form"]=function(t,e){t.setOpt(this,"name-form",e)},e.Attributes["@subgroup-delimiter"]=function(t,e){this.strings["subgroup-delimiter"]=e},e.Attributes["@subgroup-delimiter-precedes-last"]=function(t,e){this.strings["subgroup-delimiter-precedes-last"]=e},e.Attributes["@name-delimiter"]=function(t,e){t.setOpt(this,"name-delimiter",e)},e.Attributes["@et-al-min"]=function(t,e){var i=parseInt(e,10);t[t.tmp.area].opt.max_number_of_names<i&&(t[t.tmp.area].opt.max_number_of_names=i),t.setOpt(this,"et-al-min",i)},e.Attributes["@et-al-use-first"]=function(t,e){t.setOpt(this,"et-al-use-first",parseInt(e,10))},e.Attributes["@et-al-use-last"]=function(t,e){"true"===e?t.setOpt(this,"et-al-use-last",!0):t.setOpt(this,"et-al-use-last",!1)},e.Attributes["@et-al-subsequent-min"]=function(t,e){var i=parseInt(e,10);t[t.tmp.area].opt.max_number_of_names<i&&(t[t.tmp.area].opt.max_number_of_names=i),t.setOpt(this,"et-al-subsequent-min",i)},e.Attributes["@et-al-subsequent-use-first"]=function(t,e){t.setOpt(this,"et-al-subsequent-use-first",parseInt(e,10))},e.Attributes["@suppress-min"]=function(t,e){this.strings["suppress-min"]=parseInt(e,10)},e.Attributes["@suppress-max"]=function(t,e){this.strings["suppress-max"]=parseInt(e,10)},e.Attributes["@and"]=function(t,e){t.setOpt(this,"and",e)},e.Attributes["@delimiter-precedes-last"]=function(t,e){t.setOpt(this,"delimiter-precedes-last",e)},e.Attributes["@delimiter-precedes-et-al"]=function(t,e){t.setOpt(this,"delimiter-precedes-et-al",e)},e.Attributes["@initialize-with"]=function(t,e){t.setOpt(this,"initialize-with",e)},e.Attributes["@initialize"]=function(t,e){"false"===e&&t.setOpt(this,"initialize",!1)},e.Attributes["@name-as-reverse-order"]=function(t,e){this["name-as-reverse-order"]=e},e.Attributes["@name-as-sort-order"]=function(t,e){"style-options"===this.name?this["name-as-sort-order"]=e:t.setOpt(this,"name-as-sort-order",e)},e.Attributes["@sort-separator"]=function(t,e){t.setOpt(this,"sort-separator",e)},e.Attributes["@year-suffix-delimiter"]=function(t,e){t[this.name].opt["year-suffix-delimiter"]=e},e.Attributes["@after-collapse-delimiter"]=function(t,e){t[this.name].opt["after-collapse-delimiter"]=e},e.Attributes["@subsequent-author-substitute"]=function(t,e){t[this.name].opt["subsequent-author-substitute"]=e},e.Attributes["@subsequent-author-substitute-rule"]=function(t,e){t[this.name].opt["subsequent-author-substitute-rule"]=e},e.Attributes["@disambiguate-add-names"]=function(t,e){"true"===e&&(t.opt["disambiguate-add-names"]=!0)},e.Attributes["@disambiguate-add-givenname"]=function(t,e){"true"===e&&(t.opt["disambiguate-add-givenname"]=!0)},e.Attributes["@disambiguate-add-year-suffix"]=function(t,e){"true"===e&&"numeric"!==t.opt.xclass&&(t.opt["disambiguate-add-year-suffix"]=!0)},e.Attributes["@second-field-align"]=function(t,e){("flush"===e||"margin"===e)&&(t[this.name].opt["second-field-align"]=e)},e.Attributes["@hanging-indent"]=function(t,e){"true"===e&&(t[this.name].opt.hangingindent=2)},e.Attributes["@line-spacing"]=function(t,e){e&&e.match(/^[.0-9]+$/)&&(t[this.name].opt["line-spacing"]=parseFloat(e,10))},e.Attributes["@entry-spacing"]=function(t,e){e&&e.match(/^[.0-9]+$/)&&(t[this.name].opt["entry-spacing"]=parseFloat(e,10))},e.Attributes["@near-note-distance"]=function(t,e){t[this.name].opt["near-note-distance"]=parseInt(e,10)},e.Attributes["@text-case"]=function(t,e){var i=function(t,i){if("normal"===e)this.text_case_normal=!0;else if(this.strings["text-case"]=e,"title"===e){{t.opt["default-locale"][0].slice(0,2)}i.jurisdiction&&(this.strings["text-case"]="passthrough")}};this.execs.push(i)},e.Attributes["@page-range-format"]=function(t,e){t.opt["page-range-format"]=e},e.Attributes["@year-range-format"]=function(t,e){t.opt["year-range-format"]=e},e.Attributes["@default-locale"]=function(t,e){var i,s,r,a,n;if(a=e.match(/-x-(sort|translit|translat)-/g))for(r=0,s=a.length;s>r;r+=1)a[r]=a[r].replace(/^-x-/,"").replace(/-$/,"");for(i=e.split(/-x-(?:sort|translit|translat)-/),n=[i[0]],r=1,s=i.length;s>r;r+=1)n.push(a[r-1]),n.push(i[r]);for(i=n.slice(),s=i.length,r=1;s>r;r+=2)t.opt["locale-"+i[r]].push(i[r+1].replace(/^\s*/g,"").replace(/\s*$/g,""));t.opt["default-locale"]=i.length?i.slice(0,1):["en"]},e.Attributes["@default-locale-sort"]=function(t,e){t.opt["default-locale-sort"]=e},e.Attributes["@demote-non-dropping-particle"]=function(t,e){t.opt["demote-non-dropping-particle"]=e},e.Attributes["@initialize-with-hyphen"]=function(t,e){"false"===e&&(t.opt["initialize-with-hyphen"]=!1)},e.Attributes["@institution-parts"]=function(t,e){this.strings["institution-parts"]=e},e.Attributes["@if-short"]=function(t,e){"true"===e&&(this.strings["if-short"]=!0)},e.Attributes["@substitute-use-first"]=function(t,e){this.strings["substitute-use-first"]=parseInt(e,10)},e.Attributes["@use-first"]=function(t,e){this.strings["use-first"]=parseInt(e,10)},e.Attributes["@stop-last"]=function(t,e){this.strings["stop-last"]=-1*parseInt(e,10)},e.Attributes["@oops"]=function(t,e){this.strings.oops=e},e.Attributes["@use-last"]=function(t,e){this.strings["use-last"]=parseInt(e,10)},e.Attributes["@reverse-order"]=function(t,e){"true"===e&&(this.strings["reverse-order"]=!0)},e.Attributes["@display"]=function(t,e){this.strings.cls=e},e.Stack=function(t,e){this.mystack=[],(e||t)&&this.mystack.push(t)},e.Stack.prototype.push=function(t,e){this.mystack.push(e||t?t:"")},e.Stack.prototype.clear=function(){this.mystack=[]},e.Stack.prototype.replace=function(t,e){if(0===this.mystack.length)throw"Internal CSL processor error: attempt to replace nonexistent stack item with "+t;this.mystack[this.mystack.length-1]=e||t?t:""},e.Stack.prototype.pop=function(){return this.mystack.pop()},e.Stack.prototype.value=function(){return this.mystack.slice(-1)[0]},e.Stack.prototype.length=function(){return this.mystack.length},e.Parallel=function(t){this.state=t,this.sets=new e.Stack([]),this.try_cite=!0,this.use_parallels=!1,this.midVars=["section","volume","container-title","collection-number","issue","page-first","page","number"],this.ignoreVarsLawGeneral=["first-reference-note-number","locator","label","page-first","page","genre"],this.ignoreVarsLawProceduralHistory=["issued","first-reference-note-number","locator","label","page-first","page","genre","jurisdiction"],this.ignoreVarsOrders=["first-reference-note-number"],this.ignoreVarsOther=["first-reference-note-number","locator","label","section","page-first","page"]},e.Parallel.prototype.isMid=function(t){return this.midVars.indexOf(t)>-1},e.Parallel.prototype.StartCitation=function(t,e){this.parallel_conditional_blobs_list=[],this.use_parallels&&(this.sortedItems=t,this.sortedItemsPos=-1,this.sets.clear(),this.sets.push([]),this.in_series=!0,this.delim_counter=0,this.delim_pointers=[],this.out=e?e:this.state.output.queue,this.master_was_neutral_cite=!0)},e.Parallel.prototype.StartCite=function(t,i,s){var r,a,n,o,l,u,p,h;if(this.use_parallels){this.sets.value().length&&this.sets.value()[0].itemId==t.id&&this.ComposeSet(),this.sortedItemsPos+=1,i&&(r=i.position),this.try_cite=!0;for(var c=!1,m=0,f=e.PARALLEL_MATCH_VARS.length;f>m;m+=1)if(t[e.PARALLEL_MATCH_VARS[m]]){c=!0;break}var d=!0,g=this.sets.value().slice(-1)[0];if(g&&g.Item){var b=g.Item.jurisdiction?g.Item.jurisdiction.split(";")[0]:"",y=t.jurisdiction?t.jurisdiction.split(";")[0]:"";g.Item.title!==t.title?d=!1:b!==y?d=!1:g.Item.type!==t.type?d=!1:["article-journal","article-magazine"].indexOf(t.type)>-1&&(this.state.opt.development_extensions.handle_parallel_articles&&g.Item["container-title"]===t["container-title"]||(d=!1))}if(d&&c&&-1!==e.PARALLEL_TYPES.indexOf(t.type)||(this.try_cite=!0,this.in_series&&(this.in_series=!1)),this.cite={},this.cite.front=[],this.cite.mid=[],this.cite.back=[],this.cite.front_collapse={},this.cite.back_forceme=[],this.cite.position=r,this.cite.Item=t,this.cite.itemId=""+t.id,this.cite.prevItemID=""+s,this.target="front",["treaty"].indexOf(t.type)>-1)this.ignoreVars=this.ignoreVarsOrders;else if(["article-journal","article-magazine"].indexOf(t.type)>-1)this.ignoreVars=this.ignoreVarsOther;else if(i&&i.prefix){this.ignoreVars=this.ignoreVarsLawProceduralHistory,this.cite.useProceduralHistory=!0;var v=this.sets.value()[this.sets.value().length-1];if(v&&v.back)for(var m=v.back.length-1;m>-1;m+=-1)v.back[m]&&v[v.back[m]]&&delete v[v.back[m]]}else this.ignoreVars=this.ignoreVarsLawGeneral;if(this.sortedItems&&this.sortedItemsPos>0&&this.sortedItemsPos<this.sortedItems.length){if(o=this.sortedItems[this.sortedItemsPos][1],u=""+this.sortedItems[this.sortedItemsPos-1][1].id,l=this.state.registry.registry[u].parallel,p=!1,l==o.id){for(a=this.sortedItemsPos-1,n=a;n>-1;n+=-1)if(this.sortedItems[n][1].id==t.id){p=this.sortedItems[n][1].locator;break}h=this.sortedItems[this.sortedItemsPos][1].locator,o.position=!p&&h?e.POSITION_IBID_WITH_LOCATOR:h===p?e.POSITION_IBID:e.POSITION_IBID_WITH_LOCATOR}}else{if(!this.state.registry.registry[t.id])return this.try_cite=!1,void(this.force_collapse=!1);this.state.registry.registry[t.id].parallel=!1}this.force_collapse=!1,this.state.registry.registry[t.id].parallel&&(this.force_collapse=!0)}},e.Parallel.prototype.StartVariable=function(t,i){if(this.use_parallels&&(this.try_cite||this.force_collapse)){if(this.variable="names"===t?t+":"+this.target:t,this.ignoreVars.indexOf(t)>-1)return;"container-title"===t&&0===this.sets.value().length&&(this.master_was_neutral_cite=!1),this.data={},this.data.value="",this.data.blobs=[];var s=this.isMid(t);"authority"===i&&"names:front"===this.variable?(this.try_cite=!0,this.in_series=!1):"front"===this.target&&s?this.target="mid":"mid"===this.target&&!s&&this.cite.Item.title&&"names"!==t?this.target="back":"back"===this.target&&s&&(this.try_cite=!0,this.in_series=!1),"number"===t?this.cite.front.push(this.variable):e.PARALLEL_COLLAPSING_MID_VARSET.indexOf(t)>-1?["article-journal","article-magazine"].indexOf(this.cite.Item.type)>-1?this.cite.mid.push(this.variable):this.cite.front.push(this.variable):this.cite[this.target].push(this.variable)}},e.Parallel.prototype.AppendBlobPointer=function(t){if(this.use_parallels){if(this.ignoreVars.indexOf(this.variable)>-1)return;if(this.use_parallels&&(this.force_collapse||this.try_cite)){if(["article-journal","article-magazine"].indexOf(this.cite.Item.type)>-1){if(["volume","page","page-first","issue"].indexOf(this.variable)>-1)return;if("container-title"===this.variable&&this.cite.mid.length>1)return}this.variable&&(this.try_cite||this.force_collapse)&&t&&t.blobs&&(this.cite.useProceduralHistory&&"back"===this.target||this.data.blobs.push([t,t.blobs.length]))}}},e.Parallel.prototype.AppendToVariable=function(t){if(this.use_parallels){if(this.ignoreVars.indexOf(this.variable)>-1)return;if(this.try_cite||this.force_collapse){this.data.value+="::"+t}}},e.Parallel.prototype.CloseVariable=function(){if(this.use_parallels){if(this.ignoreVars.indexOf(this.variable)>-1)return;if((this.try_cite||this.force_collapse)&&(this.cite[this.variable]=this.data,this.sets.value().length>0)){var t=this.sets.value()[this.sets.value().length-1];"front"===this.target&&"issued"===this.variable&&this.data.value&&this.master_was_neutral_cite&&(this.target="mid"),"front"===this.target?!t[this.variable]&&!this.data.value||t[this.variable]&&this.data.value===t[this.variable].value||"issued"!==this.variable&&(this.in_series=!1):"mid"===this.target?e.PARALLEL_COLLAPSING_MID_VARSET.indexOf(this.variable)>-1&&(this.cite.front_collapse[this.variable]=t[this.variable]&&t[this.variable].value===this.data.value?!0:!1):"back"===this.target&&t[this.variable]&&this.data.value!==t[this.variable].value&&-1===this.sets.value().slice(-1)[0].back_forceme.indexOf(this.variable)&&(this.in_series=!1)}this.variable=!1}},e.Parallel.prototype.CloseCite=function(){var t,e,i,s,r,a,n;if(this.use_parallels&&(this.force_collapse||this.try_cite)){if(s=!1,this.cite.front_collapse["container-title"]||(s=!0),this.cite.front_collapse.volume===!1&&(s=!0),this.cite.front_collapse["collection-number"]===!1&&(s=!0),this.cite.front_collapse.section===!1&&(s=!0),s&&(this.cite.use_journal_info=!0,n=this.cite.front.indexOf("section"),n>-1&&(this.cite.front=this.cite.front.slice(0,n).concat(this.cite.front.slice(n+1))),r=this.cite.front.indexOf("volume"),r>-1&&(this.cite.front=this.cite.front.slice(0,r).concat(this.cite.front.slice(r+1))),a=this.cite.front.indexOf("container-title"),a>-1&&(this.cite.front=this.cite.front.slice(0,a).concat(this.cite.front.slice(a+1))),collection_number_pos=this.cite.front.indexOf("collection-number"),collection_number_pos>-1&&(this.cite.front=this.cite.front.slice(0,collection_number_pos).concat(this.cite.front.slice(collection_number_pos+1)))),this.in_series||this.force_collapse||this.ComposeSet(!0),0===this.sets.value().length){for(has_date=!1,e=0,i=this.cite.back.length;i>e;e+=1)if(t=this.cite.back[e],"issued"===t&&this.cite.issued&&this.cite.issued.value){has_date=!0;break}has_date||this.cite.back_forceme.push("issued")}else{var o=this.cite.front.indexOf("issued");if((-1===o||this.master_was_neutral_cite)&&(this.cite.back_forceme=this.sets.value().slice(-1)[0].back_forceme),o>-1){var l=this.sets.value()[this.sets.value().length-1];l.issued||(this.cite.front=this.cite.front.slice(0,o).concat(this.cite.front.slice(o+1)))}this.master_was_neutral_cite&&this.cite.mid.indexOf("names:mid")>-1&&this.cite.front.push("names:mid")}this.sets.value().push(this.cite)}},e.Parallel.prototype.ComposeSet=function(){var t,i,s;if(this.use_parallels&&(this.force_collapse||this.try_cite)){var r=this.sets.value().length;if(1===this.sets.value().length)this.in_series||(this.sets.value().pop(),this.delim_counter+=1);else{for(s=this.sets.value().length,i=0;s>i;i+=1)t=this.sets.value()[i],0===i?this.delim_counter+=1:(this.delim_pointers.push(!t.Item.title&&t.use_journal_info?!1:this.delim_counter),this.delim_counter+=1),e.POSITION_FIRST===t.position&&(0===i?(this.state.registry.registry[t.itemId].master=!0,this.state.registry.registry[t.itemId].siblings=[],this.state.registry.registry[t.itemId].parallel=!1):t.prevItemID&&(this.state.registry.registry[t.itemId].parallel=this.state.registry.registry[t.prevItemID].parallel?this.state.registry.registry[t.prevItemID].parallel:t.prevItemID,this.state.registry.registry[t.itemId].siblings=this.state.registry.registry[t.prevItemID].siblings,this.state.registry.registry[t.itemId].siblings||(this.state.registry.registry[t.itemId].siblings=[],e.debug("WARNING: adding missing siblings array to registry object")),this.state.registry.registry[t.itemId].siblings.push(t.itemId)));this.sets.push([])}this.purgeGroupsIfParallel(2>r?!1:!0),this.in_series=!0}},e.Parallel.prototype.PruneOutputQueue=function(){var t,e,i,s,r,a;if(this.use_parallels)for(t=this.sets.mystack.length,e=0;t>e;e+=1)if(i=this.sets.mystack[e],i.length>1)for(r=i.length,s=0;r>s;s+=1)a=i[s],0===s?this.purgeVariableBlobs(a,a.back):s===i.length-1?this.purgeVariableBlobs(a,a.front.concat(a.back_forceme)):this.purgeVariableBlobs(a,a.front.concat(a.back))},e.Parallel.prototype.purgeVariableBlobs=function(t,e){var i,s,r,a,n,o,l;if(this.use_parallels){for(l=this.state.output.current.value(),"undefined"==typeof l.length&&(l=l.blobs),s=0,i=this.delim_pointers.length;i>s;s+=1)o=this.delim_pointers[s],o!==!1&&(l[o].parallel_delimiter=", ");for(i=e.length-1,s=i;s>-1;s+=-1)if(r=e[s],t[r])for(n=t[r].blobs.length-1,o=n;o>-1;o+=-1)a=t[r].blobs[o],a[0].blobs=a[0].blobs.slice(0,a[1]).concat(a[0].blobs.slice(a[1]+1)),this.state.tmp.has_purged_parallel=!0,a[0]&&a[0].strings&&"string"==typeof a[0].strings.oops&&a[0].parent&&a[0].parent&&(a[0].parent.parent.strings.delimiter=a[0].strings.oops)}},e.Parallel.prototype.purgeGroupsIfParallel=function(t){for(var e=this.parallel_conditional_blobs_list.length-1;e>-1;e+=-1){for(var i=this.parallel_conditional_blobs_list[e],s=!0,r=0,a=i.conditions.length;a>r;r+=1)if(!i.conditions[r]!=!!t&&("master"!==i.conditions[r]||this.state.registry.registry[i.id].master)&&("servant"!==i.conditions[r]||this.state.registry.registry[i.id].parallel)){var s=!1;break}if(s){for(var n=[];i.blobs.length>i.pos;)n.push(i.blobs.pop());for(n.length&&n.pop();n.length;)i.blobs.push(n.pop())}this.parallel_conditional_blobs_list.pop()}},e.Util={},e.Util.Match=function(){this.any=function(t,e,i){return function(t,e){for(var s=0,r=i.length;r>s;s+=1)if(result=i[s](t,e),result)return!0;return!1}},this.none=function(t,e,i){return function(t,e){for(var s=0,r=i.length;r>s;s+=1)if(result=i[s](t,e),result)return!1;return!0}},this.all=function(t,e,i){return function(t,e){for(var s=0,r=i.length;r>s;s+=1)if(result=i[s](t,e),!result)return!1;return!0}},this[void 0]=this.all,this.nand=function(t,e,i){return function(t,e){for(var s=0,r=i.length;r>s;s+=1)if(result=i[s](t,e),!result)return!0;return!1}}},e.Transform=function(t){function i(t,i,s,r,a,n){var o;if(!a)return r;var l=a,u=!1;if(["title","title-short"].indexOf(l)>-1&&!i.jurisdiction&&(u=!0),e.NUMERIC_VARIABLES.indexOf(a)>-1&&(a="number"),["publisher-place","event-place","jurisdiction","archive-place"].indexOf(a)>-1&&(a="place"),["publisher","authority"].indexOf(a)>-1&&(a="institution-part"),["genre","event","medium","title-short"].indexOf(a)>-1&&(a="title"),["archive"].indexOf(a)>-1&&(a="collection-title"),"jurisdiction"===l&&t.sys.getHumanForm&&r&&(r=t.sys.getHumanForm(r)),o="",t.sys.getAbbreviation){var p=t.transform.loadAbbreviation(i.jurisdiction,a,r,i.type,u);t.transform.abbrevs[p][a]&&r&&t.sys.getAbbreviation&&t.transform.abbrevs[p][a][r]&&(o=t.transform.abbrevs[p][a][r].replace("{stet}",r))}return o||t.opt.development_extensions.require_explicit_legal_case_title_short&&"legal_case"===i.type||!s||!i[s]||!n||(o=i[s]),o||(o=r),o&&o.match(/^\!(?:[^>]+,)*here(?:,[^>]+)*>>>/)&&(o="jurisdiction"===l&&["treaty","patent"].indexOf(i.type)>-1?o.replace(/^\![^>]*>>>\s*/,""):!1),o}function s(e,i){var s,r=t.opt["default-locale"][0].slice(0,2);return s=new RegExp(t.opt.development_extensions.strict_text_case_locales?"^([a-zA-Z]{2})(?:$|-.*| .*)":"^([a-zA-Z]{2})(?:$|-.*|.*)"),e.language&&(m=(""+e.language).match(s),r=m?m[1]:"tlh"),e.multi&&e.multi&&e.multi.main&&e.multi.main[i]&&(r=e.multi.main[i]),(!t.opt.development_extensions.strict_text_case_locales||t.opt.development_extensions.normalize_lang_keys_to_lowercase)&&(r=r.toLowerCase()),r}function r(e,i,r,a,n){var o,l,u,p;if(!e[i])return{name:"",usedOrig:n};if(u={name:"",usedOrig:n,locale:s(e,i)},p=t.opt[r],"locale-orig"===r)return u=n?{name:"",usedOrig:n}:{name:e[i],usedOrig:!1,locale:s(e,i)};if(a&&("undefined"==typeof p||0===p.length))return{name:e[i],usedOrig:!0,locale:s(e,i)};for(var h=0,c=p.length;c>h;h+=1){if(o=p[h],l=o.split(/[\-_]/)[0],o&&e.multi&&e.multi._keys[i]&&e.multi._keys[i][o]){u.name=e.multi._keys[i][o],u.locale=l;break}if(l&&e.multi&&e.multi._keys[i]&&e.multi._keys[i][l]){u.name=e.multi._keys[i][l],u.locale=l;break}}return!u.name&&a&&(u={name:e[i],usedOrig:!0,locale:s(e,i)}),u}function a(e,i,s,r,a){if(e||(e="default"),!s)return t.transform.abbrevs[e]||(t.transform.abbrevs[e]=new t.sys.AbbreviationSegments),e;if(t.sys.getAbbreviation){var n=["default"];if("default"!==e)for(var o=e.split(/\s*;\s*/),l=0,u=o.length;u>l;l+=1)n.push(o.slice(0,l+1).join(";"));for(var l=n.length-1;l>-1;l+=-1)if(t.transform.abbrevs[n[l]]||(t.transform.abbrevs[n[l]]=new t.sys.AbbreviationSegments),t.transform.abbrevs[n[l]][i][s]||t.sys.getAbbreviation(t.opt.styleID,t.transform.abbrevs,n[l],i,s,r,a),t.transform.abbrevs[n[l]][i][s]){l<n.length&&(t.transform.abbrevs[e][i][s]=t.transform.abbrevs[n[l]][i][s]);break}}return e}function n(e,s,r,a){var n=e.variables[0];if(t.publisherOutput&&r){if(-1===["publisher","publisher-place"].indexOf(n))return!1;t.publisherOutput[n+"-token"]=e,t.publisherOutput.varlist.push(n);var o=r.split(/;\s*/);o.length===t.publisherOutput[n+"-list"].length&&(t.publisherOutput[n+"-list"]=o);for(var l=0,u=o.length;u>l;l+=1)o[l]=i(t,s,!1,o[l],a,!0);return t.tmp[n+"-token"]=e,!0}return!1}function o(s,a,o,u){var p,h=e.LangPrefsMap[s[0]];return p=h?t.opt["cite-lang-prefs"][h]:!1,function(t,o,c){var m,f,d,g,b,y,v;if(!s[0]||!o[s[0]]&&!o[u])return null;if(t.opt.suppressJurisdictions&&"jurisdiction"===s[0]&&t.opt.suppressJurisdictions[o.jurisdiction]&&["legal_case","gazette","regulation","legislation"].indexOf(o.type)>-1)return null;var _={primary:!1,secondary:!1,tertiary:!1};if("_sort"===t.tmp.area.slice(-5))_.primary="locale-sort";else if(p)for(var x=["primary","secondary","tertiary"],A=0,I=x.length;I>A&&!(p.length-1<A);A+=1)p[A]&&(_[x[A]]="locale-"+p[A]);else _.primary="locale-orig";if("bibliography"===t.tmp.area||"citation"===t.tmp.area&&"note"===t.opt.xclass&&c&&!c.position||(_.secondary=!1,_.tertiary=!1),t.tmp["publisher-list"])return"publisher"===s[0]?t.tmp["publisher-token"]=this:"publisher-place"===s[0]&&(t.tmp["publisher-place-token"]=this),null;var S=r(o,s[0],_.primary,!0);m=S.name,f=S.locale;var O=S.usedOrig;if(n(this,o,m,a))return null;d=!1,b=!1,_.secondary&&(S=r(o,s[0],_.secondary,!1,S.usedOrig),d=S.name,g=S.locale),_.tertiary&&(S=r(o,s[0],_.tertiary,!1,S.usedOrig),b=S.name,y=S.locale),a&&(m=i(t,o,u,m,a,!0),m&&(m=l(m)),d=i(t,o,!1,d,a,!0),b=i(t,o,!1,b,a,!0));var E,k=e.Util.cloneToken(this),v=e.Util.cloneToken(this);if("locale-translit"===_.primary&&(E=t.opt.citeAffixes[h][_.primary].prefix),"<i>"===E&&"title"===s[0]&&!O){for(var T=!1,A=0,I=v.decorations.length;I>A;A+=1)"@font-style"===v.decorations[A][0]&&"italic"===v.decorations[A][1]&&(T=!0);T||v.decorations.push(["@font-style","italic"])}if("en"!==f&&"title"===v.strings["text-case"]&&(v.strings["text-case"]="passthrough"),"title"===s[0]&&(m=e.demoteNoiseWords(t,m,this["leading-noise-words"])),d||b){if(t.output.openLevel("empty"),v.strings.suffix=v.strings.suffix.replace(/[ .,]+$/,""),t.output.append(m,v),d){secondary_tok=e.Util.cloneToken(k),secondary_tok.strings.prefix=t.opt.citeAffixes[h][_.secondary].prefix,secondary_tok.strings.suffix=t.opt.citeAffixes[h][_.secondary].suffix,secondary_tok.strings.prefix||(secondary_tok.strings.prefix=" ");for(var A=secondary_tok.decorations.length-1;A>-1;A+=-1)["@quotes/true","@font-style/italic","@font-style/oblique","@font-weight/bold"].indexOf(secondary_tok.decorations[A].join("/"))>-1&&(secondary_tok.decorations=secondary_tok.decorations.slice(0,A).concat(secondary_tok.decorations.slice(A+1)));"en"!==g&&"title"===secondary_tok.strings["text-case"]&&(secondary_tok.strings["text-case"]="passthrough"),t.output.append(d,secondary_tok);var w=t.output.current.value(),N=t.output.current.value().blobs.length-1;t.parallel.use_parallels&&(t.parallel.cite.front.push(s[0]+":secondary"),t.parallel.cite[s[0]+":secondary"]={blobs:[[w,N]]})}if(b){tertiary_tok=e.Util.cloneToken(k),tertiary_tok.strings.prefix=t.opt.citeAffixes[h][_.tertiary].prefix,tertiary_tok.strings.suffix=t.opt.citeAffixes[h][_.tertiary].suffix,tertiary_tok.strings.prefix||(tertiary_tok.strings.prefix=" ");for(var A=tertiary_tok.decorations.length-1;A>-1;A+=-1)["@quotes/true","@font-style/italic","@font-style/oblique","@font-weight/bold"].indexOf(tertiary_tok.decorations[A].join("/"))>-1&&(tertiary_tok.decorations=tertiary_tok.decorations.slice(0,A).concat(tertiary_tok.decorations.slice(A+1)));"en"!==y&&"title"===tertiary_tok.strings["text-case"]&&(tertiary_tok.strings["text-case"]="passthrough"),t.output.append(b,tertiary_tok);var w=t.output.current.value(),N=t.output.current.value().blobs.length-1;t.parallel.use_parallels&&(t.parallel.cite.front.push(s[0]+":tertiary"),t.parallel.cite[s[0]+":tertiary"]={blobs:[[w,N]]})}t.output.closeLevel()}else t.output.append(m,v);return null}}function l(e){var i=e.match(/^!([-,_a-z]+)>>>/);if(i){var s=i[1].split(",");e=e.slice(i[0].length);for(var r=0,a=s.length;a>r;r+=1)-1===t.tmp.done_vars.indexOf(s[r])&&t.tmp.done_vars.push(s[r])}return e}this.abbrevs={},this.abbrevs["default"]=new t.sys.AbbreviationSegments,this.getTextSubField=r,this.loadAbbreviation=a,this.getOutputFunction=o,this.quashCheck=l},e.Token=function(t,e){this.name=t,this.strings={},this.strings.delimiter=void 0,this.strings.prefix="",this.strings.suffix="",this.decorations=[],this.variables=[],this.execs=[],this.tokentype=e,this.evaluator=!1,this.tests=[],this.rawtests=[],this.succeed=!1,this.fail=!1,this.next=!1},e.Util.cloneToken=function(t){var i,s,r,a;if("string"==typeof t)return t;i=new e.Token(t.name,t.tokentype);for(s in t.strings)t.strings.hasOwnProperty(s)&&(i.strings[s]=t.strings[s]);if(t.decorations)for(i.decorations=[],r=0,a=t.decorations.length;a>r;r+=1)i.decorations.push(t.decorations[r].slice());return t.variables&&(i.variables=t.variables.slice()),t.execs&&(i.execs=t.execs.slice(),i.tests=t.tests.slice(),i.rawtests=t.tests.slice()),i},e.AmbigConfig=function(){this.maxvals=[],this.minval=1,this.names=[],this.givens=[],this.year_suffix=!1,this.disambiguate=0},e.Blob=function(t,e,i){var s,r,a;if(this.levelname=i,e){this.strings={prefix:"",suffix:""};for(a in e.strings)e.strings.hasOwnProperty(a)&&(this.strings[a]=e.strings[a]);for(this.decorations=[],s=void 0===e.decorations?0:e.decorations.length,r=0;s>r;r+=1)this.decorations.push(e.decorations[r].slice())}else this.strings={},this.strings.prefix="",this.strings.suffix="",this.strings.delimiter="",this.decorations=[];this.blobs="string"==typeof t?t:t?[t]:[],this.alldecor=[this.decorations]},e.Blob.prototype.push=function(t){if("string"==typeof this.blobs)throw"Attempt to push blob onto string object";!1!==t&&(t.alldecor=t.alldecor.concat(this.alldecor),this.blobs.push(t))},e.NumericBlob=function(t,i,s){this.id=s,this.alldecor=[],this.num=t,this.blobs=t.toString(),this.status=e.START,this.strings={},i?(this.gender=i.gender,this.decorations=i.decorations,this.strings.prefix=i.strings.prefix,this.strings.suffix=i.strings.suffix,this.strings["text-case"]=i.strings["text-case"],this.successor_prefix=i.successor_prefix,this.range_prefix=i.range_prefix,this.splice_prefix=i.splice_prefix,this.formatter=i.formatter,this.formatter||(this.formatter=new e.Output.DefaultFormatter),this.formatter&&(this.type=this.formatter.format(1))):(this.decorations=[],this.strings.prefix="",this.strings.suffix="",this.successor_prefix="",this.range_prefix="",this.splice_prefix="",this.formatter=new e.Output.DefaultFormatter)},e.NumericBlob.prototype.setFormatter=function(t){this.formatter=t,this.type=this.formatter.format(1)
},e.Output.DefaultFormatter=function(){},e.Output.DefaultFormatter.prototype.format=function(t){return t.toString()},e.NumericBlob.prototype.checkNext=function(t,i){i?(this.status=e.START,"object"==typeof t&&(t.status=t.num===this.num+1?e.SUCCESSOR:e.SEEN)):t&&t.num&&this.type===t.type&&t.num===this.num+1?this.status===e.START||this.status===e.SEEN?t.status=e.SUCCESSOR:(this.status===e.SUCCESSOR||this.status===e.SUCCESSOR_OF_SUCCESSOR)&&(this.range_prefix?(t.status=e.SUCCESSOR_OF_SUCCESSOR,this.status=e.SUPPRESS):t.status=e.SUCCESSOR):(this.status===e.SUCCESSOR_OF_SUCCESSOR&&(this.status=e.END),"object"==typeof t&&(t.status=e.SEEN))},e.NumericBlob.prototype.checkLast=function(t){return this.status===e.SEEN||t.num!==this.num-1&&this.status===e.SUCCESSOR?(this.status=e.SUCCESSOR,!0):!1},e.Util.fixDateNode=function(t,e,i){var s,r,a,n,o,l,u,p,h,c,m,f,d,g;this.build.date_key=!0,s=this.sys.xml.getAttributeValue(i,"form");var b;if(b="accessed"===this.sys.xml.getAttributeValue(i,"variable")?this.opt["default-locale"][0]:this.sys.xml.getAttributeValue(i,"lingo"),!this.getDate(s))return t;var y=this.sys.xml.getAttributeValue(i,"date-parts");r=this.sys.xml.getAttributeValue(i,"variable"),p=this.sys.xml.getAttributeValue(i,"prefix"),h=this.sys.xml.getAttributeValue(i,"suffix"),d=this.sys.xml.getAttributeValue(i,"display"),g=this.sys.xml.getAttributeValue(i,"cslid"),a=this.sys.xml.nodeCopy(this.getDate(s,"accessed"===r)),this.sys.xml.setAttribute(a,"lingo",this.opt.lang),this.sys.xml.setAttribute(a,"form",s),this.sys.xml.setAttribute(a,"date-parts",y),this.sys.xml.setAttribute(a,"cslid",g),this.sys.xml.setAttribute(a,"variable",r),p&&this.sys.xml.setAttribute(a,"prefix",p),h&&this.sys.xml.setAttribute(a,"suffix",h),d&&this.sys.xml.setAttribute(a,"display",d),c=this.sys.xml.children(i);for(m in c)if(n=c[m],"date-part"===this.sys.xml.nodename(n)){o=this.sys.xml.getAttributeValue(n,"name"),f=this.sys.xml.attributes(n);for(l in f)if(f.hasOwnProperty(l)){if("@name"===l)continue;if(b&&b!==this.opt.lang&&["@suffix","@prefix","@form"].indexOf(l)>-1)continue;u=f[l],this.sys.xml.setAttributeOnNodeIdentifiedByNameAttribute(a,"date-part",o,l,u)}}return"year"===this.sys.xml.getAttributeValue(i,"date-parts")?(this.sys.xml.deleteNodeByNameAttribute(a,"month"),this.sys.xml.deleteNodeByNameAttribute(a,"day")):"year-month"===this.sys.xml.getAttributeValue(i,"date-parts")&&this.sys.xml.deleteNodeByNameAttribute(a,"day"),this.sys.xml.insertChildNodeAfter(t,i,e,a)},e.dateMacroAsSortKey=function(t,i){e.dateAsSortKey.call(this,t,i,!0)},e.dateAsSortKey=function(t,i,s){var r,a,n,o,l,u,p,h,c=this.variables[0],m="empty";for(s&&(m="macro-with-date"),r=i[c],"undefined"==typeof r&&(r={"date-parts":[[0]]},r.year||(t.tmp.empty_date=!0)),"undefined"==typeof this.dateparts&&(this.dateparts=["year","month","day"]),r.raw?r=t.fun.dateparser.parse(r.raw):r["date-parts"]&&(r=t.dateParseArray(r)),"undefined"==typeof r&&(r={}),p=0,h=e.DATE_PARTS_INTERNAL.length;h>p;p+=1)a=e.DATE_PARTS_INTERNAL[p],n=0,o=a,"_end"===o.slice(-4)&&(o=o.slice(0,-4)),r[a]&&this.dateparts.indexOf(o)>-1&&(n=r[a]),"year"===a.slice(0,4)?(l=e.Util.Dates[o].numeric(t,n),u="Y","-"===l[0]&&(u="X",l=l.slice(1),l=9999-parseInt(l,10)),t.output.append(e.Util.Dates[a.slice(0,4)].numeric(t,u+l),m)):(n=e.Util.Dates[o]["numeric-leading-zeros"](t,n),n||(n="00"),t.output.append(n,m))},e.Engine.prototype.dateParseArray=function(t){var i,s,r,a;i={};for(s in t)if("date-parts"===s){r=t["date-parts"],r.length>1&&r[0].length!==r[1].length&&e.error("CSL data error: element mismatch in date range input."),a=["","_end"];for(var n=0,o=r.length;o>n;n+=1)for(var l=0,u=e.DATE_PARTS.length;u>l;l+=1)i[e.DATE_PARTS[l]+a[n]]="undefined"==typeof r[n][l]?r[n][l]:parseInt(r[n][l],10)}else t.hasOwnProperty(s)&&("literal"===s&&"object"==typeof t.literal&&"string"==typeof t.literal.part?(e.debug("Warning: fixing up weird literal date value"),i.literal=t.literal.part):i[s]=t[s]);return i},e.Util.Names={},e.Util.Names.compareNamesets=e.NameOutput.prototype._compareNamesets,e.Util.Names.unInitialize=function(t,i){var s,r,a,n,o;if(!i)return"";for(a=i.split(/(?:\-|\s+)/),n=i.match(/(\-|\s+)/g),o="",s=0,r=a.length;r>s;s+=1)e.ALL_ROMANESQUE_REGEXP.exec(a[s].slice(0,-1))&&a[s]&&a[s]!==a[s].toUpperCase()&&(a[s]=a[s].slice(0,1)+a[s].slice(1,2).toLowerCase()+a[s].slice(2)),o+=a[s],r-1>s&&(o+=n[s]);return o},e.Util.Names.initializeWith=function(t,i,s,r){var a,n,o,l,u,p,h;if(!i)return"";if(["Lord","Lady"].indexOf(i)>-1||!i.match(e.STARTSWITH_ROMANESQUE_REGEXP)&&!s.match("%s"))return i;s||(s="");var c=i;if(t.opt["initialize-with-hyphen"]===!1&&(c=c.replace(/\-/g," ")),c=c.replace(/\s*\-\s*/g,"-").replace(/\s+/g," "),c=c.replace(/-([a-z])/g,"\u2013$1"),u=c.match(/[\-\s]+/g),p=c.split(/[\-\s]+/),0===p.length)c=u;else for(c=[p[0]],a=1,n=p.length;n>a;a+=1)c.push(u[a-1]),c.push(p[a]);for(p=c,a=p.length-1;a>-1;a+=-1)if(p[a]&&p[a].slice(0,-1).indexOf(".")>-1){var m=p.slice(a+1),f=p[a].slice(0,-1).split(".");for(p=p.slice(0,a),o=0,l=f.length;l>o;o+=1)p.push(f[o]+"."),o<f.length-1&&p.push(" ");p=p.concat(m)}return h=r?e.Util.Names.doNormalize(t,p,s):e.Util.Names.doInitialize(t,p,s),h=h.replace(/\u2013([a-z])/g,"-$1")},e.Util.Names.doNormalize=function(t,i,s){var r,a,n=[];for(r=0,a=i.length;a>r;r+=1)i[r].length>1&&"."===i[r].slice(-1)?(i[r]=i[r].slice(0,-1),n.push(!0)):n.push(1===i[r].length&&i[r].toUpperCase()===i[r]?!0:!1);for(r=0,a=i.length;a>r;r+=2)n[r]&&(r<i.length-2&&(i[r+1]="",(!s||s.slice(-1)&&" "!==s.slice(-1))&&i[r].length&&i[r].match(e.ALL_ROMANESQUE_REGEXP)&&(i[r].length>1||i[r+2].length>1)&&(i[r+1]=" "),i[r]=i[r]+s),r===i.length-1&&(i[r]=i[r]+s));return i.join("").replace(/\s+$/,"")},e.Util.Names.doInitialize=function(t,i,s){var r,a,n,o,l,u,p;for(r=0,a=i.length;a>r;r+=2)if(p=i[r])if(n=p.match(e.NAME_INITIAL_REGEXP),!n&&!p.match(e.STARTSWITH_ROMANESQUE_REGEXP)&&p.length>1&&s.match("%s")&&(n=p.match(/(.)(.*)/)),n&&n[1]===n[1].toUpperCase()){var h="";if(n[2]){var c="";for(u=n[2].split(""),o=0,l=u.length;l>o;o+=1){var m=u[o];if(m!==m.toUpperCase())break;c+=m}c.length<n[2].length&&(h=c.toLocaleLowerCase())}i[r]=n[1].toLocaleUpperCase()+h,a-1>r?s.match("%s")?i[r]=s.replace("%s",i[r]):i[r+1]=i[r+1].indexOf("-")>-1?s+i[r+1]:s:s.match("%s")?i[r]=s.replace("%s",i[r]):i.push(s)}else p.match(e.ROMANESQUE_REGEXP)&&(i[r]=" "+p);var f=i.join("");return f=f.replace(/\s+$/,"").replace(/\s*\-\s*/g,"-").replace(/\s+/g," ")},e.Util.Names.getRawName=function(t){var e=[];return t.given&&e.push(t.given),t.family&&e.push(t.family),e.join(" ")},e.Util.Dates={},e.Util.Dates.year={},e.Util.Dates.year["long"]=function(t,e){return e||(e="boolean"==typeof e?"":0),e.toString()},e.Util.Dates.year.imperial=function(t,e,i){e||(e="boolean"==typeof e?"":0),i=i?"_end":"";var s=t.tmp.date_object["month"+i];for(s=s?""+s:"1";s.length<2;)s="0"+s;var r=t.tmp.date_object["day"+i];for(r=r?""+r:"1";r.length<2;)r="0"+r;var a,n,o=parseInt(e+s+r,10);return o>=18680908&&19120730>o?(a="\u660e\u6cbb",n=1867):o>=19120730&&19261225>o?(a="\u5927\u6b63",n=1911):o>=19261225&&19890108>o?(a="\u662d\u548c",n=1925):o>=19890108&&(a="\u5e73\u6210",n=1988),a&&n&&(t.transform.abbrevs["default"].number[a]||t.transform.loadAbbreviation("default","number",a),t.transform.abbrevs["default"].number[a]&&(a=t.transform.abbrevs["default"].number[a]),year=a+(e-n)),year},e.Util.Dates.year["short"]=function(t,e){return e=e.toString(),e&&4===e.length?e.substr(2):void 0},e.Util.Dates.year.numeric=function(t,e){var i,s;for(e=""+e,i=e.match(/([0-9]*)$/),i?(s=e.slice(0,-1*i[1].length),e=i[1]):(s=e,e="");e.length<4;)e="0"+e;return s+e},e.Util.Dates.normalizeMonth=function(t,e){var i;if(t||(t=0),t=""+t,t.match(/^[0-9]+$/)||(t=0),t=parseInt(t,10),e){var s={stub:"month-",num:t};s.num<1||s.num>20?s.num=0:s.num>16?(s.stub="season-",s.num=s.num-16):s.num>12&&(s.stub="season-",s.num=s.num-12),i=s}else(1>t||t>12)&&(t=0),i=t;return i},e.Util.Dates.month={},e.Util.Dates.month.numeric=function(t,i){var i=e.Util.Dates.normalizeMonth(i);return i||(i=""),i},e.Util.Dates.month["numeric-leading-zeros"]=function(t,i){var i=e.Util.Dates.normalizeMonth(i);if(i)for(i=""+i;i.length<2;)i="0"+i;else i="";return i},e.Util.Dates.month["long"]=function(t,i,s,r){var a=e.Util.Dates.normalizeMonth(i,!0),i=a.num;if(i){for(i=""+i;i.length<2;)i="0"+i;i=t.getTerm(a.stub+i,"long",0,0,!1,r)}else i="";return i},e.Util.Dates.month["short"]=function(t,i,s,r){var a=e.Util.Dates.normalizeMonth(i,!0),i=a.num;if(i){for(i=""+i;i.length<2;)i="0"+i;i=t.getTerm(a.stub+i,"short",0,0,!1,r)}else i="";return i},e.Util.Dates.day={},e.Util.Dates.day.numeric=function(t,e){return e.toString()},e.Util.Dates.day["long"]=e.Util.Dates.day.numeric,e.Util.Dates.day["numeric-leading-zeros"]=function(t,e){for(e||(e=0),e=e.toString();e.length<2;)e="0"+e;return e.toString()},e.Util.Dates.day.ordinal=function(t,e,i){return t.fun.ordinalizer.format(e,i)},e.Util.Sort={},e.Util.Sort.strip_prepositions=function(t){var e;return"string"==typeof t&&(e=t.toLocaleLowerCase(),e=t.match(/^((a|an|the)\s+)/)),e&&(t=t.substr(e[1].length)),t},e.Util.substituteStart=function(t,i){var s,r,a,n,o,l,u;n=function(t){for(var e=0,i=this.decorations.length;i>e;e+=1)if("@strip-periods"===this.decorations[e][0]&&"true"===this.decorations[e][1]){t.tmp.strip_periods+=1;break}},this.execs.push(n),this.decorations&&(t.opt.development_extensions.csl_reverse_lookup_support||t.sys.csl_reverse_lookup_support)&&(this.decorations.reverse(),this.decorations.push(["@showid","true",this.cslid]),this.decorations.reverse()),u=["number","date","names"],("text"===this.name&&!this.postponed_macro||u.indexOf(this.name)>-1)&&(s=function(t,e,i){"author"===t.tmp.element_trace.value()||"names"===this.name?i&&i["author-only"]?t.tmp.element_trace.push("do-not-suppress-me"):i&&i["suppress-author"]:i&&i["author-only"]?t.tmp.element_trace.push("suppress-me"):i&&i["suppress-author"]&&t.tmp.element_trace.push("do-not-suppress-me")},this.execs.push(s)),r=this.strings.cls,this.strings.cls=!1,0===t.build.render_nesting_level&&("bibliography"===t.build.area&&t.bibliography.opt["second-field-align"]?(a=new e.Token("group",e.START),a.decorations=[["@display","left-margin"]],n=function(t,e){t.tmp.render_seen||(a.strings.first_blob=e.id,t.output.startTag("bib_first",a))},a.execs.push(n),i.push(a)):e.DISPLAY_CLASSES.indexOf(r)>-1&&(a=new e.Token("group",e.START),a.decorations=[["@display",r]],n=function(t,e){a.strings.first_blob=e.id,t.output.startTag("bib_first",a)},a.execs.push(n),i.push(a)),t.build.cls=r),t.build.render_nesting_level+=1,1===t.build.substitute_level.value()&&(o=new e.Token("choose",e.START),e.Node.choose.build.call(o,t,i),l=new e.Token("if",e.START),n=function(){return t.tmp.can_substitute.value()?!0:!1},l.tests.push(n),l.test=t.fun.match.any(this,t,l.tests),i.push(l)),t.sys.variableWrapper&&this.variables_real&&this.variables_real.length&&(n=function(t,i,s){if(!t.tmp.just_looking&&!t.tmp.suppress_decorations){variable_entry=new e.Token("text",e.START),variable_entry.decorations=[["@showid","true"]],t.output.startTag("variable_entry",variable_entry);var r=null;s&&(r=s.position),r||(r=0);var a=["first","subsequent","ibid","ibid-with-locator"],n=0;s&&s.noteIndex&&(n=s.noteIndex);var o=0;s&&s["first-reference-note-number"]&&(o=s["first-reference-note-number"]);var l=0;s&&s["citation-number"]&&(l=s["citation-number"]);var u=0;s&&s.index&&(u=s.index);var p={itemData:i,variableNames:this.variables,context:t.tmp.area,xclass:t.opt.xclass,position:a[r],"note-number":n,"first-reference-note-number":o,"citation-number":l,index:u,mode:t.opt.mode};t.output.current.value().params=p}},this.execs.push(n))},e.Util.substituteEnd=function(t,i){var s,r,a,n,o,l,u,p,h;t.sys.variableWrapper&&(this.hasVariable||this.variables_real&&this.variables_real.length)&&(s=function(t){t.tmp.just_looking||t.tmp.suppress_decorations||t.output.endTag("variable_entry")},this.execs.push(s)),s=function(t){for(var e=0,i=this.decorations.length;i>e;e+=1)if("@strip-periods"===this.decorations[e][0]&&"true"===this.decorations[e][1]){t.tmp.strip_periods+=-1;break}},this.execs.push(s),t.build.render_nesting_level+=-1,0===t.build.render_nesting_level&&(t.build.cls?(s=function(t){t.output.endTag("bib_first")},this.execs.push(s),t.build.cls=!1):"bibliography"===t.build.area&&t.bibliography.opt["second-field-align"]&&(r=new e.Token("group",e.END),s=function(t){t.tmp.render_seen||t.output.endTag()},r.execs.push(s),i.push(r),a=new e.Token("group",e.START),a.decorations=[["@display","right-inline"]],s=function(t){t.tmp.render_seen||(t.tmp.render_seen=!0,t.output.startTag("bib_other",a))},a.execs.push(s),i.push(a))),1===t.build.substitute_level.value()&&(n=new e.Token("if",e.END),i.push(n),o=new e.Token("choose",e.END),e.Node.choose.build.call(o,t,i)),l="names"===this.name&&0===t.build.substitute_level.value(),u="string"==typeof t[t.build.area].opt["subsequent-author-substitute"];var c=t[t.build.area].opt["subsequent-author-substitute-rule"];l&&u&&(p=new e.Token("text",e.SINGLETON),s=function(t){var i,s,r=!t.tmp.suppress_decorations;if(r&&"bibliography"===t.tmp.area&&t.tmp.subsequent_author_substitute_ok&&t.tmp.rendered_name)if("partial-each"===c||"partial-first"===c){var a=!0,n=[];for(i=0,s=t.tmp.name_node.children.length;s>i;i+=1){var o=t.tmp.rendered_name[i];a&&t.tmp.last_rendered_name&&t.tmp.last_rendered_name.length>i-1&&o&&!o.localeCompare(t.tmp.last_rendered_name[i])?(h=new e.Blob(t[t.tmp.area].opt["subsequent-author-substitute"]),t.tmp.name_node.children[i].blobs=[h],"partial-first"===c&&(a=!1)):a=!1,n.push(o)}t.tmp.last_rendered_name=n}else if("complete-each"===c){var n=t.tmp.rendered_name.join(",");if(n){if(!n.localeCompare(t.tmp.last_rendered_name))for(i=0,s=t.tmp.name_node.children.length;s>i;i+=1)h=new e.Blob(t[t.tmp.area].opt["subsequent-author-substitute"]),t.tmp.name_node.children[i].blobs=[h];t.tmp.last_rendered_name=n}}else{var n=t.tmp.rendered_name.join(",");n&&(n.localeCompare(t.tmp.last_rendered_name)||(h=new e.Blob(t[t.tmp.area].opt["subsequent-author-substitute"]),t.tmp.name_node.top.blobs=t.tmp.label_blob?[h,t.tmp.label_blob]:[h]),t.tmp.last_rendered_name=n)}},p.execs.push(s),i.push(p)),("text"===this.name&&!this.postponed_macro||["number","date","names"].indexOf(this.name)>-1)&&(s=function(t){t.tmp.element_trace.pop()},this.execs.push(s))},e.Util.padding=function(t){var e=t.match(/\s*(-{0,1}[0-9]+)/);if(e)for(t=parseInt(e[1],10),0>t&&(t=1e20+t),t=""+t;t.length<20;)t="0"+t;return t},e.Util.LongOrdinalizer=function(){},e.Util.LongOrdinalizer.prototype.init=function(t){this.state=t},e.Util.LongOrdinalizer.prototype.format=function(t,i){10>t&&(t="0"+t);var s=e.Engine.getField(e.LOOSE,this.state.locale[this.state.opt.lang].terms,"long-ordinal-"+t,"long",0,i);return s||(s=this.state.fun.ordinalizer.format(t,i)),this.state.tmp.cite_renders_content=!0,s},e.Util.Ordinalizer=function(t){this.state=t,this.suffixes={}},e.Util.Ordinalizer.prototype.init=function(){if(!this.suffixes[this.state.opt.lang]){this.suffixes[this.state.opt.lang]={};for(var t=0,e=3;e>t;t+=1){var i=[void 0,"masculine","feminine"][t];this.suffixes[this.state.opt.lang][i]=[];for(var s=1;5>s;s+=1){var r=this.state.getTerm("ordinal-0"+s,"long",!1,i);if("undefined"==typeof r){delete this.suffixes[this.state.opt.lang][i];break}this.suffixes[this.state.opt.lang][i].push(r)}}}},e.Util.Ordinalizer.prototype.format=function(t,e){var i;t=parseInt(t,10),i=""+t;var s="",r=[];if(e&&r.push(e),r.push("neuter"),this.state.locale[this.state.opt.lang].ord["1.0.1"]){s=this.state.getTerm("ordinal",!1,0,e);for(var a,n=0,o=r.length;o>n;n+=1){a=r[n];var l=this.state.locale[this.state.opt.lang].ord["1.0.1"];if(l["whole-number"][i]&&l["whole-number"][i][a]?s=this.state.getTerm(this.state.locale[this.state.opt.lang].ord["1.0.1"]["whole-number"][i][a],!1,0,e):l["last-two-digits"][i.slice(i.length-2)]&&l["last-two-digits"][i.slice(i.length-2)][a]?s=this.state.getTerm(this.state.locale[this.state.opt.lang].ord["1.0.1"]["last-two-digits"][i.slice(i.length-2)][a],!1,0,e):l["last-digit"][i.slice(i.length-1)]&&l["last-digit"][i.slice(i.length-1)][a]&&(s=this.state.getTerm(this.state.locale[this.state.opt.lang].ord["1.0.1"]["last-digit"][i.slice(i.length-1)][a],!1,0,e)),s)break}}else e||(e=void 0),this.state.fun.ordinalizer.init(),s=t/10%10===1||t>10&&20>t?this.suffixes[this.state.opt.lang][e][3]:t%10===1&&t%100!==11?this.suffixes[this.state.opt.lang][e][0]:t%10===2&&t%100!==12?this.suffixes[this.state.opt.lang][e][1]:t%10===3&&t%100!==13?this.suffixes[this.state.opt.lang][e][2]:this.suffixes[this.state.opt.lang][e][3];return i=i+=s},e.Util.Romanizer=function(){},e.Util.Romanizer.prototype.format=function(t){var i,s,r,a,n;if(i="",6e3>t)for(a=t.toString().split(""),a.reverse(),s=0,r=0,n=a.length,s=0;n>s;s+=1)r=parseInt(a[s],10),i=e.ROMAN_NUMERALS[s][r]+i;return i},e.Util.Suffixator=function(t){t||(t=e.SUFFIX_CHARS),this.slist=t.split(",")},e.Util.Suffixator.prototype.format=function(t){var e;t+=1;var i="";do e=t%26===0?26:t%26,i=this.slist[e-1]+i,t=(t-e)/26;while(0!==t);return i},e.Engine.prototype.processNumber=function(t,i,s,r){var a,n,o,l,u,p;if(this.tmp.shadow_numbers[s]){if(this.tmp.shadow_numbers[s].numeric)for(var o=0,l=this.tmp.shadow_numbers[s].values.length;l>o;o+=2)this.tmp.shadow_numbers[s].values[o][2]=t}else if(this.tmp.shadow_numbers[s]={},this.tmp.shadow_numbers[s].values=[],this.tmp.shadow_numbers[s].plural=0,this.tmp.shadow_numbers[s].numeric=!1,this.tmp.shadow_numbers[s].label=!1,i){var h=e.LangPrefsMap[s];if(h){var c=this.opt["cite-lang-prefs"][h][0];a=this.transform.getTextSubField(i,s,"locale-"+c,!0),a=a.name}else a=i[s];if(a&&this.sys.getAbbreviation){a=(""+a).replace(/^\"/,"").replace(/\"$/,"");var m=this.transform.loadAbbreviation(i.jurisdiction,"number",a);this.transform.abbrevs[m].number[a]?a=this.transform.abbrevs[m].number[a]:"undefined"!=typeof this.transform.abbrevs[m].number[a]&&delete this.transform.abbrevs[m].number[a]}if("undefined"!=typeof a){if("number"==typeof a&&(a=""+a),this.tmp.shadow_numbers[s].label=s,'"'===a.slice(0,1)&&'"'===a.slice(-1)&&(a=a.slice(1,-1)),a&&["number-of-volumes","number-of-pages"].indexOf(s)>-1){var n=a.match(/[^0-9]*([0-9]+).*/);n&&(this.tmp.shadow_numbers[s].numeric=!0,"1"!==n[1]&&(this.tmp.shadow_numbers[s].plural=1))}"locator"===s&&["bill","gazette","legislation","treaty"].indexOf(r)>-1&&(a=a.split(e.STATUTE_SUBDIV_PLAIN_REGEX)[0]);var f="page";if(["bill","gazette","legislation","legal_case","treaty"].indexOf(r)>-1&&"collection-number"===s&&(f="year"),["page","page-first"].indexOf(s)>-1){var n=a.split(" ")[0].match(e.STATUTE_SUBDIV_GROUPED_REGEX);if(n){this.opt.development_extensions.static_statute_locator&&(this.tmp.shadow_numbers[s].label=e.STATUTE_SUBDIV_STRINGS[n[0]]);var d=a.match(/[^ ]+\s+(.*)/);d&&(a=d[1])}}for(var g=a.split(/(?:,\s+|\s*\\*[\-\u2013]+\s*|\s*&\s*)/),n=a.match(/(,\s+|\s*\\*[\-\u2013]+\s*|\s*&\s*)/g),b=[],o=0,l=g.length-1;l>o;o+=1)b.push(g[o]),b.push(n[o]);b.push(g[g.length-1]);for(var y=0,v=!0,o=0,l=b.length;l>o;o+=1){var _=o%2===0;if(_){if(b[o]){if(b[o].match(/(?:[0-9]|[xivcmlXIVCML])/))if(b[o-1]&&b[o-1].match(/^\s*\\*[\-\u2013]+\s*$/)){var x=this.tmp.shadow_numbers[s].values.slice(-1);if(-1==x[0][1].indexOf("\\")){if(b[o-2]&&(""+b[o-2]).match(/(:?[a-zA-Z]*[0-9]+$|^[ivxlcmIVXLCM]+$)/)&&b[o].match(/(?:^[a-zA-Z]*[0-9]+|^[ivxlcmIVXLCM]+$)/)){var A=this.tmp.shadow_numbers[s].values.slice(-2);if(x[0][1]=this.getTerm(f+"-range-delimiter"),this.opt[f+"-range-format"]){var I=this.fun[f+"_mangler"](A[0][1]+"-"+b[o]);I=I.split(this.getTerm(f+"-range-delimiter")),b[o]=I[1]}y+=1}x[0][1].indexOf("--")>-1&&(x[0][1]=x[0][1].replace(/--*/,"\u2013"))}else x[0][1]=x[0][1].replace(/\\/,"","g")}else-1===b[o].indexOf(" ")&&(y+=1);for(var S=b[o].split(/\s+/),u=0,p=S.length;p>u;u+=1)this.opt.development_extensions.strict_page_numbers&&"page"===s&&!S[u].match(/^-*[0-9]/)?v=!1:S[u].match(/[-0-9]/)||(v=!1);if(b[o].match(/^[1-9][0-9]*$/))b[o]=parseInt(b[o],10),t&&"undefined"==typeof t.gender&&(t.gender=this.locale[this.opt.lang]["noun-genders"][s],t.gender||(t.gender="")),this.tmp.shadow_numbers[s].values.push(["NumericBlob",b[o],t]);else{var O=b[o];this.tmp.shadow_numbers[s].values.push(["Blob",O,t])}}}else b[o]&&this.tmp.shadow_numbers[s].values.push(["Blob",b[o],void 0])}this.tmp.shadow_numbers[s].numeric=this.opt.development_extensions.strict_page_numbers&&"page"===s?-1===a.indexOf(" ")&&a.match(/^-*[0-9]/)?!0:v:-1===a.indexOf(" ")&&a.match(/[0-9]/)?!0:v,this.tmp.shadow_numbers[s].numeric||this.transform.loadAbbreviation(i.jurisdiction,"number",a),y>1&&(this.tmp.shadow_numbers[s].plural=1),1===i.force_pluralism?this.tmp.shadow_numbers[s].plural=1:0===i.force_pluralism&&(this.tmp.shadow_numbers[s].plural=0)}}},e.Util.PageRangeMangler={},e.Util.PageRangeMangler.getFunction=function(t,e){var i,s,r,a,n,o,l,u,p,h,c,m,f,d,g,b,y,v=t.getTerm(e+"-range-delimiter");i=/([a-zA-Z]*)([0-9]+)\s*(?:\u2013|-)\s*([a-zA-Z]*)([0-9]+)/,a=function(i){for(r=i.length,s=1;r>s;s+=2)"object"==typeof i[s]&&(i[s]=i[s].join(""));var a=i.join("");return a=a.replace(/([^\\])\-/g,"$1"+t.getTerm(e+"-range-delimiter"))},n=function(t){var e,i,a,n="\\s+\\-\\s+",o="-"===v?"":v,l=new RegExp("([^\\\\])[-"+o+"\\u2013]","g");t=t.replace(l,"$1 - ").replace(/\s+-\s+/g," - ");var u=new RegExp("([a-zA-Z]*[0-9]+"+n+"[a-zA-Z]*[0-9]+)","g"),p=new RegExp("[a-zA-Z]*[0-9]+"+n+"[a-zA-Z]*[0-9]+");if(e=t.match(u),i=t.split(p),0===i.length)a=e;else for(a=[i[0]],s=1,r=i.length;r>s;s+=1)a.push(e[s-1].replace(/\s*\-\s*/,"-","g")),a.push(i[s]);return a},o=function(t){for(t=""+t,h=n(t),r=h.length,s=1;r>s;s+=2)c=h[s].match(i),c&&(c[3]&&c[1]!==c[3]||(c[4].length<c[2].length&&(c[4]=c[2].slice(0,c[2].length-c[4].length)+c[4]),parseInt(c[2],10)<parseInt(c[4],10)&&(c[3]=v+c[1],h[s]=c.slice(1)))),"string"==typeof h[s]&&(h[s]=h[s].replace("-",v,"g"));return h},l=function(t,e,i){r=t.length;for(var s=1,n=t.length;n>s;s+=2)t[s][3]=u(t[s][1],t[s][3],e,i),t[s][2].slice(1)===t[s][0]&&(t[s][2]=v);return a(t)},u=function(t,e,i,s){if(i||(i=0),m=(""+t).split(""),f=(""+e).split(""),d=f.slice(),d.reverse(),m.length===f.length)for(var r=0,a=m.length;a>r;r+=1){if(!(m[r]===f[r]&&d.length>i)){if(i&&s&&3===d.length){var n=m.slice(0,r);n.reverse(),d=d.concat(n)}break}d.pop()}return d.reverse(),d.join("")},p=function(t){for(r=t.length,s=1;r>s;s+=2)"object"==typeof t[s]&&(c=t[s],g=parseInt(c[1],10),b=parseInt(c[3],10),g>100&&g%100&&parseInt(g/100,10)===parseInt(b/100,10)?c[3]=""+b%100:g>=1e4&&(c[3]=""+b%1e3)),c[2].slice(1)===c[0]&&(c[2]=v);return a(t)};var _=function(t,e,i,s){var r;t=""+t;var a=o(t),r=e(a,i,s);return r};return t.opt[e+"-range-format"]?"expanded"===t.opt[e+"-range-format"]?y=function(t){return _(t,a)}:"minimal"===t.opt[e+"-range-format"]?y=function(t){return _(t,l)}:"minimal-two"===t.opt[e+"-range-format"]?y=function(t,e){return _(t,l,2,e)}:"chicago"===t.opt[e+"-range-format"]&&(y=function(t){return _(t,p)}):y=function(t){return t},y},e.Util.FlipFlopper=function(t){var e,i,s,r,a,n,o,l,u,p,h,c,m,f,d,g,b,y;for(this.state=t,this.blob=!1,this.quotechars=['"',"'"],e=[["<i>","</i>","italics","@font-style",["italic","normal","normal"],!0],["<b>","</b>","bold","@font-weight",["bold","normal","normal"],!0],["<sup>","</sup>","superscript","@vertical-align",["sup","sup","baseline"],!0],["<sub>","</sub>","subscript","@vertical-align",["sub","sub","baseline"],!0],["<sc>","</sc>","smallcaps","@font-variant",["small-caps","small-caps","normal"],!0],['<span style="font-variant:small-caps;">',"</span>","smallcaps","@font-variant",["small-caps","normal","normal"],!0],['<span class="nocase">',"</span>","passthrough","@passthrough",["true","true","true"],!0],['<span class="nodecor">',"</span>","passthrough","@passthrough",["true","true","true"],!0],['"','"',"quotes","@quotes",["true","inner","true"],"'"],[" '","'","quotes","@quotes",["inner","true","true"],'"']],i=0;2>i;i+=1){r=["-","-inner-"][i],a=[];var v=t.getTerm("open"+r+"quote");a.push(v),this.quotechars.push(v);var _=t.getTerm("close"+r+"quote");a.push(_),this.quotechars.push(_),a.push("quotes"),a.push("@quotes"),a.push("-"===r?["true","inner"]:["inner","true"]),a.push(!0),a.push("-"===r?t.getTerm("close-inner-quote"):t.getTerm("close-quote")),e.push(a)}for(n=function(t){for(o=[],s=t.length,i=0;s>i;i+=1)l=t[i],-1===o.indexOf(l[0])&&(u="",["(",")","[","]"].indexOf(l[0])>-1&&(u="\\"),o.push(u+l[0])),-1===o.indexOf(l[1])&&(u="",["(",")","[","]"].indexOf(l[1])>-1&&(u="\\"),o.push(u+l[1]));return o},b=n(e),y=[],i=0,s=b.length;s>i;i+=1)b[i]&&y.push(b[i]);b=y.slice(),this.allTagsRexMatch=new RegExp("("+b.join("|")+")","g"),this.allTagsRexSplit=new RegExp("(?:"+b.join("|")+")"),p=function(t){for(h={},c={},m={},f={},d={},s=t.length,i=0;s>i;i+=1)h[t[i][1]]=!0,c[t[i][1]]=t[i][5],m[t[i][0]]=t[i][1],f[t[i][0]]=[t[i][3],t[i][4]],d[t[i][3]]=[t[i][3],[t[i][4][2],t[i][1]]];return[h,c,m,f,d]},g=p(e),this.closeTagsHash=g[0],this.flipTagsHash=g[1],this.openToCloseHash=g[2],this.openToDecorations=g[3],this.okReverseHash=g[4]},e.Util.FlipFlopper.prototype.init=function(t,i){this.txt_esc=e.getSafeEscape(this.state),i?(this.blob=i,this.strs=this.getSplitStrings(this.blob.blobs),this.blob.blobs=[]):(this.strs=this.getSplitStrings(t),this.blob=new e.Blob),this.blobstack=new e.Stack(this.blob)},e.Util.FlipFlopper.prototype._normalizeString=function(t){var e,i;if(t=t.replace(/\s+'\s+/g," \u2019 "),t.indexOf(this.quotechars[0])>-1)for(e=0,i=2;i>e;e+=1)this.quotechars[e+2]&&(t=t.replace(this.quotechars[e+2],this.quotechars[0]));if(t.indexOf(this.quotechars[1])>-1)for(e=0,i=2;i>e;e+=1)this.quotechars[e+4]&&(t=0===e?t.replace(this.quotechars[e+4]," "+this.quotechars[1]):t.replace(this.quotechars[e+4],this.quotechars[1]));return t},e.Util.FlipFlopper.prototype.getSplitStrings=function(t){var e,i,s,r,a,n,o,l,u,p,h,c,m,f,d,g,b,y,v,_,x,A,I,S,O,E,k,T,w;for(t=this._normalizeString(t),T=t.match(this.allTagsRexMatch),e=t.split(this.allTagsRexSplit),w=[e[0]],i=1,s=e.length;s>i;i+=1)w.push(T[i-1]),w.push(e[i]);for(e=w.slice(),s=e.length-2,i=s;i>0;i+=-2)"\\"===e[i-1].slice(e[i-1].length-1)&&(r=e[i-1].slice(0,e[i-1].length-1)+e[i]+e[i+1],a=e.slice(0,i-1),n=e.slice(i+2),a.push(r),e=a.concat(n));for(o=[],l=[],u=[],p=[],h=[],S=e.length-1,c=1;S>c;c+=2)if(g=e[c],this.closeTagsHash[g]&&(o.reverse(),m=this.openToCloseHash[g],f=o.indexOf(g),d=u.indexOf(g),o.reverse(),!m||f>-1&&(d>f||-1===d))){for(b=!1,O=o.length-1,y=O;y>-1;y+=-1){if(b=!0,v=o[y],g===v){o.pop(),l.pop(),u.pop(),p.pop();break}h.push(c)}b||h.push(c)}else this.openToCloseHash[g]&&(o.push(this.openToCloseHash[g]),l.push(g),u.push(this.flipTagsHash[g]),p.push(c));for(E=o.length-1,_=E;_>-1;_+=-1)o.pop(),u.pop(),l.pop(),h.push(p.pop());for(h.sort(function(t,e){return e>t?1:t>e?-1:0}),s=h.length,i=0;s>i;i+=1)k=h[i],a=e.slice(0,k-1),n=e.slice(k+2),x=e[k],x.length&&"<"!==x[0]&&this.openToDecorations[x]&&-1===this.quotechars.indexOf(x.replace(/\s+/g,""))&&(I=this.openToDecorations[x],x=this.state.fun.decorate[I[0]][I[1][0]](this.state)),A=e[k-1]+x+e[k+1],a.push(A),e=a.concat(n);for(s=e.length,i=0;s>i;i+=2)e[i]=e[i].replace("'","\u2019","g"),e[i]=e[i].replace("  \u2019"," \u2019","g");return e},e.Util.FlipFlopper.prototype.processTags=function(){var t,i,s,r,a,n,o,l,u,p,h,c,m,f,d,g,b,y,v,_,x,A,I,S;if(t=[],i=[],s=[],r=[],a="",1===this.strs.length)this.blob.blobs=this.strs[0];else if(this.strs.length>2){for(x=this.strs.length-1,n=1;x>n;n+=2)if(o=this.strs[n],l=this.strs[n-1],l&&(u=new e.Blob(l),p=this.blobstack.value(),p.push(u)),this.closeTagsHash[o]&&(t.reverse(),h=this.openToCloseHash[o],c=t.indexOf(o),m=s.indexOf(o),t.reverse(),!h||c>-1&&(m>c||-1===m))){for(A=t.length,f=A;f>-1;f+=-1)if(d=t[f],o===d){t.pop(),i.pop(),s.pop(),r.pop(),this.blobstack.pop();break}}else if(this.openToCloseHash[o]){if(t.push(this.openToCloseHash[o]),i.push(o),s.push(this.flipTagsHash[o]),p=this.blobstack.value(),g=new e.Blob,p.push(g),b=this.addFlipFlop(g,this.openToDecorations[o]),'<span class="nodecor">'===o)for(y=this.state[this.state.tmp.area].opt.topdecor.concat(this.blob.alldecor).concat([[["@quotes","inner"]]]),A=y.length,f=0;A>f;f+=1)for(v=y[f],S=v.length,I=0;S>I;I+=1)_=v[I],["@font-style","@font-weight","@font-variant"].indexOf(_[0])>-1&&(b=this.addFlipFlop(g,this.okReverseHash[_[0]]));r.push(this.state.fun.decorate[b[0]][b[1]](this.state)),this.blobstack.push(g)}this.strs.length>2&&(a=this.strs[this.strs.length-1],a&&(p=this.blobstack.value(),u=new e.Blob(a),p.push(u)))}return this.blob},e.Util.FlipFlopper.prototype.addFlipFlop=function(t,e){var i,s,r,a,n,o,l,u,p,h;for(s=0,r=this.state[this.state.tmp.area].opt.topdecor.concat(t.alldecor).concat([[["@quotes","inner"]]]),a=r.length,i=0;a>i;i+=1){for(n=r[i],o=!1,h=n.length-1,u=h;u>-1;u+=-1)if(l=n[u],l[0]===e[0]){l[1]===e[1][0]&&(s=1),o=!0;break}if(o)break}return p=[e[0],e[1][s]],t.decorations.reverse(),t.decorations.push(p),t.decorations.reverse(),p},e.Output.Formatters={},e.getSafeEscape=function(t){if(["bibliography","citation"].indexOf(t.tmp.area)>-1){var i=[];return t.opt.development_extensions.thin_non_breaking_space_html_hack&&"html"===t.opt.mode&&i.push(function(t){return t.replace(/\u202f/g,'<span style="white-space:nowrap">&thinsp;</span>')}),i.length?function(s){for(var r=0,a=i.length;a>r;r+=1)s=i[r](s);return e.Output.Formats[t.opt.mode].text_escape(s)}:e.Output.Formats[t.opt.mode].text_escape}return function(t){return t}},e.Output.Formatters.passthrough=function(t,e){return e},e.Output.Formatters.lowercase=function(t,i){var s=e.Output.Formatters.doppelString(i,e.TAG_USEALL);return s.string=s.string.toLowerCase(),e.Output.Formatters.undoppelString(s)},e.Output.Formatters.uppercase=function(t,i){var s=e.Output.Formatters.doppelString(i,e.TAG_USEALL);return s.string=s.string.toUpperCase(),e.Output.Formatters.undoppelString(s)},e.Output.Formatters["capitalize-first"]=function(t,i){var s=e.Output.Formatters.doppelString(i,e.TAG_ESCAPE);return s.string.length?(s.string=s.string.slice(0,1).toUpperCase()+s.string.substr(1),e.Output.Formatters.undoppelString(s)):""},e.Output.Formatters.sentence=function(t,i){var s=e.Output.Formatters.doppelString(i,e.TAG_ESCAPE);return s.string=s.string.slice(0,1).toUpperCase()+s.string.substr(1).toLowerCase(),e.Output.Formatters.undoppelString(s)},e.Output.Formatters["capitalize-all"]=function(t,i){for(var s=e.Output.Formatters.doppelString(i,e.TAG_ESCAPE),r=s.string.split(" "),a=0,n=r.length;n>a;a+=1)r[a].length>1?r[a]=t.opt.development_extensions.allow_force_lowercase?r[a].slice(0,1).toUpperCase()+r[a].substr(1).toLowerCase():r[a].slice(0,1).toUpperCase()+r[a].substr(1):1===r[a].length&&(r[a]=r[a].toUpperCase());return s.string=r.join(" "),e.Output.Formatters.undoppelString(s)},e.Output.Formatters.title=function(t,i){function s(t){var e=t.match(/([:?!]+\s+|-|^)(.)(.*)/);return e?e[1]+e[2].toUpperCase()+e[3]:t}{var r,a,n,o,l;t.locale[t.opt.lang].opts["skip-words"]}if(!i)return"";var u=e.Output.Formatters.doppelString(i,e.TAG_ESCAPE),r=u.string,l=r.split(t.locale[t.opt.lang].opts["skip-words-regexp"]);for(p=1,h=l.length;h>p;p+=2)l[p].match(/^[:?!]/)&&(l[p]=s(l[p]));l[0]||(l[1]=s(l[1])),l.length>2&&!l[l.length-1]&&(l[l.length-2]=s(l[l.length-2]));for(var p=0,h=l.length;h>p;p+=2){for(var a=l[p].split(/([:?!]*\s+|-)/),c=0,m=a.length;m>c;c+=2)if(0!==a[c].length){if(n=a[c].toUpperCase(),o=a[c].toLowerCase(),a[c].match(/[0-9]/))continue;a[c]===o&&(a[c]=s(a[c]))}l[p]=a.join("")}u.string=l.join("");var f=e.Output.Formatters.undoppelString(u);return f},e.Output.Formatters.doppelString=function(t,e){var i;i={},i.array=e(t),i.string="";for(var s=0,r=i.array.length;r>s;s+=2)i.string+=i.array[s];return i},e.Output.Formatters.undoppelString=function(t){var e;e="";for(var i=0,s=t.array.length;s>i;i+=1)i%2?e+=t.array[i]:(e+=t.string.slice(0,t.array[i].length),t.string=t.string.slice(t.array[i].length));return e},e.Output.Formatters.serializeItemAsRdf=function(){return""},e.Output.Formatters.serializeItemAsRdfA=function(){return""},e.demoteNoiseWords=function(t,e,i){var s=t.locale[t.opt.lang].opts["leading-noise-words"];if(e&&i){e=e.split(/\s+/),e.reverse();for(var r=[],a=e.length-1;a>-1&&s.indexOf(e[a].toLowerCase())>-1;a+=-1)r.push(e.pop());e.reverse();var n=e.join(" "),o=r.join(" ");"drop"!==i&&o?"demote"===i&&(e=[n,o].join(", ")):e=n}return e},e.Output.Formats=function(){},e.Output.Formats.prototype.html={text_escape:function(t){return t||(t=""),t.replace(/&/g,"&#38;").replace(/</g,"&#60;").replace(/>/g,"&#62;").replace("  ","&#160; ","g").replace(e.SUPERSCRIPTS_REGEXP,function(t){return"<sup>"+e.SUPERSCRIPTS[t]+"</sup>"})},bibstart:'<div class="csl-bib-body">\n',bibend:"</div>","@font-style/italic":"<i>%%STRING%%</i>","@font-style/oblique":"<em>%%STRING%%</em>","@font-style/normal":'<span style="font-style:normal;">%%STRING%%</span>',"@font-variant/small-caps":'<span style="font-variant:small-caps;">%%STRING%%</span>',"@passthrough/true":e.Output.Formatters.passthrough,"@font-variant/normal":'<span style="font-variant:normal;">%%STRING%%</span>',"@font-weight/bold":"<b>%%STRING%%</b>","@font-weight/normal":'<span style="font-weight:normal;">%%STRING%%</span>',"@font-weight/light":!1,"@text-decoration/none":'<span style="text-decoration:none;">%%STRING%%</span>',"@text-decoration/underline":'<span style="text-decoration:underline;">%%STRING%%</span>',"@vertical-align/sup":"<sup>%%STRING%%</sup>","@vertical-align/sub":"<sub>%%STRING%%</sub>","@vertical-align/baseline":'<span style="baseline">%%STRING%%</span>',"@strip-periods/true":e.Output.Formatters.passthrough,"@strip-periods/false":e.Output.Formatters.passthrough,"@quotes/true":function(t,e){return"undefined"==typeof e?t.getTerm("open-quote"):t.getTerm("open-quote")+e+t.getTerm("close-quote")
},"@quotes/inner":function(t,e){return"undefined"==typeof e?"\u2019":t.getTerm("open-inner-quote")+e+t.getTerm("close-inner-quote")},"@quotes/false":!1,"@cite/entry":function(t,e){return t.sys.wrapCitationEntry(e,this.item_id,this.locator_txt,this.suffix_txt)},"@bibliography/entry":function(t,e){var i="";return t.sys.embedBibliographyEntry&&(i=t.sys.embedBibliographyEntry(this.item_id)+"\n"),'  <div class="csl-entry">'+e+"</div>\n"+i},"@display/block":function(t,e){return'\n\n    <div class="csl-block">'+e+"</div>\n"},"@display/left-margin":function(t,e){return'\n    <div class="csl-left-margin">'+e+"</div>"},"@display/right-inline":function(t,e){return'<div class="csl-right-inline">'+e+"</div>\n  "},"@display/indent":function(t,e){return'<div class="csl-indent">'+e+"</div>\n  "},"@showid/true":function(t,i,s){if(t.tmp.just_looking||t.tmp.suppress_decorations)return i;if(s)return'<span class="'+t.opt.nodenames[s]+'" cslid="'+s+'">'+i+"</span>";if("string"==typeof i){var r="";if(i){var a=i.match(e.VARIABLE_WRAPPER_PREPUNCT_REX);r=a[1],i=a[2]}var n="";return i&&e.SWAPPING_PUNCTUATION.indexOf(i.slice(-1))>-1&&(n=i.slice(-1),i=i.slice(0,-1)),t.sys.variableWrapper(this.params,r,i,n)}return i},"@URL/true":function(t,e){return'<a href="'+e+'">'+e+"</a>"},"@DOI/true":function(t,e){return'<a href="http://dx.doi.org/'+e+'">'+e+"</a>"}},e.Output.Formats.prototype.text={text_escape:function(t){return t||(t=""),t},bibstart:"",bibend:"","@font-style/italic":!1,"@font-style/oblique":!1,"@font-style/normal":!1,"@font-variant/small-caps":!1,"@passthrough/true":e.Output.Formatters.passthrough,"@font-variant/normal":!1,"@font-weight/bold":!1,"@font-weight/normal":!1,"@font-weight/light":!1,"@text-decoration/none":!1,"@text-decoration/underline":!1,"@vertical-align/baseline":!1,"@vertical-align/sup":!1,"@vertical-align/sub":!1,"@strip-periods/true":e.Output.Formatters.passthrough,"@strip-periods/false":e.Output.Formatters.passthrough,"@quotes/true":function(t,e){return"undefined"==typeof e?t.getTerm("open-quote"):t.getTerm("open-quote")+e+t.getTerm("close-quote")},"@quotes/inner":function(t,e){return"undefined"==typeof e?"\u2019":t.getTerm("open-inner-quote")+e+t.getTerm("close-inner-quote")},"@quotes/false":!1,"@cite/entry":function(t,e){return t.sys.wrapCitationEntry(e,this.item_id,this.locator_txt,this.suffix_txt)},"@bibliography/entry":function(t,e){return e+"\n"},"@display/block":function(t,e){return"\n"+e},"@display/left-margin":function(t,e){return e},"@display/right-inline":function(t,e){return e},"@display/indent":function(t,e){return"\n    "+e},"@showid/true":function(t,e){return e},"@URL/true":function(t,e){return e},"@DOI/true":function(t,e){return e}},e.Output.Formats.prototype.rtf={text_escape:function(t){return t||(t=""),t.replace(/([\\{}])/g,"\\$1","g").replace(e.SUPERSCRIPTS_REGEXP,function(t){return"\\super "+e.SUPERSCRIPTS[t]+"\\nosupersub{}"}).replace(/[\u007F-\uFFFF]/g,function(t){return"\\uc0\\u"+t.charCodeAt(0).toString()+"{}"}).replace("	","\\tab{}","g")},"@passthrough/true":e.Output.Formatters.passthrough,"@font-style/italic":"\\i %%STRING%%\\i0{}","@font-style/normal":"\\i0{}%%STRING%%\\i{}","@font-style/oblique":"\\i %%STRING%%\\i0{}","@font-variant/small-caps":"\\scaps %%STRING%%\\scaps0{}","@font-variant/normal":"\\scaps0{}%%STRING%%\\scaps{}","@font-weight/bold":"\\b %%STRING%%\\b0{}","@font-weight/normal":"\\b0{}%%STRING%%\\b{}","@font-weight/light":!1,"@text-decoration/none":!1,"@text-decoration/underline":"\\ul %%STRING%%\\ul0{}","@vertical-align/baseline":!1,"@vertical-align/sup":"\\super %%STRING%%\\nosupersub{}","@vertical-align/sub":"\\sub %%STRING%%\\nosupersub{}","@strip-periods/true":e.Output.Formatters.passthrough,"@strip-periods/false":e.Output.Formatters.passthrough,"@quotes/true":function(t,i){return"undefined"==typeof i?e.Output.Formats.rtf.text_escape(t.getTerm("open-quote")):e.Output.Formats.rtf.text_escape(t.getTerm("open-quote"))+i+e.Output.Formats.rtf.text_escape(t.getTerm("close-quote"))},"@quotes/inner":function(t,i){return"undefined"==typeof i?e.Output.Formats.rtf.text_escape("\u2019"):e.Output.Formats.rtf.text_escape(t.getTerm("open-inner-quote"))+i+e.Output.Formats.rtf.text_escape(t.getTerm("close-inner-quote"))},"@quotes/false":!1,bibstart:"{\\rtf ",bibend:"}","@display/block":"\\line{}%%STRING%%\\line\r\n","@cite/entry":function(t,e){return e},"@cite/entry":function(t,e){return t.sys.wrapCitationEntry(e,this.item_id,this.locator_txt,this.suffix_txt)},"@bibliography/entry":function(t,e){return e},"@display/left-margin":function(t,e){return e+"\\tab "},"@display/right-inline":function(t,e){return e+"\\line\r\n"},"@display/indent":function(t,e){return"\n\\tab "+e+"\\line\r\n"},"@showid/true":function(t,i){if(t.tmp.just_looking||t.tmp.suppress_decorations)return i;var s="";if(i){var r=i.match(e.VARIABLE_WRAPPER_PREPUNCT_REX);s=r[1],i=r[2]}var a="";return i&&e.SWAPPING_PUNCTUATION.indexOf(i.slice(-1))>-1&&(a=i.slice(-1),i=i.slice(0,-1)),t.sys.variableWrapper(this.params,s,i,a)},"@URL/true":function(t,e){return e},"@DOI/true":function(t,e){return e}},e.Output.Formats=new e.Output.Formats,e.Registry=function(t){var i,s,r;this.debug=!1,this.state=t,this.registry={},this.reflist=[],this.namereg=new e.Registry.NameReg(t),this.citationreg=new e.Registry.CitationReg(t),this.authorstrings={},this.mylist=[],this.myhash={},this.deletes=[],this.inserts=[],this.uncited={},this.refreshes={},this.akeys={},this.oldseq={},this.return_data={},this.ambigcites={},this.ambigresets={},this.sorter=new e.Registry.Comparifier(t,"bibliography_sort"),this.getSortedIds=function(){for(i=[],s=0,r=this.reflist.length;r>s;s+=1)i.push(""+this.reflist[s].id);return i},this.getSortedRegistryItems=function(){for(i=[],s=0,r=this.reflist.length;r>s;s+=1)i.push(this.reflist[s]);return i}},e.Registry.prototype.init=function(t,e){var i,s;if(this.oldseq={},e){this.uncited={};for(var i=0,s=t.length;s>i;i+=1)this.myhash[t[i]]||this.mylist.push(""+t[i]),this.uncited[t[i]]=!0,this.myhash[t[i]]=!0}else{for(var r in this.uncited)t.push(r);var a={};for(i=t.length-1;i>-1;i+=-1)a[t[i]]?t=t.slice(0,i).concat(t.slice(i+1)):a[t[i]]=!0;this.mylist=[];for(var i=0,s=t.length;s>i;i+=1)this.mylist.push(""+t[i]);this.myhash=a}this.refreshes={},this.touched={},this.ambigsTouched={},this.ambigresets={}},e.Registry.prototype.dopurge=function(t){for(var e=this.mylist.length-1;e>-1;e+=-1)this.citationreg.citationsByItemId&&(this.citationreg.citationsByItemId[this.mylist[e]]||t[this.mylist[e]]||(delete this.myhash[this.mylist[e]],this.mylist=this.mylist.slice(0,e).concat(this.mylist.slice(e+1))));this.dodeletes(this.myhash)},e.Registry.prototype.dodeletes=function(t){var e,i,s,r,a,n,o,l,u;"string"==typeof t&&(t={},t[t]=!0);for(i in this.registry)if(!t[i]){if(this.uncited[i])continue;e=this.namereg.delitems(i);for(o in e)this.refreshes[o]=!0;for(s=this.registry[i].ambig,l=this.ambigcites[s].indexOf(i),l>-1&&(n=this.ambigcites[s].slice(),this.ambigcites[s]=n.slice(0,l).concat(n.slice(l+1,n.length)),this.ambigresets[s]=this.ambigcites[s].length),a=this.ambigcites[s].length,r=0;a>r;r+=1)u=""+this.ambigcites[s][r],this.refreshes[u]=!0;if(this.registry[i].siblings)if(1==this.registry[i].siblings.length){var p=this.registry[i].siblings[0];this.registry[p].master=!0,this.registry[p].siblings.pop(),this.registry[p].parallel=!1}else if(this.registry[i].siblings.length>1){var h=[i];if(this.registry[i].master){var c=this.registry[i].siblings[0],m=this.registry[c];m.master=!0,m.parallel=!1,h.push(c);for(var f=0,d=this.registry[i].siblings.length;d>f;f+=1)this.registry[this.registry[i].siblings[f]].parallel=c}for(var g=[],f=this.registry[i].siblings.length-1;f>-1;f+=-1){var b=this.registry[i].siblings.pop();-1===h.indexOf(b)&&g.push(b)}for(var f=g.length-1;f>-1;f+=-1)this.registry[i].siblings.push(g[f])}delete this.registry[i],this.return_data.bibchange=!0}},e.Registry.prototype.doinserts=function(t){var i,s,r,a,n,o,l;for("string"==typeof t&&(t=[t]),o=0,l=t.length;l>o;o+=1)i=t[o],this.registry[i]||(s=this.state.retrieveItem(i),r=e.getAmbiguousCite.call(this.state,s),this.ambigsTouched[r]=!0,s.legislation_id||(this.akeys[r]=!0),a={id:""+i,seq:0,offset:0,sortkeys:!1,ambig:!1,rendered:!1,disambig:!1,ref:s},this.registry[i]=a,this.citationreg.citationsByItemId&&this.citationreg.citationsByItemId[i]&&(this.registry[i]["first-reference-note-number"]=this.citationreg.citationsByItemId[i][0].properties.noteIndex),n=e.getAmbigConfig.call(this.state),this.registerAmbigToken(r,i,n),this.touched[i]=!0,this.return_data.bibchange=!0)},e.Registry.prototype.rebuildlist=function(){var t,i,s;for(this.reflist=[],this.state.opt.citation_number_sort_direction===e.DESCENDING&&this.state.opt.citation_number_sort_used,t=this.mylist.length,i=0;t>i;i+=1)s=this.mylist[i],this.reflist.push(this.registry[s]),this.oldseq[s]=this.registry[s].seq,this.registry[s].seq=i+1;this.state.opt.citation_number_sort_direction===e.DESCENDING&&this.state.opt.citation_number_sort_used},e.Registry.prototype.dorefreshes=function(){var t,i,s,r,a;for(t in this.refreshes)if(i=this.registry[t]){i.sortkeys=void 0,s=this.state.retrieveItem(t);var r=i.ambig;"undefined"==typeof r&&(this.state.tmp.disambig_settings=!1,r=e.getAmbiguousCite.call(this.state,s),a=e.getAmbigConfig.call(this.state),this.registerAmbigToken(r,t,a));for(var n in this.ambigresets)if(1===this.ambigresets[n]){var o=this.ambigcites[r][0],s=this.state.retrieveItem(o);this.registry[o].disambig=new e.AmbigConfig,this.state.tmp.disambig_settings=!1;var r=e.getAmbiguousCite.call(this.state,s),a=e.getAmbigConfig.call(this.state);this.registerAmbigToken(r,o,a)}this.state.tmp.taintedItemIDs[t]=!0,this.ambigsTouched[r]=!0,s.legislation_id||(this.akeys[r]=!0),this.touched[t]=!0}},e.Registry.prototype.setdisambigs=function(){var t;this.leftovers=[];for(t in this.ambigsTouched)this.state.disambiguate.run(t);this.ambigsTouched={},this.akeys={}},e.Registry.prototype.renumber=function(){var t,i,s;for(this.state.opt.citation_number_sort_direction===e.DESCENDING&&this.state.opt.citation_number_sort_used,t=this.reflist.length,i=0;t>i;i+=1)s=this.reflist[i],s.seq=i+1,this.state.opt.update_mode===e.NUMERIC&&s.seq!=this.oldseq[s.id]&&(this.state.tmp.taintedItemIDs[s.id]=!0),this.state.opt.bib_mode===e.NUMERIC&&s.seq!=this.oldseq[s.id]&&(this.return_data.bibchange=!0);this.state.opt.citation_number_sort_direction===e.DESCENDING&&this.state.opt.citation_number_sort_used&&this.reflist.reverse()},e.Registry.prototype.setsortkeys=function(){for(var t,i=0,s=this.mylist.length;s>i;i+=1){var t=this.mylist[i];(this.touched[t]||this.state.tmp.taintedItemIDs[t]||!this.registry[t].sortkeys)&&(this.registry[t].sortkeys=e.getSortKeys.call(this.state,this.state.retrieveItem(t),"bibliography_sort"))}},e.Registry.prototype.sorttokens=function(){this.reflist.sort(this.sorter.compareKeys)},e.Registry.Comparifier=function(t,i){var s,r,a,n,o=e.getSortCompare(t.opt["default-locale-sort"]);s=t[i].opt.sort_directions,this.compareKeys=function(t,e){for(r=t.sortkeys?t.sortkeys.length:0,a=0;r>a;a+=1){var i=0;if(i=t.sortkeys[a]===e.sortkeys[a]?0:"undefined"==typeof t.sortkeys[a]?s[a][1]:"undefined"==typeof e.sortkeys[a]?s[a][0]:o(t.sortkeys[a],e.sortkeys[a]),i>0)return s[a][1];if(0>i)return s[a][0]}return t.seq>e.seq?1:t.seq<e.seq?-1:0},n=this.compareKeys,this.compareCompositeKeys=function(t,e){return n(t[1],e[1])}},e.Registry.prototype.compareRegistryTokens=function(t,e){return t.seq>e.seq?1:t.seq<e.seq?-1:0},e.Registry.prototype.registerAmbigToken=function(t,i,s){if(this.registry[i]&&this.registry[i].disambig&&this.registry[i].disambig.names)for(var r=0,a=s.names.length;a>r;r+=1){var n=s.names[r],o=this.registry[i].disambig.names[r];if(n!==o)this.state.tmp.taintedItemIDs[i]=!0;else if(s.givens[r])for(var l=0,u=s.givens[r].length;u>l;l+=1){var p=s.givens[r][l],h=this.registry[i].disambig.givens[r][l];p!==h&&(this.state.tmp.taintedItemIDs[i]=!0)}}this.ambigcites[t]||(this.ambigcites[t]=[]),-1===this.ambigcites[t].indexOf(""+i)&&this.ambigcites[t].push(""+i),this.registry[i].ambig=t;this.registry[i].disambig=e.cloneAmbigConfig(s)},e.getSortKeys=function(t,i){var s,r,a,n,o,l;for(s=this.tmp.area,r=this.tmp.extension,a=e.Util.Sort.strip_prepositions,this.tmp.area=i,this.tmp.extension="_sort",this.tmp.disambig_override=!0,this.tmp.disambig_request=!1,n=this.parallel.use_parallels,this.parallel.use_parallels=!1,this.tmp.suppress_decorations=!0,e.getCite.call(this,t),this.tmp.suppress_decorations=!1,this.parallel.use_parallels=n,this.tmp.disambig_override=!1,o=this[i].keys.length,l=0;o>l;l+=1)this[i].keys[l]=a(this[i].keys[l]);return this.tmp.area=s,this.tmp.extension=r,this[i].keys},e.Registry.NameReg=function(t){var i,s,r,a,n,o,l,u,p,h,c,m,f,d,g,b;this.state=t,this.namereg={},this.nameind={},this.nameindpkeys={},this.itemkeyreg={},u=function(t){return t||(t=""),t.replace("."," ","g").replace(/\s+/g," ").replace(/\s+$/,"")},p=function(t,a,n){i=u(n.family),r=u(n.given);var o=r.match(/[,\!]* ([^,]+)$/);o&&o[1]===o[1].toLowerCase()&&(r=r.replace(/[,\!]* [^,]+$/,"")),s=e.Util.Names.initializeWith(t,r,"%s"),"by-cite"===t.citation.opt["givenname-disambiguation-rule"]&&(i=""+a+i)},h=function(e,r,o,l,u,h){var c;if("bibliography"===t.tmp.area.slice(0,12)&&!u)return"string"==typeof h?1:2;var m=t.nameOutput.getName(r,"locale-translit",!0);r=m.name,p(this.state,""+e,r),c=2,a=t.opt["disambiguate-add-givenname"],n=t.citation.opt["givenname-disambiguation-rule"];var f=n;return"by-cite"===n&&(n="all-names"),"short"===u?c=0:"string"==typeof h&&(c=1),"undefined"==typeof this.namereg[i]||"undefined"==typeof this.namereg[i].ikey[s]?c:"by-cite"===f&&l>=c?l:a?"string"==typeof n&&"primary-name"===n.slice(0,12)&&o>0?c:(n&&"all-names"!==n&&"primary-name"!==n?("all-names-with-initials"===n||"primary-name-with-initials"===n)&&(c=this.namereg[i].count>1?1:0):(this.namereg[i].count>1&&(c=1),(this.namereg[i].ikey&&this.namereg[i].ikey[s].count>1||this.namereg[i].count>1&&"string"!=typeof h)&&(c=2)),t.registry.registry[e]?c:"short"==u?0:"string"==typeof h?1:void 0):c},c=function(e){var a,n,u,p,h;for(("string"==typeof e||"number"==typeof e)&&(e=[""+e]),o={},n=e.length,a=0;n>a;a+=1)if(p=""+e[a],this.nameind[p]){for(h in this.nameind[p])if(this.nameind[p].hasOwnProperty(h)){if(f=h.split("::"),i=f[0],s=f[1],r=f[2],"undefined"==typeof this.namereg[i])continue;if(l=this.namereg[i].items,r&&this.namereg[i].ikey[s]&&this.namereg[i].ikey[s].skey[r]&&(d=this.namereg[i].ikey[s].skey[r].items,u=d.indexOf(""+p),u>-1&&(this.namereg[i].ikey[s].skey[r].items=d.slice(0,u).concat(d.slice([u+1]))),0===this.namereg[i].ikey[s].skey[r].items.length&&(delete this.namereg[i].ikey[s].skey[r],this.namereg[i].ikey[s].count+=-1,this.namereg[i].ikey[s].count<2)))for(g=0,b=this.namereg[i].ikey[s].items.length;b>g;g+=1)t.tmp.taintedItemIDs[this.namereg[i].ikey[s].items[g]]=!0;if(s&&this.namereg[i].ikey[s]&&(u=this.namereg[i].ikey[s].items.indexOf(""+p),u>-1&&(l=this.namereg[i].ikey[s].items.slice(),this.namereg[i].ikey[s].items=l.slice(0,u).concat(l.slice([u+1]))),0===this.namereg[i].ikey[s].items.length&&(delete this.namereg[i].ikey[s],this.namereg[i].count+=-1,this.namereg[i].count<2)))for(g=0,b=this.namereg[i].items.length;b>g;g+=1)t.tmp.taintedItemIDs[this.namereg[i].items[g]]=!0;i&&(u=this.namereg[i].items.indexOf(""+p),u>-1&&(l=this.namereg[i].items.slice(),this.namereg[i].items=l.slice(0,u).concat(l.slice([u+1],l.length))),this.namereg[i].items.length<2&&delete this.namereg[i]),delete this.nameind[p][h]}delete this.nameind[p],delete this.nameindpkeys[p]}return o},m=function(e,a,n){var o,l,u=t.nameOutput.getName(a,"locale-translit",!0);if(a=u.name,!t.citation.opt["givenname-disambiguation-rule"]||"primary-"!==t.citation.opt["givenname-disambiguation-rule"].slice(0,8)||0===n){if(p(this.state,""+e,a),i&&("undefined"==typeof this.namereg[i]?(this.namereg[i]={},this.namereg[i].count=0,this.namereg[i].ikey={},this.namereg[i].items=[e]):-1===this.namereg[i].items.indexOf(e)&&this.namereg[i].items.push(e)),i&&s)if("undefined"==typeof this.namereg[i].ikey[s]){if(this.namereg[i].ikey[s]={},this.namereg[i].ikey[s].count=0,this.namereg[i].ikey[s].skey={},this.namereg[i].ikey[s].items=[e],this.namereg[i].count+=1,2===this.namereg[i].count)for(o=0,l=this.namereg[i].items.length;l>o;o+=1)t.tmp.taintedItemIDs[this.namereg[i].items[o]]=!0}else-1===this.namereg[i].ikey[s].items.indexOf(e)&&this.namereg[i].ikey[s].items.push(e);if(i&&s&&r)if("undefined"==typeof this.namereg[i].ikey[s].skey[r]){if(this.namereg[i].ikey[s].skey[r]={},this.namereg[i].ikey[s].skey[r].items=[e],this.namereg[i].ikey[s].count+=1,2===this.namereg[i].ikey[s].count)for(o=0,l=this.namereg[i].ikey[s].items.length;l>o;o+=1)t.tmp.taintedItemIDs[this.namereg[i].ikey[s].items[o]]=!0}else-1===this.namereg[i].ikey[s].skey[r].items.indexOf(e)&&this.namereg[i].ikey[s].skey[r].items.push(e);"undefined"==typeof this.nameind[e]&&(this.nameind[e]={},this.nameindpkeys[e]={}),i&&(this.nameind[e][i+"::"+s+"::"+r]=!0,this.nameindpkeys[e][i]=this.namereg[i])}},this.addname=m,this.delitems=c,this.evalname=h},e.Registry.CitationReg=function(){this.citationById={},this.citationByIndex=[]},e.Disambiguation=function(t){this.state=t,this.sys=this.state.sys,this.registry=t.registry.registry,this.ambigcites=t.registry.ambigcites,this.configModes(),this.debug=!1},e.Disambiguation.prototype.run=function(t){this.modes.length&&(this.akey=t,this.initVars(t)&&this.runDisambig())},e.Disambiguation.prototype.runDisambig=function(){var t;for(this.initGivens=!0;this.lists.length;){for(this.gnameset=0,this.gname=0,this.clashes=[1,0];this.lists[0][1].length;){this.listpos=0,this.base||(this.base=this.lists[0][0]);t=this.incrementDisambig(),this.scanItems(this.lists[0]),this.evalScan(t)}this.lists=this.lists.slice(1)}},e.Disambiguation.prototype.scanItems=function(t){var i,s,r;this.Item=t[1][0],this.ItemCite=e.getAmbiguousCite.call(this.state,this.Item,this.base,!0),this.scanlist=t[1],this.partners=[],this.partners.push(this.Item),this.nonpartners=[];var a=0;for(i=1,s=t[1].length;s>i;i+=1){r=t[1][i];var n=e.getAmbiguousCite.call(this.state,r,this.base,!0);this.ItemCite===n?(a+=1,this.partners.push(r)):this.nonpartners.push(r)}this.clashes[0]=this.clashes[1],this.clashes[1]=a},e.Disambiguation.prototype.evalScan=function(t){this[this.modes[this.modeindex]](t),t&&(this.modeindex<this.modes.length-1?this.modeindex+=1:this.lists[this.listpos+1]=[this.base,[]])},e.Disambiguation.prototype.disNames=function(t){var e,i;if(0===this.clashes[1]&&1===this.nonpartners.length)this.captureStepToBase(),this.state.registry.registerAmbigToken(this.akey,""+this.nonpartners[0].id,this.betterbase),this.state.registry.registerAmbigToken(this.akey,""+this.partners[0].id,this.betterbase),this.lists[this.listpos]=[this.betterbase,[]];else if(0===this.clashes[1])this.captureStepToBase(),this.state.registry.registerAmbigToken(this.akey,""+this.partners[0].id,this.betterbase),this.lists[this.listpos]=[this.betterbase,this.nonpartners],this.nonpartners.length&&(this.initGivens=!0);else if(1===this.nonpartners.length)this.captureStepToBase(),this.state.registry.registerAmbigToken(this.akey,""+this.nonpartners[0].id,this.betterbase),this.lists[this.listpos]=[this.betterbase,this.partners];else if(this.clashes[1]<this.clashes[0])this.captureStepToBase(),this.lists[this.listpos]=[this.betterbase,this.partners],this.lists.push([this.betterbase,this.nonpartners]);else if(t&&(this.lists[this.listpos]=[this.betterbase,this.nonpartners],this.lists.push([this.betterbase,this.partners]),this.modeindex===this.modes.length-1)){for(e=0,i=this.partners.length;i>e;e+=1)this.state.registry.registerAmbigToken(this.akey,""+this.partners[e].id,this.betterbase);this.lists[this.listpos]=[this.betterbase,[]]}},e.Disambiguation.prototype.disExtraText=function(){var t=!1;if(0===this.clashes[1]&&this.nonpartners.length<2&&(t=!0),t||this.base.disambiguate&&this.state.tmp.disambiguate_count===this.state.tmp.disambiguate_maxMax){if(t||this.state.tmp.disambiguate_count===this.state.tmp.disambiguate_maxMax)if(t||this.modeindex===this.modes.length-1){for(var e=this.lists[this.listpos][0],i=0,s=this.lists[this.listpos][1].length;s>i;i+=1)this.state.tmp.taintedItemIDs[this.lists[this.listpos][1][i].id]=!0,this.state.registry.registerAmbigToken(this.akey,""+this.lists[this.listpos][1][i].id,e);this.lists[this.listpos]=[this.betterbase,[]]}else{this.modeindex=this.modes.length-1;var e=this.lists[this.listpos][0];e.disambiguate=!0;for(var i=0,s=this.lists[this.listpos][1].length;s>i;i+=1)this.state.tmp.taintedItemIDs[this.lists[this.listpos][1][i].id]=!0,this.state.registry.registerAmbigToken(this.akey,""+this.lists[this.listpos][1][i].id,e)}}else if(this.modeindex=0,this.base.disambiguate=this.state.tmp.disambiguate_count,this.betterbase.disambiguate=this.state.tmp.disambiguate_count,this.base.disambiguate)this.disNames();else{this.initGivens=!0,this.base.disambiguate=1;for(var i=0,s=this.lists[this.listpos][1].length;s>i;i+=1)this.state.tmp.taintedItemIDs[this.lists[this.listpos][1][i].id]=!0}},e.Disambiguation.prototype.disYears=function(){var t,i,s,r;s=[];var a=this.lists[this.listpos][0];if(this.clashes[1])for(var n=0,o=this.state.registry.mylist.length;o>n;n+=1)for(var l=this.state.registry.mylist[n],u=0,p=this.lists[this.listpos][1].length;p>u;u+=1){var r=this.lists[this.listpos][1][u];if(r.id==l){s.push(this.registry[r.id]);break}}for(s.sort(this.state.registry.sorter.compareKeys),t=0,i=s.length;i>t;t+=1){a.year_suffix=""+t;var h=this.state.registry.registry[s[t].id].disambig;this.state.registry.registerAmbigToken(this.akey,""+s[t].id,a),e.ambigConfigDiff(h,a)&&(this.state.tmp.taintedItemIDs[s[t].id]=!0)}this.lists[this.listpos]=[this.betterbase,[]]},e.Disambiguation.prototype.incrementDisambig=function(){if(this.initGivens)return this.initGivens=!1,!1;var t=!1,e=!0;if("disNames"===this.modes[this.modeindex]){e=!1,"number"!=typeof this.givensMax&&(e=!0);var i=!1;if("number"!=typeof this.namesMax&&(i=!0),"number"==typeof this.givensMax&&(this.base.givens.length&&this.base.givens[this.gnameset][this.gname]<this.givensMax?this.base.givens[this.gnameset][this.gname]+=1:e=!0),"number"==typeof this.namesMax&&e&&(this.state.opt["disambiguate-add-names"]?(i=!1,this.gname<this.namesMax?(this.base.names[this.gnameset]+=1,this.gname+=1):i=!0):i=!0),"number"==typeof this.namesetsMax&&i)if(this.gnameset<this.namesetsMax)this.gnameset+=1,this.base.names[this.gnameset]=1,this.gname=0;else;"number"==typeof this.namesetsMax&&-1!==this.namesetsMax&&this.gnameset!==this.namesetsMax||this.state.opt["disambiguate-add-names"]&&"number"==typeof this.namesMax&&this.gname!==this.namesMax||"number"==typeof this.givensMax&&"undefined"!=typeof this.base.givens[this.gnameset]&&"undefined"!=typeof this.base.givens[this.gnameset][this.gname]&&this.base.givens[this.gnameset][this.gname]!==this.givensMax||(t=!0)}else"disExtraText"===this.modes[this.modeindex]&&(this.base.disambiguate+=1,this.betterbase.disambiguate+=1);return t},e.Disambiguation.prototype.initVars=function(t){var i,s,r,a,n;if(this.lists=[],this.base=!1,this.betterbase=!1,this.akey=t,this.maxNamesByItemId={},a=[],r=this.ambigcites[t],!r||!r.length)return!1;var o=this.state.retrieveItem(""+r[0]);if(this.getCiteData(o),this.base=e.getAmbigConfig.call(this.state),r&&r.length>1){for(a.push([this.maxNamesByItemId[o.id],o]),i=1,s=r.length;s>i;i+=1)o=this.state.retrieveItem(""+r[i]),this.getCiteData(o,this.base),a.push([this.maxNamesByItemId[o.id],o]);for(a.sort(function(t,e){return t[0]>e[0]?1:t[0]<e[0]?-1:t[1].id>e[1].id?1:t[1].id<e[1].id?-1:0}),n=[],i=0,s=a.length;s>i;i+=1)n.push(a[i][1]);this.lists.push([this.base,n]),this.Item=this.lists[0][1][0]}else this.Item=this.state.retrieveItem(""+r[0]);this.modeindex=0;var i,s;return this.namesMax=this.maxNamesByItemId[this.Item.id][0],this.padBase(this.base),this.padBase(this.betterbase),this.base.year_suffix=!1,this.base.disambiguate=!1,this.betterbase.year_suffix=!1,this.betterbase.disambiguate=!1,"by-cite"===this.state.citation.opt["givenname-disambiguation-rule"]&&this.state.opt["disambiguate-add-givenname"]&&(this.givensMax=2),!0},e.Disambiguation.prototype.padBase=function(t){for(var e=0,i=t.names.length;i>e;e+=1){t.givens[e]||(t.givens[e]=[]);for(var s=0,r=t.names[e];r>s;s+=1)t.givens[e][s]||(t.givens[e][s]=0)}},e.Disambiguation.prototype.configModes=function(){var t,e;this.modes=[],t=this.state.opt["disambiguate-add-givenname"],e=this.state.citation.opt["givenname-disambiguation-rule"],(this.state.opt["disambiguate-add-names"]||t&&"by-cite"===e)&&this.modes.push("disNames"),this.state.opt.has_disambiguate&&this.modes.push("disExtraText"),this.state.opt["disambiguate-add-year-suffix"]&&this.modes.push("disYears")},e.Disambiguation.prototype.getCiteData=function(t,i){if(!this.maxNamesByItemId[t.id]){e.getAmbiguousCite.call(this.state,t,i),i=e.getAmbigConfig.call(this.state),this.maxNamesByItemId[t.id]=e.getMaxVals.call(this.state),this.state.registry.registry[t.id].disambig.givens=this.state.tmp.disambig_settings.givens.slice();for(var s=0,r=this.state.registry.registry[t.id].disambig.givens.length;r>s;s+=1)this.state.registry.registry[t.id].disambig.givens[s]=this.state.tmp.disambig_settings.givens[s].slice();this.namesetsMax=this.state.registry.registry[t.id].disambig.names.length-1,this.base||(this.base=i,this.betterbase=e.cloneAmbigConfig(i)),i.names.length<this.base.names.length&&(this.base=i);for(var s=0,r=i.names.length;r>s;s+=1)i.names[s]>this.base.names[s]&&(this.base.givens[s]=i.givens[s].slice(),this.base.names[s]=i.names[s],this.betterbase.names=this.base.names.slice(),this.betterbase.givens=this.base.givens.slice(),this.padBase(this.base),this.padBase(this.betterbase));this.betterbase.givens=this.base.givens.slice();for(var a=0,n=this.base.givens.length;n>a;a+=1)this.betterbase.givens[a]=this.base.givens[a].slice()}},e.Disambiguation.prototype.captureStepToBase=function(){"by-cite"===this.state.citation.opt["givenname-disambiguation-rule"]&&this.base.givens&&this.base.givens.length&&"undefined"!=typeof this.base.givens[this.gnameset][this.gname]&&(this.betterbase.givens[this.gnameset][this.gname]=this.base.givens[this.gnameset][this.gname]),this.betterbase.names[this.gnameset]=this.base.names[this.gnameset]},e}),function(t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define("citeproc/locale",[],t):window.locale=t()}(function(){var t={"en-US":'<locale xml:lang="en" xmlns="http://purl.org/net/xbiblio/csl">  <style-options punctuation-in-quote="true"/>  <date form="text">    <date-part name="month" suffix=" "/>    <date-part name="day" suffix=", "/>    <date-part name="year"/>  </date>  <date form="numeric">    <date-part name="year"/>    <date-part name="month" form="numeric" prefix="-" range-delimiter="/"/>    <date-part name="day" prefix="-" range-delimiter="/"/>  </date>  <terms>    <term name="document-number-label">No.</term>    <term name="document-number-authority-suffix">Doc.</term>    <term name="un-sales-number-label">U.N. Sales No.</term>    <term name="collection-number-label">No.</term>    <term name="open-quote">\u201c</term>    <term name="close-quote">\u201d</term>    <term name="open-inner-quote">\u2018</term>    <term name="close-inner-quote">\u2019</term>    <term name="ordinal-01">st</term>    <term name="ordinal-02">nd</term>    <term name="ordinal-03">rd</term>    <term name="ordinal-04">th</term>    <term name="long-ordinal-01">first</term>    <term name="long-ordinal-02">second</term>    <term name="long-ordinal-03">third</term>    <term name="long-ordinal-04">fourth</term>    <term name="long-ordinal-05">fifth</term>    <term name="long-ordinal-06">sixth</term>    <term name="long-ordinal-07">seventh</term>    <term name="long-ordinal-08">eighth</term>    <term name="long-ordinal-09">ninth</term>    <term name="long-ordinal-10">tenth</term>    <term name="at">at</term>    <term name="in">in</term>    <term name="ibid">ibid</term>    <term name="accessed">accessed</term>    <term name="retrieved">retrieved</term>    <term name="from">from</term>    <term name="forthcoming">forthcoming</term>    <term name="references">      <single>reference</single>      <multiple>references</multiple>    </term>    <term name="references" form="short">      <single>ref</single>      <multiple>refs</multiple>    </term>    <term name="no date">n.d.</term>    <term name="and">and</term>    <term name="et-al">et al.</term>    <term name="interview">interview</term>    <term name="letter">letter</term>    <term name="anonymous">anonymous</term>    <term name="anonymous" form="short">anon.</term>    <term name="and others">and others</term>    <term name="in press">in press</term>    <term name="online">online</term>    <term name="cited">cited</term>    <term name="internet">internet</term>    <term name="presented at">presented at the</term>    <term name="ad">AD</term>    <term name="bc">BC</term>    <term name="season-01">Spring</term>    <term name="season-02">Summer</term>    <term name="season-03">Autumn</term>    <term name="season-04">Winter</term>    <term name="with">with</term>        <!-- CATEGORIES -->    <term name="anthropology">anthropology</term>    <term name="astronomy">astronomy</term>    <term name="biology">biology</term>    <term name="botany">botany</term>    <term name="chemistry">chemistry</term>    <term name="engineering">engineering</term>    <term name="generic-base">generic base</term>    <term name="geography">geography</term>    <term name="geology">geology</term>    <term name="history">history</term>    <term name="humanities">humanities</term>    <term name="literature">literature</term>    <term name="math">math</term>    <term name="medicine">medicine</term>    <term name="philosophy">philosophy</term>    <term name="physics">physics</term>    <term name="psychology">psychology</term>    <term name="sociology">sociology</term>    <term name="science">science</term>    <term name="political_science">political science</term>    <term name="social_science">social science</term>    <term name="theology">theology</term>    <term name="zoology">zoology</term>        <!-- LONG LOCATOR FORMS -->    <term name="book">      <single>book</single>      <multiple>books</multiple>    </term>    <term name="chapter">      <single>chapter</single>      <multiple>chapters</multiple>    </term>    <term name="column">      <single>column</single>      <multiple>columns</multiple>    </term>    <term name="figure">      <single>figure</single>      <multiple>figures</multiple>    </term>    <term name="folio">      <single>folio</single>      <multiple>folios</multiple>    </term>    <term name="issue">      <single>number</single>      <multiple>numbers</multiple>    </term>    <term name="line">      <single>line</single>      <multiple>lines</multiple>    </term>    <term name="note">      <single>note</single>      <multiple>notes</multiple>    </term>    <term name="opus">      <single>opus</single>      <multiple>opera</multiple>    </term>    <term name="page">      <single>page</single>      <multiple>pages</multiple>    </term>    <term name="paragraph">      <single>paragraph</single>      <multiple>paragraph</multiple>    </term>    <term name="part">      <single>part</single>      <multiple>parts</multiple>    </term>    <term name="section">      <single>section</single>      <multiple>sections</multiple>    </term>    <term name="volume">      <single>volume</single>      <multiple>volumes</multiple>    </term>    <term name="edition">      <single>edition</single>      <multiple>editions</multiple>    </term>    <term name="verse">      <single>verse</single>      <multiple>verses</multiple>    </term>    <term name="sub verbo">      <single>sub verbo</single>      <multiple>s.vv</multiple>    </term>        <!-- SHORT LOCATOR FORMS -->    <term name="book" form="short">bk.</term>    <term name="chapter" form="short">chap.</term>    <term name="column" form="short">col.</term>    <term name="figure" form="short">fig.</term>    <term name="folio" form="short">f.</term>    <term name="issue" form="short">no.</term>    <term name="opus" form="short">op.</term>    <term name="page" form="short">      <single>p.</single>      <multiple>pp.</multiple>    </term>    <term name="paragraph" form="short">para.</term>    <term name="part" form="short">pt.</term>    <term name="section" form="short">sec.</term>    <term name="sub verbo" form="short">      <single>s.v.</single>      <multiple>s.vv.</multiple>    </term>    <term name="verse" form="short">      <single>v.</single>      <multiple>vv.</multiple>    </term>    <term name="volume" form="short">    	<single>vol.</single>    	<multiple>vols.</multiple>    </term>    <term name="edition">edition</term>    <term name="edition" form="short">ed.</term>        <!-- SYMBOL LOCATOR FORMS -->    <term name="paragraph" form="symbol">      <single>\xb6</single>      <multiple>\xb6\xb6</multiple>    </term>    <term name="section" form="symbol">      <single>\xa7</single>      <multiple>\xa7\xa7</multiple>    </term>        <!-- LONG ROLE FORMS -->    <term name="author">      <single></single>      <multiple></multiple>    </term>    <term name="editor">      <single>editor</single>      <multiple>editors</multiple>    </term>    <term name="translator">      <single>translator</single>      <multiple>translators</multiple>    </term>        <!-- SHORT ROLE FORMS -->    <term name="author" form="short">      <single></single>      <multiple></multiple>    </term>    <term name="editor" form="short">      <single>ed.</single>      <multiple>eds.</multiple>    </term>    <term name="translator" form="short">      <single>tran.</single>      <multiple>trans.</multiple>    </term>        <!-- VERB ROLE FORMS -->    <term name="editor" form="verb">edited by</term>    <term name="translator" form="verb">translated by</term>    <term name="recipient" form="verb">to</term>    <term name="interviewer" form="verb">interview by</term>        <!-- SHORT VERB ROLE FORMS -->    <term name="editor" form="verb-short">ed.</term>    <term name="translator" form="verb-short">trans.</term>        <!-- LONG MONTH FORMS -->    <term name="month-01">January</term>    <term name="month-02">February</term>    <term name="month-03">March</term>    <term name="month-04">April</term>    <term name="month-05">May</term>    <term name="month-06">June</term>    <term name="month-07">July</term>    <term name="month-08">August</term>    <term name="month-09">September</term>    <term name="month-10">October</term>    <term name="month-11">November</term>    <term name="month-12">December</term>        <!-- SHORT MONTH FORMS -->    <term name="month-01" form="short">Jan.</term>    <term name="month-02" form="short">Feb.</term>    <term name="month-03" form="short">Mar.</term>    <term name="month-04" form="short">Apr.</term>	<term name="month-05" form="short">May</term>    <term name="month-06" form="short">Jun.</term>    <term name="month-07" form="short">Jul.</term>    <term name="month-08" form="short">Aug.</term>    <term name="month-09" form="short">Sep.</term>    <term name="month-10" form="short">Oct.</term>    <term name="month-11" form="short">Nov.</term>    <term name="month-12" form="short">Dec.</term>  </terms></locale>'};
return t}),function(t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define("citeproc/sys",["citeproc/locale"],t):window.Sys=t()}(function(t){var e=function(t,e){this.abbreviations=t||{},this.abbrevsname="default",this.bibdata=e||{}};return e.prototype.retrieveItem=function(t){return this.bibdata[t]},e.prototype.retrieveLocale=function(e){return t[e]},e.prototype.getAbbreviation=function(t,e,i,s,r){try{e["default"][s][r]=this.abbreviations[this.abbrevsname][s][r]?this.abbreviations[this.abbrevsname][s][r]:""}catch(a){}},e.prototype.setAbbreviations=function(t){this.abbrevsname=t},e}),function(t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define("citeproc/csl",[],t):window.citationstyles=t()}(function(){var t={"modern-language-association":'<?xml version="1.0" encoding="utf-8"?><style xmlns="http://purl.org/net/xbiblio/csl" class="in-text" version="1.0" demote-non-dropping-particle="never">  <info>    <title>Modern Language Association 7th edition</title>    <title-short>MLA</title-short>    <id>http://www.zotero.org/styles/modern-language-association</id>    <link href="http://www.zotero.org/styles/modern-language-association" rel="self"/>    <link href="http://owl.english.purdue.edu/owl/section/2/11/" rel="documentation"/>    <author>      <name>Ilouise S. Bradford</name>      <email>isbradford@gmail.com</email>    </author>    <contributor>      <name>Sarah Ficke</name>      <email>sficke@email.unc.edu</email>    </contributor>    <contributor>      <name>Sebastian Karcher</name>      <email>karcher@u.northwestern.edu</email>    </contributor>    <contributor>      <name>Christian Werthschulte</name>      <email>Christian.Werthschulte@rub.de</email>    </contributor>    <contributor>      <name>Simon Kornblith</name>      <email>simon@simonster.com</email>    </contributor>    <contributor>      <name>James Johnston</name>      <email>thejamesjohnston@gmail.com</email>    </contributor>    <category citation-format="author"/>    <category field="generic-base"/>    <summary>This style adheres to the MLA 7th edition handbook and contains modifications to these types of sources: e-mail, forum posts, interviews, manuscripts, maps, presentations, TV broadcasts, and web pages.</summary>    <updated>2014-07-06T20:05:10+00:00</updated>    <rights license="http://creativecommons.org/licenses/by-sa/3.0/">This work is licensed under a Creative Commons Attribution-ShareAlike 3.0 License</rights>  </info>  <locale xml:lang="en">    <terms>      <term name="month-01" form="short">Jan.</term>      <term name="month-02" form="short">Feb.</term>      <term name="month-03" form="short">Mar.</term>      <term name="month-04" form="short">Apr.</term>      <term name="month-05" form="short">May</term>      <term name="month-06" form="short">June</term>      <term name="month-07" form="short">July</term>      <term name="month-08" form="short">Aug.</term>      <term name="month-09" form="short">Sept.</term>      <term name="month-10" form="short">Oct.</term>      <term name="month-11" form="short">Nov.</term>      <term name="month-12" form="short">Dec.</term>      <term name="volume" form="short">        <single>Vol.</single>        <multiple>vols</multiple>      </term>      <term name="edition" form="short">ed</term>      <term name="editor" form="verb-short">ed.</term>      <term name="translator" form="verb-short">trans.</term>      <term name="translator" form="short">trans.</term>    </terms>  </locale>  <macro name="editor-translator">    <names variable="editor translator" delimiter=". ">      <label form="verb-short" text-case="capitalize-first" suffix=" "/>      <name and="text" delimiter=", "/>    </names>  </macro>  <macro name="author">    <names variable="author">      <name name-as-sort-order="first" and="text" sort-separator=", " delimiter=", " delimiter-precedes-last="always"/>      <label form="short" prefix=", "/>      <substitute>        <names variable="editor"/>        <names variable="translator"/>        <text macro="title"/>      </substitute>    </names>  </macro>  <macro name="author-short">    <names variable="author">      <name form="short" and="text" delimiter=", " initialize-with=". "/>      <substitute>        <names variable="editor"/>        <names variable="translator"/>        <text macro="title-short"/>      </substitute>    </names>  </macro>  <macro name="access">    <group delimiter=" ">      <date variable="accessed">        <date-part name="day" suffix=" "/>        <date-part name="month" form="short" suffix=" "/>        <date-part name="year"/>      </date>    </group>  </macro>  <macro name="issued-full-date">    <choose>      <if variable="issued">        <date variable="issued">          <date-part name="day" suffix=" "/>          <date-part name="month" form="short" suffix=" " strip-periods="false"/>          <date-part name="year"/>        </date>      </if>      <else>        <text term="no date" form="short"/>      </else>    </choose>  </macro>  <macro name="medium">    <choose>      <if type="motion_picture">        <choose>          <if variable="medium">            <text variable="medium" prefix=" "/>          </if>          <else>            <text value="Film" prefix=" "/>          </else>        </choose>      </if>      <else-if type="broadcast">        <choose>          <if variable="medium">            <text variable="medium" prefix=" "/>          </if>          <else>            <text value="Television" prefix=" "/>          </else>        </choose>      </else-if>      <else-if type="manuscript">        <text value=""/>      </else-if>      <else-if type="personal_communication" match="any">        <text value="" prefix=" "/>      </else-if>      <else-if type="speech" match="any">        <text value=""/>      </else-if>      <else-if type="interview">        <text variable="medium" prefix=" "/>      </else-if>      <else-if type="song">        <choose>          <if variable="medium">            <text variable="medium" prefix=" "/>          </if>          <else>            <text value="Audio Recording" prefix=" "/>          </else>        </choose>      </else-if>      <else>        <choose>          <if variable="URL DOI" match="any">            <text variable="source" prefix=" " suffix="." font-style="italic"/>            <group>              <text value="Web." prefix=" "/>            </group>            <text prefix=" " suffix="." macro="access"/>          </if>          <else>            <text value="Print" prefix=" "/>          </else>        </choose>      </else>    </choose>  </macro>  <macro name="title">    <choose>      <if type="bill book graphic legal_case legislation manuscript motion_picture report song" match="any">        <text variable="title" font-style="italic" text-case="title"/>      </if>      <else-if type="interview personal_communication" match="any">        <text variable="title" text-case="title" quotes="false"/>      </else-if>      <else>        <text variable="title" text-case="title" quotes="true"/>      </else>    </choose>  </macro>  <macro name="title-short">    <choose>      <if type="bill book graphic legal_case legislation manuscript motion_picture report song" match="any">        <text variable="title" text-case="title" form="short" font-style="italic"/>      </if>      <else>        <text variable="title" text-case="title" form="short" quotes="true"/>      </else>    </choose>  </macro>  <macro name="pages">    <choose>      <if variable="page">        <text variable="page"/>      </if>      <else-if type="personal_communication interview" match="any">        <text value=""/>      </else-if>      <else>        <text value="n. pag"/>      </else>    </choose>  </macro>  <macro name="edition">    <choose>      <if is-numeric="edition">        <group delimiter=" ">          <number variable="edition" form="ordinal"/>          <text term="edition" form="short"/>        </group>      </if>      <else>        <text variable="edition"/>      </else>    </choose>  </macro>  <macro name="volume">    <choose>      <if is-numeric="volume">        <group delimiter=" ">          <text term="volume" form="short" strip-periods="false"/>          <number variable="volume"/>        </group>      </if>      <else>        <text variable="volume"/>      </else>    </choose>  </macro>  <macro name="number-of-volumes-only">    <choose>      <if variable="volume" match="none">        <choose>          <if is-numeric="number-of-volumes">            <group delimiter=" ">              <number variable="number-of-volumes"/>              <text term="volume" form="short" plural="true" strip-periods="true"/>            </group>          </if>          <else>            <text variable="number-of-volumes"/>          </else>        </choose>      </if>    </choose>  </macro>  <macro name="number-of-volumes-optional">    <choose>      <if variable="volume">        <choose>          <if is-numeric="number-of-volumes">            <group delimiter=" ">              <number variable="number-of-volumes"/>              <text term="volume" form="short" plural="true" strip-periods="true"/>            </group>          </if>          <else>            <text variable="number-of-volumes"/>          </else>        </choose>      </if>    </choose>  </macro>  <macro name="collection-title">    <text variable="collection-title" text-case="title" prefix=" "/>  </macro>  <macro name="collection-number">    <text variable="collection-number" prefix=" " suffix="."/>  </macro>  <macro name="publisher">    <choose>      <if variable="publisher">        <text variable="publisher"/>      </if>      <else>        <text value="N.p."/>      </else>    </choose>  </macro>  <macro name="publisher-year">    <group delimiter=", ">      <group delimiter=": ">        <text variable="publisher-place"/>        <text macro="publisher"/>      </group>      <date variable="issued">        <date-part name="year"/>      </date>    </group>  </macro>  <citation et-al-min="4" et-al-use-first="1" disambiguate-add-names="true" disambiguate-add-givenname="true">    <layout prefix="(" suffix=")" delimiter="; ">      <group delimiter=" ">        <choose>          <if variable="author editor translator" match="any">            <group delimiter=", ">              <text macro="author-short"/>              <choose>                <if disambiguate="true">                  <text macro="title-short"/>                </if>              </choose>            </group>          </if>          <else>            <text macro="title-short"/>          </else>        </choose>        <text variable="locator"/>      </group>    </layout>  </citation>  <bibliography hanging-indent="true" et-al-min="4" et-al-use-first="1" line-spacing="2" entry-spacing="0" subsequent-author-substitute="---">    <sort>      <key macro="author"/>      <key variable="title"/>    </sort>    <layout suffix=".">      <text macro="author" suffix="."/>      <text macro="title" prefix=" " suffix="."/>      <choose>        <if type="bill book graphic legal_case legislation motion_picture report song" match="any">          <text macro="editor-translator" prefix=" " suffix="."/>          <text macro="edition" prefix=" " suffix="."/>          <text macro="volume" prefix=" " suffix="."/>          <text macro="number-of-volumes-only" prefix=" " suffix="."/>          <text macro="publisher-year" prefix=" " suffix="."/>        </if>        <else-if type="chapter paper-conference" match="any">          <group>            <text variable="container-title" text-case="title" font-style="italic" prefix=" " suffix="."/>            <text macro="editor-translator" prefix=" " suffix="."/>            <text macro="edition" prefix=" " suffix="."/>            <text macro="volume" prefix=" " suffix="."/>            <text macro="number-of-volumes-only" prefix=" " suffix="."/>            <text macro="publisher-year" prefix=" " suffix="."/>          </group>          <text variable="page" prefix=" " suffix="."/>        </else-if>        <else-if type="thesis">          <text variable="genre" prefix=" " suffix="."/>          <group delimiter=", ">            <text macro="publisher" prefix=" "/>            <date variable="issued" prefix=" " suffix=".">              <date-part name="year"/>            </date>          </group>          <text variable="archive_location" prefix=" " suffix="."/>        </else-if>        <else-if type="manuscript">          <date variable="issued" prefix=" " suffix=".">            <date-part name="year"/>          </date>          <text variable="genre" prefix=" " suffix="."/>          <text variable="archive_location" prefix=" " suffix="."/>          <text variable="publisher-place" prefix=" "/>        </else-if>        <else-if type="personal_communication">          <date variable="issued" prefix=" " suffix=".">            <date-part name="day" suffix=" "/>            <date-part name="month" form="short" suffix=" "/>            <date-part name="year"/>          </date>          <choose>            <if variable="genre">              <text prefix=" " suffix="." variable="genre"/>            </if>            <else>              <text prefix=" " suffix="." value="E-mail"/>            </else>          </choose>        </else-if>        <else-if type="map">          <text variable="genre" prefix=" " suffix="."/>          <text variable="publisher-place" prefix=" " suffix=":"/>          <text macro="publisher" prefix=" "/>          <date variable="issued" prefix=" " suffix=",">            <date-part name="year"/>          </date>        </else-if>        <else-if type="speech">          <text variable="event" prefix=" " suffix="."/>          <text variable="publisher-place" prefix=" " suffix="."/>          <date variable="issued" prefix=" " suffix=".">            <date-part name="year"/>          </date>          <text variable="genre" prefix=" " suffix="."/>        </else-if>        <else-if type="webpage post-weblog" match="any">          <text variable="genre" prefix=" " suffix="."/>          <text variable="container-title" font-style="italic" prefix=" " suffix="."/>          <group delimiter=", " prefix=" ">            <text macro="publisher"/>            <text macro="issued-full-date" suffix="."/>          </group>        </else-if>        <else-if type="broadcast">          <text variable="container-title" font-style="italic" prefix=" " suffix="."/>          <text macro="publisher" prefix=" " suffix=","/>          <date variable="issued" prefix=" " suffix=".">            <date-part name="day" suffix=" "/>            <date-part name="month" form="short" suffix=" " strip-periods="false"/>            <date-part name="year"/>          </date>        </else-if>        <else>          <group prefix=" " suffix="." delimiter=": ">            <group delimiter=" ">              <text macro="editor-translator" suffix="."/>              <text variable="container-title" font-style="italic"/>              <choose>                <if type="article-journal">                  <group delimiter=" ">                    <group delimiter=".">                      <text variable="volume"/>                      <text variable="issue"/>                    </group>                    <date variable="issued" prefix="(" suffix="):">                      <date-part name="year"/>                    </date>                  </group>                  <text macro="pages" prefix=" "/>                </if>                <else>                  <group>                    <date variable="issued">                      <date-part name="day" suffix=" "/>                      <date-part name="month" form="short" suffix=" " strip-periods="false"/>                      <date-part name="year"/>                    </date>                    <choose>                      <if variable="URL DOI" match="any">                        <text variable="page" prefix=": "/>                      </if>                      <else>                        <text macro="pages" prefix=": "/>                      </else>                    </choose>                  </group>                </else>              </choose>            </group>          </group>        </else>      </choose>      <text macro="medium" suffix="."/>      <text macro="number-of-volumes-optional" suffix="." prefix=" "/>      <text macro="collection-title"/>      <text macro="collection-number"/>    </layout>  </bibliography></style>',"chicago-author-date":'<style       xmlns="http://purl.org/net/xbiblio/csl"      class="in-text"   default-locale="en-US-x-sort-ja-alalc97-x-sec-en" version="1.0">  <!-- BOGUS COMMENT -->  <info>    <title>Chicago Manual of Style (Author-Date format)</title>    <id>http://www.zotero.org/styles/chicago-author-date</id>    <link href="http://www.zotero.org/styles/chicago-author-date" />    <author>      <name>Julian Onions</name>      <email>julian.onions@gmail.com</email>    </author>    <category term="author-date" />    <category term="generic-base" />    <updated />    <summary>The author-date variant of the Chicago style</summary>    <link href="http://www.chicagomanualofstyle.org/tools_citationguide.html" rel="documentation" />  </info> <macro name="secondary-contributors">    <choose>      <if match="none" type="chapter">        <group delimiter=". ">          <choose>            <if variable="author">              <names variable="editor">                <label form="verb-short" prefix=" " suffix=". " text-case="capitalize-first" />                <name and="text" delimiter=", " />              </names>            </if>          </choose>          <choose>            <if match="any" variable="author editor">              <names variable="translator">                <label form="verb-short" prefix=" " suffix=". " text-case="capitalize-first" />                <name and="text" delimiter=", " />              </names>            </if>          </choose>        </group>      </if>    </choose>  </macro>  <macro name="container-contributors">    <choose>      <if type="chapter">        <group delimiter=", " prefix=",">          <choose>            <if variable="author">              <names variable="editor">                <label form="verb-short" prefix=" " suffix=". " text-case="lowercase" />                <name and="text" delimiter=", " />              </names>            </if>          </choose>          <choose>            <if match="any" variable="author editor">              <names variable="translator">                <label form="verb-short" prefix=" " suffix=". " text-case="lowercase" />                <name and="text" delimiter=", " />              </names>            </if>          </choose>        </group>      </if>    </choose>  </macro>  <macro name="anon">    <choose>      <if match="none" variable="author editor translator">        <text form="short" term="anonymous" text-case="capitalize-first" />      </if>    </choose>  </macro>  <macro name="editor">    <names variable="editor">      <name and="text" delimiter=", " delimiter-precedes-last="always" name-as-sort-order="first" sort-separator=", " />      <label form="short" prefix=", " suffix="." />    </names>  </macro>  <macro name="translator">    <names variable="translator">      <name and="text" delimiter=", " delimiter-precedes-last="always" name-as-sort-order="first" sort-separator=", " />      <label form="verb-short" prefix=", " suffix="." />    </names>  </macro>  <macro name="recipient">    <choose>      <if type="personal_communication">        <choose>          <if variable="genre">            <text text-case="capitalize-first" variable="genre" />          </if>          <else>            <text term="letter" text-case="capitalize-first" />          </else>        </choose>      </if>    </choose>    <names delimiter=", " variable="recipient">      <label form="verb" prefix=" " suffix=" " text-case="lowercase" />      <name and="text" delimiter=", " />    </names>  </macro>  <macro name="contributors">    <names variable="author">      <name and="text" delimiter=", " delimiter-precedes-last="always" name-as-sort-order="first" sort-separator=", " />      <label form="verb-short" prefix=", " suffix="." text-case="lowercase" />      <substitute>        <text macro="editor" />        <text macro="translator" />      </substitute>    </names>    <text macro="anon" />    <text macro="recipient" />  </macro>  <macro name="contributors-short">    <names variable="author">      <name and="text" delimiter=", " form="short" />      <substitute>        <names variable="editor" />        <names variable="translator" />      </substitute>    </names>    <text macro="anon" />  </macro>  <macro name="interviewer">    <names delimiter=", " variable="interviewer">      <label form="verb" prefix=" " suffix=" " text-case="capitalize-first" />      <name and="text" delimiter=", " />    </names>  </macro>  <macro name="archive">    <group delimiter=". ">      <text text-case="capitalize-first" variable="archive_location" />      <text variable="archive" />      <text variable="archive-place" />    </group>  </macro>  <macro name="access">    <group delimiter=". ">      <choose>        <if match="any" type="graphic report">          <text macro="archive" />        </if>        <else-if match="none" type="book thesis chapter article-journal article-newspaper article-magazine">          <text macro="archive" />        </else-if>      </choose>      <text prefix="doi:" variable="DOI" />      <text variable="URL" />    </group>  </macro>  <macro name="title">    <choose>      <if match="none" variable="title">        <choose>          <if match="none" type="personal_communication">            <text text-case="capitalize-first" variable="genre" />          </if>        </choose>      </if>      <else-if type="book">        <text font-style="italic" variable="title" />      </else-if>      <else>        <text variable="title" />      </else>    </choose>  </macro>  <macro name="edition">    <choose>      <if match="any" type="book chapter">        <choose>          <if is-numeric="edition">            <group delimiter=" ">              <number form="ordinal" variable="edition" />              <text form="short" suffix="." term="edition" />            </group>          </if>          <else>            <text suffix="." variable="edition" />          </else>        </choose>      </if>    </choose>  </macro>  <macro name="locators">    <choose>      <if type="article-journal">        <text prefix=" " variable="volume" />        <text prefix=", no. " variable="issue" />      </if>      <else-if type="book">        <group delimiter=". " prefix=". ">          <group>            <text form="short" suffix=". " term="volume" text-case="capitalize-first" />            <number form="numeric" variable="volume" />          </group>          <group>            <number form="numeric" variable="number-of-volumes" />            <text form="short" plural="true" prefix=" " suffix="." term="volume" />          </group>        </group>      </else-if>    </choose>  </macro>  <macro name="locators-chapter">    <choose>      <if type="chapter">        <group prefix=", ">          <text suffix=":" variable="volume" />          <text variable="page" />        </group>      </if>    </choose>  </macro>  <macro name="locators-article">    <choose>      <if type="article-newspaper">        <group delimiter=", " prefix=", ">          <group>            <text suffix=" " variable="edition" />            <text prefix=" " term="edition" />          </group>          <group>            <text form="short" suffix=". " term="section" />            <text variable="section" />          </group>        </group>      </if>      <else-if type="article-journal">        <text prefix=": " variable="page" />      </else-if>    </choose>  </macro>  <macro name="point-locators">    <group>      <choose>        <if locator="page" match="none">          <label form="short" strip-periods="false" suffix=" " variable="locator" />        </if>      </choose>      <text variable="locator" />    </group>  </macro>  <macro name="container-prefix">    <text term="in" text-case="capitalize-first" />  </macro>  <macro name="container-title">    <choose>      <if type="chapter">        <text macro="container-prefix" suffix=" " />      </if>    </choose>    <text font-style="italic" variable="container-title" form="short"/>  </macro>  <macro name="publisher">    <group delimiter=": ">      <text variable="publisher-place" />      <text variable="publisher" />    </group>  </macro>  <macro name="date">    <date variable="issued" form="text" date-parts="year"><date-part name="year"/></date>  </macro>  <macro name="day-month">    <date variable="issued">      <date-part name="month" />      <date-part name="day" prefix=" " />    </date>  </macro>  <macro name="collection-title">    <text variable="collection-title" />    <text prefix=" " variable="collection-number" />  </macro>  <macro name="event">    <group>      <text suffix=" " term="presented at" />      <text variable="event" />    </group>  </macro>  <macro name="description">    <group delimiter=". ">      <text macro="interviewer" />      <text text-case="capitalize-first" variable="medium" />    </group>    <choose>      <if match="none" variable="title"> </if>      <else-if type="thesis"> </else-if>      <else>        <text prefix=". " text-case="capitalize-first" variable="genre" />      </else>    </choose>  </macro>  <macro name="issue">    <choose>      <if type="article-journal">        <text macro="day-month" prefix=" (" suffix=")" />      </if>      <else-if type="speech">        <group delimiter=", " prefix=" ">          <text macro="event" />          <text macro="day-month" />          <text variable="event-place" />        </group>      </else-if>      <else-if match="any" type="article-newspaper article-magazine">        <text macro="day-month" prefix=", " />      </else-if>      <else>        <group delimiter=", " prefix=". ">          <choose>            <if type="thesis">              <text text-case="capitalize-first" variable="genre" />            </if>          </choose>          <text macro="publisher" />          <text macro="day-month" />        </group>      </else>    </choose>  </macro>  <citation          disambiguate-add-givenname="true"         disambiguate-add-names="true"         disambiguate-add-year-suffix="true"         et-al-min="4"         et-al-subsequent-min="4"         et-al-subsequent-use-first="1"         et-al-use-first="1">    <layout text-decoration="underline" delimiter="; " prefix="(" suffix=")">      <group delimiter=", ">        <group delimiter=" ">          <text macro="contributors-short" />          <text macro="date" />        </group>        <text macro="point-locators" />      </group>    </layout>  </citation>  <bibliography          entry-spacing="0"         et-al-min="11"         et-al-use-first="7"         hanging-indent="true"         subsequent-author-substitute="---">    <sort>      <key macro="contributors" />      <key macro="date" />    </sort>    <layout suffix=".">      <text macro="contributors" suffix=". " />      <text macro="date" suffix=". " />      <text macro="title" />      <text macro="description"/>      <text macro="secondary-contributors" prefix=". " />      <text macro="container-title" prefix=". "/>      <text macro="container-contributors" />      <text macro="locators-chapter" />      <text macro="edition" prefix=". " />      <text macro="locators" />      <text macro="collection-title" prefix=". " />      <text macro="issue" />      <text macro="locators-article" />      <text macro="access" prefix=". " />    </layout>  </bibliography></style>',ieee:'<style        xmlns="http://purl.org/net/xbiblio/csl"       class="in-text">   <info>     <title>IEEE</title>     <id>http://www.zotero.org/styles/ieee</id>     <link href="http://www.zotero.org/styles/ieee" />     <author>       <name>Michael Berkowitz</name>       <email>mberkowi@gmu.edu</email>     </author>     <contributor>       <name>Julian Onions</name>       <email>julian.onions@gmail.com</email>     </contributor>     <contributor>       <name>Rintze Zelle</name>       <uri>http://forums.zotero.org/account/831/</uri>     </contributor>     <category term="engineering" />     <category term="generic-base" />     <category term="numeric" />     <updated />     <link href="http://www.ieee.org/portal/cms_docs_iportals/iportals/publications/authors/transjnl/stylemanual.pdf" rel="documentation" />   </info>   <macro name="author">     <names variable="author">       <name and="text" delimiter=", " initialize-with="."/>       <label form="short" prefix=", " suffix="." text-case="lowercase" />       <substitute>         <names variable="editor" />         <names variable="translator" />       </substitute>     </names>   </macro>   <macro name="editor">     <names variable="editor">       <name and="text" delimiter=", " initialize-with="." name-as-sort-order="all" />       <label form="short" prefix=", " suffix="." text-case="lowercase" />     </names>   </macro>   <macro name="title">     <choose>       <if type="book">         <text font-style="italic" variable="title" />       </if>       <else>         <text quotes="true" variable="title" />       </else>     </choose>   </macro>   <macro name="publisher">     <text prefix=" " suffix=": " variable="publisher-place" />     <text suffix=", " variable="publisher" />     <date variable="issued">       <date-part name="year" />     </date>   </macro>   <macro name="access">     <text variable="URL" />   </macro>   <macro name="page">     <group>       <label form="short" suffix=". " variable="page" />       <text variable="page" />     </group>   </macro>   <citation           collapse="citation-number"          et-al-min="3"          et-al-use-first="1">     <sort>       <key variable="citation-number" />     </sort>     <layout delimiter="," prefix="[" suffix="]">       <text variable="citation-number" />     </layout>   </citation>   <bibliography           entry-spacing="0"          second-field-align="flush">     <layout suffix=".">       <text prefix="[" suffix="]" variable="citation-number" />       <text macro="author" prefix=" " suffix=", " />       <choose>         <if type="book">           <group delimiter=", ">             <text macro="title" />             <text macro="publisher" />           </group>         </if>         <else-if type="chapter">           <group delimiter=", ">             <text macro="title" />             <text font-style="italic" variable="container-title" form="short"/>             <text macro="editor" />             <text macro="publisher" />             <text macro="page" />           </group>         </else-if>         <else-if type="patent">           <text macro="title" suffix=", " />           <text prefix="U.S. Patent " variable="number" />           <date prefix=", " variable="issued">             <date-part name="month" suffix=" " />             <date-part name="day" suffix=", " />             <date-part name="year" />           </date>         </else-if>         <else-if type="thesis">           <group delimiter=", ">             <text macro="title" />             <text variable="genre" />             <text variable="publisher" />             <date variable="issued">               <date-part name="year" />             </date>           </group>         </else-if>         <else>           <group delimiter=", ">             <text macro="title" />             <text font-style="italic" variable="container-title" form="short"/>             <text prefix=" vol. " variable="volume" />             <date variable="issued">               <date-part form="short" name="month" suffix=". " />               <date-part name="year" />             </date>             <text macro="page" />           </group>         </else>       </choose>     </layout>   </bibliography> </style>',"springer-author-date":'<style xmlns="http://purl.org/net/xbiblio/csl" class="in-text" default-locale="en-US" version="1.0" demote-non-dropping-particle="sort-only">  <info>    <title>Springer Author Date</title>    <id>http://www.zotero.org/styles/springer-author-date</id>    <link href="http://www.zotero.org/styles/springer-author-date" rel="self"/>    <link href="www.springer.com/cda/content/document/cda_downloaddocument/instruct-authors-e.pdf" rel="documentation"/>    <author>      <name>Jens Allmer</name>      <email>jens@allmer.de</email>      <uri>http://jens.allmer.de</uri>    </author>    <contributor>      <name>Sebastian Karcher</name>    </contributor>    <category citation-format="author-date"/>    <category field="generic-base"/>    <updated>2008-10-29T21:01:24+00:00</updated>    <summary>Springer Author Date Style for the disciplines Medicine, Biomedicine, Life Sciences, Chemistry, Geosciences, Computer Science, Engineering, Economics</summary>    <rights>This work is licensed under a Creative Commons Attribution-ShareAlike 3.0 License: http://creativecommons.org/licenses/by-sa/3.0/</rights>  </info>  <macro name="author-short">    <names variable="author">      <name form="short" and="text"/>      <substitute>        <names variable="editor"/>        <names variable="translator"/>      </substitute>    </names>  </macro>  <macro name="author">    <names variable="author">      <name sort-separator=" " initialize-with="" name-as-sort-order="all" delimiter=", " delimiter-precedes-last="always"/>      <!--<et-al strip-periods="true"/> -->      <substitute>        <names variable="editor"/>        <names variable="translator"/>      </substitute>    </names>  </macro>  <macro name="editor">    <text term="in" text-case="capitalize-first" suffix=": "/>    <names variable="editor">      <name sort-separator=" " initialize-with="" name-as-sort-order="all" delimiter=", " delimiter-precedes-last="always"/>      <label form="short" strip-periods="true" prefix=" (" suffix=")"/>    </names>  </macro>  <macro name="edition">    <choose>      <if is-numeric="edition">        <group delimiter=" ">          <number variable="edition" form="ordinal"/>          <text term="edition" form="short" strip-periods="true"/>        </group>      </if>      <else>        <text variable="edition"/>      </else>    </choose>  </macro>  <macro name="year">    <date variable="issued">      <date-part name="year"/>    </date>  </macro>  <macro name="title">    <choose>      <if type="book">        <group delimiter=", " suffix=". ">          <text variable="title"/>          <text macro="edition"/>        </group>      </if>      <else>        <text variable="title" suffix=". "/>      </else>    </choose>  </macro>  <macro name="year-parenth">    <date prefix="(" suffix=")" variable="issued">      <date-part name="year"/>    </date>  </macro>  <citation et-al-min="3" et-al-use-first="1" disambiguate-add-year-suffix="true">    <sort>      <key macro="author"/>      <key variable="issued" sort="descending"/>    </sort>    <layout prefix="(" suffix=")" delimiter="; ">      <group delimiter=" ">        <text macro="author-short"/>        <text macro="year"/>      </group>    </layout>  </citation>  <bibliography et-al-min="5" et-al-use-first="3" hanging-indent="true">    <sort>      <key macro="author"/>      <key variable="author" sort="ascending"/>    </sort>    <layout>      <group delimiter=" ">        <text macro="author"/>        <text macro="year-parenth"/>        <text macro="title"/>      </group>      <choose>        <if variable="page">          <choose>            <!--    Book chapter		 Brown B, Aaron M (2001) The politics of nature.		 In: Smith J (ed) The rise of modern genomics, 3rd edn.		 Wiley, New York, pp 230-257 -->            <if type="chapter paper-conference" match="any">              <text macro="editor"/>              <group prefix=" " delimiter=", " suffix=". ">                <text variable="container-title" form="short"/>                <text macro="edition"/>              </group>              <text variable="publisher" suffix=", "/>              <text variable="publisher-place" suffix=", "/>              <group delimiter=" ">                <label variable="page" form="short" strip-periods="true"/>                <text variable="page"/>              </group>            </if>            <else>              <!--    Journal article		   Gamelin FX, Baquet G, Berthoin S, Thevenet D, Nourry C, Nottin S, Bosquet L (2009)		   Effect of high intensity intermittent training on heart rate variability in prepubescent children.		   Eur J Appl Physiol 105:731-738. doi: 10.1007/s00421-008-0955-8		   Ideally, the names of all authors should be provided, but the usage of "et al"		   in long author lists will also be accepted:		   Smith J, Jones M Jr, Houghton L et al (1999)		   Future of health insurance. N Engl J Med 965:325-329   -->              <group delimiter="">                <text variable="container-title" suffix=" " form="short" strip-periods="true"/>                <text variable="volume" suffix=":"/>                <text variable="page" suffix="."/>                <text prefix=" doi: " variable="DOI"/>              </group>            </else>          </choose>        </if>        <else-if variable="DOI">          <!--    Article by DOI	       Slifka MK, Whitton JL (2000) Clinical implications of dysregulated cytokine production.	       J Mol Med. doi:10.1007/s001090000086     -->          <group delimiter=". ">            <text variable="container-title" form="short" strip-periods="true"/>            <text prefix="doi: " variable="DOI"/>          </group>        </else-if>        <else-if type="bill book graphic legal_case motion_picture report song" match="any">          <!--    Book	       South J, Blass B (2001) The future of modern genomics. Blackwell, London    -->          <group delimiter=", ">            <text variable="publisher"/>            <text variable="publisher-place"/>          </group>        </else-if>        <else-if type="webpage">          <!--    Online document	       Doe J (1999) Title of subordinate document. In: The dictionary of substances and their effects.	       Royal Society of Chemistry. Available via DIALOG.	       http://www.rsc.org/dose/title of subordinate document. Accessed 15 Jan 1999	       Unfortunately, "Royal Society of Chemistry. Available via DIALOG." cannot seem to be mapped here -->          <group delimiter="">            <text prefix="In: " variable="container-title" suffix=". " form="short"/>            <text variable="URL" suffix=". "/>            <date variable="accessed">              <date-part prefix="Accessed " name="day" suffix=" "/>              <date-part name="month" form="short" suffix=" " strip-periods="true"/>              <date-part name="year"/>            </date>          </group>        </else-if>        <else-if type="thesis">          <!--    Dissertation	       Trent JW (1975) Experimental acute renal failure. Dissertation, University of California       -->          <group delimiter=", ">            <text variable="genre"/>            <text variable="publisher"/>          </group>        </else-if>        <else>          <!--    None of the provided formats need to add manually (some data provided) -->          <group delimiter="">            <text variable="container-title" form="short" suffix=" "/>            <text variable="volume" suffix=":"/>            <text variable="page" suffix="."/>          </group>        </else>      </choose>    </layout>  </bibliography></style>',"iso690-author-date-en":'<style xmlns="http://purl.org/net/xbiblio/csl" class="in-text" version="1.0" demote-non-dropping-particle="never" default-locale="en-US">  <info>    <title>ISO-690 (author-date, English)</title>    <id>http://www.zotero.org/styles/iso690-author-date-en</id>    <link href="http://www.zotero.org/styles/iso690-author-date-en" rel="self"/>    <author>      <name>Laure Mellifluo</name>      <email>laure.mellifluo@hesge.ch</email>    </author>    <author>      <name>Raphael Grolimund</name>      <email>raphael.grolimund@epfl.ch</email>    </author>    <author>      <name>Michel Hardegger</name>      <email>michel.hardegger@hesge.ch</email>    </author>    <category citation-format="author-date"/>    <category field="generic-base"/>    <updated>2011-11-01T13:00:00+01:00</updated>    <summary>Style based on ISO 690:2010(E), V1</summary>    <rights>This work is licensed under a Creative Commons Attribution-ShareAlike 3.0 License: http://creativecommons.org/licenses/by-sa/3.0/</rights>  </info>  <locale>    <terms>      <term name="anonymous">Anon.</term>      <term name="no date">[no date]</term>      <term name="in">in</term>      <term name="online">online</term>      <term name="accessed">accessed</term>      <term name="retrieved">Available</term>      <term name="from">from</term>      <term name="page" form="short">        <single>p.</single>        <multiple>pp.</multiple>      </term>    </terms>  </locale>  <macro name="author">    <names variable="author">      <name and="text" name-as-sort-order="all" sort-separator=", " delimiter=", " delimiter-precedes-last="never">        <name-part name="family" text-case="uppercase"/>        <name-part name="given"/>      </name>    </names>  </macro>  <macro name="editor">    <names variable="editor">      <name and="text" name-as-sort-order="all" sort-separator=", " delimiter=", " delimiter-precedes-last="never">        <name-part name="family" text-case="uppercase"/>        <name-part name="given"/>      </name>      <label prefix=" (" form="short" suffix=".)"/>    </names>  </macro>  <macro name="translator">    <names variable="translator">      <name and="text" name-as-sort-order="all" sort-separator=", " delimiter=", " delimiter-precedes-last="never">        <name-part name="family" text-case="uppercase"/>        <name-part name="given"/>      </name>      <label prefix=" (" form="short" suffix=".)"/>    </names>  </macro>  <macro name="responsability">    <choose>      <if variable="author editor translator" match="any">        <choose>          <if variable="author">            <text macro="author"/>          </if>          <else-if variable="editor">            <text macro="editor"/>          </else-if>          <else>            <text macro="translator"/>          </else>        </choose>      </if>      <else>        <text term="anonymous" text-case="uppercase"/>      </else>    </choose>  </macro>  <macro name="author-citation">    <choose>      <if variable="author editor translator" match="any">        <names variable="author">          <name form="short"/>          <substitute>            <names variable="editor"/>            <names variable="translator"/>          </substitute>        </names>      </if>      <else>        <text term="anonymous" text-case="uppercase"/>      </else>    </choose>  </macro>  <macro name="container-author">    <names variable="container-author">      <name and="text" name-as-sort-order="all" sort-separator=", " delimiter=", " delimiter-precedes-last="never">        <name-part name="family" text-case="uppercase"/>        <name-part name="given"/>      </name>    </names>  </macro>  <macro name="container-responsability">    <choose>      <if variable="container-author editor translator" match="any">        <choose>          <if variable="container-author">            <text macro="container-author"/>          </if>          <else-if variable="editor">            <text macro="editor"/>          </else-if>          <else>            <text macro="translator"/>          </else>        </choose>      </if>      <else>        <text term="anonymous" text-case="uppercase"/>      </else>    </choose>  </macro>  <macro name="year-date">    <choose>      <if variable="issued">        <date variable="issued">          <date-part name="year" form="long" suffix=""/>        </date>      </if>      <else>        <text term="no date"/>      </else>    </choose>  </macro>  <macro name="title">    <choose>      <if type="book thesis map motion_picture song manuscript" match="any">        <text variable="title" font-style="italic"/>      </if>      <else-if type="paper-conference speech chapter article-journal article-magazine article-newspaper post-weblog post webpage broadcast" match="any">        <text variable="title" suffix=". "/>        <text term="in" text-case="capitalize-first" suffix=": "/>        <choose>          <if variable="container-author editor translator" match="any">            <text macro="container-responsability"/>            <choose>              <if variable="container-title event" match="any">                <text value=", "/>              </if>            </choose>          </if>        </choose>        <choose>          <if variable="container-title">            <text variable="container-title" font-style="italic"/>          </if>          <else>            <text variable="event" font-style="italic"/>          </else>        </choose>      </else-if>      <else-if type="report">        <text variable="number" suffix=": "/>        <text variable="title" font-style="italic"/>      </else-if>      <else-if type="patent">        <text variable="title"/>      </else-if>      <else>        <text variable="title" font-style="italic"/>      </else>    </choose>    <choose>      <if variable="URL">        <text term="online" prefix=" [" suffix="]"/>      </if>    </choose>  </macro>  <macro name="number">    <text variable="number"/>  </macro>  <macro name="medium">    <text variable="medium"/>  </macro>  <macro name="genre">    <choose>      <if type="map">        <choose>          <if variable="genre">            <text variable="genre" prefix="[" suffix="]"/>          </if>          <else>            <text value="map" prefix="[" suffix="]"/>          </else>        </choose>      </if>      <else>        <text variable="genre"/>      </else>    </choose>  </macro>  <macro name="date">    <choose>      <if variable="issued">        <date variable="issued">          <date-part name="day" suffix=" "/>          <date-part name="month" suffix=" "/>          <date-part name="year"/>        </date>      </if>    </choose>  </macro>  <macro name="edition">    <text variable="edition" form="long"/>  </macro>  <macro name="publisher-place">    <choose>      <if type="patent manuscript article-newspaper broadcast motion_picture song" match="any">        <choose>          <if variable="publisher-place">            <text variable="publisher-place"/>          </if>        </choose>      </if>      <else>        <choose>          <if variable="publisher-place">            <text variable="publisher-place"/>          </if>          <else>            <text value="s.l." text-case="capitalize-first"/>          </else>        </choose>      </else>    </choose>  </macro>  <macro name="issue">    <group delimiter=", ">      <text variable="volume" prefix="Vol. "/>      <text variable="issue" prefix="no. "/>      <text variable="page" prefix="pp. "/>    </group>  </macro>  <macro name="publisher">    <choose>      <if type="broadcast motion_picture song report" match="any">        <choose>          <if variable="publisher">            <text variable="publisher"/>          </if>        </choose>      </if>      <else>        <choose>          <if variable="publisher">            <text variable="publisher"/>          </if>          <else>            <text value="s.n."/>          </else>        </choose>      </else>    </choose>  </macro>  <macro name="accessed">    <choose>      <if variable="URL">        <group prefix=" [" suffix="]">          <text term="accessed" text-case="capitalize-first"/>          <date variable="accessed">            <date-part name="day" prefix=" "/>            <date-part name="month" prefix=" "/>            <date-part name="year" prefix=" "/>          </date>        </group>      </if>    </choose>  </macro>  <macro name="collection">    <group delimiter=", ">      <text variable="collection-title"/>      <text variable="collection-number"/>    </group>  </macro>  <macro name="page">    <choose>      <if type="book thesis manuscript" match="any">        <text variable="number-of-pages" suffix=" p"/>      </if>      <else-if type="chapter paper-conference article-newspaper" match="any">        <text variable="page" prefix="pp. "/>      </else-if>      <else-if type="report patent" match="any">        <text variable="page" suffix=" p"/>      </else-if>    </choose>  </macro>  <macro name="isbn">    <text variable="ISBN" prefix="ISBN "/>  </macro>  <macro name="doi">    <text variable="DOI" prefix="DOI "/>  </macro>  <macro name="url">    <choose>      <if variable="URL">        <group>          <text term="retrieved" suffix=" " text-case="capitalize-first"/>          <text term="from" suffix=": "/>          <text variable="URL"/>        </group>      </if>    </choose>  </macro>  <macro name="archive">    <text variable="archive"/>    <choose>      <if variable="archive_location">        <text value=": "/>      </if>    </choose>  </macro>  <macro name="archive_location">    <choose>      <if variable="archive_location">        <text variable="archive_location"/>      </if>      <else>        <text variable="call-number"/>      </else>    </choose>  </macro>  <macro name="abstract">    <text variable="abstract"/>  </macro>  <macro name="note">    <text variable="note"/>  </macro>  <citation disambiguate-add-year-suffix="true" disambiguate-add-names="true" disambiguate-add-givenname="true" collapse="year" year-suffix-delimiter=", " after-collapse-delimiter="; ">    <layout prefix="(" suffix=")" delimiter="; ">      <group delimiter=", ">        <group delimiter=" ">          <text macro="author-citation"/>          <text macro="year-date"/>        </group>        <text variable="locator"/>      </group>    </layout>  </citation>  <bibliography>    <sort>      <key macro="responsability"/>      <key macro="year-date"/>      <key macro="title"/>    </sort>    <layout>      <choose>        <if type="book map" match="any">          <group display="block">            <text macro="responsability" suffix=", "/>            <text macro="year-date" suffix=". "/>            <text macro="title" suffix=". "/>            <text macro="genre" suffix=". "/>            <text macro="edition" suffix=". "/>            <text macro="publisher-place" suffix=": "/>            <text macro="publisher" suffix=". "/>            <text macro="accessed" suffix=". "/>            <text macro="collection" suffix=". "/>            <text macro="isbn" suffix=". "/>            <text macro="url" suffix=". "/>          </group>        </if>        <else-if type="article-journal article-magazine" match="any">          <group display="block">            <text macro="responsability" suffix=", "/>            <text macro="year-date" suffix=". "/>            <text macro="title" suffix=". "/>            <text macro="edition" suffix=". "/>            <text macro="date" suffix=". "/>            <text macro="issue" suffix=". "/>            <text macro="accessed" suffix=". "/>            <text macro="doi" suffix=". "/>            <text macro="url" suffix=". "/>          </group>        </else-if>        <else-if type="article-newspaper">          <group display="block">            <text macro="responsability" suffix=", "/>            <text macro="year-date" suffix=". "/>            <text macro="title" suffix=". "/>            <text macro="edition" suffix=". "/>            <text macro="publisher-place" suffix=", "/>            <text macro="date" suffix=". "/>            <text macro="page" suffix=". "/>            <text macro="accessed" suffix=". "/>            <text macro="url" suffix=". "/>          </group>        </else-if>        <else-if type="chapter entry entry-dictionary entry-encyclopedia" match="any">          <group display="block">            <text macro="responsability" suffix=", "/>            <text macro="year-date" suffix=". "/>            <text macro="title" font-style="normal" suffix=". "/>            <text macro="edition" suffix=". "/>            <text macro="publisher-place" suffix=": "/>            <text macro="publisher" suffix=". "/>            <text macro="collection" suffix=". "/>            <text macro="page" suffix=". "/>            <text macro="accessed" suffix=". "/>            <text macro="isbn" suffix=". "/>            <text macro="url" suffix=". "/>          </group>        </else-if>        <else-if type="speech">          <group display="block">            <text macro="responsability" suffix=", "/>            <text macro="year-date" suffix=". "/>            <text macro="title" suffix=". "/>            <text macro="genre" suffix=". "/>            <text macro="publisher-place" suffix=". "/>            <text macro="date" suffix=". "/>            <text macro="accessed" suffix=". "/>            <text macro="page" suffix=". "/>            <text macro="url" suffix=". "/>          </group>        </else-if>        <else-if type="paper-conference">          <group display="block">            <text macro="responsability" suffix=", "/>            <text macro="year-date" suffix=". "/>            <text macro="title" suffix=". "/>            <text macro="genre" suffix=". "/>            <text macro="publisher-place" suffix=": "/>            <text macro="publisher" suffix=". "/>            <text macro="date" suffix=". "/>            <text macro="page" suffix=". "/>            <text macro="accessed" suffix=". "/>            <text macro="url" suffix=". "/>          </group>        </else-if>        <else-if type="thesis">          <group display="block">            <text macro="responsability" suffix=", "/>            <text macro="year-date" suffix=". "/>            <text macro="title" suffix=". "/>            <text macro="genre" suffix=". "/>            <text macro="publisher-place" suffix=": "/>            <text macro="publisher" suffix=". "/>            <text macro="accessed" suffix=". "/>            <text macro="url" suffix=". "/>          </group>        </else-if>        <else-if type="post-weblog post webpage" match="any">          <group display="block">            <text macro="responsability" suffix=", "/>            <text macro="year-date" suffix=". "/>            <text macro="title" suffix=". "/>            <text macro="date" suffix=". "/>            <text macro="accessed" suffix=". "/>            <text macro="url" suffix=". "/>          </group>        </else-if>        <else-if type="broadcast motion_picture song" match="any">          <group display="block">            <text macro="responsability" suffix=", "/>            <text macro="year-date" suffix=". "/>            <text macro="title" suffix=". "/>            <text macro="medium" suffix=". "/>            <text macro="publisher-place" suffix=": "/>            <text macro="publisher" suffix=". "/>            <text macro="date" suffix=". "/>            <text macro="accessed" suffix=". "/>            <text macro="collection" suffix=". "/>            <text macro="isbn" suffix=". "/>            <text macro="url" suffix=". "/>          </group>        </else-if>        <else-if type="report">          <group display="block">            <text macro="responsability" suffix=", "/>            <text macro="year-date" suffix=". "/>            <text macro="title" suffix=". "/>            <text macro="genre" suffix=". "/>            <text macro="edition" suffix=". "/>            <text macro="publisher-place" suffix=". "/>            <text macro="publisher" suffix=". "/>            <text macro="accessed" suffix=". "/>            <text macro="collection" suffix=". "/>            <text macro="url" suffix=". "/>          </group>        </else-if>        <else-if type="manuscript">          <group display="block">            <text macro="responsability" suffix=", "/>            <text macro="year-date" suffix=". "/>            <text macro="title" suffix=". "/>            <text macro="genre" suffix=". "/>            <text macro="edition" suffix=". "/>            <text macro="publisher-place" suffix=". "/>            <text macro="accessed" suffix=". "/>            <text macro="collection" suffix=". "/>            <text macro="url" suffix=". "/>          </group>        </else-if>        <else-if type="patent">          <group display="block">            <text macro="responsability" suffix=", "/>            <text macro="year-date" suffix=". "/>            <text macro="title" suffix=". "/>            <text macro="number" suffix=". "/>            <text macro="date" suffix=". "/>            <text macro="publisher-place" suffix=". "/>            <text macro="accessed" suffix=". "/>            <text macro="collection" suffix=". "/>            <text macro="url" suffix=". "/>          </group>        </else-if>        <else>          <group display="block">            <text macro="responsability" suffix=", "/>            <text macro="year-date" suffix=". "/>            <text macro="title" suffix=". "/>            <text macro="medium" suffix=". "/>            <text macro="genre" suffix=". "/>            <text macro="date" suffix=". "/>            <text macro="edition" suffix=". "/>            <text macro="publisher-place" suffix=": "/>            <text macro="publisher" suffix=". "/>            <text macro="accessed" suffix=". "/>            <text macro="collection" suffix=". "/>            <text macro="page" suffix=". "/>            <text macro="isbn" suffix=". "/>            <text macro="url" suffix=". "/>          </group>        </else>      </choose>      <group display="block">        <group display="block">          <text macro="archive"/>          <text macro="archive_location"/>        </group>      </group>      <group display="block">        <text macro="abstract" display="block"/>      </group>      <group display="block">        <text macro="note" display="block"/>      </group>    </layout>  </bibliography></style>'};
return t}),function(t){"object"==typeof exports?module.exports=t(require("underscore"),require("backbone"),require("citeproc"),require("citeproc/sys")):"function"==typeof define&&define.amd?define("models/metadata/citation",["underscore","backbone","citeproc/citeproc","citeproc/sys","citeproc/csl","writedown","models/metadata/object"],t):"undefined"!=typeof _&&"undefined"!=typeof Backbone&&"undefined"!=typeof CSL&&"undefined"!=typeof Sys&&"undefined"!=typeof MetadataObject&&(window.MetadataCitation=t(_,Backbone,CSL,Sys,citationstyles,Writedown,MetadataObject))}(function(t,e,i,s,r,a,n){var o=n.extend({defaults:{original:{}},initialize:function(e,n,o){var l,u,p,h;e||(e=this.defaults.citation),n||(n=""),o||(o=""),"object"==typeof e&&e instanceof Array&&(e=e[0]),this.attributes.original=e,this.attributes.original.author=n,this.attributes.original.title=o,h=t.clone(this.attributes.original,!0),h.id="citation","year"in this.attributes.original?(h.issued={},h.issued.year=this.attributes.original.year,"month"in this.attributes.original&&(h.issued.month=this.attributes.original.month,"day"in this.attributes.original&&(h.issued.day=this.attributes.original.day))):"date"in this.attributes.original&&(h.issued={"date-parts":t.map(this.attributes.original.date.split("-"),function(t){return parseInt(t)})}),h.title=a.html(h.title),"pages"in this.attributes.original&&(h.page=this.attributes.original.pages),u=new s({"default":{}},{citation:h}),l=new i.Engine(u,r["modern-language-association"]),l.setAbbreviations("default"),l.updateItems(["citation"]),p=l.makeBibliography(),this.attributes.string=p&&p.length&&p[1].length?p[1].join(""):"Error Processing Citation"}});return o}),function(t){"object"==typeof exports?module.exports=t(require("underscore"),require("backbone"),require("models/metadata/author"),require("models/metadata/title"),require("models/metadata/citation")):"function"==typeof define&&define.amd?define("models/metadata",["underscore","backbone","jsyaml","models/metadata/author","models/metadata/title","models/metadata/citation"],t):"undefined"!=typeof _&&"undefined"!=typeof Backbone&&"undefined"!=typeof jsyaml&&"undefined"!=typeof MetadataAuthor&&"undefined"!=typeof MetadataTitle&&"undefined"!=typeof MetadataCitation&&(window.Metadata=t(_,Backbone,jsyaml,MetadataAuthor,MetadataTitle,MetadataCitation))}(function(t,e,i,s,r,a){var n=e.Model.extend({defaults:{metadata:{}},initialize:function(t){t||(t={}),this.updateMetadata(t)},updateMetadata:function(t){"string"==typeof t&&(t=i.safeLoad(t)),"undefined"==typeof t&&(t={}),"title"in t&&(t.title=new r(t.title)),"author"in t&&(t.author=new s(t.author)),"citation"in t&&(t.citation=new a(t.citation,t.author.raw(),t.title.raw())),this.attributes.metadata=t},toYaml:function(){var e=this.get("metadata"),s={};return t.each(t.keys(e),function(t){var i=e[t];s[t]="undefined"!=typeof i.raw?i.raw():i}),i.safeDump(s)},to_s:function(){var t=this.get("metadata"),e="";return"citation"in t?e=t.citation.to_s().replace(/\&\#60\;(\/{0,1})(em|strong|b|i|img|blockquote|a)(.*?)\&\#62\;/g,"<$1$2$3>"):"title"in t&&"author"in t&&(e=t.title.to_s()+" by "+t.author.to_s()),e},get:function(t){var e=this.attributes[t];return t in this.attributes.metadata&&(e=this.attributes.metadata[t]),e}});return n}),define("models/document",["lodash","backbone","lorem","models/metadata"],function(t,e,i,s){var r=e.Model.extend({urlRoot:"/document",idAttribute:"id",defaults:{metadata:""},get:function(t){var e=this.attributes[t];if("metadata"==t&&("metadata_json"in this.attributes?e=this.attributes.metadata_json:(e=new s(e),this.attributes.metadata_json=e,this.trigger("change change:metadata"))),"text"==t){var r=new i;r.type=i.TEXT,r.query="4-6p",e=r.createLorem()}return e},set:function(t,i,r){var a;return null==t?this:("object"==typeof t?(a=t,r=i):(a={})[t]=i,"metadata"in a&&(i=a.metadata,"metadata_json"in this.attributes||(this.attributes.metadata_json=new s),this.attributes.metadata_json.updateMetadata(i),this.attributes.metadata=this.attributes.metadata_json.toYaml(),delete a.metadata,this.trigger("change change:metadata")),e.Model.prototype.set.call(this,a,r))},save:function(i,s){return s||(s={}),i||(i=t.clone(this.attributes)),delete i.metadata_json,s.data=JSON.stringify(i),e.Model.prototype.save.apply(this,i,s)},initialize:function(){}});return r}),function(t){"object"==typeof exports?module.exports=t(require("backbone"),require("models/document")):"function"==typeof define&&define.amd?define("collections/document_collection",["backbone","models/document"],t):"undefined"!=typeof Backbone&&"undefined"!=typeof Document&&(window.DocumentCollection=t(Backbone,Document))}(function(t,e){var i=t.Collection.extend({url:"/document",model:e,initialize:function(){this.listenTo(this,"update",function(){this.trigger("reset")})}});return i}),define("components/sidebar/sidebar",["lodash","react","mixins/publish-component-mount/PublishComponentMountMixin"],function(t,e,i){var s=e.createClass({displayName:"Sidebar",mixins:[e.addons.PureRenderMixin,i],routes:["documents","anthologies"],getDefaultProps:function(){return{cols:5,affix:!0,route:null}},renderSidebar:function(){return t.includes(this.routes,this.props.route)&&require(["react","components/sidebar/routes/"+this.props.route],t.bind(function(t,e){t.render(t.createElement(e,this),$(".sidebar-body .sidebar-mountpoint").get(0))},this.props)),e.createElement("div",{className:"sidebar-mountpoint"})},render:function(){return e.createElement("aside",{className:"sidebar","data-affix":this.props.affix},e.createElement("div",{className:"sidebar-body"},this.renderSidebar()))}});return s}),define("components/document/short_view",["lodash","react"],function(t,e){var i=e.createClass({displayName:"DocumentShortView",render:function(){return e.createElement("li",null,e.createElement("a",{href:"#/document/"+this.props.model.id,dangerouslySetInnerHTML:{__html:this.props.model.get("metadata").to_s()}}))}});return i}),define("components/document/documents",["lodash","react","mixins/publish-component-mount/PublishComponentMountMixin","components/sidebar/sidebar","components/document/short_view"],function(t,e,i,s,r){var a=e.createClass({displayName:"Documents",mixins:[i],getPropDefaults:function(){return{collection:[]}},render:function(){return e.createElement("div",{className:"row"},e.createElement("h1",null,"List of Available Documents ",e.createElement("span",{className:"subtitle"})),e.createElement(n,{collection:this.props.collection}),e.createElement(s,{attach:!0,route:"documents"}))}}),n=e.createClass({displayName:"DocumentList",createChildren:function(){return t.map(this.props.collection.models,function(t){return e.createElement(r,{model:t,key:JSON.stringify(t)})})},render:function(){return e.createElement("ul",{id:"DocumentsView"},this.createChildren())}});return a}),define("routes/documents",["jquery","lodash","collections/document_collection","components/document/documents","postal","react"],function(t,e,i,s,r,a){var n=function(n){var o=!1,l={};l.route=r.channel("route"),e.has(n,"documentList")||(o=!0,n.documentList=new i),o?n.documentList.fetch().then(function(){a.render(a.createElement(s,{collection:n.documentList}),t("#app").get(0)),l.route.publish("ready")}):(a.render(a.createElement(s,{collection:n.documentList}),t("#app").get(0)),l.route.publish("ready"))};return n}),define("components/sidebar/routes/documents",["lodash","jquery","react","postal","mixins/login-dependent/LoginDependentMixin","postal.request-response"],function(t,e,i,s,r){var a=i.createClass({displayName:"SidebarDocuments",mixins:[i.addons.PureRenderMixin,r],getInitialState:function(){return"object"!=typeof this.channel&&(this.channel={}),this.channel.component=s.channel("component"),null},render:function(){var t;return t=this.state.loginStatus?i.createElement("p",null,"Logged In"):i.createElement("p",null,"Foobar")}});return a});
